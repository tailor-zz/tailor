Ext.ns("divo");Ext.ns("divo.data");Ext.ns("divo.form");Ext.ns("divo.grid");Ext.ns("divo.layout");Ext.ns("divo.panel");Ext.ns("divo.menu");Ext.ns("divo.utils");Ext.ns("divo.tree");Ext.ns("divo.misc");Ext.ns("divo.window");Ext.ns("Ext.ux");Ext.apply(divo,{save:function(b,e){divo.setCookie(b,e)},find:function(b){return divo.getCookie(b)},remove:function(b,e){divo.delCookie(b,e)},setCookie:function(b,f){var e=365*10;var g=new Date();g.setTime(g.getTime()+e*24*60*60*1000);document.cookie=b+"="+escape(f)+";expires="+g.toGMTString()},getCookie:function(e){var b=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));if(b!=null){return unescape(b[2])}return null},delCookie:function(b,e){var g=new Date();g.setTime(g.getTime()-10000);var f=divo.getCookie(b);if(!f){return}if(!e){document.cookie=b+"="+f+";expires="+g.toGMTString()}else{document.cookie=b+"="+f+";expires="+g.toGMTString()+";domain="+e}}});divo.AppContext=function(b){Ext.apply(this,b);divo.AppContext.superclass.constructor.call(this)};Ext.extend(divo.AppContext,Ext.util.Observable,{version:null,user:null,funcPermissions:[],globalPermissions:[],isDebug:false,baseUrl:"/media/",homeUrl:null,productName:null,copyRight:null,toDay:null,firstLogin:false,deptId:null,deptName:"",init:function(){this.homeUrl=window.location.href;this.loadAppContext();this.loadPermissions()},isAdmin:function(b){if(b!==undefined){return b===1}return false},getDayMonthYearFormat:function(){return"Y.m.d"},getDatetimeFormat:function(){return"Y.m.d h:i a"},hasAppInstalled:function(e){if(!this.apps){return false}for(var b=0;b<this.apps.length;b++){if(this.apps[b].indexOf(e)>=0){return true}}return false},loadAppContext:function(){Ext.Ajax.request({scope:this,url:"/appcontext",async:false,method:"GET",success:function(b,e){var f=Ext.decode(b.responseText);this.user={id:f.userId,name:f.userName,fullName:f.userFullName,email:f.email};this.isDebug=f.isDebug;this.apps=f.apps;this.version=f.version;this.productName=f.productName;this.copyRight=f.copyRight;this.toDay=f.toDay;this.firstLogin=f.firstLogin;this.deptId=f.deptId;this.deptName=f.deptName},failure:function(b,e){top.window.location.href="/"}})},loadPermissions:function(){Ext.Ajax.request({scope:this,url:"/users/"+this.user.id+"/permissions/functional",async:false,method:"GET",success:function(b,e){var f=Ext.decode(b.responseText);this.funcPermissions=f.rows},failure:function(b,e){top.window.location.href="/"}});Ext.Ajax.request({scope:this,url:"/users/"+this.user.id+"/permissions/global",async:false,method:"GET",success:function(b,e){var f=Ext.decode(b.responseText);this.globalPermissions=f.rows},failure:function(b,e){top.window.location.href="/"}})}});divo.appContext=new divo.AppContext();Ext.override(Ext.Component,{defaults:{border:false},getAppContext:function(){return divo.appContext},getUserId:function(){return divo.getUserId()},getUserFullName:function(){return divo.getUserFullName()},getDeptId:function(){return divo.getDeptId()},getDeptName:function(){return divo.getDeptName()},myId:function(b){return this.id+"-"+b},subscribe:function(b,f,e){if(!this.pagebusSubs){this.pagebusSubs=[]}this.pagebusSubs.push(divo.subscribe(b,f,e))},unsubscribe:function(){if(!this.pagebusSubs){return}for(var b=0;b<this.pagebusSubs.length;b++){divo.unsubscribe(this.pagebusSubs[b])}},publish:function(b,e){divo.publish(b,e)},alert:function(b){divo.showError(b)},err:function(b){divo.err(b)},say:function(b){divo.say(b)}});Ext.override(Ext.form.BasicForm,{getObjectValues:function(){var vv=this.getValues();this.items.each(function(f){if(f.xtype=="numberfield"){vv[f.name]=parseFloat(vv[f.name]||0)}if(f.xtype=="xcheckbox"){vv[f.name]=eval(vv[f.name])}});return vv},setValues:function(g){if(Ext.isArray(g)){for(var h=0,b=g.length;h<b;h++){var e=g[h];var j=this.findField(e.id);if(j){j.setValue(e.value);if(this.trackResetOnLoad){j.originalValue=j.getValue()}}}}else{var k,m;for(m in g){if(typeof g[m]!="function"&&(k=this.findField(m))){if(k.xtype=="xcheckbox"&&typeof g[m]!="boolean"){k.setValue(g[m]?true:false)}else{k.setValue(g[m])}if(this.trackResetOnLoad){k.originalValue=k.getValue()}}}}return this}});Ext.override(Ext.DataView,{refresh:function(){this.clearSelections(false,true);this.el.update("");var b=this.store.getRange();if(b.length<1){this.el.update(this.emptyText);this.all.clear();return}this.tpl.overwrite(this.el,this.collectData(b,0));this.all.fill(Ext.query(this.itemSelector,this.el.dom));this.updateIndexes(0);this.fireEvent("afterRefresh",this)}});Ext.override(Ext.Window,{cancelAction:"destroy",onCancel:function(){this[this.cancelAction]()},shadow:false,constrainHeader:true});Ext.apply(Ext.PagingToolbar.prototype,{beforePageText:"第",afterPageText:"页共 {0} 页",firstText:"第一页",prevText:"前一页",nextText:"下一页",lastText:"最后页",refreshText:"刷新",displayMsg:"显示{0}-{1}共{2}条",emptyMsg:"共0条"});Ext.apply(Ext.DatePicker.prototype,{todayText:"今天",minText:"日期在最小日期之前",maxText:"日期在最大日期之后",disabledDaysText:"",disabledDatesText:"",monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:"下月 (Control+Right)",prevText:"上月 (Control+Left)",monthYearText:"选择一个月 (Control+Up/Down 来改变年)",todayTip:"{0} (空格键选择)",format:"y年m月d日"});Ext.apply(Ext.grid.GroupingView.prototype,{groupByText:"分组",showGroupsText:"分组有效"});Ext.apply(Ext.grid.GridView.prototype,{sortAscText:"升序",sortDescText:"降序",lockText:"锁列",unlockText:"解锁列",columnsText:"列",emptyText:"没有找到记录"});Ext.apply(Ext.menu.TextItem.prototype,{setText:function(b){this.text=b;if(this.rendered){this.el.update(b);this.parentMenu.autoWidth()}}});Ext.override(Ext.form.ComboBox,{doQuery:function(g,f){if(g===undefined||g===null){g=""}this.queryFilterByValue=g;var e={query:g,forceAll:f,combo:this,cancel:false};if(this.fireEvent("beforequery",e)===false||e.cancel){return false}g=e.query;f=e.forceAll;if(f===true||(g.length>=this.minChars)){if(this.lastQuery!==g){var b=this.lastQuery;this.lastQuery=g;if(this.mode=="local"){this.selectedIndex=-1;if(f){this.store.clearFilter()}else{if(this.searchField){if(typeof this.queryFilterByFunc=="function"){this.store.filterBy(this.queryFilterByFunc.createDelegate(this))}else{this.store.filter(this.searchField,g)}}else{this.store.filter(this.displayField,g)}}this.onLoad()}else{this.store.baseParams[this.queryParam]=g;this.store.load({params:this.getParams(g)});this.expand()}}else{this.selectedIndex=-1;this.onLoad()}}}});Ext.override(Ext.tree.TreeLoader,{processResponse:function(response,node,callback){var json=response.responseText;try{var o=eval("("+json+")");node.beginUpdate();for(var i=0,len=o.length;i<len;i++){if(this.nodeConfigFn){var n=this.createNode(this.nodeConfigFn(o[i]))}else{var n=this.createNode(o[i])}if(n){node.appendChild(n)}}node.endUpdate();if(typeof callback=="function"){callback(this,node)}}catch(e){this.handleFailure(response)}}});Ext.override(Ext.layout.FormLayout,{renderItem:function(g,b,f){if(g&&!g.rendered&&g.isFormField&&g.inputType!="hidden"){var e=[g.id,g.fieldLabel,g.labelStyle||this.labelStyle||"",this.elementStyle||"",typeof g.labelSeparator=="undefined"?this.labelSeparator:g.labelSeparator,(g.itemCls||this.container.itemCls||"")+(g.hideLabel?" x-hide-label":""),g.clearCls||"x-form-clear-left"];if(typeof b=="number"){b=f.dom.childNodes[b]||null}g.actionMode="formItem";if(b){g.formItem=Ext.get(this.fieldTpl.insertBefore(b,e))}else{g.formItem=Ext.get(this.fieldTpl.append(f,e))}g.render("x-form-el-"+g.id)}else{Ext.layout.FormLayout.superclass.renderItem.apply(this,arguments)}}});Ext.override(Ext.FormPanel,{startMonitoring:function(){if(!this.bound){this.bound=true;if(!this.monitorTask){this.monitorTask=Ext.TaskMgr.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this})}}},stopMonitoring:function(){this.bound=false;if(this.monitorTask){Ext.TaskMgr.stop(this.monitorTask);this.monitorTask=null}}});Ext.override(Ext.form.RadioGroup,{getName:function(){return this.items.first().getName()},getValue:function(){var b;this.items.each(function(e){b=e.getRawValue();return !e.getValue()});return b},setValue:function(b){this.items.each(function(e){e.setValue(e.getRawValue()==b)})}});Ext.override(Ext.form.TextField,{validateValue:function(b){if(b.getHzLength()<1||b===this.emptyText){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(b.getHzLength()<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(b.getHzLength()>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}if(this.vtype){var f=Ext.form.VTypes;if(!f[this.vtype](b,this)){this.markInvalid(this.vtypeText||f[this.vtype+"Text"]);return false}}if(typeof this.validator=="function"){var e=this.validator(b);if(e!==true){this.markInvalid(e);return false}}if(this.regex&&!this.regex.test(b)){this.markInvalid(this.regexText);return false}return true}});Ext.override(Ext.TabPanel,{setActiveTab:function(f){f=this.getComponent(f);if(!f||this.fireEvent("beforetabchange",this,f,this.activeTab)===false){return}if(!this.rendered){this.activeTab=f;return}if(this.activeTab!=f){if(this.activeTab){var b=this.getTabEl(this.activeTab);if(b){Ext.fly(b).removeClass("x-tab-strip-active")}this.activeTab.fireEvent("deactivate",this.activeTab)}var e=this.getTabEl(f);Ext.fly(e).addClass("x-tab-strip-active");this.activeTab=f;this.stack.add(f);this.layout.setActiveItem(f);if(this.layoutOnTabChange&&f.doLayout){f.doLayout()}if(this.scrolling){this.scrollToTab(f,this.animScroll)}Ext.fly(e)["frame"].apply(Ext.fly(e),[]);f.fireEvent("activate",f);this.fireEvent("tabchange",this,f)}}});Ext.override(Ext.grid.GridView,{getCells:function(b){return this.fly(this.getRow(b)).query(this.cellSelector)},getCellAttributes:function(e){var b={};if(!(e&&Ext.isString(e))){return b}Ext.each(e.match(/[\w:]+=(?:'.*?'|".*?")/g),function(g){var f=g.split("=");b[f[0]]=f[1].substring(1,f[1].length-1)});return b},refreshRow:function(h){var f=this.ds,m;if(typeof h=="number"){m=h;h=f.getAt(m)}else{m=f.indexOf(h)}if(!h||m<0){return}var j=this.getColumnData(),n=j.length-1,q=this.getCells(m),g=["x-grid3-cell-first","x-grid3-cell-last","x-grid3-dirty-cell"],b,o,k,e;Ext.each(j,function(u,t){b={id:u.id,style:u.style,attr:"",cellAttr:""};k=h.modified;o=(k&&k[u.name]!=undefined?["x-grid3-dirty-cell"]:[]).concat(t===0?["x-grid3-cell-first"]:t===n?["x-grid3-cell-last"]:[]);e=u.renderer(h.data[u.name],b,h,m,t,f);e=Ext.isEmpty(e)?" ":e;Ext.fly(q[t]).removeClass(g).addClass(o).child(".x-grid3-cell-inner").set(this.getCellAttributes(b.attr)).dom.innerHTML=e},this);this.fireEvent("rowupdated",this,m,h)}});Ext.override(Ext.form.NumberField,{selectOnFocus:true});Ext.apply(Ext.TabPanel.prototype,{hideTabStrip:function(){if(this.tabPosition==="top"){Ext.getDom(this.header.id).style.display="none"}else{Ext.getDom(this.footer.id).style.display="none"}},showTabStrip:function(){if(this.tabPosition==="top"){Ext.getDom(this.header.id).style.display=""}else{Ext.getDom(this.footer.id).style.display=""}}});Ext.BLANK_IMAGE_URL="/media/js/ext/resources/images/default/s.gif";Ext.QuickTips.init();Ext.apply(Ext.QuickTips.getQuickTip(),{showDelay:250,hideDelay:300,dismissDelay:0});Ext.form.Field.prototype.msgTarget="under";Ext.Ajax.defaultHeaders={accept:"application/json"};Ext.lib.Ajax.defaultPostHeader="application/json";Ext.Msg.minWidth=200;Ext.TabPanel.prototype.layoutOnTabChange=true;Ext.Ajax.timeout=300000;new Ext.KeyMap(document,{key:Ext.EventObject.ENTER,fn:function(g,q){var t=q.target;if(!t.form||t.type=="textarea"){return}var b,m,n,h;n=t.form.elements;b=n.length;for(m=n.length-1;n[m]!=t;m--){q.preventDefault()}try{t=n[++m];while(!t.type||t.type.toLowerCase()=="hidden"||t.disabled||t.readOnly){t=n[++m]}t.focus()}catch(q){}}});Ext.apply(divo,{AUTH_KEY:"adG9rZW41",TOKEN_KEY:"dG9rZW4",required:'<span style="font-size: 16px;color:red">*</span>',fixIFrame:function(f,e){var b=e.getEl().dom;if(b.src){b.src="javascript:false"}},subscribe:function(b,f,e){return window.PageBus.subscribe(b,e,f,null)},publish:function(b,e){window.PageBus.publish(b,e)},unsubscribe:function(b){window.PageBus.unsubscribe(b)},waitFor:function(g,b,f){var e={run:function(){if(g.call(f||this)){b.call(f||this);return false}},interval:100};if(!(e.run()===false)){if(!e.duration&&!e.repeat){e.repeat=300}Ext.TaskMgr.start(e)}},getUserId:function(){if(divo.appContext.user){return divo.appContext.user.id}return null},getUserFullName:function(){if(divo.appContext.user){return divo.appContext.user.fullName}return null},isAdmin:function(){var b=divo.getUserId();return b&&b==1},getDeptId:function(){if(divo.appContext.user){return divo.appContext.deptId}return null},getDeptName:function(){if(divo.appContext.user){return divo.appContext.deptName}return null},t1:'<tpl for=".">',t2:"</tpl>",hasPermission:function(b){var f=divo.appContext.globalPermissions;for(var e=0;e<f.length;e++){if(f[e].name==b){return true}}return false},isPermitted:function(g,b){var h=divo.appContext.funcPermissions;var f;for(var e=0;e<h.length;e++){if(h[e].item_id==g){f=h[e].permission;break}}return f&&((f&b)==b)},canCreate:function(b){return divo.isPermitted(b,1)},canUpdate:function(b){return divo.isPermitted(b,2)},canDelete:function(b){return divo.isPermitted(b,4)},getMenuItem:function(b){var e=null;Ext.Ajax.request({scope:this,url:"/menus/items/url/"+b,async:false,method:"GET",success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){e=h.data}},failure:function(f,g){this.alert(f.responseText)}});return e},callMenuItem:function(b,f){var e=divo.getMenuItem(b);f.id=e.id;f.name=e.name;this.publish("j.selectMenuItem",f)},toastAlert:function(e){the_title=typeof(e.title)!="undefined"?e.title:"通知";the_icon=typeof(e.iconCls)!="undefined"?e.iconCls:"information";the_autoDestroy=typeof(e.autoDestroy)!="undefined"?e.autoDestroy:false;var h=new Ext.ux.ToastWindow({title:the_title,html:e.message,iconCls:the_icon,autoDestroy:the_autoDestroy,hideDelay:e.hideDelay});h.show(document);if(e.flashTitle){var g=0;var f=document.title;function j(){g++;if(g==3){g=1}if(g==1){document.title=e.t2}if(g==2){document.title=e.t1}}var b={run:function(){j()},scope:this,interval:(1000)};Ext.TaskMgr.start(b);h.on("destroy",function(){Ext.TaskMgr.stop(b);document.title=f},this)}},getGridMeta:function(m,n,g){var k={};if(!n){k.recordDef=Ext.data.Record.create([{name:""}]);k.columnModel=new Ext.grid.ColumnModel([{header:""}]);return k}var b=[],h=[],f=[],j=[];if(g&&m.putFirst){for(var e=0;e<g.length;e++){if(g[e]){h.push(g[e])}}}for(var e=0;e<n.length;e++){j.push({name:n[e].name,header:n[e].header});b.push({name:n[e].name,type:n[e].type?n[e].type:"auto",convert:n[e].convert?n[e].convert:undefined});if(n[e].header){h.push({header:n[e].header,dataIndex:n[e].name,type:n[e].type,align:n[e].align?n[e].align:undefined,renderer:n[e].renderer?n[e].renderer:null,id:n[e].id?n[e].id:undefined,width:n[e].width?n[e].width:undefined,css:n[e].css?n[e].css:undefined,sortable:n[e].sortable==undefined?true:n[e].sortable,editor:n[e].editor==undefined?undefined:n[e].editor,hidden:n[e].hidden==undefined?false:n[e].hidden,summaryType:n[e].summaryType==undefined?undefined:n[e].summaryType,summaryRenderer:n[e].summaryRenderer==undefined?undefined:n[e].summaryRenderer,cellActions:n[e].cellActions==undefined?undefined:n[e].cellActions});if(n[e].searchable){f.push({text:n[e].searchName?n[e].searchName:n[e].header,name:n[e].name})}}}if(g&&!m.putFirst){for(var e=0;e<g.length;e++){if(g[e]){h.push(g[e])}}}k.recordDef=Ext.data.Record.create(b);k.columnModel=new Ext.grid.ColumnModel(h);k.columnModel.defaultSortable=true;k.rs=b;k.cms=h;k.fs=f;k.metas=j;return k},showPopupWindow:function(e,g){var b={width:Ext.getBody().getSize().width-100,height:Ext.getBody().getSize().height-100,resizable:true,draggable:true,closable:true,closeAction:"destroy",hideBorders:true,plain:true,maximizable:true,layout:"fit",autoScroll:false,border:false,bodyBorder:false,frame:true,modal:true,pinned:true,bodyStyle:"background-color: #ffffff;"};Ext.apply(b,e);var f=new Ext.Window(b);f.add(g);f.show();return f},insertAtCurrentPosition:function(h,f){if(document.selection){f.focus();var g=document.selection.createRange();g.text=h}else{if(f.selectionStart||f.selectionStart=="0"){var e=f.selectionStart;var b=f.selectionEnd;f.value=f.value.substring(0,e)+h+f.value.substring(b,f.value.length)}else{f.value+=h}}f.focus()},setInitDateRange:function(o,f,b,j){var m=null;var n=null;if(b!=false){var u;divo.restoreProfile(function(w){u=w},divo.getUserId(),o+".startdate");if(u){m=u.msgValue}divo.restoreProfile(function(w){u=w},divo.getUserId(),o+".enddate");if(u){n=u.msgValue}}var q=new Date();var k=q.getFullYear();var h=q.getMonth()+1;var t=null;if(h<12){t=new Date(k,h,1)}else{t=new Date(k+1,0,1)}var e=new Date(t-86400000);var g=e.getDate();if(g<10){g="0"+g}if(h<10){h="0"+h}if(m){f.getForm().findField("startDate").setValue(m)}else{if(j==true){f.getForm().findField("startDate").setValue(k+".01.01")}else{f.getForm().findField("startDate").setValue(k+"."+h+".01")}}if(n){f.getForm().findField("endDate").setValue(n)}else{f.getForm().findField("endDate").setValue(new Date())}},getLocalNamePyComboDefinition:function(e){var b='<div class="x-combo-list-item"><div style="position: absolute;left: 0;">{name}</div><div style="position: relative;left: 150;">{py}</div></div>';var f={xtype:"combo",fieldLabel:e.fieldLabel,hiddenName:e.hiddenName,store:new Ext.data.SimpleStore({fields:["name","py"],data:e.data}),width:110,displayField:"name",searchField:"py",forceSelection:true,valueField:"name",typeAhead:false,mode:"local",triggerAction:"all",selectOnFocus:false,resizable:true,editable:true,listWidth:200,tpl:divo.t1+b+divo.t2};if(e.itemFld!=undefined){f.items=[e.itemFld]}if(e.listeners!=undefined){f.listeners=e.listeners}if(e.labelWidth!=undefined){f.labelWidth=e.labelWidth}if(e.width!=undefined){f.width=e.width}if(e.value!=undefined){f.value=e.value}if(e.items!=undefined){f.items=e.items}return f},getLocalCodeNamePyComboDefinition:function(e){var b='<div class="x-combo-list-item"><div style="position: absolute;left: 0;">{name}</div><div style="position: relative;left: 150;">{py}</div></div>';var f={xtype:"combo",fieldLabel:e.fieldLabel,id:e.id,hiddenName:e.hiddenName,store:new Ext.data.SimpleStore({fields:["code","name","py"],data:e.data}),width:110,displayField:"name",searchField:"py",forceSelection:true,valueField:"code",typeAhead:false,mode:"local",triggerAction:"all",selectOnFocus:false,resizable:true,editable:true,listWidth:200,tpl:divo.t1+b+divo.t2};if(e.itemFld!=undefined){f.items=[e.itemFld]}if(e.listeners!=undefined){f.listeners=e.listeners}if(e.labelWidth!=undefined){f.labelWidth=e.labelWidth}if(e.width!=undefined){f.width=e.width}if(e.value!=undefined){f.value=e.value}if(e.items!=undefined){f.items=e.items}return f},log:function(){if(Ext.isIE){return}if(console){console.log.apply(console,arguments)}},money:function(g){if(g==null){return""}var f=g+"";var e=f.startsWith("-");g=Math.abs(g);g=g.toString().replace(/\$|\,/g,"");if(isNaN(g)){g="0"}g=Math.floor(g*100+0.50000000001);var b=g%100;g=Math.floor(g/100).toString();if(b<10){b="0"+b}for(var h=0;h<Math.floor((g.length-(1+h))/3);h++){g=g.substring(0,g.length-(4*h+3))+","+g.substring(g.length-(4*h+3))}return(((!e)?"":"-")+g+"."+b)},amount:function(e){if(e==null){return""}var b=e+"";var j=b.indexOf(".");if(j<0){return b}var h=b.substr(j);var g="";for(var f=h.length-1;f>0;f--){if(h[f]!="0"){g=h.substring(0,f+1);break}}return b.replace(h,g)},say:function(k,j,f,h,g){if(typeof j=="undefined"){j=k;k="提示："}if(typeof f=="undefined"){f=3}if(!h){h="msg"}var e=['<div class="'+h+'" title="点击移除">','<div class="og-box-tl"><div class="og-box-tr"><div class="og-box-tc"></div></div></div>','<div class="og-box-ml"><div class="og-box-mr"><div class="og-box-mc"><h3>{0}</h3><p>{1}</p>',"</div></div></div>",'<div class="og-box-bl"><div class="og-box-br"><div class="og-box-bc"></div></div></div>',"</div>"].join("");if(!this.msgCt){this.msgCt=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},true)}var b=Ext.DomHelper.append(this.msgCt,{html:String.format(e,k,j.replace(/([^>])\n/g,"$1<br/>\n"))},true);Ext.get(b).on("click",function(){if(f>0){this.setStyle("display","none")}else{this.remove()}});if(f>0){b.slideIn("t").pause(f).ghost("t",{remove:true})}else{b.slideIn("t")}},err:function(f){var g=Ext.query("div.err");var e=2;for(var b=0;b<g.length-e+1;b++){Ext.fly(g[b]).remove()}divo.say("错误：",f,10,"err")},getTimeText:function(f){if(!f||f.length<18){return""}var k=Date.parseDate(f,"Y-m-d H:i:s");var b=k.getElapsed();var g=Math.floor(b/1000/60);var j=Math.floor(b/1000)%60;var e=Math.floor(b/1000/60/60);var n=Math.floor(b/1000/60/60/24);var h="";if(n>30){h=f.substring(0,10)}else{if(n>0){h=n+"天前"}else{if(e>0){h=e+"小时前"}else{if(g>0){h=g+"分钟前"}else{h=j+"秒前"}}}}return h}});divo.iconUrl="/media/images/";Ext.apply(divo,{iconAdd:divo.iconUrl+"divo/add.gif",iconEdit:divo.iconUrl+"divo/edit.gif",iconDelete:divo.iconUrl+"divo/delete.png",iconExpandAll:divo.iconUrl+"divo/expandall.gif",iconCollapseAll:divo.iconUrl+"divo/collapseall.gif",iconCollapseAll2:divo.iconUrl+"divo/collapseall2.png",iconSearch:divo.iconUrl+"divo/search.gif",iconSave:divo.iconUrl+"divo/save.gif",iconRefresh:divo.iconUrl+"divo/refresh.gif",iconPublish:divo.iconUrl+"divo/publish.gif"});divo.ErrorForm=function(){return{show:function(g,f){var e=g?g:"<br />无详细信息。</h3>";var b=new Ext.WindowGroup();b.zseed=10000;var h=new divo.window.ExceptionDialog({manager:b,errorMsg:f?f+":<br/>":""+e});h.show()}}}();divo.showError=divo.ErrorForm.show;Ext.apply(divo,{saveProfile:function(e,b){if(!e.userId){return}Ext.Ajax.request({async:b?b:false,url:"/myprofile/"+e.userId,method:"POST",jsonData:{msg_code:e.msgCode,msg_value:e.msgValue},success:function(f,g){var h=Ext.decode(f.responseText);if(!h.success){divo.say(h.errors.reason)}}})},saveProfileAsync:function(b){this.saveProfile(b,true)},restoreProfile:function(f,e,b){Ext.Ajax.request({scope:this,async:false,url:"/myprofile/"+e+"/"+b,method:"GET",success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){f({msgValue:j.data.msg_value})}else{f(null)}},failure:function(g,h){f(null)}})}});divo.StateProvider=function(b){divo.StateProvider.superclass.constructor.call(this);this.stateOn=false;Ext.apply(this,b)};Ext.extend(divo.StateProvider,Ext.state.Provider,{set:function(b,f){if(!this.stateOn){return}if(b.length>3&&b.substr(0,3)=="ext"){return}if(f==undefined||f===null||f==""){return}var e=true;if(this.lastUserId){e=!(this.lastUserId==divo.getUserId()&&this.lastMsgCode==b&&this.lastMsgValue==f)}if(e){divo.saveProfileAsync({userId:divo.getUserId(),msgCode:b,msgValue:this.encodeValue(f)});this.lastUserId=divo.getUserId();this.lastMsgCode=b;this.lastMsgValue=f}divo.StateProvider.superclass.set.call(this,b,f)},clear:function(b){if(!this.stateOn){return}divo.saveProfileAsync({userId:divo.getUserId(),msgCode:b,msgValue:""});divo.StateProvider.superclass.clear.call(this,b)},get:function(f,e){if(!this.stateOn){return undefined}if(f.length>3&&f.substr(0,3)=="ext"){return undefined}var b;divo.restoreProfile(function(g){b=g},divo.getUserId(),f);if(!b){this.set(f,e);return this.decodeValue(e)}return this.decodeValue(b.msgValue)}});if(Ext.Component){Ext.override(Ext.Component,{stateful:false})}Ext.ns("Ext.ux.state");Ext.ux.state.HttpProvider=function(b){this.addEvents("readsuccess","readfailure","savesuccess","savefailure");Ext.ux.state.HttpProvider.superclass.constructor.call(this);Ext.apply(this,b,{delay:750,dirty:false,started:false,autoStart:true,autoRead:true,user:"user",id:1,session:"session",logFailure:false,logSuccess:false,queue:[],url:".",readUrl:undefined,saveUrl:undefined,method:"post",saveBaseParams:{},readBaseParams:{},paramNames:{id:"id",name:"name",value:"value",user:"user",session:"session",data:"data"}});if(this.autoRead){this.readState()}this.dt=new Ext.util.DelayedTask(this.submitState,this);if(this.autoStart){this.start()}};Ext.extend(Ext.ux.state.HttpProvider,Ext.state.Provider,{saveSuccessText:"Save Success",saveFailureText:"Save Failure",readSuccessText:"Read Success",readFailureText:"Read Failure",dataErrorText:"Data Error",initState:function(b){if(b instanceof Array){Ext.each(b,function(e){this.state[e.name]=this.decodeValue(e[this.paramNames.value])},this)}else{this.state=b?b:{}}},set:function(b,e){if(!b){return}this.queueChange(b,e)},start:function(){this.dt.delay(this.delay);this.started=true},stop:function(){this.dt.cancel();this.started=false},queueChange:function(b,g){var j=undefined===this.state[b]||this.state[b]!==g;var h={};var e;var f=false;if(j){h[this.paramNames.name]=b;h[this.paramNames.value]=this.encodeValue(g);for(e=0;e<this.queue.length;e++){if(this.queue[e].name===h.name){this.queue[e]=h;f=true}}if(false===f){this.queue.push(h)}this.dirty=true}if(this.started){this.start()}return j},submitState:function(){if(!this.dirty){this.dt.delay(this.delay);return}this.dt.cancel();var e={url:this.saveUrl||this.url,method:this.method,scope:this,success:this.onSaveSuccess,failure:this.onSaveFailure,queue:Ext.ux.util.clone(this.queue),params:{}};var b=Ext.apply({},this.saveBaseParams);b[this.paramNames.id]=this.id;b[this.paramNames.user]=this.user;b[this.paramNames.session]=this.session;b[this.paramNames.data]=Ext.encode(e.queue);Ext.apply(e.params,b);this.dirty=false;Ext.Ajax.request(e)},clear:function(b){this.set(b,undefined)},onSaveSuccess:function(b,g){var n={};try{n=Ext.decode(b.responseText)}catch(m){if(true===this.logFailure){this.log(this.saveFailureText,m,b)}this.dirty=true;return}if(true!==n.success){if(true===this.logFailure){this.log(this.saveFailureText,n,b)}this.dirty=true}else{Ext.each(g.queue,function(j){if(!j){return}var e=j[this.paramNames.name];var o=this.decodeValue(j[this.paramNames.value]);if(undefined===o||null===o){Ext.ux.state.HttpProvider.superclass.clear.call(this,e)}else{Ext.ux.state.HttpProvider.superclass.set.call(this,e,o)}},this);if(false===this.dirty){this.queue=[]}else{var h,f,k;for(h=0;h<g.queue.length;h++){k=false;for(f=0;f<this.queue.length;f++){if(g.queue[h].name===this.queue[f].name){k=true;break}}if(true===k&&this.encodeValue(g.queue[h].value)===this.encodeValue(this.queue[f].value)){this.queue.remove(this.queue[f])}}}if(true===this.logSuccess){this.log(this.saveSuccessText,n,b)}this.fireEvent("savesuccess",this)}},onSaveFailure:function(b,e){if(true===this.logFailure){this.log(this.saveFailureText,b)}this.dirty=true;this.fireEvent("savefailure",this)},onReadFailure:function(b,e){if(true===this.logFailure){this.log(this.readFailureText,b)}this.fireEvent("readfailure",this)},onReadSuccess:function(b,f){var j={},g;try{j=Ext.decode(b.responseText)}catch(h){if(true===this.logFailure){this.log(this.readFailureText,h,b)}return}if(true!==j.success){if(true===this.logFailure){this.log(this.readFailureText,j,b)}}else{g=j[this.paramNames.data];if(!(g instanceof Array)&&true===this.logFailure){this.log(this.dataErrorText,g,b);return}Ext.each(g,function(e){this.state[e[this.paramNames.name]]=this.decodeValue(e[this.paramNames.value])},this);this.queue=[];this.dirty=false;if(true===this.logSuccess){this.log(this.readSuccessText,g,b)}this.fireEvent("readsuccess",this)}},readState:function(){var e={url:this.readUrl||this.url,method:this.method,scope:this,success:this.onReadSuccess,failure:this.onReadFailure,params:{}};var b=Ext.apply({},this.readBaseParams);b[this.paramNames.id]=this.id;b[this.paramNames.user]=this.user;b[this.paramNames.session]=this.session;Ext.apply(e.params,b);Ext.Ajax.request(e)},log:function(){if(console){console.log.apply(console,arguments)}}});divo.data.SimpleListStore=function(b){divo.data.SimpleListStore.superclass.constructor.call(this,{reader:new Ext.data.JsonReader({id:b.id},Ext.data.Record.create(b.fields)),proxy:new Ext.data.MemoryProxy(b.data)});this.load()};Ext.extend(divo.data.SimpleListStore,Ext.data.Store);divo.data.ArrayStore=function(b){divo.data.ArrayStore.superclass.constructor.call(this,{reader:new Ext.data.ArrayReader({},Ext.data.Record.create(b.fields))});this.loadData(b.data||[])};Ext.extend(divo.data.ArrayStore,Ext.data.Store);(function(){var EV=Ext.lib.Event;Ext.ux.ManagedIFrame=function(){var args=Array.prototype.slice.call(arguments,0),el=Ext.get(args[0]),config=args[0];if(el&&el.dom&&el.dom.tagName=="IFRAME"){config=args[1]||{}}else{config=args[0]||args[1]||{};el=config.autoCreate?Ext.get(Ext.DomHelper.append(config.autoCreate.parent||document.body,Ext.apply({tag:"iframe",src:(Ext.isIE&&Ext.isSecure)?Ext.SSL_SECURE_URL:""},config.autoCreate))):null}if(!el||el.dom.tagName!="IFRAME"){return el}el.dom.name||(el.dom.name=el.dom.id);el.dom.mifId=el.dom.id;this.addEvents({focus:true,blur:true,unload:true,domready:true,documentloaded:true,exception:true,message:true});if(config.listeners){this.listeners=config.listeners;Ext.ux.ManagedIFrame.superclass.constructor.call(this)}Ext.apply(el,this);el.addClass("x-managed-iframe");if(config.style){el.applyStyles(config.style)}el._maskEl=el.parent(".x-managed-iframe-mask")||el.parent().addClass("x-managed-iframe-mask");Ext.apply(el,{disableMessaging:config.disableMessaging===true,loadMask:Ext.apply({msg:"Loading..",msgCls:"x-mask-loading",maskEl:el._maskEl,hideOnReady:true,disabled:!config.loadMask},config.loadMask),_eventName:Ext.isIE?"onreadystatechange":"onload",_windowContext:null,eventsFollowFrameLinks:typeof config.eventsFollowFrameLinks=="undefined"?true:config.eventsFollowFrameLinks});el.dom[el._eventName]=el.loadHandler.createDelegate(el);var um=el.updateManager=new Ext.UpdateManager(el,true);um.showLoadIndicator=config.showLoadIndicator||false;if(config.src){el.setSrc(config.src)}else{var content=config.html||config.content||false;if(content){el.update.defer(10,el,[content])}}return Ext.ux.ManagedIFrame.Manager.register(el)};var MIM=Ext.ux.ManagedIFrame.Manager=function(){var frames={};var readyHandler=function(e,target){try{var id=target?target.mifId:null,frame;if((frame=this.getFrameById(id||target.id))&&frame._frameAction){frame.loadHandler({type:"domready"})}}catch(rhEx){}};var implementation={shimCls:"x-frame-shim",register:function(frame){frame.manager=this;frames[frame.id]=frames[frame.dom.name]={ref:frame,elCache:{}};return frame},deRegister:function(frame){frame._unHook();delete frames[frame.id];delete frames[frame.dom.name]},hideShims:function(){if(!this.shimApplied){return}Ext.select("."+this.shimCls,true).removeClass(this.shimCls+"-on");this.shimApplied=false},showShims:function(){if(!this.shimApplied){this.shimApplied=true;Ext.select("."+this.shimCls,true).addClass(this.shimCls+"-on")}},getFrameById:function(id){return typeof id=="string"?(frames[id]?frames[id].ref||null:null):null},getFrameByName:function(name){return this.getFrameById(name)},getFrameHash:function(frame){return frame.id?frames[frame.id]:null},eventProxy:function(e){if(!e){return}e=Ext.EventObject.setEvent(e);var be=e.browserEvent||e;if(e.type=="unload"){this._unHook()}if(!be.eventPhase||(be.eventPhase==(be.AT_TARGET||2))){return this.fireEvent(e.type,e)}},_flyweights:{},destroy:function(){if(this._domreadySignature){Ext.EventManager.un.apply(Ext.EventManager,this._domreadySignature)}},removeNode:Ext.isIE?function(frame,n){frame=MIM.getFrameHash(frame);if(frame&&n&&n.tagName!="BODY"){d=frame.scratchDiv||(frame.scratchDiv=frame.getDocument().createElement("div"));d.appendChild(n);d.innerHTML=""}}:function(frame,n){if(n&&n.parentNode&&n.tagName!="BODY"){n.parentNode.removeChild(n)}}};if(document.addEventListener){Ext.EventManager.on.apply(Ext.EventManager,implementation._domreadySignature=[window,"DOMFrameContentLoaded",readyHandler,implementation])}Ext.EventManager.on(window,"beforeunload",implementation.destroy,implementation);return implementation}();MIM.showDragMask=MIM.showShims;MIM.hideDragMask=MIM.hideShims;MIM.El=function(frame,el,forceNew){var frameObj;frame=(frameObj=MIM.getFrameHash(frame))?frameObj.ref:null;if(!frame){return null}var elCache=frameObj.elCache||(frameObj.elCache={});var dom=frame.getDom(el);if(!dom){return null}var id=dom.id;if(forceNew!==true&&id&&elCache[id]){return elCache[id]}this.dom=dom;this.id=id||Ext.id(dom)};MIM.El.get=function(frame,el){var ex,elm,id,doc;if(!frame||!el){return null}var frameObj;frame=(frameObj=MIM.getFrameHash(frame))?frameObj.ref:null;if(!frame){return null}var elCache=frameObj.elCache||(frameObj.elCache={});if(!(doc=frame.getDocument())){return null}if(typeof el=="string"){if(!(elm=frame.getDom(el))){return null}if(ex=elCache[el]){ex.dom=elm}else{ex=elCache[el]=new MIM.El(frame,elm)}return ex}else{if(el.tagName){if(!(id=el.id)){id=Ext.id(el)}if(ex=elCache[id]){ex.dom=el}else{ex=elCache[id]=new MIM.El(frame,el)}return ex}else{if(el instanceof MIM.El){if(el!=frameObj.docEl){el.dom=frame.getDom(el.id)||el.dom;elCache[el.id]=el}return el}else{if(el.isComposite){return el}else{if(Ext.isArray(el)){return frame.select(el)}else{if(el==doc){if(!frameObj.docEl){var f=function(){};f.prototype=MIM.El.prototype;frameObj.docEl=new f();frameObj.docEl.dom=doc}return frameObj.docEl}}}}}}return null};Ext.apply(MIM.El.prototype,Ext.Element.prototype);Ext.extend(Ext.ux.ManagedIFrame,Ext.util.Observable,{src:null,resetUrl:Ext.isIE&&Ext.isSecure?Ext.SSL_SECURE_URL:"about:blank",setSrc:function(url,discardUrl,callback){var src=url||this.src||this.resetUrl;this._windowContext=null;this._unHook();this._frameAction=this.frameInit=this._domReady=false;if(Ext.isOpera){this.reset()}this._callBack=callback||false;this.showMask();(function(){var s=typeof src=="function"?src()||"":src;try{this._frameAction=true;this.dom.src=s;this.frameInit=true;this.checkDOM()}catch(ex){this.fireEvent("exception",this,ex)}}).defer(100,this);if(discardUrl!==true){this.src=src}return this},reset:function(src,callback){this.dom.src=src||this.resetUrl;if(typeof callback=="function"){callback.defer(100)}return this},scriptRE:/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/gi,update:function(content,loadScripts,callback){loadScripts=loadScripts||this.getUpdateManager().loadScripts||false;content=Ext.DomHelper.markup(content||"");content=loadScripts===true?content:content.replace(this.scriptRE,"");var doc;if(doc=this.getDocument()){this._frameAction=!!content.length;this._windowContext=this.src=null;this._callBack=callback||false;this._unHook();this.showMask();doc.open();doc.write(content);doc.close();this.frameInit=true;if(this._frameAction){this.checkDOM()}else{this.hideMask(true);if(this._callBack){this._callBack()}}}else{this.hideMask(true);if(this._callBack){this._callBack()}}return this},disableMessaging:true,_XFrameMessaging:function(){var tagStack={"$":[]};var isEmpty=function(v,allowBlank){return v===null||v===undefined||(!allowBlank?v==="":false)};window.sendMessage=function(message,tag,origin){var MIF;if(MIF=arguments.callee.manager){if(message._fromHost){var fn,result;var compTag=message.tag||tag||null;var mstack=!isEmpty(compTag)?tagStack[compTag.toLowerCase()]||[]:tagStack["$"];for(var i=0,l=mstack.length;i<l;i++){if(fn=mstack[i]){result=fn.apply(fn.__scope,arguments)===false?false:result;if(fn.__single){mstack[i]=null}if(result===false){break}}}return result}else{message={type:isEmpty(tag)?"message":"message:"+tag.toLowerCase().replace(/^\s+|\s+$/g,""),data:message,domain:origin||document.domain,uri:document.documentURI,source:window,tag:isEmpty(tag)?null:tag.toLowerCase()};try{return MIF.disableMessaging!==true?MIF.fireEvent.call(MIF,message.type,MIF,message):null}catch(ex){}return null}}};window.onhostmessage=function(fn,scope,single,tag){if(typeof fn=="function"){if(!isEmpty(fn.__index)){throw"onhostmessage: duplicate handler definition"+(tag?" for tag:"+tag:"")}var k=isEmpty(tag)?"$":tag.toLowerCase();tagStack[k]||(tagStack[k]=[]);Ext.apply(fn,{__tag:k,__single:single||false,__scope:scope||window,__index:tagStack[k].length});tagStack[k].push(fn)}else{throw"onhostmessage: function required"}};window.unhostmessage=function(fn){if(typeof fn=="function"&&typeof fn.__index!="undefined"){var k=fn.__tag||"$";tagStack[k][fn.__index]=null}}},get:function(el){return MIM.El.get(this,el)},fly:function(el,named){named=named||"_global";el=this.getDom(el);if(!el){return null}if(!MIM._flyweights[named]){MIM._flyweights[named]=new Ext.Element.Flyweight()}MIM._flyweights[named].dom=el;return MIM._flyweights[named]},getDom:function(el){var d;if(!el||!(d=this.getDocument())){return null}return el.dom?el.dom:(typeof el=="string"?d.getElementById(el):el)},select:function(selector,unique){var d;return(d=this.getDocument())?Ext.Element.select(selector,unique,d):null},query:function(selector){var d;return(d=this.getDocument())?Ext.DomQuery.select(selector,d):null},getDoc:function(){return this.get(this.getDocument())},removeNode:function(node){MIM.removeNode(this,this.getDom(node))},_unHook:function(){var elcache,h=MIM.getFrameHash(this)||{};if(this._hooked&&h&&(elcache=h.elCache)){for(var id in elcache){var el=elcache[id];delete elcache[id];if(el.removeAllListeners){el.removeAllListeners()}}if(h.docEl){h.docEl.removeAllListeners();h.docEl=null;delete h.docEl}}this._hooked=this._domReady=this._domFired=false},_renderHook:function(){this._windowContext=this.CSS=null;this._hooked=false;try{if(this.writeScript('(function(){(window.hostMIF = parent.Ext.get("'+this.dom.id+'"))._windowContext='+(Ext.isIE?"window":"{eval:function(s){return eval(s);}}")+";})();")){this._frameProxy||(this._frameProxy=MIM.eventProxy.createDelegate(this));var w=this.getWindow();EV.doAdd(w,"focus",this._frameProxy);EV.doAdd(w,"blur",this._frameProxy);EV.doAdd(w,"unload",this._frameProxy);if(this.disableMessaging!==true){this.loadFunction({name:"XMessage",fn:this._XFrameMessaging},false,true);var sm;if(sm=w.sendMessage){sm.manager=this}}this.CSS=new CSSInterface(this.getDocument())}}catch(ex){}return this.domWritable()},sendMessage:function(message,tag,origin){var win;if(this.disableMessaging!==true&&(win=this.getWindow())){tag||(tag=message.tag||"");tag=tag.toLowerCase();message=Ext.applyIf(message.data?message:{data:message},{type:Ext.isEmpty(tag)?"message":"message:"+tag,domain:origin||document.domain,uri:document.documentURI,source:window,tag:tag||null,_fromHost:this});return win.sendMessage?win.sendMessage.call(null,message,tag,origin):null}return null},_windowContext:null,getDocument:function(){var win=this.getWindow(),doc=null;try{doc=(Ext.isIE&&win?win.document:null)||this.dom.contentDocument||window.frames[this.id].document||null}catch(gdEx){return false}return doc},getBody:function(){var d;return(d=this.getDocument())?d.body:null},getDocumentURI:function(){var URI,d;try{URI=this.src&&(d=this.getDocument())?d.location.href:null}catch(ex){}return URI||this.src},getWindow:function(){var dom=this.dom,win=null;try{win=dom.contentWindow||window.frames[dom.name]||null}catch(gwEx){}return win},print:function(){try{var win=this.getWindow();if(Ext.isIE){win.focus()}win.print()}catch(ex){throw"print exception: "+(ex.description||ex.message||ex)}},destroy:function(){this.removeAllListeners();if(this.dom){this.dom[this._eventName]=null;Ext.ux.ManagedIFrame.Manager.deRegister(this);this._windowContext=null;if(Ext.isIE&&this.dom.src){this.dom.src="javascript:false"}this._maskEl=null;this.remove()}if(this.loadMask){Ext.apply(this.loadMask,{masker:null,maskEl:null})}},domWritable:function(){return !!this._windowContext},execScript:function(block,useDOM){try{if(this.domWritable()){if(useDOM){this.writeScript(block)}else{return this._windowContext.eval(block)}}else{throw"execScript:non-secure context"}}catch(ex){this.fireEvent("exception",this,ex);return false}return true},writeScript:function(block,attributes){attributes=Ext.apply({},attributes||{},{type:"text/javascript",text:block});try{var head,script,doc=this.getDocument();if(doc&&typeof doc.getElementsByTagName!="undefined"){if(!(head=doc.getElementsByTagName("head")[0])){head=doc.createElement("head");doc.getElementsByTagName("html")[0].appendChild(head)}if(head&&(script=doc.createElement("script"))){for(var attrib in attributes){if(attributes.hasOwnProperty(attrib)&&attrib in script){script[attrib]=attributes[attrib]}}return !!head.appendChild(script)}}}catch(ex){this.fireEvent("exception",this,ex)}return false},loadFunction:function(fn,useDOM,invokeIt){var name=fn.name||fn;var fn=fn.fn||window[fn];this.execScript(name+"="+fn,useDOM);if(invokeIt){this.execScript(name+"()")}},showMask:function(msg,msgCls,forced){var lmask;if((lmask=this.loadMask)&&(!lmask.disabled||forced)){if(lmask._vis){return}lmask.masker||(lmask.masker=Ext.get(lmask.maskEl||this.dom.parentNode||this.wrap({tag:"div",style:{position:"relative"}})));lmask._vis=true;lmask.masker.mask.defer(lmask.delay||5,lmask.masker,[msg||lmask.msg,msgCls||lmask.msgCls])}},hideMask:function(forced){var tlm;if((tlm=this.loadMask)&&!tlm.disabled&&tlm.masker){if(!forced&&(tlm.hideOnReady!==true&&this._domReady)){return}tlm._vis=false;tlm.masker.unmask.defer(tlm.delay||5,tlm.masker)}},loadHandler:function(e,target){if(!this.frameInit||(!this._frameAction&&!this.eventsFollowFrameLinks)){return}target||(target={});var rstatus=(e&&typeof e.type!=="undefined"?e.type:this.dom.readyState);switch(rstatus){case"loading":case"interactive":break;case"domready":if(this._domReady){return}this._domReady=true;if(this._hooked=this._renderHook()){this._domFired=true;this.fireEvent("domready",this)}case"domfail":this._domReady=true;this.hideMask();break;case"load":case"complete":if(!this._domReady){this.loadHandler({type:"domready",id:this.id})}this.hideMask(true);if(this._frameAction||this.eventsFollowFrameLinks){this.fireEvent.defer(50,this,["documentloaded",this])}this._frameAction=this._frameInit=false;if(this.eventsFollowFrameLinks){this._domFired=this._domReady=false}if(this._callBack){this._callBack(this)}break;default:}this.frameState=rstatus},checkDOM:function(win){if(Ext.isOpera||Ext.isGecko||!this._frameAction){return}var n=0,win=win||this.getWindow(),manager=this,domReady=false,max=300;var poll=function(){try{var doc=manager.getDocument(),body=null;if(doc===false){throw"Document Access Denied"}if(!manager._domReady){domReady=!!(doc&&doc.getElementsByTagName);domReady=domReady&&(body=doc.getElementsByTagName("body")[0])&&!!body.innerHTML.length}}catch(ex){n=max}if(!manager._frameAction||manager._domReady){return}if((++n<max)&&!domReady){setTimeout(arguments.callee,10);return}manager.loadHandler({type:domReady?"domready":"domfail"})};setTimeout(poll,40)}});var styleCamelRe=/(-[a-z])/gi;var styleCamelFn=function(m,a){return a.charAt(1).toUpperCase()};var CSSInterface=function(hostDocument){var doc;if(hostDocument){doc=hostDocument;return{rules:null,createStyleSheet:function(cssText,id){var ss;if(!doc){return}var head=doc.getElementsByTagName("head")[0];var rules=doc.createElement("style");rules.setAttribute("type","text/css");if(id){rules.setAttribute("id",id)}if(Ext.isIE){head.appendChild(rules);ss=rules.styleSheet;ss.cssText=cssText}else{try{rules.appendChild(doc.createTextNode(cssText))}catch(e){rules.cssText=cssText}head.appendChild(rules);ss=rules.styleSheet?rules.styleSheet:(rules.sheet||doc.styleSheets[doc.styleSheets.length-1])}this.cacheStyleSheet(ss);return ss},removeStyleSheet:function(id){if(!doc){return}var existing=doc.getElementById(id);if(existing){existing.parentNode.removeChild(existing)}},swapStyleSheet:function(id,url){this.removeStyleSheet(id);if(!doc){return}var ss=doc.createElement("link");ss.setAttribute("rel","stylesheet");ss.setAttribute("type","text/css");ss.setAttribute("id",id);ss.setAttribute("href",url);doc.getElementsByTagName("head")[0].appendChild(ss)},refreshCache:function(){return this.getRules(true)},cacheStyleSheet:function(ss){if(this.rules){this.rules={}}try{var ssRules=ss.cssRules||ss.rules;for(var j=ssRules.length-1;j>=0;--j){this.rules[ssRules[j].selectorText]=ssRules[j]}}catch(e){}},getRules:function(refreshCache){if(this.rules==null||refreshCache){this.rules={};if(doc){var ds=doc.styleSheets;for(var i=0,len=ds.length;i<len;i++){try{this.cacheStyleSheet(ds[i])}catch(e){}}}}return this.rules},getRule:function(selector,refreshCache){var rs=this.getRules(refreshCache);if(!Ext.isArray(selector)){return rs[selector]}for(var i=0;i<selector.length;i++){if(rs[selector[i]]){return rs[selector[i]]}}return null},updateRule:function(selector,property,value){if(!Ext.isArray(selector)){var rule=this.getRule(selector);if(rule){rule.style[property.replace(styleCamelRe,styleCamelFn)]=value;return true}}else{for(var i=0;i<selector.length;i++){if(this.updateRule(selector[i],property,value)){return true}}}return false}}}};Ext.ux.ManagedIframePanel=Ext.extend(Ext.Panel,{defaultSrc:null,bodyStyle:{height:"100%",width:"100%",position:"relative"},frameStyle:{overflow:"auto"},frameConfig:null,hideMode:!Ext.isIE?"nosize":"display",shimCls:Ext.ux.ManagedIFrame.Manager.shimCls,shimUrl:null,loadMask:false,stateful:false,animCollapse:Ext.isIE&&Ext.enableFx,autoScroll:false,closable:true,ctype:"Ext.ux.ManagedIframePanel",showLoadIndicator:false,unsupportedText:"Inline frames are NOT enabled/supported by your browser.",initComponent:function(){this.bodyCfg||(this.bodyCfg={cls:"x-managed-iframe-mask",children:[Ext.apply({tag:"iframe",frameborder:0,cls:"x-managed-iframe",style:this.frameStyle||null,html:this.unsupportedText||null},this.frameConfig?this.frameConfig.autoCreate||{}:false,Ext.isIE&&Ext.isSecure?{src:Ext.SSL_SECURE_URL}:false),{tag:"img",src:this.shimUrl||Ext.BLANK_IMAGE_URL,cls:this.shimCls,galleryimg:"no"}]});this.autoScroll=false;this.items=null;if(this.stateful!==false){this.stateEvents||(this.stateEvents=["documentloaded"])}Ext.ux.ManagedIframePanel.superclass.initComponent.call(this);this.monitorResize||(this.monitorResize=this.fitToParent);this.addEvents({documentloaded:true,domready:true,message:true,exception:true});this.addListener=this.on},doLayout:function(){if(this.fitToParent&&!this.ownerCt){var pos=this.getPosition(),size=(Ext.get(this.fitToParent)||this.getEl().parent()).getViewSize();this.setSize(size.width-pos[0],size.height-pos[1])}Ext.ux.ManagedIframePanel.superclass.doLayout.apply(this,arguments)},beforeDestroy:function(){if(this.rendered){if(this.tools){for(var k in this.tools){Ext.destroy(this.tools[k])}}if(this.header&&this.headerAsText){var s;if(s=this.header.child("span")){s.remove()}this.header.update("")}Ext.each(["iframe","shim","header","topToolbar","bottomToolbar","footer","loadMask","body","bwrap"],function(elName){if(this[elName]){if(typeof this[elName].destroy=="function"){this[elName].destroy()}else{Ext.destroy(this[elName])}this[elName]=null;delete this[elName]}},this)}Ext.ux.ManagedIframePanel.superclass.beforeDestroy.call(this)},onDestroy:function(){Ext.Panel.superclass.onDestroy.call(this)},onRender:function(ct,position){Ext.ux.ManagedIframePanel.superclass.onRender.call(this,ct,position);if(this.iframe=this.body.child("iframe.x-managed-iframe")){this.iframe.ownerCt=this;var El=Ext.Element;var mode=El[this.hideMode.toUpperCase()]||"x-hide-nosize";Ext.each([this[this.collapseEl],this.floating?null:this.getActionEl(),this.iframe],function(el){if(el){el.setVisibilityMode(mode)}},this);if(this.loadMask){this.loadMask=Ext.apply({disabled:false,maskEl:this.body,hideOnReady:true},this.loadMask)}if(this.iframe=new Ext.ux.ManagedIFrame(this.iframe,{loadMask:this.loadMask,showLoadIndicator:this.showLoadIndicator,disableMessaging:this.disableMessaging,style:this.frameStyle})){this.loadMask=this.iframe.loadMask;this.relayEvents(this.iframe,["blur","focus","unload","documentloaded","domready","exception","message"].concat(this._msgTagHandlers||[]));delete this._msgTagHandlers}this.getUpdater().showLoadIndicator=this.showLoadIndicator||false;var ownerCt=this.ownerCt;while(ownerCt){ownerCt.on("afterlayout",function(container,layout){var MIM=Ext.ux.ManagedIFrame.Manager,st=false;Ext.each(["north","south","east","west"],function(region){var reg;if((reg=layout[region])&&reg.splitEl){st=true;if(!reg.split._splitTrapped){reg.split.on("beforeresize",MIM.showShims,MIM);reg.split._splitTrapped=true}}},this);if(st&&!this._splitTrapped){this.on("resize",MIM.hideShims,MIM);this._splitTrapped=true}},this,{single:true});ownerCt=ownerCt.ownerCt}}this.shim=Ext.get(this.body.child("."+this.shimCls))},toggleShim:function(){if(this.shim&&this.shimCls){this.shim.toggleClass(this.shimCls+"-on")}},afterRender:function(container){var html=this.html;delete this.html;Ext.ux.ManagedIframePanel.superclass.afterRender.call(this);if(this.iframe){if(this.defaultSrc){this.setSrc()}else{if(html){this.iframe.update(typeof html=="object"?Ext.DomHelper.markup(html):html)}}}},sendMessage:function(){if(this.iframe){this.iframe.sendMessage.apply(this.iframe,arguments)}},on:function(name){var tagRE=/^message\:/i,n=null;if(typeof name=="object"){for(var na in name){if(!this.filterOptRe.test(na)&&tagRE.test(na)){n||(n=[]);n.push(na.toLowerCase())}}}else{if(tagRE.test(name)){n=[name.toLowerCase()]}}if(this.getFrame()&&n){this.relayEvents(this.iframe,n)}else{this._msgTagHandlers||(this._msgTagHandlers=[]);if(n){this._msgTagHandlers=this._msgTagHandlers.concat(n)}}Ext.ux.ManagedIframePanel.superclass.on.apply(this,arguments)},setSrc:function(url,discardUrl,callback){url=url||this.defaultSrc||false;if(!url){return this}if(url.url){callback=url.callback||false;discardUrl=url.discardUrl||false;url=url.url||false}var src=url||(Ext.isIE&&Ext.isSecure?Ext.SSL_SECURE_URL:"");if(this.rendered&&this.iframe){this.iframe.setSrc(src,discardUrl,callback)}return this},getState:function(){var URI=this.iframe?this.iframe.getDocumentURI()||null:null;return Ext.apply(Ext.ux.ManagedIframePanel.superclass.getState.call(this)||{},URI?{defaultSrc:typeof URI=="function"?URI():URI}:null)},getUpdater:function(){return this.rendered?(this.iframe||this.body).getUpdater():null},getFrame:function(){return this.rendered?this.iframe:null},getFrameWindow:function(){return this.rendered&&this.iframe?this.iframe.getWindow():null},getFrameDocument:function(){return this.rendered&&this.iframe?this.iframe.getDocument():null},getFrameDoc:function(){return this.rendered&&this.iframe?this.iframe.getDoc():null},getFrameBody:function(){return this.rendered&&this.iframe?this.iframe.getBody():null},load:function(loadCfg){var um;if(um=this.getUpdater()){if(loadCfg&&loadCfg.renderer){um.setRenderer(loadCfg.renderer);delete loadCfg.renderer}um.update.apply(um,arguments)}return this},doAutoLoad:function(){this.load(typeof this.autoLoad=="object"?this.autoLoad:{url:this.autoLoad})}});Ext.reg("iframepanel",Ext.ux.ManagedIframePanel);Ext.ux.ManagedIframePortlet=Ext.extend(Ext.ux.ManagedIframePanel,{anchor:"100%",frame:true,collapseEl:"bwrap",collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("iframeportlet",Ext.ux.ManagedIframePortlet);Ext.apply(Ext.Element.prototype,{setVisible:function(visible,animate){if(!animate||!Ext.lib.Anim){if(this.visibilityMode==Ext.Element.DISPLAY){this.setDisplayed(visible)}else{if(this.visibilityMode==Ext.Element.VISIBILITY){this.fixDisplay();this.dom.style.visibility=visible?"visible":"hidden"}else{this[visible?"removeClass":"addClass"](String(this.visibilityMode))}}}else{var dom=this.dom;var visMode=this.visibilityMode;if(visible){this.setOpacity(0.01);this.setVisible(true)}this.anim({opacity:{to:(visible?1:0)}},this.preanim(arguments,1),null,0.35,"easeIn",function(){if(!visible){if(visMode==Ext.Element.DISPLAY){dom.style.display="none"}else{if(visMode==Ext.Element.VISIBILITY){dom.style.visibility="hidden"}else{Ext.get(dom).addClass(String(visMode))}}Ext.get(dom).setOpacity(1)}})}return this},isVisible:function(deep){var vis=!(this.getStyle("visibility")=="hidden"||this.getStyle("display")=="none"||this.hasClass(this.visibilityMode));if(deep!==true||!vis){return vis}var p=this.dom.parentNode;while(p&&p.tagName.toLowerCase()!="body"){if(!Ext.fly(p,"_isVisible").isVisible()){return false}p=p.parentNode}return true}});Ext.onReady(function(){var CSS=Ext.util.CSS,rules=[];CSS.getRule(".x-managed-iframe")||(rules.push(".x-managed-iframe {height:100%;width:100%;overflow:auto;}"));CSS.getRule(".x-managed-iframe-mask")||(rules.push(".x-managed-iframe-mask{width:100%;height:100%;position:relative;}"));if(!CSS.getRule(".x-frame-shim")){rules.push(".x-frame-shim {z-index:8500;position:absolute;top:0px;left:0px;background:transparent!important;overflow:hidden;display:none;}");rules.push(".x-frame-shim-on{width:100%;height:100%;display:block;zoom:1;}");rules.push(".ext-ie6 .x-frame-shim{margin-left:5px;margin-top:3px;}")}CSS.getRule(".x-hide-nosize")||(rules.push(".x-hide-nosize,.x-hide-nosize *{height:0px!important;width:0px!important;border:none;}"));if(!!rules.length){CSS.createStyleSheet(rules.join(" "))}})})();Ext.ux.ClickActionPanel=Ext.extend(Ext.Panel,{doAction:function(f,b){f.stopEvent();this.publish("ux.clickAction",{targetId:b.id,targetText:b.innerHTML,sender:this.id})},onRender:function(){Ext.ux.ClickActionPanel.superclass.onRender.apply(this,arguments);this.body.on("mousedown",this.doAction,this,{delegate:"a"});this.body.on("click",Ext.emptyFn,null,{delegate:"a",preventDefault:true})}});Ext.reg("clickactionpanel",Ext.ux.ClickActionPanel);divo.panel.ClickActionWithFocusPanel=Ext.extend(Ext.Panel,{customCls:"",customBodyStyle:"padding:10px",selectedItemCode:null,initComponent:function(){this.listId=this.myId("list");var b=['<div id="'+this.listId+'" class="divo-list'+(this.customCls?"-"+this.customCls:"")+'">','  <div id="'+this.listId+'-inner"></div>',"</div>"].join("");Ext.apply(this,{layout:"fit",bodyStyle:this.customBodyStyle,items:[{autoScroll:true,xtype:"panel",html:b}]});divo.panel.ClickActionWithFocusPanel.superclass.initComponent.apply(this,arguments)},afterRender:function(){divo.panel.ClickActionWithFocusPanel.superclass.afterRender.call(this);this.renderOther.defer(100,this)},renderOther:function(){var e=Ext.get(this.listId+"-inner");var b=new Ext.XTemplate('<tpl for=".">','<tpl if="this.isLine(name)">',"    <br />","</tpl>",'<tpl if="this.isLine(name)==false">','  <a href="#" hidefocus="on" class="{cls}" id="'+this.listId+'-{code}">','    <img src="/media/js/ext/resources/images/default/s.gif">',"    {name}","  </a>","</tpl>","</tpl>",{isLine:function(f){return f=="-"}});this.listData=this.getListData();b.overwrite(e,this.listData);e.on("click",function(g,f){g.stopEvent();this.selectItem(f)},this);if(this.selectedItemCode){this.selectItem.defer(100,this,[this.listId+"-"+this.selectedItemCode])}},selectItem:function(e){var f=Ext.get(e);if(!f){return}f.radioClass("active");if(e.id){var b=e.id.split("-")}else{var b=e.split("-")}code=b[b.length-1];if(code=="inner"){return}this.publish("divo.panel.clickAction",{code:code,name:this.getListName(code),sender:this.id})},getListName:function(e){for(var b=0;b<this.listData.length;b++){if(this.listData[b].code==e){return this.listData[b].name}}return""},getListData:Ext.emptyFn});Ext.reg("divo.panel.ClickActionWithFocusPanel",divo.panel.ClickActionWithFocusPanel);divo.panel.PanelWithHtmlBtns=Ext.extend(Ext.Panel,{rightWidth:100,btnRightCls:"divo-big-btn-right",btnCls:"divo-big-btn-left",initComponent:function(){divo.waitFor(this.canSetupBtns,this.setupBtns,this);divo.panel.PanelWithHtmlBtns.superclass.initComponent.call(this)},getHtmlBtnsPanel:function(f){this.hasRightBtns=false;this.htmlBtns=f;var j=[];j.push('<div class="divo-big-btn" >');j.push('<div class="'+this.btnCls+'"><ul id="'+this.myId("btns")+'">');var o=false;var b=0;for(var g=0;g<this.htmlBtns.length;g++){var n=this.htmlBtns[g];if(typeof n=="string"&&n=="->"){this.hasRightBtns=true;b=g+1;break}if(n.hidden){continue}if(n.items==undefined){var e=this.myId("btn-"+g);var h="";if(n.icon){var h='<img src="/media/images/'+n.icon+'" />&nbsp;'}var m=h+n.text}else{var e=this.myId("btn-items-"+g);var m=n.text+"▼"}j.push('<li><a id="'+e+'" href="#">'+m+"</a></li>");o=true}j.push("</ul></div>");j.push("</div>");if(this.hasRightBtns){var k=[];k.push('<div class="divo-big-btn" >');k.push('<div id="'+this.myId("btnsRight")+'" class="'+this.btnRightCls+'">');for(var g=b;g<this.htmlBtns.length;g++){var n=this.htmlBtns[g];if(n.hidden){continue}if(n.handler==undefined){k.push(n.text)}else{k.push('<a id="'+this.myId("btn-"+g)+'" href="#">'+n.text+"</a>&nbsp;&nbsp;")}o=true}k.push("</div>");k.push("</div>")}if(!this.hasRightBtns){return{region:"north",layout:"fit",height:o?38:0,html:j.join("")}}return{region:"north",layout:"fit",height:o?38:0,items:[this.createBtnLayoutPanel(j,k)]}},createBtnLayoutPanel:function(b,e){return new Ext.Panel({layout:"border",items:[{region:"center",layout:"fit",html:b.join("")},{region:"east",width:this.rightWidth,layout:"fit",html:e.join("")}]})},canSetupBtns:function(){return Ext.get(this.myId("btns"))},setupBtnsCore:function(b){b.on({click:{stopEvent:false,delegate:"a",scope:this,fn:function(j,h){var g=h.id.split("-");var f=g[g.length-1];if(h.id.indexOf("-items-")>0){this.showContextMenu(f,h.id)}else{this.htmlBtns[f].handler.call(this)}}}})},setupBtns:function(){this.setupBtnsCore(Ext.get(this.myId("btns")));if(this.hasRightBtns){this.setupBtnsCore(Ext.get(this.myId("btnsRight")))}},setBtnText:function(b,f){var e=Ext.get(this.myId("btn-"+b));e.dom.innerHTML=f},setBtnVisible:function(b,f){var e=Ext.get(this.myId("btn-"+b));e.setVisibilityMode(Ext.Element.DISPLAY);e.setVisible(f)},disableBtn:function(b){this.setBtnVisible(b,false)},enableBtn:function(b){this.setBtnVisible(b,true)},showContextMenu:function(e,g){var f=new Ext.menu.Menu({items:this.htmlBtns[e].items});var b=Ext.get(g).getXY();b[1]=b[1]+22;f.showAt(b)}});Ext.removeNode=Ext.isIE?function(e){var b=document.createElement("div");if(e&&e.tagName!="BODY"){var b=document.createElement("div");b.appendChild(e);b.removeChild(e);delete Ext.Element.cache[e.id];b=null}}:function(b){if(b&&b.parentNode&&b.tagName!="BODY"){b.parentNode.removeChild(b);delete Ext.Element.cache[b.id]}};(function(){Ext.ux.Media=function(g){this.toString=this.asMarkup;Ext.apply(this,g||{});this.initMedia()};var b=Ext.ux.Media;var e=/4$/i;if(parseFloat(Ext.version)<2.1){throw"Ext.ux.Media and sub-classes are not License-Compatible with your Ext release."}Ext.ux.Media.prototype={mediaObject:null,mediaCfg:null,mediaVersion:null,requiredVersion:null,unsupportedText:null,hideMode:!Ext.isIE?"nosize":"display",animCollapse:Ext.enableFx&&Ext.isIE,animFloat:Ext.enableFx&&Ext.isIE,autoScroll:true,bodyStyle:{position:"relative"},visibilityCls:!Ext.isIE?"x-hide-nosize":null,initMedia:function(){},disableCaching:false,_maxPoll:200,getMediaType:function(g){return b.mediaTypes[g]},assert:function(g,h){g=typeof g==="function"?g.call(g.scope||null):g;return Ext.value(g,h)},assertId:function(h,g){h||(h=g||Ext.id());return h},prepareURL:function(j,m){var k=j?j.split("#"):[""];if(!!j&&(m=m===undefined?this.disableCaching:m)){var h=k[0];if(!(/_dc=/i).test(h)){var g="_dc="+(new Date().getTime());if(h.indexOf("&")!==-1){h+="&"+g}else{h+="?"+g}k[0]=h}}return k.length>1?k.join("#"):k[0]},prepareMedia:function(g,j,y,t){g=g||this.mediaCfg;if(!g){return""}var n=Ext.apply({url:false,autoSize:false},g);n.url=this.prepareURL(this.assert(n.url,false),n.disableCaching);if(n.mediaType){var w,h,o=Ext.Element;var k=Ext.apply({},this.getMediaType(this.assert(n.mediaType,false))||false);var q=Ext.apply(k.params||{},n.params||{});for(var x in q){if(q.hasOwnProperty(x)){n.children||(n.children=[]);h=this.assert(q[x],null);if(h!==null){n.children.push({tag:"param",name:x,value:typeof h==="object"?Ext.urlEncode(h):encodeURI(h)})}}}delete k.params;var u=this.assert(n.unsupportedText||this.unsupportedText||k.unsupportedText,null);if(u){n.children||(n.children=[]);n.children.push(u)}if(n.style&&typeof n.style!="object"){throw"Style must be JSON formatted"}n.style=this.assert(Ext.apply(k.style||{},n.style||{}),{});delete k.style;n.height=this.assert(y||n.height||k.height||n.style.height,null);n.width=this.assert(j||n.width||k.width||n.style.width,null);n=Ext.apply({tag:"object"},n,k);if(n.height||n.autoSize){Ext.apply(n.style,{height:o.addUnits(n.autoSize?"100%":n.height,o.prototype.defaultUnit)})}if(n.width||n.autoSize){Ext.apply(n.style,{width:o.addUnits(n.autoSize?"100%":n.width,o.prototype.defaultUnit)})}n.id=this.assertId(n.id);n.name=this.assertId(n.name,n.id);n._macros={url:n.url||"",height:(/%$/.test(n.height))?n.height:parseInt(n.height,10)||null,width:(/%$/.test(n.width))?n.width:parseInt(n.width,10)||null,scripting:this.assert(n.scripting,false),controls:this.assert(n.controls,false),scale:this.assert(n.scale,1),status:this.assert(n.status,false),start:this.assert(n.start,false),loop:this.assert(n.loop,false),volume:this.assert(n.volume,20),id:n.id};delete n.url;delete n.mediaType;delete n.controls;delete n.status;delete n.start;delete n.loop;delete n.scale;delete n.scripting;delete n.volume;delete n.autoSize;delete n.params;delete n.unsupportedText;delete n.renderOnResize;delete n.disableCaching;delete n.listeners;delete n.height;delete n.width;return n}else{var u=this.assert(n.unsupportedText||this.unsupportedText||k.unsupportedText,null);u=u?Ext.DomHelper.markup(u):null;return String.format(u||"Media Configuration/Plugin Error"," "," ")}},asMarkup:function(g){return this.mediaMarkup(this.prepareMedia(g))},mediaMarkup:function(k){k=k||this.mediaCfg;if(k){var j=k._macros;delete k._macros;var g=Ext.DomHelper.markup(k);if(j){var h,o;for(o in j){h=j[o];if(h!==null){g=g.replace(new RegExp("((%40|@)"+o+")","g"),h+"")}}}return g}},setMask:function(g){var h;if((h=this.mediaMask)){h.el||(h=this.mediaMask=new Ext.ux.IntelliMask(g,h));h.el.addClass("x-media-mask")}},refreshMedia:function(g){if(this.mediaCfg){this.renderMedia(null,g)}return this},renderMedia:function(o,j,n,g,k){if(!Ext.isReady){Ext.onReady(this.renderMedia.createDelegate(this,Array.prototype.slice.call(arguments,0)));return}var m=(this.mediaCfg=o||this.mediaCfg);j=Ext.get(this.lastCt||j||(this.mediaObject?this.mediaObject.dom.parentNode:null));this.onBeforeMedia.call(this,m,j,n,g,k);if(j){this.lastCt=j;if(m&&(m=this.prepareMedia(m,g,k,j))){this.setMask(j);if(this.mediaMask&&this.autoMask){this.mediaMask.show()}this.clearMedia();this.writeMedia(m,j,n||"afterbegin")}}this.onAfterMedia(j)},writeMedia:function(k,g,j){var h=Ext.get(g);if(h){j?Ext.DomHelper.insertHtml(j,h.dom,this.mediaMarkup(k)):h.update(this.mediaMarkup(k))}},clearMedia:function(){var g;if(Ext.isReady&&(g=this.mediaObject)){g.remove(true,true)}this.mediaObject=null},resizeMedia:function(j,g,k){var m=this.mediaCfg;if(m&&this.boxReady&&m.renderOnResize&&!!g&&!!k){if(arguments.length>3&&(!this.mediaObject||m.renderOnResize)){this.refreshMedia(this[this.mediaEl])}}},onBeforeMedia:function(q,k,o,n,h){var g=q||this.mediaCfg,j;if(g&&(j=this.getMediaType(g.mediaType))){g.autoSize=g.autoSize||j.autoSize===true;var t;if(g.autoSize&&(t=Ext.isReady?Ext.get(this[this.mediaEl]||this.lastCt||k):null)){g.height=this.autoHeight?null:t.getHeight(true);g.width=this.autoWidth?null:t.getWidth(true)}}this.assert(g.height,h);this.assert(g.width,n);q=g},onMediaLoad:function(g){if(g&&g.type=="load"){this.fireEvent("mediaload",this,this.mediaObject);if(this.mediaMask&&this.autoMask){this.mediaMask.hide()}}},onAfterMedia:function(h){var j;if(this.mediaCfg&&h&&(j=this.mediaObject=new (this.elementClass||Ext.ux.Media.Element)(h.child(".x-media",true)))){j.ownerCt=this;var g;if(g=this.mediaCfg.listeners||null){j.on(g)}this.fireEvent("mediarender",this,this.mediaObject);if(j.dom.tagName!=="OBJECT"){j.on({load:this.onMediaLoad,scope:this,single:true})}else{this._countPoll=0;this.pollReadyState(this.onMediaLoad.createDelegate(this,[{type:"load"}],0))}}if(this.autoWidth||this.autoHeight){this.syncSize()}},pollReadyState:function(g,h){var j=this.getInterface();if(j&&typeof j.readyState!="undefined"){(h||e).test(j.readyState)?g():arguments.callee.defer(10,this,arguments)}},getInterface:function(){return this.mediaObject?this.mediaObject.dom||null:null},detectVersion:Ext.emptyFn,autoMask:false};Ext.ns("Ext.ux.plugin");var f={init:function(){this.getId=function(){return this.id||(this.id="media-comp"+(++Ext.Component.AUTO_ID))};this.html=this.contentEl=this.items=null;if(this.hideMode=="nosize"&&Ext.ux.plugin.VisibilityMode){new Ext.ux.plugin.VisibilityMode({visibilityCls:"x-hide-nosize",hideMode:"nosize"}).init(this)}this.initMedia();this.toString=this.asMarkup;this.addEvents("mediarender","mediaload");if(this.mediaCfg.renderOnResize){this.on("resize",this.resizeMedia,this)}},afterRender:function(g){this.setMask(this[this.mediaEl]||g);if(!this.mediaCfg.renderOnResize){this.renderMedia(this.mediaCfg,this[this.mediaEl]||g)}},onDestroy:function(){this.clearMedia();Ext.destroy(this.mediaMask,this.loadMask);this.lastCt=this.mediaObject=this.renderTo=this.applyTo=this.mediaMask=this.loadMask=null}};Ext.ux.Media.Component=Ext.extend(Ext.BoxComponent,{ctype:"Ext.ux.Media.Component",mediaEl:"el",autoEl:{tag:"div",style:{overflow:"hidden",display:"block",position:"relative"}},cls:"x-media-comp",mediaClass:Ext.ux.Media,constructor:function(){Ext.apply(this,this.mediaClass.prototype);b.Component.superclass.constructor.apply(this,arguments)},initComponent:function(){b.Component.superclass.initComponent.apply(this,arguments);f.init.apply(this,arguments)},afterRender:function(g){b.Component.superclass.afterRender.apply(this,arguments);f.afterRender.apply(this,arguments)},beforeDestroy:function(){b.Component.superclass.beforeDestroy.apply(this,arguments);f.onDestroy.apply(this,arguments)},doAutoLoad:Ext.emptyFn,setAutoScroll:function(){if(this.rendered&&this.autoScroll){this.getEl().setOverflow("auto")}}});Ext.reg("uxmedia",Ext.ux.Media.Component);Ext.reg("media",Ext.ux.Media.Component);Ext.ux.Media.Panel=Ext.extend(Ext.Panel,{cls:"x-media-panel",ctype:"Ext.ux.Media.Panel",mediaEl:"body",mediaClass:Ext.ux.Media,constructor:function(){Ext.apply(this,this.mediaClass.prototype);b.Panel.superclass.constructor.apply(this,arguments)},initComponent:function(){b.Panel.superclass.initComponent.apply(this,arguments);f.init.apply(this,arguments)},afterRender:function(g){b.Panel.superclass.afterRender.apply(this,arguments);f.afterRender.apply(this,arguments)},beforeDestroy:function(){b.Panel.superclass.beforeDestroy.apply(this,arguments);f.onDestroy.apply(this,arguments)},doAutoLoad:Ext.emptyFn});Ext.reg("mediapanel",Ext.ux.Media.Panel);Ext.ux.Media.Portlet=Ext.extend(Ext.ux.Media.Panel,{anchor:"100%",frame:true,collapseEl:"bwrap",collapsible:true,draggable:true,ctype:"Ext.ux.Media.Portlet",cls:"x-portlet x-media-portlet"});Ext.reg("mediaportlet",Ext.ux.Media.Portlet);Ext.ux.Media.Window=Ext.extend(Ext.Window,{constructor:function(g){Ext.apply(this,this.mediaClass.prototype);b.Window.superclass.constructor.apply(this,arguments)},cls:"x-media-window",ctype:"Ext.ux.Media.Window",mediaClass:Ext.ux.Media,mediaEl:"body",initComponent:function(){b.Window.superclass.initComponent.apply(this,arguments);f.init.apply(this,arguments)},afterRender:function(){b.Window.superclass.afterRender.apply(this,arguments);f.afterRender.apply(this,arguments)},beforeDestroy:function(){f.onDestroy.apply(this,arguments);b.Window.superclass.beforeDestroy.apply(this,arguments)},doAutoLoad:Ext.emptyFn});Ext.reg("mediawindow",b.Window);Ext.onReady(function(){var g=Ext.util.CSS,h=[];g.getRule(".x-media",true)||(h.push(".x-media{width:100%;height:100%;outline:none;overflow:hidden;}"));g.getRule(".x-media-mask")||(h.push(".x-media-mask{width:100%;height:100%;position:relative;zoom:1;}"));g.getRule(".x-media-img")||(h.push(".x-media-img{background-color:transparent;width:auto;height:auto;position:relative;}"));if(!!h.length){g.createStyleSheet(h.join(""));g.refreshCache()}});Ext.override(Ext.Element,{mask:function(j,g){if(this._maskMsg){this._maskMsg.remove()}if(this._mask){this._mask.remove()}if(this.getStyle("position")=="static"){this._preMaskPosition="static";this.setStyle("position","relative")}this._mask=Ext.DomHelper.append(this.dom,{cls:"ext-el-mask"},true);if(!this.select("iframe,frame,object,embed").elements.length){this.addClass("x-masked")}this._mask.setDisplayed(true);if(typeof j=="string"){this._maskMsg=Ext.DomHelper.append(this.dom,{cls:"ext-el-mask-msg",cn:{tag:"div"}},true);var h=this._maskMsg;h.dom.className=g?"ext-el-mask-msg "+g:"ext-el-mask-msg";h.dom.firstChild.innerHTML=j;h.setDisplayed(true);h.center(this)}if(Ext.isIE&&!(Ext.isIE7&&Ext.isStrict)&&this.getStyle("height")=="auto"){this._mask.setHeight(this.getHeight())}return this._mask},unmask:function(){if(this._mask){if(this._preMaskPosition){this.setStyle("position",this._preMaskPosition)}if(this._maskMsg){this._maskMsg.remove();delete this._maskMsg}this._mask.remove();delete this._mask}this.removeClass("x-masked")},remove:function(h,g){if(this.dom){this.removeAllListeners();if(h){this.cleanse(true,g)}Ext.removeNode(this.dom);this.maskEl=null;this.dom=null;delete this.dom}},cleanse:function(h,j){if(this.isCleansed&&h!==true){return this}var k=this.dom,m=k.firstChild,g;while(k&&m){g=m.nextSibling;if(j){Ext.fly(m,"_cleanser").cleanse(h,j)}Ext.removeNode(m);m=g}this.isCleansed=true;return this}});Ext.ux.Media.Element=Ext.extend(Ext.Element,{visibilityMode:"x-hide-nosize",constructor:function(g){if(!g){return null}var h=typeof g=="string"?d.getElementById(g):g.dom||g;if(!h){return null}this.dom=h;this.id=h.id||Ext.id(h);Ext.Element.cache[this.id]=this},mask:function(h,g){this.maskEl||(this.maskEl=this.parent(".x-media-mask")||this.parent());return this.maskEl.mask.apply(this.maskEl,arguments)},unmask:function(){if(this.maskEl){this.maskEl.unmask();this.maskEl=null}}});Ext.ux.Media.prototype.elementClass=Ext.ux.Media.Element;Ext.ux.IntelliMask=function(h,g){Ext.apply(this,g);this.el=Ext.get(h);this.removeMask=Ext.value(g.removeMask,true)};Ext.ux.IntelliMask.prototype={removeMask:true,msg:"Loading Media...",msgCls:"x-mask-loading",zIndex:null,disabled:false,active:false,autoHide:false,disable:function(){this.disabled=true},enable:function(){this.disabled=false},show:function(o,n,m,j){var k={},g=this.autoHide;j=parseInt(j,10)||20;if(typeof o=="object"){k=o;o=k.msg;n=k.msgCls;m=k.fn;g=typeof k.autoHide!="undefined"?k.autoHide:g;j=k.fnDelay||j}if(!this.active&&!this.disabled&&this.el){var h=this.el.mask(o||this.msg,n||this.msgCls);this.active=!!this.el._mask;if(this.active){if(this.zIndex){this.el._mask.setStyle("z-index",this.zIndex);if(this.el._maskMsg){this.el._maskMsg.setStyle("z-index",this.zIndex+1)}}}}else{j=0}if(typeof m==="function"){m.defer(j,k.scope||null)}else{j=0}if(g&&(g=parseInt(g,10)||2000)){this.hide.defer(g+(j||0),this)}return this.active?{mask:this.el._mask,maskMsg:this.el._maskMsg}:null},hide:function(g){if(this.el){this.el.unmask(g||this.removeMask)}this.active=false;return this},destroy:function(){this.hide(true);this.el=null}};Ext.ux.Media.mediaTypes={PDF:Ext.apply({tag:"object",cls:"x-media x-media-pdf",type:"application/pdf",data:"@url",autoSize:true,params:{src:"@url"}},Ext.isIE?{classid:"CLSID:CA8A9780-280D-11CF-A24D-444553540000"}:false),PDFFRAME:{tag:"iframe",cls:"x-media x-media-pdf-frame",frameBorder:0,style:{"z-index":2},src:"@url",autoSize:true},WMV:Ext.apply({tag:"object",cls:"x-media x-media-wmv",type:"application/x-mplayer2",data:"@url",autoSize:false,params:{filename:"@url",displaysize:0,autostart:"@start",showControls:"@controls",showStatusBar:"@status",showaudiocontrols:true,stretchToFit:true,Volume:"@volume",PlayCount:1}},Ext.isIE?{classid:"CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95",codebase:"http"+((Ext.isSecure)?"s":"")+"http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701",type:"application/x-oleobject"}:{src:"@url"}),SWF:Ext.apply({tag:"object",cls:"x-media x-media-swf",type:"application/x-shockwave-flash",scripting:"sameDomain",standby:"Loading..",loop:true,start:false,unsupportedText:{cn:["The Adobe Flash Player is required.",{tag:"br"},{tag:"a",cn:[{tag:"img",src:"http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif"}],href:"http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash",target:"_flash"}]},params:{movie:"@url",menu:"@controls",play:"@start",quality:"high",allowscriptaccess:"@scripting",allownetworking:"all",allowfullScreen:false,bgcolor:"#FFFFFF",wmode:"opaque",loop:"@loop"}},Ext.isIE?{classid:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",codebase:"http"+((Ext.isSecure)?"s":"")+"://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"}:{data:"@url"}),JWP:Ext.apply({tag:"object",cls:"x-media x-media-swf x-media-flv",type:"application/x-shockwave-flash",data:"@url",loop:false,start:false,boundExternals:["sendEvent","addModelListener","addControllerListener","addViewListener","getConfig","getPlaylist"],params:{movie:"@url",flashVars:{autostart:"@start",repeat:"@loop",height:"@height",width:"@width",id:"@id"}}},Ext.isIE?{classid:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",codebase:"http"+((Ext.isSecure)?"s":"")+"://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0"}:false),QT:Ext.apply({tag:"object",cls:"x-media x-media-quicktime",type:"video/quicktime",style:{position:"relative","z-index":1,behavior:"url(#qt_event_source)"},scale:"aspect",unsupportedText:'<a href="http://www.apple.com/quicktime/download/">Get QuickTime</a>',scripting:true,volume:"50%",data:"@url",params:{src:Ext.isIE?"@url":null,href:"http://quicktime.com",target:"_blank",autoplay:"@start",targetcache:true,cache:true,wmode:"transparent",controller:"@controls",enablejavascript:"@scripting",loop:"@loop",scale:"@scale",volume:"@volume",QTSRC:"@url"}},Ext.isIE?{classid:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",codebase:"http"+((Ext.isSecure)?"s":"")+"://www.apple.com/qtactivex/qtplugin.cab#version=7,2,1,0"}:{PLUGINSPAGE:"http://www.apple.com/quicktime/download/"}),QTEVENTS:{tag:"object",id:"qt_event_source",cls:"x-media x-media-qtevents",type:"video/quicktime",params:{},classid:"clsid:CB927D12-4FF7-4a9e-A169-56E4B8A75598",codebase:"http"+((Ext.isSecure)?"s":"")+"://www.apple.com/qtactivex/qtplugin.cab#version=7,2,1,0"},WPMP3:Ext.apply({tag:"object",cls:"x-media x-media-audio x-media-wordpress",type:"application/x-shockwave-flash",data:"@url",start:true,loop:false,boundExternals:["open","close","setVolume","load"],params:{movie:"@url",width:"@width",flashVars:{autostart:"@start",controller:"@controls",enablejavascript:"@scripting",loop:"@loop",scale:"@scale",initialvolume:"@volume",width:"@width",encode:"no",soundFile:""}}},Ext.isIE?{classid:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"}:false),REAL:Ext.apply({tag:"object",cls:"x-media x-media-real",type:"audio/x-pn-realaudio",data:"@url",controls:"imagewindow,all",start:false,standby:"Loading Real Media Player components...",params:{src:"@url",autostart:"@start",center:false,maintainaspect:true,controller:"@controls",controls:"@controls",volume:"@volume",loop:"@loop",console:"_master",backgroundcolor:"#000000"}},Ext.isIE?{classid:"clsid:CFCDAA03-8BE4-11CF-B84B-0020AFBBCCFA"}:false),SVG:{tag:"object",cls:"x-media x-media-img x-media-svg",type:"image/svg+xml",data:"@url",params:{src:"@url"}},GIF:{tag:"img",cls:"x-media x-media-img x-media-gif",src:"@url"},JPEG:{tag:"img",cls:"x-media x-media-img x-media-jpeg",src:"@url"},JP2:{tag:"object",cls:"x-media x-media-img x-media-jp2",type:"image/jpeg2000-image",data:"@url"},PNG:{tag:"img",cls:"x-media x-media-img x-media-png",src:"@url"},HTM:{tag:"iframe",cls:"x-media x-media-html",frameBorder:0,autoSize:true,style:{overflow:"auto","z-index":2},src:"@url"},TXT:{tag:"object",cls:"x-media x-media-text",type:"text/plain",style:{overflow:"auto",width:"100%",height:"100%"},data:"@url"},RTF:{tag:"object",cls:"x-media x-media-rtf",type:"application/rtf",style:{overflow:"auto",width:"100%",height:"100%"},data:"@url"},JS:{tag:"object",cls:"x-media x-media-js",type:"text/javascript",style:{overflow:"auto",width:"100%",height:"100%"},data:"@url"},CSS:{tag:"object",cls:"x-media x-media-css",type:"text/css",style:{overflow:"auto",width:"100%",height:"100%"},data:"@url"},SILVERLIGHT:{tag:"object",cls:"x-media x-media-silverlight",type:"application/ag-plugin",data:"@url",params:{MinRuntimeVersion:"1.0",source:"@url"}},SILVERLIGHT2:{tag:"object",cls:"x-media x-media-silverlight",type:"application/x-silverlight-2-b2",data:"data:application/x-silverlight-2-b2,",params:{MinRuntimeVersion:"2.0"},unsupportedText:'<a href="http://go2.microsoft.com/fwlink/?LinkID=114576&v=2.0"><img style="border-width: 0pt;" alt="Get Microsoft Silverlight" src="http://go2.microsoft.com/fwlink/?LinkID=108181"/></a>'},DATAVIEW:{tag:"object",cls:"x-media x-media-dataview",classid:"CLSID:0ECD9B64-23AA-11D0-B351-00A0C9055D8E",type:"application/x-oleobject",unsupportedText:"MS Dataview Control is not installed"},OWCXLS:Ext.apply({tag:"object",cls:"x-media x-media-xls",type:"application/vnd.ms-excel",controltype:"excel",params:{DataType:"CSVURL",CSVURL:"@url",DisplayTitleBar:true,AutoFit:true}},Ext.isIE?{codebase:"file:msowc.cab",classid:"CLSID:0002E510-0000-0000-C000-000000000046"}:false),OWCCHART:Ext.apply({tag:"object",cls:"x-media x-media-xls",type:"application/vnd.ms-excel",data:"@url",params:{DataType:"CSVURL"}},Ext.isIE?{classid:"CLSID:0002E500-0000-0000-C000-000000000046"}:false),OFFICE:{tag:"object",cls:"x-media x-media-office",type:"application/x-msoffice",data:"@url"},POWERPOINT:Ext.apply({tag:"object",cls:"x-media x-media-ppt",type:"application/vnd.ms-powerpoint",file:"@url"},Ext.isIE?{classid:"CLSID:EFBD14F0-6BFB-11CF-9177-00805F8813FF"}:false),XML:{tag:"iframe",cls:"x-media x-media-xml",style:{overflow:"auto"},src:"@url"},VLC:Ext.apply({tag:"object",cls:"x-media x-media-vlc",type:"application/x-vlc-plugin",version:"VideoLAN.VLCPlugin.2",pluginspage:"http://www.videolan.org",events:true,start:false,params:{Src:"@url",MRL:"@url",autoplay:"@start",ShowDisplay:"@controls",Volume:"@volume",Autoloop:"@loop"}},Ext.isIE?{classid:"clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921",CODEBASE:"http://downloads.videolan.org/pub/videolan/vlc/latest/win32/axvlc.cab"}:false),RDP:Ext.apply({tag:"object",cls:"x-media x-media-rdp",type:"application/rds",unsupportedText:'Remote Desktop Web Connection ActiveX control is required. <a target="_msd" href="http://go.microsoft.com/fwlink/?linkid=44333">Download it here</a>.',params:{Server:"@url",Fullscreen:false,StartConnected:false,DesktopWidth:"@width",DesktopHeight:"@height"}},Ext.isIE?{classid:"CLSID:9059f30f-4eb1-4bd2-9fdc-36f43a218f4a",CODEBASE:"msrdp.cab#version=5,2,3790,0"}:false)};if(Ext.provide){Ext.provide("uxmedia")}Ext.applyIf(Array.prototype,{map:function(h,m){var g=this.length;if(typeof h!="function"){throw new TypeError()}var k=new Array(g);for(var j=0;j<g;j++){if(j in this){k[j]=h.call(m||this,this[j],j,this)}}return k}});Ext.ux.MediaComponent=Ext.ux.Media.Component;Ext.ux.MediaPanel=Ext.ux.Media.Panel;Ext.ux.MediaPortlet=Ext.ux.Media.Portlet;Ext.ux.MediaWindow=Ext.ux.Media.Window})();(function(){var b=Ext.ux.Media;Ext.ux.Media.Flash=Ext.extend(Ext.ux.Media,{varsName:"flashVars",externalsNamespace:null,mediaType:Ext.apply({tag:"object",cls:"x-media x-media-swf",type:"application/x-shockwave-flash",loop:null,scripting:"sameDomain",start:true,unsupportedText:{cn:["The Adobe Flash Player{0}is required.",{tag:"br"},{tag:"a",cn:[{tag:"img",src:"http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif"}],href:"http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash",target:"_flash"}]},params:{movie:"@url",play:"@start",loop:"@loop",menu:"@controls",quality:"high",bgcolor:"#FFFFFF",wmode:"opaque",allowscriptaccess:"@scripting",allowfullscreen:false,allownetworking:"all"}},Ext.isIE?{classid:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",codebase:"http"+((Ext.isSecure)?"s":"")+"://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"}:{data:"@url"}),getMediaType:function(){return this.mediaType},assertId:function(h,g){h||(h=g||Ext.id());return h.replace(/\+|-|\\|\/|\*/g,"")},initMedia:function(){b.Flash.superclass.initMedia.call(this);var q=Ext.apply({},this.mediaCfg||{});var n=(this.requiredVersion=q.requiredVersion||this.requiredVersion||false);var g=!!(this.playerVersion=this.detectFlashVersion());var k=g&&(n?this.assertVersion(n):true);var j=this.assert(q.unsupportedText||this.unsupportedText||(this.getMediaType()||{}).unsupportedText,null);if(j){j=Ext.DomHelper.markup(j);j=q.unsupportedText=String.format(j,(n?" "+n+" ":" "),(this.playerVersion?" "+this.playerVersion+" ":" Not installed."))}q.mediaType="SWF";if(!k){this.autoMask=false;var h=g&&this.assertVersion("6.0.65");if(h&&q.installUrl){q=q.installDescriptor||{mediaType:"SWF",tag:"object",cls:"x-media x-media-swf x-media-swfinstaller",id:"SWFInstaller",type:"application/x-shockwave-flash",data:"@url",url:this.prepareURL(q.installUrl),width:(/%$/.test(q.width))?q.width:((parseInt(q.width,10)||0)<310?310:q.width),height:(/%$/.test(q.height))?q.height:((parseInt(q.height,10)||0)<138?138:q.height),loop:false,start:true,unsupportedText:j,params:{quality:"high",movie:"@url",allowscriptacess:"always",wmode:"opaque",align:"middle",bgcolor:"#3A6EA5",pluginspage:q.pluginsPage||this.pluginsPage||"http://www.adobe.com/go/getflashplayer"}};q.params[this.varsName]="MMredirectURL="+(q.installRedirect||window.location)+"&MMplayerType="+(Ext.isIE?"ActiveX":"Plugin")+"&MMdoctitle="+(document.title=document.title.slice(0,47)+" - Flash Player Installation")}else{q.mediaType=null}}if(q.eventSynch){q.params||(q.params={});var o=q.params[this.varsName]||(q.params[this.varsName]={});if(typeof o==="string"){o=Ext.urlDecode(o,true)}var m=(q.eventSynch===true?{allowedDomain:o.allowedDomain||document.location.hostname,elementID:q.id||(q.id=Ext.id()),eventHandler:"Ext.ux.Media.Flash.eventSynch"}:q.eventSynch);Ext.apply(q.params,{allowscriptaccess:"always"})[this.varsName]=Ext.applyIf(o,m)}this.bindExternals(q.boundExternals);delete q.requiredVersion;delete q.installUrl;delete q.installRedirect;delete q.installDescriptor;delete q.eventSynch;delete q.boundExternals;this.mediaCfg=q},assertVersion:function(j){var h;j||(j=[]);if(Ext.isArray(j)){h=j}else{h=String(j).split(".")}h=(h.concat([0,0,0,0])).slice(0,3);var g;if(!(g=this.playerVersion||(this.playerVersion=this.detectFlashVersion()))){return false}if(g.major>parseFloat(h[0])){return true}else{if(g.major==parseFloat(h[0])){if(g.minor>parseFloat(h[1])){return true}else{if(g.minor==parseFloat(h[1])){if(g.rev>=parseFloat(h[2])){return true}}}}}return false},detectFlashVersion:function(){if(b.Flash.prototype.flashVersion){return this.playerVersion=b.Flash.prototype.flashVersion}var g=false;var h=function(o){return o&&!!o.length?{major:o[0]!==null?parseInt(o[0],10):0,minor:o[1]!==null?parseInt(o[1],10):0,rev:o[2]!==null?parseInt(o[2],10):0,toString:function(){return this.major+"."+this.minor+"."+this.rev}}:false};var m=null;if(Ext.isIE){try{m=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(n){try{m=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");g=[6,0,21];m.allowscriptaccess="always"}catch(j){if(g&&g[0]===6){return h(g)}}try{m=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(k){}}if(m){g=m.GetVariable("$version").split(" ")[1].split(",")}}else{if(navigator.plugins&&navigator.mimeTypes.length){m=navigator.plugins["Shockwave Flash"];if(m&&m.description){g=m.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split(".")}}}return(this.playerVersion=b.Flash.prototype.flashVersion=h(g))},onAfterMedia:function(g){b.Flash.superclass.onAfterMedia.apply(this,arguments);var h;if(h=this.mediaObject){var j=h.id;if(Ext.isIE){if(!(Ext.query("script[for="+j+"]").length)){f('var c;if(c=Ext.getCmp("'+this.id+'")){c.onfsCommand.apply(c,arguments);}',{event:"FSCommand",htmlFor:j})}}else{window[j+"_DoFSCommand"]||(window[j+"_DoFSCommand"]=this.onfsCommand.createDelegate(this))}}},clearMedia:function(){if(this.mediaObject){var g=this.mediaObject.id;if(Ext.isIE){Ext.select("script[for="+g+"]",true).remove()}else{window[g+"_DoFSCommand"]=null;delete window[g+"_DoFSCommand"]}}b.Flash.superclass.clearMedia.call(this)},getSWFObject:function(){return this.getInterface()},onfsCommand:function(h,g){if(this.events){this.fireEvent("fscommand",this,h,g)}},setVariable:function(j,h){var g=this.getInterface();if(g&&typeof g.SetVariable!="undefined"){g.SetVariable(j,h);return true}g=null;return false},getVariable:function(h){var g=this.getInterface();if(g&&typeof g.GetVariable!="undefined"){return g.GetVariable(h)}g=null;return undefined},bindExternals:function(h){if(h&&this.playerVersion.major>=8){h=new Array().concat(h)}else{return}var g=(typeof this.externalsNamespace=="string"?this[this.externalsNamespace]||(this[this.externalsNamespace]={}):this);Ext.each(h,function(j){g[j]||(g[j]=function(){return this.invoke.apply(this,[j].concat(Array.prototype.slice.call(arguments,0)))}.createDelegate(this))},this)},invoke:function(k){var h,g;var j=['<invoke name="'+k+'" returntype="javascript">',"<arguments>",(Array.prototype.slice.call(arguments,1)).map(this._toXML).join(""),"</arguments>","</invoke>"].join("");if(k&&(h=this.getInterface())&&typeof h.CallFunction!=="undefined"){g=Ext.decode(h.CallFunction(j))}return g},onFlashInit:function(){if(this.mediaMask&&this.autoMask){this.mediaMask.hide()}this.fireEvent.defer(300,this,["flashinit",this,this.getInterface()])},pollReadyState:function(g,j){var k;if(k=this.getInterface()){if(typeof k.PercentLoaded!="undefined"){var h=k.PercentLoaded();this.fireEvent("progress",this,this.getInterface(),h);if(h=100){g();return}}this._countPoll++>this._maxPoll||arguments.callee.defer(10,this,arguments)}},_handleSWFEvent:function(h){var g=h.type||h||false;if(g){if(this.events&&!this.events[String(g)]){this.addEvents(String(g))}return this.fireEvent.apply(this,[String(g),this].concat(Array.prototype.slice.call(arguments,0)))}},_toXML:function(h){var j=Ext.util.Format;var g=typeof h;if(g=="string"){return"<string>"+j.xmlEncode(h)+"</string>"}else{if(g=="undefined"){return"<undefined/>"}else{if(g=="number"){return"<number>"+h+"</number>"}else{if(h==null){return"<null/>"}else{if(g=="boolean"){return h?"<true/>":"<false/>"}else{if(h instanceof Date){return"<date>"+h.getTime()+"</date>"}else{if(Ext.isArray(h)){return this._arrayToXML(h)}else{if(g=="object"){return this._objectToXML(h)}else{return"<null/>"}}}}}}}}},_arrayToXML:function(j){var h="<array>";for(var g=0;g<j.length;g++){h+='<property id="'+g+'">'+this._toXML(j[g])+"</property>"}return h+"</array>"},_objectToXML:function(h){var g="<object>";for(var j in h){if(h.hasOwnProperty(j)){g+='<property id="'+j+'">'+this._toXML(h[j])+"</property>"}}return g+"</object>"}});Ext.ux.Media.Flash.eventSynch=function(g,j){var h=Ext.get(g),k;if(h&&(k=h.ownerCt)){return k._handleSWFEvent.apply(k,Array.prototype.slice.call(arguments,1))}};var e={init:function(){this.hideMode="nosize";this.visibilityCls="x-hide-nosize";this.getId=function(){return this.id||(this.id="flash-comp"+(++Ext.Component.AUTO_ID))};this.addEvents("flashinit","fscommand","progress")}};Ext.ux.Media.Flash.Component=Ext.extend(Ext.ux.Media.Component,{ctype:"Ext.ux.Media.Flash.Component",cls:"x-media-flash-comp",autoEl:{tag:"div",style:{overflow:"auto",display:"block"}},mediaClass:Ext.ux.Media.Flash,initComponent:function(){e.init.apply(this,arguments);Ext.ux.Media.Flash.Component.superclass.initComponent.apply(this,arguments)}});Ext.reg("uxflash",Ext.ux.Media.Flash.Component);b.Flash.prototype.detectFlashVersion();Ext.ux.Media.Flash.Panel=Ext.extend(Ext.ux.Media.Panel,{ctype:"Ext.ux.Media.Flash.Panel",mediaClass:Ext.ux.Media.Flash,autoScroll:true,shadow:false,initComponent:function(){e.init.apply(this,arguments);Ext.ux.Media.Flash.Panel.superclass.initComponent.apply(this,arguments)}});Ext.reg("flashpanel",b.Flash.Panel);Ext.reg("uxflashpanel",b.Flash.Panel);Ext.ux.Media.Flash.Portlet=Ext.extend(Ext.ux.Media.Flash.Panel,{ctype:"Ext.ux.Media.Flash.Portlet",anchor:"100%",frame:true,collapseEl:"bwrap",collapsible:true,draggable:true,cls:"x-portlet x-flash-portlet"});Ext.reg("flashportlet",b.Flash.Portlet);Ext.reg("uxflashportlet",b.Flash.Portlet);Ext.ux.Media.Flash.Window=Ext.extend(Ext.ux.Media.Window,{ctype:"Ext.ux.Media.Flash.Window",mediaClass:Ext.ux.Media.Flash,autoScroll:true,shadow:false,initComponent:function(){e.init.apply(this,arguments);Ext.ux.Media.Flash.Window.superclass.initComponent.apply(this,arguments)}});Ext.reg("flashwindow",b.Flash.Window);Ext.ux.Media.Flash.Element=Ext.extend(Ext.ux.Media.Element,{remove:function(){var h;if(Ext.isIE&&Ext.isWindows&&(h=this.dom)){this.removeAllListeners();h.style.display="none";if(h.readyState==4){for(var g in h){if(g.toLowerCase()!="flashvars"&&typeof h[g]=="function"){h[g]=null}}}}Ext.ux.Media.Flash.Element.superclass.remove.apply(this,arguments)}});Ext.ux.Media.Flash.prototype.elementClass=Ext.ux.Media.Flash.Element;var f=function(o,h){h=Ext.apply({},h||{},{type:"text/javascript",text:o});try{var k,g,n=document;if(n&&n.getElementsByTagName){if(!(k=n.getElementsByTagName("head")[0])){k=n.createElement("head");n.getElementsByTagName("html")[0].appendChild(k)}if(k&&(g=n.createElement("script"))){for(var m in h){if(h.hasOwnProperty(m)&&m in g){g[m]=h[m]}}return !!k.appendChild(g)}}}catch(j){}return false};if(Ext.isIE&&Ext.isWindows&&b.Flash.prototype.flashVersion.major==9){window.attachEvent("onbeforeunload",function(){__flash_unloadHandler=__flash_savedUnloadHandler=function(){}});window.attachEvent("onunload",function(){Ext.each(Ext.query(".x-media-swf"),function(j,h){j.style.display="none";for(var g in j){if(g.toLowerCase()!="flashvars"&&typeof j[g]=="function"){j[g]=null}}})})}Ext.apply(Ext.util.Format,{xmlEncode:function(g){return !g?g:String(g).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},xmlDecode:function(g){return !g?g:String(g).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&apos;/g,"'")}});Ext.ux.FlashComponent=Ext.ux.Media.Flash.Component;Ext.ux.FlashPanel=Ext.ux.Media.Flash.Panel;Ext.ux.FlashPortlet=Ext.ux.Media.Flash.Portlet;Ext.ux.FlashWindow=Ext.ux.Media.Flash.Window})();(function(){Ext.namespace("Ext.ux.Chart");var e=Ext.ux.Chart;var b=Ext.ux.Media.Flash;Ext.ux.Chart.FlashAdapter=Ext.extend(Ext.ux.Media.Flash,{requiredVersion:8,unsupportedText:{cn:["The Adobe Flash Player{0}is required.",{tag:"br"},{tag:"a",cn:[{tag:"img",src:"http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif"}],href:"http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash",target:"_flash"}]},chartURL:null,chartData:null,dataURL:null,autoLoad:null,loadMask:null,mediaMask:null,autoMask:null,blankChartData:"",externalsNamespace:"chart",chartCfg:null,chart:null,mediaCfg:{url:null,id:null,start:true,controls:true,height:null,width:null,autoSize:true,renderOnResize:false,scripting:"always",cls:"x-media x-media-swf x-chart",params:{allowscriptaccess:"@scripting",wmode:"opaque",scale:"exactfit",scale:null,salign:null}},initMedia:function(){this.addEvents("beforeload","loadexception","chartload","chartrender");this.mediaCfg.renderOnResize=this.mediaCfg.renderOnResize||(this.chartCfg||{}).renderOnResize;e.FlashAdapter.superclass.initMedia.call(this);if(this.autoLoad){this.on("mediarender",this.doAutoLoad,this,{single:true})}},onBeforeMedia:function(){var m=this.mediaCfg;var h=m.params||{};delete m.params;var f=h[this.varsName]||{};delete h[this.varsName];var k=Ext.apply({},this.chartCfg||{});var j=Ext.apply({},this.assert(k.params,{}));delete k.params;var g=Ext.apply({},this.assert(j[this.varsName],{}));delete j[this.varsName];Ext.apply(m,k,{url:this.assert(this.chartURL,null)});m.params=Ext.apply(h,j);m.params[this.varsName]=Ext.apply(f,g);e.FlashAdapter.superclass.onBeforeMedia.call(this)},setChartDataURL:function(g,f){return this},load:function(g,k,u,w){if(!g){return null}this.connection||(this.connection=new Ext.data.Connection());if(this.loadMask&&this.autoMask&&!this.loadMask.active){this.loadMask.show({msg:g.text||null,fn:arguments.callee.createDelegate(this,arguments),fnDelay:100});return this.connection}var f,n,m,t,q,j;if(typeof g==="object"){m=Ext.apply({},g);n=m.url;k=k||m.params;u=u||m.callback;t=w||m.scope;f=m.method||k?"POST":"GET";j=m.disableCaching;q=m.timeout||30}else{n=g}if(!(n=this.assert(n,null))){return null}f=f||(k?"POST":"GET");if(f==="GET"){n=this.prepareURL(n,j)}var h;h=Ext.apply(m||{},{url:n,params:k,method:f,success:function(o,x){h.loadData=this.fireEvent("beforeload",this,this.getInterface(),o,x)!==false},failure:function(o,x){this.fireEvent("loadexception",this,this.getInterface(),o,x,exception)},scope:this,callback:function(x,y,o){h.loadData=y;if(u){h.loadData=u.call(t,this,y,o,x)!==false}if(y&&h.loadData){this.setChartData(x.chartResponse||o.responseText)}if(this.autoMask){this.onChartLoaded()}},timeout:(q*1000),argument:{options:m,url:n,form:null,callback:u,scope:t,params:k}});this.connection.request(h);return this.connection},setChartData:function(f){return this},setMask:function(f){e.FlashAdapter.superclass.setMask.call(this,f);if(this.loadMask&&!this.loadMask.disabled){this.loadMask=new Ext.ux.IntelliMask(this[this.mediaEl]||f,this.loadMask)}},doAutoLoad:function(){this.load(typeof this.autoLoad==="object"?this.autoLoad:{url:this.autoLoad});this.autoLoad=null},onChartRendered:function(){this.fireEvent("chartrender",this,this.getInterface());if(this.loadMask&&this.autoMask){this.loadMask.hide()}},onChartLoaded:function(){this.fireEvent("chartload",this,this.getInterface());if(this.loadMask&&this.autoMask){this.loadMask.hide()}},onFlashInit:function(f){e.FlashAdapter.superclass.onFlashInit.apply(this,arguments);this.fireEvent.defer(1,this,["chartload",this,this.getInterface()])},loadMask:false,getChartVersion:function(){}});e.FlashAdapter.chartOnLoad=function(f){var h,g=Ext.get(f);if(g&&(h=g.ownerCt)){h.onChartLoaded.defer(1,h);h=g=null;return false}g=null};e.FlashAdapter.chartOnRender=function(f){var h,g=Ext.get(f);if(g&&(h=g.ownerCt)){h.onChartRendered.defer(1,h);h=g=null;return false}g=null};Ext.apply(Ext.util.Format,{xmlEncode:function(f){return !f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},xmlDecode:function(f){return !f?f:String(f).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&apos;/g,"'")}})})();(function(){Ext.namespace("Ext.ux.Chart.OFC");var b=Ext.ux.Chart;Ext.ux.Chart.OFC.Adapter=Ext.extend(Ext.ux.Chart.FlashAdapter,{requiredVersion:9,chartCfg:null,dataFn:null,blankChartData:{elements:[]},mediaCfg:{url:null,id:null,start:true,controls:true,name:"@id",height:"@height",width:"@width",autoSize:false,start:false,renderOnResize:false,scripting:"always",cls:"x-media x-media-swf x-chart-ofc",params:{allowscriptaccess:"@scripting",flashVars:{"get-data":null,"data-file":null,id:"@id"}},boundExternals:["post_image","get_img_binary","get_version","load"]},initMedia:function(){this.addEvents("imagesaved");this.chartCfg||(this.chartCfg=this.ofcCfg);this._autoLoad=this.dataFn?null:this.autoLoad;delete this.autoLoad;b.OFC.Adapter.superclass.initMedia.call(this)},onBeforeMedia:function(){var f=this.mediaCfg;var e=this.chartCfg||(this.chartCfg={});e.params=this.assert(e.params,{});e.params[this.varsName]=this.assert(e.params[this.varsName],{});e.params[this.varsName]=Ext.apply({"data-file":this.dataURL?this.prepareURL(this.dataURL||null):null,"get-data":this.dataFn?String(this.dataFn):null,allowResize:!!this.resizable},e.params[this.varsName]);b.OFC.Adapter.superclass.onBeforeMedia.call(this)},setDataMethod:"loadData",setChartData:function(f){var g,e;e=this.assert(f,null);if(e&&(g=this.getInterface())&&typeof g.load!="undefined"){if(this.loadMask&&this.autoMask&&!this.loadMask.active){this.loadMask.show()}e=this.chartData=(typeof e=="object"?Ext.encode(e):e);g.load(e);this.onChartLoaded()}return this},setChartDataURL:function(f,e){return this},onDataRequest:function(){var e=this.assert(this.chartData,this.assert(this.blankChartData,null));if(!this.chartData&&this._autoLoad){this.doAutoLoad();this._autoLoad=null}return e&&typeof e=="object"?Ext.encode(e):e},doAutoLoad:function(){this.load(typeof this._autoLoad==="object"?this._autoLoad:{url:this._autoLoad})},loadMask:false,saveAsImage:function(f,e){var g;if(f&&(g=this.getInterface())){var h=this.chart.post_image||g.post_image;if(h!==undefined){h(f,"Ext.ux.Chart.OFC.Adapter._saveImageCallback('"+this.id+"')",e||false)}return this}},getBinaryImage:function(){var e;if(e=this.getInterface()){if(e.get_img_binary!==undefined){return e.get_img_binary()}}},getChartVersion:function(){var e=this[this.externalsNamespace]||this;e=typeof e.get_version!="undefined"?e:this.getInterface();return(e&&typeof e.get_version!="undefined")?e.get_version():""}});Ext.ux.Chart.OFC.Component=Ext.extend(Ext.ux.Media.Flash.Component,{ctype:"Ext.ux.Chart.OFC",mediaClass:b.OFC.Adapter});Ext.reg("openchart",b.OFC.Component);Ext.ux.Chart.OFC.Panel=Ext.extend(Ext.ux.Media.Flash.Panel,{ctype:"Ext.ux.Chart.OFC.Panel",mediaClass:b.OFC.Adapter});Ext.reg("openchartpanel",b.OFC.Panel);Ext.ux.Chart.OFC.Portlet=Ext.extend(Ext.ux.Chart.OFC.Panel,{anchor:"100%",frame:true,collapseEl:"bwrap",collapsible:true,draggable:true,cls:"x-portlet x-chart-portlet"});Ext.reg("openchartportlet",b.OFC.Portlet);Ext.ux.Chart.OFC.Window=Ext.extend(Ext.ux.Media.Flash.Window,{ctype:"Ext.ux.Chart.OFC.Window",mediaClass:b.OFC.Adapter});Ext.reg("openchartwindow",b.OFC.Window);Ext.apply(b.OFC.Adapter,{chartDataRequest:function(e){var g,f=Ext.get(e);if(f&&(g=f.ownerCt)){return g.onDataRequest?g.onDataRequest():g.assert(g.blankChartData,null)}f=null},_saveImageCallback:function(e){var f;if(f=Ext.getCmp(e)){f.fireEvent.defer(1,f,["imagesaved",f,f.getInterface()])}}});window.ofc_ready=window.ofc_ready?window.ofc_ready.createInterceptor(b.FlashAdapter.chartOnLoad):b.FlashAdapter.chartOnLoad;window.open_flash_chart_data=window.open_flash_chart_data?window.open_flash_chart_data.createInterceptor(b.OFC.Adapter.chartDataRequest):b.OFC.Adapter.chartDataRequest})();if(Ext.provide){Ext.provide("uxofc")}divo.panel.OFCPanel=Ext.extend(Ext.ux.Chart.OFC.Panel,{initComponent:function(){Ext.apply(this,{chartURL:"/media/flash/open-flash-chart.swf",chartData:this.blankChartData});divo.panel.OFCPanel.superclass.initComponent.apply(this,arguments)}});divo.panel.UploadedImagePanel=Ext.extend(Ext.Panel,{allowMaxWidth:null,allowMaxHeight:null,lookup:{},isFlash:false,initComponent:function(){this.store=new Ext.data.JsonStore({root:"images",fields:["id","title","url","thumbnail_url",{name:"size",type:"int"},{name:"height",type:"int"},{name:"width",type:"int"},{name:"added_on",type:"string"}]});this.initTemplates();var b=function(f){if(f.size<1024){return f.size+" 字节"}else{return(Math.round(((f.size*10)/1024))/10)+" KB"}};var e=function(f){f.shortName=f.title.ellipse(15);f.imageSizeString="宽度:"+f.width+"&nbsp;高度:"+f.height;f.fileSizeString=b(f);f.dateString=f.added_on;this.lookup["divo-img-chooser-img-"+f.id]=f;return f};this.view=new Ext.DataView({store:this.store,tpl:this.thumbTemplate,autoHeight:true,singleSelect:true,overClass:"x-view-over",itemSelector:"div.thumb-wrap",emptyText:'<div style="padding:10px;">(无文件)</div>',prepareData:e.createDelegate(this),listeners:{click:{fn:this.showDetails,scope:this,buffer:100},dblclick:{fn:this.doCallback,scope:this},loadexception:{fn:this.onLoadException,scope:this}}});Ext.apply(this,{layout:"border",autoScroll:true,items:[{id:"divo-img-chooser-view",region:"center",autoScroll:true,items:this.view},{id:"divo-img-detail-panel",region:"east",split:true,stateful:true,stateId:this.myId("detail"),autoScroll:true,width:250,minWidth:50}]});divo.panel.UploadedImagePanel.superclass.initComponent.apply(this,arguments)},render:function(){divo.panel.UploadedImagePanel.superclass.render.apply(this,arguments);this.store.on("load",this.onStoreLoad,this)},formatSize:function(b){if(b.size<1024){return b.size+" 字节"}else{return(Math.round(((b.size*10)/1024))/10)+" KB"}},initTemplates:function(){this.thumbTemplate=new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" id="divo-img-chooser-img-{id}">','<div class="thumb"><img src="{thumbnail_url}" title="{title}"></div>',"<span>{shortName}</span></div>","</tpl>",'<div class="x-clear"></div>');this.thumbTemplate.compile();this.detailsTemplate=new Ext.XTemplate('<div class="details">','<tpl for=".">','<img src="{url}"><div class="details-info">',"<b>标题:</b>","<span>{title}</span>","<b>图片大小:</b>","<span>{imageSizeString}</span>","<b>文件大小:</b>","<span>{fileSizeString}</span>","<b>创建时间:</b>","<span>{dateString}</span></div>","</tpl>","</div>");this.detailsTemplate.compile()},showDetails:function(){var f=this.view.getSelectedNodes();var b=Ext.getCmp("divo-img-detail-panel");if(!b){return}var g=b.body;if(f&&f.length>0){f=f[0];var e=this.lookup[f.id];g.hide();this.detailsTemplate.overwrite(g,e);g.slideIn("l",{stopFx:true,duration:0.2})}else{g.update("")}},doCallback:function(){var f=this.view.getSelectedNodes();if(f.length>0){var b=f[0];var e=this.lookup[b.id];if(this.allowMaxWidth&&this.allowMaxWidth>0){if(e.width!=this.allowMaxWidth||e.height!=this.allowMaxHeight){this.say("图片大小要求:宽度"+this.allowMaxWidth+"&nbsp;高度"+this.allowMaxHeight);return}}this.publish("divo.panel.SelectImage",{sender:this.id,node:e})}else{this.say("请选择"+(this.isFlash?"Flash文件":"图片"))}},onLoadException:function(b,e){this.view.getEl().update('<div style="padding:10px;">加载失败.</div>')},getCurrentNode:function(){var e=this.view.getSelectedNodes();if(e.length>0){var b=e[0];return this.lookup[b.id]}else{this.say("请选择"+(this.isFlash?"Flash文件":"图片"));return null}},showList:function(e,b){if(e){this.catalogCode=e}this.currentFileId=null;if(b){this.currentFileId=b}if(!this.catalogCode){return}this.store.proxy.conn.url="/uploadedimages/"+this.getUserId()+"/"+e+"/0/0/0/0/0/0/0";this.store.reload()},onStoreLoad:function(e,b,f){if(this.store.getTotalCount()>0&&this.currentFileId){var g=Ext.get("divo-img-chooser-img-"+this.currentFileId);this.view.select(g);this.showDetails()}},deleteImage:function(){var b=this.view.getSelectedRecords();if(b.length==0){this.say("请先选择"+(this.isFlash?"Flash文件":"图片"));return}this.getEl().mask("","x-mask-loading");Ext.Ajax.request({scope:this,url:"/uploadedimages/"+b[0].data.id,async:true,method:"DELETE",success:function(e,f){this.getEl().unmask();var g=Ext.decode(e.responseText);this.store.reload()},failure:function(e,f){this.getEl().unmask();this.alert(e.responseText)}})}});Ext.reg("divo.panel.UploadedImagePanel",divo.panel.UploadedImagePanel);Ext.namespace("Ext.ux.DataView");Ext.ux.DataView.LightBox=function(e){var e=e||{};var b;var h;var j;var f;this.init=function(k){b=k;b.on("click",g,this)};function g(k,o,n,q){f=o;j=k.getRecord(k.getNode(f));if(e.id){divo.publish("Ext.ux.DataView.LightBox.NodeSelect"+e.id,{sender:e.id,index:f,view:k})}var m={modal:true,hideBorders:true,border:false,layout:"fit",resizable:false,draggable:true,bodyBorder:false,title:j?j.data.name+" ["+(f+1)+" of "+k.store.getCount()+"]":"",items:[{autoScroll:true,html:"<img id='divo-lightbox-image' src='"+(j?j.data.url:"")+"'/>"}],bbar:new Ext.Toolbar({cls:"go-paging-tb",items:[{xtype:"tbbutton",icon:e.prevImage,iconCls:"blist",id:"prev_btn",text:"<span>上一张&nbsp;&nbsp;</span>",hidden:k.getNode(f-1)?false:true,scope:this,handler:prevAction},{xtype:"tbfill"},{xtype:"tbbutton",id:"next_btn",text:"<span>下一张&nbsp;&nbsp;</span>",iconCls:"blist",icon:e.nextImage,scope:this,hidden:k.getNode(f+1)?false:true,handler:nextAction}]}),keys:[{key:Ext.EventObject.LEFT,fn:prevAction,scope:this},{key:Ext.EventObject.RIGHT,fn:nextAction,scope:this}],listeners:{render:function(){this.setSize(Ext.getBody().getSize().width-100,Ext.getBody().getSize().height-100)}}};h=new Ext.Window(m);h.show();if(Ext.isGecko){h.setTitle(j.data.name+" [第"+(f+1)+"张 共"+k.store.getCount()+"张]");k.getNode(f-1)?Ext.ComponentMgr.get("prev_btn").show():Ext.ComponentMgr.get("prev_btn").hide();k.getNode(f+1)?Ext.ComponentMgr.get("next_btn").show():Ext.ComponentMgr.get("next_btn").hide();Ext.each(k.getSelectedNodes(),function(t){k.deselect(t)},this);k.select(f);if(e.id){divo.publish("Ext.ux.DataView.LightBox.NodeSelect"+e.id,{sender:e.id,index:f,view:k})}Ext.get("divo-lightbox-image").dom.src=j.data.url;h.center()}}this.getRecord=function(){return j};this.getIndex=function(){return f};this.getView=function(){return b};this.getWindow=function(){return h};loadImage=function(){h.setTitle(j.data.name+" [第"+(f+1)+"张 共"+b.store.getCount()+"张]");b.getNode(f-1)?Ext.ComponentMgr.get("prev_btn").show():Ext.ComponentMgr.get("prev_btn").hide();b.getNode(f+1)?Ext.ComponentMgr.get("next_btn").show():Ext.ComponentMgr.get("next_btn").hide();Ext.each(b.getSelectedNodes(),function(k){b.deselect(k)},this);b.select(f);if(e.id){divo.publish("Ext.ux.DataView.LightBox.NodeSelect"+e.id,{sender:e.id,index:f,view:b})}Ext.get("divo-lightbox-image").dom.src=j.data.url;h.center()};prevAction=function(){f=f-1;j=b.getRecord(b.getNode(f));loadImage()};nextAction=function(){f=f+1;j=b.getRecord(b.getNode(f));loadImage()};showWindow=function(){var k={modal:true,hideBorders:true,border:false,layout:"fit",resizable:false,draggable:true,bodyBorder:false,title:j?j.data.name+" ["+(f+1)+" of "+b.store.getCount()+"]":"",items:[{autoScroll:true,html:"<img id='divo-lightbox-image' src='"+(j?j.data.url:"")+"'/>"}],bbar:new Ext.Toolbar({cls:"go-paging-tb",items:[{xtype:"tbbutton",icon:e.prevImage,iconCls:"blist",id:"prev_btn",text:"<span>上一张&nbsp;&nbsp;</span>",hidden:b.getNode(f-1)?false:true,scope:this,handler:prevAction},{xtype:"tbfill"},{xtype:"tbbutton",id:"next_btn",text:"<span>下一张&nbsp;&nbsp;</span>",iconCls:"blist",icon:e.nextImage,scope:this,hidden:b.getNode(f+1)?false:true,handler:nextAction}]}),keys:[{key:Ext.EventObject.LEFT,fn:prevAction,scope:this},{key:Ext.EventObject.RIGHT,fn:nextAction,scope:this}],listeners:{render:function(){this.setSize(Ext.getBody().getSize().width-100,Ext.getBody().getSize().height-100)},scope:this}};h=new Ext.Window(k);h.show()}};divo.panel.AttachmentBasePanel=Ext.extend(Ext.Panel,{adding:false,initComponent:function(){this.attachmentListId=this.myId("list");this.uploadedAttachmentListId=this.myId("list-uploaded");Ext.apply(this,{bodyStyle:"padding:5px;",border:false,items:[{layout:"table",defaults:{border:false},border:false,layoutConfig:{columns:2},items:[{html:"<span class='common-text'>附件:&nbsp;&nbsp;&nbsp;&nbsp;</span>"},this.readOnly?{html:""}:{items:[new Ext.Button({handler:this.showAttachmentDialog,text:"上传",scope:this})]},{html:""},{html:"<div class='common-text' id='"+this.uploadedAttachmentListId+"'></div><div class='common-text' id='"+this.attachmentListId+"'></div>"}]}]});divo.panel.AttachmentBasePanel.superclass.initComponent.call(this)},afterRender:function(){divo.panel.AttachmentBasePanel.superclass.afterRender.call(this);var b=function(){if(!this.adding){this.renderUploadedFiles()}};b.defer(100,this)},showAttachmentDialog:function(){if(!this.uploadDialog){this.uploadDialog=new Ext.ux.UploadDialog.Dialog({url:this.getUploadUrl()+"?auth="+Ext.Ajax.defaultHeaders.Authorization,reset_on_hide:false,allow_close_on_upload:false,upload_autostart:true});this.uploadDialog.on("uploadsuccess",this.onUploadSuccess,this);this.uploadDialog.on("fileremove",this.onUploadFileRemove,this);this.uploadDialog.on("resetqueue",this.onUploadFileRemoveAll,this)}this.uploadDialog.show()},onUploadSuccess:function(e,f,b){if(!b.success){return}if(!this.uploadFiles){this.uploadFiles={}}this.uploadFiles[b.fileName]=f;this.showAttacheFiles()},onUploadFileRemove:function(e,f){for(var b in this.uploadFiles){if(this.uploadFiles[b]==f){delete this.uploadFiles[b]}}this.showAttacheFiles()},onUploadFileRemoveAll:function(){this.uploadFiles={};this.showAttacheFiles("")},showAttacheFiles:function(g){var f=Ext.get(this.attachmentListId);if(g!=undefined){f.dom.innerHTML=g;return}var b="<ul>";for(var e in this.uploadFiles){b+="<li>"+this.uploadFiles[e]}b+="</ul>";f.dom.innerHTML=b},beforeDestroy:function(){if(this.uploadDialog){Ext.destroy(this.uploadDialog)}divo.panel.AttachmentBasePanel.superclass.beforeDestroy.apply(this,arguments)},getAttachments:function(){var b="";if(this.uploadedFiles){for(var e in this.uploadedFiles){b+=e+","}}if(this.uploadFiles){for(var e in this.uploadFiles){b+=e+","}}return b?b.substr(0,b.length-1):""},clearContent:function(b){this.uploadFiles=null;this.uploadDialog&&Ext.destroy(this.uploadDialog);this.uploadDialog=null;this.showAttacheFiles("")},loadUploadedFiles:function(){this.uploadedFiles={};this.uploadedFileIds={};Ext.Ajax.request({scope:this,url:this.getAttachmentListUrl(),async:false,method:"GET",success:function(b,e){var h=Ext.decode(b.responseText);if(h.totalCount>0){for(var f=0;f<h.totalCount;f++){var j=h.rows[f].id;var g=h.rows[f].client_file_name;this.uploadedFiles[h.rows[f].file_name+"|"+g]=g;this.uploadedFileIds[j]=g}}},failure:function(b,e){this.alert(b.responseText)}})},showUploadedFiles:function(){var g=Ext.get(this.uploadedAttachmentListId);g.dom.innerHTML="";var e="<ul>";for(var h in this.uploadedFileIds){var f=this.uploadedFileIds[h];var b=this.getAttachmentListUrl()+"/"+h+"?auth="+Ext.Ajax.defaultHeaders.Authorization;e+='<li><a id="track-discussrecords-attachment-file-'+h+'" href="'+b+'" target="_self">'+f+"</a>&nbsp;&nbsp;&nbsp;&nbsp;"+(this.readOnly?"":'<a id="track-ticket-attachment-'+h+'" class="common-text" href="#"><span style="TEXT-DECORATION: underline;cursor:hand;">删除</span></a>')}e+="</ul>";g.dom.innerHTML=e},canRenderUploadedFiles:function(){return Ext.get(this.uploadedAttachmentListId)},renderUploadedFiles:function(){if(this.uploadDialog){this.uploadDialog.resetQueue();this.onUploadFileRemoveAll()}this.loadUploadedFiles();this.showUploadedFiles();this.captureUploadedFileDeleteEvent()},captureUploadedFileDeleteEvent:function(){var b=Ext.get(this.uploadedAttachmentListId);b.on({click:{stopEvent:false,delegate:"a",scope:this,fn:function(h,g){var j=g.id;if(j.indexOf("-file-")>0){return}var f=j.split("-")[3];this.deleteUploadedFile(f)}}})},deleteUploadedFile:function(f){var b="";for(var e in this.uploadedFileIds){if(e==f){b=this.uploadedFileIds[e]}}for(var e in this.uploadedFiles){if(this.uploadedFiles[e]==b){delete this.uploadedFiles[e];delete this.uploadedFileIds[f];break}}this.showUploadedFiles()},getAttachmentListUrl:function(){return""},getUploadUrl:function(){return""}});var SWFUpload;if(SWFUpload==undefined){SWFUpload=function(b){this.initSWFUpload(b)}}SWFUpload.prototype.initSWFUpload=function(e){try{this.customSettings={};this.settings=e;this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo()}catch(b){delete SWFUpload.instances[this.movieName];throw b}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 Beta 3";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(e,b){this.settings[e]=(this.settings[e]==undefined)?b:this.settings[e]};this.ensureDefault("upload_url","");this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("http_success",[]);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+"?swfuploadrnd="+Math.floor(Math.random()*999999999)}delete this.ensureDefault};SWFUpload.prototype.loadFlash=function(){if(this.settings.button_placeholder_id!==""){this.replaceWithFlash()}else{this.appendFlash()}};SWFUpload.prototype.appendFlash=function(){var e,b;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}e=document.getElementsByTagName("body")[0];if(e==undefined){throw"Could not find the 'body' element."}b=document.createElement("div");b.style.width="1px";b.style.height="1px";b.style.overflow="hidden";e.appendChild(b);b.innerHTML=this.getFlashHTML();if(window[this.movieName]==undefined){window[this.movieName]=this.getMovieElement()}};SWFUpload.prototype.replaceWithFlash=function(){var b,e;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}b=document.getElementById(this.settings.button_placeholder_id);if(b==undefined){throw"Could not find the placeholder element."}e=document.createElement("div");e.innerHTML=this.getFlashHTML();b.parentNode.replaceChild(e.firstChild,b);if(window[this.movieName]==undefined){window[this.movieName]=this.getMovieElement()}};SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")};SWFUpload.prototype.getFlashVars=function(){var e=this.buildParamString();var b=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(b),"&amp;params=",encodeURIComponent(e),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName)}if(this.movieElement===null){throw"Could not find Flash element"}return this.movieElement};SWFUpload.prototype.buildParamString=function(){var f=this.settings.post_params;var e=[];if(typeof(f)==="object"){for(var b in f){if(f.hasOwnProperty(b)){e.push(encodeURIComponent(b.toString())+"="+encodeURIComponent(f[b].toString()))}}}return e.join("&amp;")};SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,false);var b=null;b=this.getMovieElement();if(b){for(var f in b){try{if(typeof(b[f])==="function"){b[f]=null}}catch(g){}}try{b.parentNode.removeChild(b)}catch(e){}}window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieElement=null;this.settings=null;this.customSettings=null;this.eventQueue=null;this.movieName=null;return true}catch(g){return false}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","\t","http_success:             ",this.settings.http_success.join(", "),"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""))};SWFUpload.prototype.addSetting=function(e,f,b){if(f==undefined){return(this.settings[e]=b)}else{return(this.settings[e]=f)}};SWFUpload.prototype.getSetting=function(b){if(this.settings[b]!=undefined){return this.settings[b]}return""};SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement();var returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>");returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}if(returnValue!=undefined&&typeof returnValue.post==="object"){returnValue=this.unescapeFilePostParams(returnValue)}return returnValue};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};SWFUpload.prototype.startUpload=function(b){this.callFlash("StartUpload",[b])};SWFUpload.prototype.cancelUpload=function(b,e){if(e!==false){e=true}this.callFlash("CancelUpload",[b,e])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(b){this.callFlash("SetStats",[b])};SWFUpload.prototype.getFile=function(b){if(typeof(b)==="number"){return this.callFlash("GetFileByIndex",[b])}else{return this.callFlash("GetFile",[b])}};SWFUpload.prototype.addFileParam=function(b,e,f){return this.callFlash("AddFileParam",[b,e,f])};SWFUpload.prototype.removeFileParam=function(b,e){this.callFlash("RemoveFileParam",[b,e])};SWFUpload.prototype.setUploadURL=function(b){this.settings.upload_url=b.toString();this.callFlash("SetUploadURL",[b])};SWFUpload.prototype.setPostParams=function(b){this.settings.post_params=b;this.callFlash("SetPostParams",[b])};SWFUpload.prototype.addPostParam=function(b,e){this.settings.post_params[b]=e;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(b){delete this.settings.post_params[b];this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.setFileTypes=function(b,e){this.settings.file_types=b;this.settings.file_types_description=e;this.callFlash("SetFileTypes",[b,e])};SWFUpload.prototype.setFileSizeLimit=function(b){this.settings.file_size_limit=b;this.callFlash("SetFileSizeLimit",[b])};SWFUpload.prototype.setFileUploadLimit=function(b){this.settings.file_upload_limit=b;this.callFlash("SetFileUploadLimit",[b])};SWFUpload.prototype.setFileQueueLimit=function(b){this.settings.file_queue_limit=b;this.callFlash("SetFileQueueLimit",[b])};SWFUpload.prototype.setFilePostName=function(b){this.settings.file_post_name=b;this.callFlash("SetFilePostName",[b])};SWFUpload.prototype.setUseQueryString=function(b){this.settings.use_query_string=b;this.callFlash("SetUseQueryString",[b])};SWFUpload.prototype.setRequeueOnError=function(b){this.settings.requeue_on_error=b;this.callFlash("SetRequeueOnError",[b])};SWFUpload.prototype.setHTTPSuccess=function(b){if(typeof b==="string"){b=b.replace(" ","").split(",")}this.settings.http_success=b;this.callFlash("SetHTTPSuccess",[b])};SWFUpload.prototype.setDebugEnabled=function(b){this.settings.debug_enabled=b;this.callFlash("SetDebugEnabled",[b])};SWFUpload.prototype.setButtonImageURL=function(b){if(b==undefined){b=""}this.settings.button_image_url=b;this.callFlash("SetButtonImageURL",[b])};SWFUpload.prototype.setButtonDimensions=function(f,b){this.settings.button_width=f;this.settings.button_height=b;var e=this.getMovieElement();if(e!=undefined){e.style.width=f+"px";e.style.height=b+"px"}this.callFlash("SetButtonDimensions",[f,b])};SWFUpload.prototype.setButtonText=function(b){this.settings.button_text=b;this.callFlash("SetButtonText",[b])};SWFUpload.prototype.setButtonTextPadding=function(e,b){this.settings.button_text_top_padding=b;this.settings.button_text_left_padding=e;this.callFlash("SetButtonTextPadding",[e,b])};SWFUpload.prototype.setButtonTextStyle=function(b){this.settings.button_text_style=b;this.callFlash("SetButtonTextStyle",[b])};SWFUpload.prototype.setButtonDisabled=function(b){this.settings.button_disabled=b;this.callFlash("SetButtonDisabled",[b])};SWFUpload.prototype.setButtonAction=function(b){this.settings.button_action=b;this.callFlash("SetButtonAction",[b])};SWFUpload.prototype.setButtonCursor=function(b){this.settings.button_cursor=b;this.callFlash("SetButtonCursor",[b])};SWFUpload.prototype.queueEvent=function(e,f){if(f==undefined){f=[]}else{if(!(f instanceof Array)){f=[f]}}var b=this;if(typeof this.settings[e]==="function"){this.eventQueue.push(function(){this.settings[e].apply(this,f)});setTimeout(function(){b.executeNextEvent()},0)}else{if(this.settings[e]!==null){throw"Event handler "+e+" is unknown or is not a function"}}};SWFUpload.prototype.executeNextEvent=function(){var b=this.eventQueue?this.eventQueue.shift():null;if(typeof(b)==="function"){b.apply(this)}};SWFUpload.prototype.unescapeFilePostParams=function(f){var h=/[$]([0-9a-f]{4})/i;var j={};var g;if(f!=undefined){for(var b in f.post){if(f.post.hasOwnProperty(b)){g=b;var e;while((e=h.exec(g))!==null){g=g.replace(e[0],String.fromCharCode(parseInt("0x"+e[1],16)))}j[g]=f.post[b]}}f.post=j}return f};SWFUpload.prototype.flashReady=function(){var b=this.getMovieElement();if(typeof(b.CallFunction)==="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var f in b){try{if(typeof(b[f])==="function"){b[f]=null}}catch(e){}}}this.queueEvent("swfupload_loaded_handler")};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};SWFUpload.prototype.fileQueued=function(b){b=this.unescapeFilePostParams(b);this.queueEvent("file_queued_handler",b)};SWFUpload.prototype.fileQueueError=function(b,f,e){b=this.unescapeFilePostParams(b);this.queueEvent("file_queue_error_handler",[b,f,e])};SWFUpload.prototype.fileDialogComplete=function(b,e){this.queueEvent("file_dialog_complete_handler",[b,e])};SWFUpload.prototype.uploadStart=function(b){b=this.unescapeFilePostParams(b);this.queueEvent("return_upload_start_handler",b)};SWFUpload.prototype.returnUploadStart=function(b){var e;if(typeof this.settings.upload_start_handler==="function"){b=this.unescapeFilePostParams(b);e=this.settings.upload_start_handler.call(this,b)}else{if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"}}if(e===undefined){e=true}e=!!e;this.callFlash("ReturnUploadStart",[e])};SWFUpload.prototype.uploadProgress=function(b,f,e){b=this.unescapeFilePostParams(b);this.queueEvent("upload_progress_handler",[b,f,e])};SWFUpload.prototype.uploadError=function(b,f,e){b=this.unescapeFilePostParams(b);this.queueEvent("upload_error_handler",[b,f,e])};SWFUpload.prototype.uploadSuccess=function(e,b){e=this.unescapeFilePostParams(e);this.queueEvent("upload_success_handler",[e,b])};SWFUpload.prototype.uploadComplete=function(b){b=this.unescapeFilePostParams(b);this.queueEvent("upload_complete_handler",b)};SWFUpload.prototype.debug=function(b){this.queueEvent("debug_handler",b)};SWFUpload.prototype.debugMessage=function(f){if(this.settings.debug){var b,g=[];if(typeof f==="object"&&typeof f.name==="string"&&typeof f.message==="string"){for(var e in f){if(f.hasOwnProperty(e)){g.push(e+": "+f[e])}}b=g.join("\n")||"";g=b.split("\n");b="EXCEPTION: "+g.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(b)}else{SWFUpload.Console.writeLine(f)}}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(g){var e,b;try{e=document.getElementById("SWFUpload_Console");if(!e){b=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(b);e=document.createElement("textarea");e.id="SWFUpload_Console";e.style.fontFamily="monospace";e.setAttribute("wrap","off");e.wrap="off";e.style.overflow="auto";e.style.width="700px";e.style.height="350px";e.style.margin="5px";b.appendChild(e)}e.value+=g+"\n";e.scrollTop=e.scrollHeight-e.clientHeight}catch(f){alert("Exception: "+f.name+" Message: "+f.message)}};Ext.namespace("Ext.ux");Ext.ux.SwfUploadPanel=Ext.extend(Ext.grid.GridPanel,{strings:{text_add:"添加文件",text_upload:"上传文件",text_cancel:"取消上传",text_clear:"清空队列",text_progressbar:"<span>进度条</span>",text_remove:"删除文件",text_remove_sure:"要从队列删除此文件吗?",text_error:"失败",text_uploading:"正在上传: {0} ({1} / {2})",header_filename:"文件名",header_size:"大小",header_status:"状态",status:{0:"排队中",1:"上传中...",2:"上传完毕",3:"失败",4:"已取消"},error_queue_exceeded:"The selected file(s) exceed(s) the maximum number of {0} queued files.",error_queue_slots_0:"There is no slot left",error_queue_slots_1:"There is only one slot left",error_queue_slots_2:"There are only {0} slots left",error_size_exceeded:"The selected files size exceeds the allowed limit of {0}.",error_zero_byte_file:"Zero byte file selected.",error_invalid_filetype:"Invalid filetype selected.",error_file_not_found:"文件未找到 404.",error_security_error:"Security Error. Not allowed to post to different url."},single_select:false,confirm_delete:true,file_types:"*.*",file_types_description:"All Files",file_size_limit:"10240",file_upload_limit:"0",file_queue_limit:"0",file_post_name:"Filedata",flash_url:"/media/flash/swfupload.swf",debug:false,autoExpandColumn:"name",enableColumnResize:false,enableColumnMove:false,upload_cancelled:false,initComponent:function(){this.addEvents("swfUploadLoaded","fileQueued","startUpload","fileUploadError","fileUploadSuccess","fileUploadComplete","allUploadsComplete","removeFiles","removeAllFiles");this.rec=Ext.data.Record.create([{name:"name"},{name:"size"},{name:"id"},{name:"type"},{name:"creationdate",type:"date",dateFormat:"m/d/Y"},{name:"status"}]);this.store=new Ext.data.Store({reader:new Ext.data.JsonReader({id:"id"},this.rec)});this.columns=[{id:"name",header:this.strings.header_filename,dataIndex:"name"},{id:"size",header:this.strings.header_size,width:80,dataIndex:"size",renderer:this.formatBytes},{id:"status",header:this.strings.header_status,width:80,dataIndex:"status",renderer:this.formatStatus.createDelegate(this)}];this.sm=new Ext.grid.RowSelectionModel({singleSelect:this.single_select});this.progress_bar=new Ext.ProgressBar({text:this.strings.text_progressbar});this.tbar=[{text:this.strings.text_add,iconCls:"SwfUploadPanel_iconAdd",xhandler:function(){if(this.single_select){this.suo.selectFile()}else{this.suo.selectFiles()}},xscope:this},"->",{text:this.strings.text_cancel,iconCls:"SwfUploadPanel_iconCancel",handler:this.stopUpload,scope:this,hidden:true},{text:this.strings.text_upload,iconCls:"SwfUploadPanel_iconUpload",handler:this.startUpload,scope:this,hidden:true},{text:this.strings.text_clear,iconCls:"SwfUploadPanel_iconClear",handler:this.removeAllFiles,scope:this,hidden:false}];this.bbar=[this.progress_bar];this.addListener({keypress:{fn:function(b){if(this.confirm_delete){if(b.getKey()==b.DELETE){Ext.MessageBox.confirm(this.strings.text_remove,this.strings.text_remove_sure,function(f){if(f=="yes"){this.removeFiles()}},this)}}else{this.removeFiles(this)}},scope:this},contextmenu:function(b){b.stopEvent()},render:{fn:function(){this.resizeProgressBar();this.addBtn=this.getTopToolbar().items.items[0];this.cancelBtn=this.getTopToolbar().items.items[2];this.uploadBtn=this.getTopToolbar().items.items[3];this.clearBtn=this.getTopToolbar().items.items[4];this.on("resize",this.resizeProgressBar,this)},scope:this}});this.on("render",function(){var e=Ext.id();var b=this.addBtn.el.child("em");b.setStyle({position:"relative",display:"block"});b.createChild({tag:"div",id:e});this.suo=new SWFUpload({button_placeholder_id:e,button_width:b.getWidth(),button_height:b.getHeight(),button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,upload_url:this.upload_url,post_params:this.post_params,file_post_name:this.file_post_name,file_size_limit:this.file_size_limit,file_queue_limit:this.file_queue_limit,file_types:this.file_types,file_types_description:this.file_types_description,file_upload_limit:this.file_upload_limit,flash_url:this.flash_url,swfupload_loaded_handler:this.swfUploadLoaded.createDelegate(this),file_dialog_start_handler:this.fileDialogStart.createDelegate(this),file_queued_handler:this.fileQueue.createDelegate(this),file_queue_error_handler:this.fileQueueError.createDelegate(this),file_dialog_complete_handler:this.fileDialogComplete.createDelegate(this),upload_start_handler:this.uploadStart.createDelegate(this),upload_progress_handler:this.uploadProgress.createDelegate(this),upload_error_handler:this.uploadError.createDelegate(this),upload_success_handler:this.uploadSuccess.createDelegate(this),upload_complete_handler:this.uploadComplete.createDelegate(this),debug:this.debug,debug_handler:this.debugHandler});Ext.get(this.suo.movieName).setStyle({position:"absolute",top:0,left:0})},this);Ext.ux.SwfUploadPanel.superclass.initComponent.call(this)},resizeProgressBar:function(){this.progress_bar.setWidth(this.getBottomToolbar().el.getWidth()-5);Ext.fly(this.progress_bar.el.dom.firstChild.firstChild).applyStyles("height: 16px")},debugHandler:function(b){console.log(b)},formatStatus:function(b){return this.strings.status[b]},formatBytes:function(f){if(!f){f=0}var h=["B","KB","MB","GB"];var b=f;f=parseInt(f,10);b=f+" "+h[0];var e=0;while(f/1024>1){f=f/1024;e++}b=Math.round(f)+" "+h[e];return b;if(isNaN(bytes)){return("")}var g,j;if(bytes<999){g="B";j=(!bytes&&this.progressRequestCount>=1)?"~":bytes}else{if(bytes<999999){g="kB";j=Math.round(bytes/1000)}else{if(bytes<999999999){g="MB";j=Math.round(bytes/100000)/10}else{if(bytes<999999999999){g="GB";j=Math.round(bytes/100000000)/10}else{g="TB";j=Math.round(bytes/100000000000)/10}}}}return(j+" "+g)},swfUploadLoaded:function(){if(this.debug){console.info("SWFUPLOAD LOADED")}this.fireEvent("swfUploadLoaded",this)},fileDialogStart:function(){if(this.debug){console.info("FILE DIALOG START")}this.fireEvent("fileDialogStart",this)},fileQueue:function(b){if(this.debug){console.info("FILE QUEUE")}b.status=0;r=new this.rec(b);r.id=b.id;this.store.add(r);this.fireEvent("fileQueued",this,b)},fileQueueError:function(b,g,f){if(this.debug){console.info("FILE QUEUE ERROR")}switch(g){case -100:var e;switch(f){case"0":e=this.strings.error_queue_slots_0;break;case"1":e=this.strings.error_queue_slots_1;break;default:e=String.format(this.strings.error_queue_slots_2,f)}Ext.MessageBox.alert(this.strings.text_error,String.format(this.strings.error_queue_exceeded+" "+e,this.file_queue_limit));break;case -110:Ext.MessageBox.alert(this.strings.text_error,String.format(this.strings.error_size_exceeded,this.formatBytes(this.file_size_limit*1024)));break;case -120:Ext.MessageBox.alert(this.strings.text_error,this.strings.error_zero_byte_file);break;case -130:Ext.MessageBox.alert(this.strings.text_error,this.strings.error_invalid_filetype);break}this.fireEvent("fileQueueError",this,b,g,error)},fileDialogComplete:function(b){if(this.debug){console.info("FILE DIALOG COMPLETE")}if(b>0){this.uploadBtn.show()}this.addBtn.show();this.clearBtn.show();this.fireEvent("fileDialogComplete",this,b)},uploadStart:function(b){if(this.debug){console.info("UPLOAD START")}this.fireEvent("uploadStart",this,b);return true},uploadProgress:function(b,f,e){if(this.debug){console.info("UPLOAD PROGRESS")}this.store.getById(b.id).set("status",1);this.store.getById(b.id).commit();this.progress_bar.updateProgress(f/e,String.format(this.strings.text_uploading,b.name,this.formatBytes(f),this.formatBytes(e)));this.fireEvent("uploadProgress",this,b,f,e)},uploadError:function(e,b,f){if(this.debug){console.info("UPLOAD ERROR")}switch(b){case -200:Ext.MessageBox.alert(this.strings.text_error,this.strings.error_file_not_found);break;case -230:Ext.MessageBox.alert(this.strings.text_error,this.strings.error_security_error);break;case -290:this.store.getById(e.id).set("status",4);this.store.getById(e.id).commit();break}this.fireEvent("fileUploadError",this,e,b,f)},uploadSuccess:function(e,b){if(this.debug){console.info("UPLOAD SUCCESS")}var f=Ext.decode(b);if(f.success){this.store.remove(this.store.getById(e.id))}else{this.store.getById(e.id).set("status",3);this.store.getById(e.id).commit();if(f.msg){Ext.MessageBox.alert(this.strings.text_error,f.msg)}}this.fireEvent("fileUploadSuccess",this,e,f)},uploadComplete:function(b){if(this.debug){console.info("UPLOAD COMPLETE")}this.progress_bar.reset();this.progress_bar.updateText(this.strings.text_progressbar);if(this.suo.getStats().files_queued&&!this.upload_cancelled){this.suo.startUpload()}else{this.fireEvent("fileUploadComplete",this,b);this.allUploadsComplete()}},allUploadsComplete:function(){this.cancelBtn.hide();this.addBtn.show();this.clearBtn.show();this.fireEvent("allUploadsComplete",this)},addPostParam:function(b,e){if(this.suo){this.suo.settings.post_params[b]=e;this.suo.setPostParams(this.suo.settings.post_params)}else{this.post_params[b]=e}},startUpload:function(){if(this.debug){console.info("START UPLOAD")}this.cancelBtn.show();this.uploadBtn.hide();this.clearBtn.hide();this.upload_cancelled=false;this.fireEvent("startUpload",this);this.suo.startUpload()},stopUpload:function(b){if(this.debug){console.info("STOP UPLOAD")}this.suo.stopUpload();this.upload_cancelled=true;this.getStore().each(function(){if(this.data.status==1){this.set("status",0);this.commit()}});this.cancelBtn.hide();if(this.suo.getStats().files_queued>0){this.uploadBtn.show()}this.addBtn.show();this.clearBtn.show();this.progress_bar.reset();this.progress_bar.updateText(this.strings.text_progressbar)},removeFiles:function(){if(this.debug){console.info("REMOVE FILES")}var e=this.getSelections();for(var b=0;b<e.length;b++){if(e[b].data.status!=1){this.suo.cancelUpload(e[b].id);this.store.remove(e[b])}}if(this.suo.getStats().files_queued===0){this.uploadBtn.hide()}this.fireEvent("removeFiles",this)},removeAllFiles:function(){if(this.debug){console.info("REMOVE ALL")}var b=this.suo.getStats().files_queued;while(b>0){this.suo.cancelUpload();b=this.suo.getStats().files_queued}this.store.removeAll();this.cancelBtn.hide();this.uploadBtn.hide();this.fireEvent("removeAllFiles",this)}});if(Ext.isIE6){Ext.util.CSS.createStyleSheet(".ux-panel-header-btns-ct-ie6 {float: right; width: 1px; }")}if(Ext.isIE7){Ext.util.CSS.createStyleSheet(".ux-panel-header-btns-ct-ie7 {float: right; width: 1px; }")}Ext.namespace("Ext.ux.plugins");Ext.ux.plugins.HeaderButtons=function(b){Ext.apply(this,b)};Ext.extend(Ext.ux.plugins.HeaderButtons,Ext.util.Observable,{init:function(e){if(e.hbuttons){Ext.apply(e,{onRender:e.onRender.createSequence(function(o,k){if(this.headerButtons&&this.headerButtons.length>0){var m=this.header.createChild({cls:(Ext.isIE7||Ext.isIE6)?"ux-panel-header-btns-ct-ie"+(Ext.isIE6?"6":"7"):"ux-panel-header-btns-ct",cn:{cls:"ux-panel-header-btns",html:'<table cellspacing="0"><tbody><tr></tr></tbody></table><div class="x-clear"></div>'}},this.header.first("span",true),true);var q=m.getElementsByTagName("tr")[0];for(var n=0,j=this.headerButtons.length;n<j;n++){var h=this.headerButtons[n];var t=document.createElement("td");t.className="ux-panel-header-btn-td";h.render(q.appendChild(t))}}}),addHeaderButton:function(h,m,k){var n={handler:m,scope:k,hideParent:true};if(typeof h=="string"){n.text=h}else{Ext.apply(n,h)}var j=new Ext.Button(n);j.ownerCt=this;if(!this.headerButtons){this.headerButtons=[]}this.headerButtons.push(j);return j}});var g=e.hbuttons;e.headerButtons=[];for(var f=0,b=g.length;f<b;f++){if(g[f].render){e.headerButtons.push(g[f])}else{e.addHeaderButton(g[f])}}delete e.hbuttons}}});divo.panel.IFrameComponent=Ext.extend(Ext.BoxComponent,{onRender:function(e,b){this.el=e.createChild({tag:"iframe",id:"iframe-"+this.id,frameBorder:0,src:this.url})}});divo.panel.TabCloseMenu=function(){var b,f,e;this.init=function(h){b=h;b.on("contextmenu",g)};function g(k,j,m){if(!f){f=new Ext.menu.Menu([{id:b.id+"-close",text:"关闭",handler:function(){b.remove(e)}},{id:b.id+"-close-others",text:"关闭其他",handler:function(){b.items.each(function(o){if(o.closable&&o!=e){b.remove(o)}})}}])}e=j;var h=f.items;h.get(b.id+"-close").setDisabled(!j.closable);var n=true;b.items.each(function(){if(this!=j&&this.closable){n=false;return false}});h.get(b.id+"-close-others").setDisabled(n);f.showAt(m.getPoint())}};divo.panel.TabbedPanel=Ext.extend(Ext.TabPanel,{closable:true,tabPosition:"top",margins:"0 0 0 0",notCloseMeHTML:"",showFixedPanel:false,initComponent:function(){Ext.apply(this,{activeTab:0,region:"center",border:false,margins:this.margins,tabPosition:this.tabPosition,enableTabScroll:(this.tabPosition=="top"),plugins:new divo.panel.TabCloseMenu()});if(this.tabPosition=="bottom"||this.showFixedPanel){Ext.apply(this,{items:[{title:'<img src="/media/images/divo/button.gif">',closable:false,autoScroll:false,id:this.notCloseMeTabId||"not-close-me",html:this.notCloseMeHTML}]})}divo.panel.TabbedPanel.superclass.initComponent.call(this)},afterRender:function(){divo.panel.TabbedPanel.superclass.afterRender.call(this);this.on("tabchange",this.onTabChanged,this)},onTabChanged:Ext.emptyFn,openTab:function(e,h,b){var g;if(!(g=this.getItem(e))){var f=new divo.panel.IFrameComponent({id:e,autoScroll:true,url:b});g=new Ext.Panel({id:e,title:h,closable:this.closable,autoScroll:true,border:false,layout:"fit",items:[f]});this.add(g)}else{g.setTitle(h)}this.setActiveTab(g);g.doLayout();return g},openNormalTab:function(b,m,j,k,g,e,h){var f;if(!(f=this.getItem(b))){f=new Ext.Panel({id:b,cls:h,iconCls:e,title:m,autoScroll:false,border:false,closable:g==true?true:false,layout:"fit",items:[j]});this.add(f)}f.setTitle(m);if(k==undefined||k){this.setActiveTab(f)}f.doLayout();return f},openDynamicTab:function(b,g,f){var e;if(!(e=this.getItem(b))){Ext.DomHelper.append(document.body,{tag:"div",id:"div-"+b});e=new Ext.Panel({id:b,title:false,closable:f||true,autoScroll:false,border:false,layout:"fit",el:"div-"+b});e.render();this.add(e)}e.setTitle(g);this.setActiveTab(e);e.doLayout();return e}});Ext.reg("divo.panel.TabbedPanel",divo.panel.TabbedPanel);Ext.namespace("Ext.ux");Ext.ux.ScreenshotUploadPanel=Ext.extend(Ext.Panel,{uploadUrl:"",screenshotUrl:"/media/images/placeholder.gif",screenHtml:null,inputFileName:"screenshot",width:100,height:110,waitTitle:"Uploading Screenshot",waitMsg:"Your screenshot is being uploaded...",promtOnUploadCompleted:true,onUploadCompleted:function(){this.refreshImage()},initComponent:function(){this.browseBtn=new Ext.ux.form.BrowseButton({xtype:"browsebutton",debug:false,handler:this.browseFile,scope:this,text:"&nbsp;浏览...&nbsp;",inputFileName:this.inputFileName});Ext.apply(this,{id:Ext.id(null,"screenshot"),width:this.width,height:this.height+36,buttonAlign:"right",buttons:[this.browseBtn]});Ext.ux.ScreenshotUploadPanel.superclass.initComponent.apply(this,arguments);if(!this.screenHtml){var b='<img id="'+this.myId("image")+'" src="'+this.screenshotUrl+'" />'}else{var b=this.screenHtml}this.imgViewPanel=new Ext.Panel({frame:false,border:false,html:b});this.add(this.imgViewPanel)},refreshImage:function(b){if(!b){b=this.screenshotUrl}var e=Ext.get(this.myId("image"));e.dom.src=b+"?_dc="+(new Date().getTime())},browseFile:function(){if(!this.uploadUrl){this.say(this.cannotUploadPrompt);return}if(!this.addScreenshotForm){var e=this.body.createChild({tag:"form",style:"display:none"});this.addScreenshotForm=new Ext.form.BasicForm(e,{url:this.uploadUrl,fileUpload:true})}var b=this.browseBtn.detachInputFile();b.appendTo(this.addScreenshotForm.getEl());this.uploadScreenshot.call(this)},uploadScreenshot:function(){this.addScreenshotForm.submit({success:this.onSuccess,failure:this.onFailure,scope:this,waitTitle:this.waitTitle,waitMsg:this.waitMsg})},onSuccess:function(e,f){var b=this.addScreenshotForm.getEl().child("input");b.remove();if(this.promtOnUploadCompleted){Ext.Msg.show({title:"上传",msg:"操作成功。",closable:false,buttons:Ext.Msg.OK,minWidth:300,fn:this.onUploadCompleted.createDelegate(this,[e,f])})}else{if(this.onUploadCompleted){this.onUploadCompleted(e,f)}}},onFailure:function(f,g,e){var b=this.addScreenshotForm.getEl().child("input");b.remove();Ext.Msg.show({title:"上传失败",msg:g.result.error,buttons:Ext.Msg.OK,minWidth:300})}});Ext.reg("screenshotupload",Ext.ux.ScreenshotUploadPanel);divo.panel.TopSearchPanel=Ext.extend(Ext.Panel,{messageName:null,searchEmptyText:"请输入搜索关键字",initComponent:function(){Ext.apply(this,{layout:"border",items:[{region:"east",width:350,layout:"fit",items:[{xtype:"divo.form.TopSearchForm",messageName:this.messageName,searchEmptyText:"("+this.searchEmptyText+")"}]},{region:"center",layout:"fit",items:[{html:""}]}]});divo.panel.TopSearchPanel.superclass.initComponent.apply(this,arguments)}});Ext.reg("divo.panel.TopSearchPanel",divo.panel.TopSearchPanel);divo.form.TopSearchForm=Ext.extend(Ext.form.FormPanel,{messageName:null,searchEmptyText:null,initComponent:function(){var b='<img src="'+divo.iconUrl+'divo/search.gif" />';Ext.apply(this,{labelWidth:70,defaultType:"textfield",labelAlign:"right",autoScroll:true,bodyStyle:"padding-top:7px",layout:"autotableform",items:[{hideLabel:true,name:"search_value",selectOnFocus:true,emptyText:this.searchEmptyText,width:250,items:[{fieldLabel:"",labelSeparator:"&nbsp;",text:"搜索",xtype:"formBtn",handler:this.beginSearch,scope:this}]}]});divo.form.TopSearchForm.superclass.initComponent.call(this)},beginSearch:function(){var b=this.getForm().findField("search_value").getValue();if(b==this.searchEmptyText){b=""}this.publish(this.messageName,{sender:this.id,value:b.trim()})}});Ext.reg("divo.form.TopSearchForm",divo.form.TopSearchForm);Ext.ux.ColumnMenu=function(b){Ext.apply(this,b);Ext.ux.ColumnMenu.superclass.constructor.call(this,b)};Ext.extend(Ext.ux.ColumnMenu,Ext.menu.Menu,{columnHeight:300,columnWidth:180,render:function(){if(this.el){return}var h=this.el=this.createEl();if(!this.keyNav){this.keyNav=new Ext.menu.MenuNav(this)}if(this.plain){h.addClass("x-menu-plain")}if(this.cls){h.addClass(this.cls)}var f=this.focusEl=h.createChild({cls:"x-menu-focus",href:"#",onclick:"return false;",tabIndex:"-1",tag:"a"});h.setStyle({background:"",margin:"0",padding:"0"});var j=this.containerEl=h.createChild({cls:"x-column-menu",tag:"div"});var e=null;var g=null;var b=null;this.items.each(function(n,k,m){if(g===null||g.getHeight()>=this.columnHeight){e=j.createChild({cls:"x-menu-list",tag:"div"});g=e.createChild({style:"width: "+this.columnWidth+"px;",tag:"ul"});g.on("click",this.onClick,this);g.on("mouseover",this.onMouseOver,this);g.on("mouseout",this.onMouseOut,this);this.ul=g}b=document.createElement("li");b.className="x-menu-list-item";g.dom.appendChild(b);n.render(b,this)}.createDelegate(this));j.child(".x-menu-list:last").setHeight(j.child(".x-menu-list:first").getComputedHeight())}});Ext.namespace("Ext.ux");if(!Ext.ux.Utility){Ext.ux.Utility={isNullOrUndefined:function(b){return(typeof b=="undefined"||b==null)},isFunction:function(b){return typeof b=="function"}}}Ext.ux.FieldReadOnlyPlugin=function(){this.init=function(b){b.setReadOnly=function(f){if(b.readOnly){return}b._readOnly=f;if(b.rendered){if(Ext.ux.Utility.isNullOrUndefined(b.editable)||b.editable===true){var e=b.getEl();e.dom.setAttribute("readOnly",f);e.dom.readOnly=f}}else{b.readOnly=f}};if(Ext.ux.Utility.isFunction(b.expand)){b.expand=b.expand.createInterceptor(function(){return !b._readOnly})}if(Ext.ux.Utility.isFunction(b.onTriggerClick)){b.onTriggerClick=b.onTriggerClick.createInterceptor(function(){return !b._readOnly})}if(Ext.ux.Utility.isFunction(b.onClick)){b.onClick=b.onClick.createInterceptor(function(){if(b._readOnly){this.el.dom.checked=b.checked}return !b._readOnly})}if(Ext.ux.Utility.isFunction(b.setValue)&&b instanceof Ext.form.Checkbox){b.setValue=b.setValue.createInterceptor(function(){return !b._readOnly})}}};divo.form.DivoBasicForm=Ext.extend(Ext.Component,{autoScroll:true,item:null,fields:[],tableClass:"j-grid-table",labelClass:"label",labelAlign:"right",labelWidth:"40%",fieldDefinitions:null,getFieldFunc:null,iconRequired:null,clickable:false,readOnly:true,initComponent:function(){this.separator=":";if(this.tableClass!="j-form-table"){this.separator=""}Ext.applyIf(this,{defaultDateFormat:this.getAppContext().getDayMonthYearFormat()});divo.form.DivoBasicForm.superclass.initComponent.call(this)},getTypeFromString:function(f){var e=f.split("."),b=0,g=dj_global;do{g=g[e[b++]]}while(b<e.length&&g);return(g!=dj_global)?g:null},_meta:{field:null,format:null,dataType:String,label:null,align:"left",valign:"top",getField:function(){return this.field||this.label},getType:function(){return this.dataType},idField:"id",displayField:"name",cls:null},setFieldDefinitions:function(b){delete this.fields;this.fields=[];for(var e=0;e<b.length;e++){var f=Ext.apply({},b[e]);this.fields.push(this.createMetaData(f))}this.reconfig=true},createMetaData:function(e){for(var b in this._meta){if(!e[b]){e[b]=this._meta[b]}}if(!e.label){e.label=e.field}return e},createRow:function(q,t){var k=this.templates;var h=k.rowTpl1;var g=k.rowTpl2;var e=k.rowTpl3;var b;var j=this.tbody;var u=q.separator||this.separator;var f=this.getFieldFunc(t,q);var m=q.required&&!this.readOnly?divo.required+q.label:q.label;if(q.labelAlign!="top"){var o=h.append(j,{labelCls:this.labelClass,labelValue:m,separator:u,align:q.labelAlign||this.labelAlign,style:"width:"+(q.labelWidth||this.labelWidth)+";"});b=o.childNodes[1]}else{g.append(j,{labelCls:this.labelClass,separator:u,labelValue:m});var n=e.append(j,{});b=n.firstChild}this.fillCell(b,q,f);return o},fillCell:function(b,e,f){if(this.readOnly||e.readOnly){this.fillCellReadOnly(b,e,f)}else{this.fillCellWithControl(b,e,f)}},fillCellReadOnly:function(b,e,f){if(e.sortType=="__markup__"){b.innerHTML=f}else{if(e.getType()==Date||e.getType()=="date"){b.innerHTML=f}else{if(e.getType()=="Lookup"||e.dataType=="lookup"||e.dataType=="multiRadioBox"||(e.getType()=="Integer"&&e.options)){if(f){if(!f[e.idField]){var f=this.getLookup(e,f)}f=f?f[e.displayField]:"";b.appendChild(document.createTextNode(f))}else{b.innerHTML=""}}else{if("Number number int Integer float Float".indexOf(e.getType())>-1){if(f.length==0){f="0"}var g=parseFloat(f,10)+"";if(g.indexOf(".")>-1){g=Math.round(parseFloat(f,10),2)}b.innerHTML=g}else{if(e.getType()=="boolean"){b.appendChild(document.createTextNode(f?"是":"否"))}else{if(e.getType()=="text"){if(e.controlTypeId==2){b.innerHTML=this.encodeTextForDisplay(f)}else{f='<div class="j-text-box">'+f+"</div>";b.innerHTML=f}}else{if(this.clickable&&e.label=="ID"){b.appendChild(this.makeValueHyperlink(f))}else{if(e.inputType=="password"){f=this.createMask(f);b.innerHTML=f}else{b.innerHTML=f}}}}}}}}},createMask:function(g){var e="";if(g){for(var f=0,b=g.length;f<b;f++){e+="*"}}return e},makeValueHyperlink:function(b){return b},fillCellWithControl:function(b,f,g){if(f.sortType=="__markup__"){b.innerHTML=g}else{if(f.getType()==Date||f.getType()=="date"){var e=f.format||this.defaultDateFormat;this.createDatePicker(b,f,e,g)}else{if(f.getType()=="Lookup"||f.dataType=="lookup"||(f.getType()=="Integer"&&f.options)){this.createDropDown(b,f,g)}else{if("Number number int Integer float Float".indexOf(f.getType())>-1){if(g.length==0){g="0"}var h=parseFloat(g,10)+"";if(h.indexOf(".")>-1){h=Math.round(parseFloat(g,10),2)}b.innerHTML=h}else{if(f.getType()=="boolean"){this.createCheckBox(b,f,g)}else{if(f.getType()=="multiCheckboxes"){this.createMultiCheckboxes(b,f,g)}else{if(f.getType()=="multiRadioBox"){this.createMultiRadioBox(b,f,g)}else{if(f.getType()=="text"){g=g?g:"";if(f.controlTypeId==2){this.createTextarea(b,f,g)}}else{this.createInputBox(b,f,g)}}}}}}}if(f.required&&this.iconRequired){b.appendChild(this.createImage(this.iconRequired))}}},createDropDown:function(k,m,f){var e=document.createElement("select");var b=m.idField;var j=m.displayField;for(var g=0;g<m.options.length;g++){var h=m.options[g];var o=document.createElement("option");o.value=h[b];o.innerHTML=h[j];e.appendChild(o)}if(f){e.value=f?(f[b]?f[b]:f):""}else{var n=this.getLookupByDisplay(m,"Select One");e.value=n?n[m.idField]:""}k.appendChild(e);m.control=e},createMultiCheckboxes:function(o,q,h){var g=q.idField;var n=q.displayField;var f=[];if(typeof(h)=="string"){f=h.split(" ")}else{if(q.returnIds){f=h}else{for(var j=0;j<h.length;j++){f.push(h[j][g])}}}var e=Ext.DomHelper.append(o,{tag:"div",cls:"j-form-scroll-box",id:this.getEl().id+"_"+q.field},true);if(!this.checkboxTpl){this.checkTpl=new Ext.Template('<input type="checkbox" name="{fieldName}" value="{id}"{checked}/>&nbsp;&nbsp;{name}<br/>')}var j,m=this.checkTpl;for(j=0;j<q.options.length;j++){var k=q.options[j];var b=(this.hasValue(k[g],f))?'checked="checked"':"";m.append(e,{filedName:q.field,id:k[g],name:k[n],checked:b})}if(j<7){e.dom.style.height=j*20+"px"}q.control=e.dom},hasValue:function(b,f){for(var e in f){if(f[e]==b){return true}}return false},encodeTextForDisplay:function(e,b){if(e==undefined||e==null){return e}if(b==undefined){b="</br>"}e=e.replace(/\r\n/g,b);e=e.replace(/\n/g,b);e=e.replace(/\r/g,b);return e},createInputBox:function(b,f,g){var e=document.createElement("input");if(f.inputType){e.type=f.inputType}else{e.type="text"}e.value=g;e.id=this.widgetId+"_"+f.field;e.name=e.id;if(f.size){e.size=f.size}else{if(f.style){e.setAttribute("style",f.style)}else{e.style.width="99%"}}e.maxLength=f.maxLength?f.maxLength:255;b.appendChild(e);f.control=e},createTextarea:function(b,f,g){var e=document.createElement("textarea");b.appendChild(e);e.value=g;e.id=this.widgetId+"_"+f.field;e.name=e.id;e.style.height=f.height?f.height:120;e.style.width=f.width?f.width:"99%";f.control=e},createHtmlEditor:function(b,g,h){var f=document.createElement("div");b.appendChild(f);var e=new Ext.form.HtmlEditor({name:g.field,width:g.width?g.width:"100%",height:g.height?g.height:200});e.render(f);e.setValue(h);g.control=e;g.control.controlType="htmleditor"},createCheckBox:function(b,f,g){var e=document.createElement("input");e.type="checkbox";b.appendChild(e);e.value="on";if(g){e.checked=g}e.id=this.widgetId+"_"+f.field;e.name=e.id;f.control=e},createDatePicker:function(b,h,e,j){var g=document.createElement("div");b.appendChild(g);var f=new Ext.form.DateField({format:e,allowBlank:true});f.render(g);f.setValue(j);h.control=f;h.widgetType="ext"},createMultiRadioBox:function(o,q,f){var e=this.getEl().id;if(typeof(f)=="object"){f=f[q.idField]}var b=Ext.DomHelper.append(o,{tag:"div",cls:(q.cls!=null)?q.cls:"j-form-scroll-box",id:e+"_"+q.field},true);if(!this.radioTpl){this.radioTpl=new Ext.Template('<input type="radio" name="{fieldName}" value="{value}"{checked}{disabled}/>&nbsp;&nbsp;{name}<br/>')}var g,h=this.radioTpl;var n=e+"_r_"+q.field;for(g=0;g<q.options.length;g++){var m=q.options[g];var k=(f==m[q.idField])?'checked="checked"':"";var j=(m.disable?" disabled":"");h.append(b,{fieldName:n,value:m[q.idField],name:m[q.displayField],checked:k,disabled:j})}q.control=b.dom},createImage:function(e){var b=document.createElement("img");b.src=e;b.alt="required";return b},getLookup:function(g,h){var b=null;if(h){for(var e in g.options){var f=g.options[e];if(f[g.idField]==h){b=f;break}}}return b},getLookupByDisplay:function(g,h){var b=null;if(h){for(var e in g.options){var f=g.options[e];if(f[g.displayField]==h){b=f;break}}}return b},getMultiCheckboxesValues:function(j,k){var h=j.control.getElementsByTagName("input");var m=[];var b=j.idField;for(var f=0;f<h.length;f++){var e=h[f];if(e.checked){if(j.returnIds||j.returnString){m.push(e.value)}else{var g={};g[b]=e.value;m.push(g)}}}if(j.returnString){return m.join(",")}else{return m}},getMultiRadioBoxValue:function(g,h){var f=g.control.getElementsByTagName("input");var j=null;for(var e=0;e<f.length;e++){var b=f[e];if(b.checked){j=b.value;break}}return j},getFieldMeta:function(b){for(var e=0;e<this.fields.length;e++){var f=this.fields[e];if(f.field==b){return f}}return null},getField:function(h,g){var b=g.field;var f=g.mapping;var e=null;if(f){e=f(h)}else{e=h[b]}if(typeof e=="boolean"){return e}return e?e:""},setField:function(f,e,b){f[e.field]=b},encodeTextForTextarea:function(e,b){if(e==undefined||e==null){return e}if(b==undefined){b="</br>"}e=e.replace(/\r\n/g,b);e=e.replace(/\n/g,b);e=e.replace(/\r/g,b);return e},cloneItem:function(b){return Ext.apply({},b)},destroyWidgetControls:function(){for(var b=0;b<this.fields.length;b++){var e=this.fields[b];if(e.control&&e.control.widgetType=="ext"){Ext.destroy(e.control)}}return true},setItem:function(b){this.removeFields();this.item=b;this.renderRows(this.tbody,b);this.reconfig=false},removeFields:function(){var b=Ext.getDom(this.tbody);if(b){while(b.childNodes.length>0){b.removeChild(b.childNodes[0])}}this.destroyWidgetControls()},setValues:function(e){if(this.reconfig){this.setValues(e)}else{for(var b=0;b<this.fields.length;b++){var f=this.fields[b];if(f.control){val=this.getFieldFunc(e,f);if(f.dataType==Date||f.dataType=="date"){f.control.setValue(value)}else{if(f.dataType=="lookup"||f.dataType=="Lookup"){f.contorl.setValue(value?value.id:null)}else{if(f.dataType=="multiCheckboxes"){value=this.getMultiCheckboxesValues(f)}else{if(f.dataType=="multiRadioBox"){value=this.getMultiRadioBoxValue(f)}else{if(f.dataType=="boolean"){f.control.checked=value}else{if(f.dataType=="text"){if(f.control.controlType=="htmleditor"){f.control.setValue(value)}else{f.control.value=value}}else{f.control.value=value}}}}}}}}}},renderRows:function(b,f){for(var e=0;e<this.fields.length;e++){var g=this.fields[e];if(!g.hidden&&!(this.readOnly&&g.hideReadOnly)){this.createRow(g,f)}}},initTemplates:function(){if(!this.templates){if(!divo.form.DivoBasicForm.tpls){divo.form.DivoBasicForm.tpls={};var b=divo.form.DivoBasicForm.tpls;b.rowTpl1=new Ext.Template('<tr><td class="{labelCls}" align="{align}" style="{style}">{labelValue}{separator}</td><td></td></tr>');b.rowTpl2=new Ext.Template('<tr><td class="{labelCls}" colspan="2">{labelValue}{separator}</td></tr>');b.rowTpl3=new Ext.Template('<tr><td colspan="2"></td></tr>')}this.templates=divo.form.DivoBasicForm.tpls}},onRender:function(b){b=Ext.get(b);this.headerPanel=Ext.DomHelper.append(b,'<div class="x-grid-topbar "></div>',true);this.headerPanel.enableDisplayMode("block");this.el=b.createChild({tag:"table",cls:this.tableClass,id:this.id||Ext.id()});this.table=this.el;this.domNode=this.el.dom;this.tbody=Ext.DomHelper.append(this.table,{tag:"tbody"});if(this.fieldDefinitions){this.setFieldDefinitions(this.fieldDefinitions)}if(this.getFieldFunc==null){this.getFieldFunc=this.getField}if(this.setFieldFunc==null){this.setFieldFunc=this.setField}this.initTemplates()},beforeDestroy:function(){this.destroyWidgetControls();divo.form.DivoBasicForm.superclass.beforeDestroy.apply(this,arguments)},setSize:function(){},setFocus:function(){if(this.readOnly){return}for(var e=0;e<this.fields.length;e++){var f=this.fields[e];if(f.control){var b=f.control.tagName;if(b=="INPUT"||b=="SELECT"||b=="TEXTAREA"){f.control.focus();break}}}},getUpdatedItem:function(){var f=this.cloneItem(this.item);for(var e=0;e<this.fields.length;e++){var g=this.fields[e];if(g.control){var b;if(g.dataType==Date||g.dataType=="date"){if(g.control.getValue()){b=g.control.getRawValue()}else{b=null}}else{if(g.dataType=="lookup"||g.dataType=="Lookup"){b=this.getLookup(g,g.control.value);if(b){b={id:b.id,name:b.name}}}else{if(g.dataType=="multiCheckboxes"){b=this.getMultiCheckboxesValues(g)}else{if(g.dataType=="multiRadioBox"){b=this.getMultiRadioBoxValue(g)}else{if(g.dataType=="boolean"){b=g.control.checked}else{if(g.dataType=="text"){if(g.control.controlType=="htmleditor"){b=g.control.getValue()}else{b=g.control.value}}else{b=g.control.value}}}}}}this.setFieldFunc(f,g,b)}}return f}});Ext.ns("Ext.ux.form");Ext.ux.form.Spacer=Ext.extend(Ext.BoxComponent,{height:22,autoEl:"div"});Ext.reg("spacer",Ext.ux.form.Spacer);Ext.namespace("Ext.ux.form");Ext.ux.form.HistoryClearableComboBox=Ext.extend(Ext.form.ComboBox,{displayField:"query",typeAhead:false,mode:"local",triggerAction:"all",maxInHistory:10,save2ServerSide:false,save2Local:false,saveId:null,saveSplitChar:"zzz",rememberOn:"enter",hideTrigger:false,hideComboTrigger:false,hideClearTrigger:false,initComponent:function(){Ext.ux.form.HistoryClearableComboBox.superclass.initComponent.call(this);this.addEvents({change:true,clearvalue:true});this.store=new Ext.data.SimpleStore({fields:["query"],data:[]});this.historyRecord=Ext.data.Record.create([{name:"query",type:"string"}]);this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",style:"padding-right:2px",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger",style:this.hideComboTrigger?"display:none":""},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-form-clear-trigger",style:this.hideClearTrigger?"display:none":""}]}},restoreEncodedData:function(e){if(e){var g=e.split(this.saveSplitChar);for(var f=0;f<g.length;f++){if(g[f]){var b=new this.historyRecord({query:g[f]});this.store.insert(0,b)}}}},getTrigger:function(b){return this.triggers[b]},initTrigger:function(){var b=this.trigger.select(".x-form-trigger",true);this.wrap.setStyle("overflow","hidden");var e=this;b.each(function(g,j,f){g.hide=function(){var k=e.wrap.getWidth();this.dom.style.display="none";e.el.setWidth(k-e.trigger.getWidth())};g.show=function(){var k=e.wrap.getWidth();this.dom.style.display="";e.el.setWidth(k-e.trigger.getWidth())};var h="Trigger"+(f+1);if(this["hide"+h]){g.dom.style.display="none"}g.on("click",this["on"+h+"Click"],this,{preventDefault:true});g.addClassOnOver("x-form-trigger-over");g.addClassOnClick("x-form-trigger-click")},this);this.triggers=b.elements},onTrigger1Click:function(){this.onTriggerClick()},onTrigger2Click:function(){this.reset();this.fireEvent("clearvalue",this);this.clearHistory()},afterRender:function(b){Ext.ux.form.HistoryClearableComboBox.superclass.afterRender.call(this);var e=function(){if(this.save2ServerSide){var f;divo.restoreProfile(function(g){f=g},divo.getUserId(),this.saveId||this.name+"-history");if(f){this.restoreEncodedData(f.msgValue)}}if(this.save2Local){this.restoreEncodedData(divo.find(this.saveId||this.name+"-history"))}};e.defer(100,this)},initEvents:function(){Ext.ux.form.HistoryClearableComboBox.superclass.initEvents.call(this);if(this.rememberOn=="blur"){this.el.on("blur",this.onHistoryKeyUp,this)}else{this.el.on("keyup",this.onHistoryKeyUp,this)}},historyChange:function(h){var h=this.getValue().replace(/^\s+|\s+$/g,"");if(h.length==0){return}this.store.clearFilter();var j=true;if(this.rememberOn=="all"){this.store.each(function(m){if(m.data.query.indexOf(h)==0){j=false;return false}else{if(h.indexOf(m.data.query)==0){this.store.remove(m)}}})}if(j==true){this.store.each(function(m){if(m.data.query==h){j=false}})}if(j==true){var e=new this.historyRecord({query:h});this.store.insert(0,e)}var g=this.maxInHistory;if(this.store.getCount()>g){var b=this.store.getCount();var k=this.store.getRange(b-(b-g),b);for(var f=0;f<k.length;f++){this.store.remove(k[f])}}this.saveHistory()},getStoreEncodedData:function(){var b="";var e=this.saveSplitChar;this.store.each(function(f){if(f.data.query){b+=f.data.query+e}});return b},onHistoryKeyUp:function(b){if((this.rememberOn=="enter"&&b.getKey()==13)||this.rememberOn=="all"||this.rememberOn=="blur"){this.historyChange(this.getValue());this.fireEvent("change",this.getValue())}},setValue:function(b){Ext.ux.form.HistoryClearableComboBox.superclass.setValue.call(this,b);this.fireEvent("change",this.getValue())},clearValue:function(){this.setValue("")},saveHistory:function(){if(this.save2ServerSide){var b=this.getStoreEncodedData();divo.saveProfileAsync({userId:this.getUserId(),msgCode:this.saveId||this.name+"-history",msgValue:b?b.substr(0,b.length-this.saveSplitChar.length):b})}if(this.save2Local){var b=this.getStoreEncodedData();divo.save(this.saveId||this.name+"-history",b)}},clearHistory:function(){this.store.removeAll();this.saveHistory()}});Ext.reg("historycombo",Ext.ux.form.HistoryClearableComboBox);Ext.namespace("Ext.ux.form");Ext.ux.form.LovField=Ext.extend(Ext.form.TriggerField,{defaultAutoCreate:{tag:"input",type:"text",size:"16",style:"cursor:default;",autocomplete:"off"},triggerClass:"x-form-search-trigger",validateOnBlur:false,lovWidth:300,lovHeight:300,lovTitle:"",multiSelect:false,alwaysLoadStore:false,view:{},displayValue:"",hiddenValue:"",valueField:"id",displayField:"id",valueSeparator:",",displaySeparator:",",windowConfig:{},showOnFocus:false,minItem:0,minItemText:"至少应该选择{0}项",minItemText2:"至少应该选择{0}项，最多允许选择{1}项",maxItem:Number.MAX_VALUE,maxItemText:"最多允许选择{0}项",isStoreLoaded:false,selections:[],selectedRecords:null,initComponent:function(){this.hiddenName=this.hiddenName||this.name;this.multiSelect=this.maxItem>1;Ext.ux.form.LovField.superclass.initComponent.call(this)},onRender:function(e,b){if(this.isRendered){return}this.readOnly=true;if(this.textarea){this.defaultAutoCreate={tag:"textarea",style:"cursor:default;width:124px;height:200px;",autocomplete:"off",value:this.displayValue};this.displaySeparator="\n"}this.value=this.displayValue;Ext.ux.form.LovField.superclass.onRender.call(this,e,b);this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.el.dom.getAttribute("name"),id:this.id+"-hidden"},"before",true);this.hiddenField.value=this.hiddenValue;this.el.dom.removeAttribute("name");if(this.showOnFocus){this.on("focus",this.onTriggerClick,this)}this.isRendered=true},afterRender:function(){Ext.ux.form.LovField.superclass.afterRender.apply(this,arguments);this.viewType="grid";if(this.viewType=="grid"){this.view.sm=this.view.getSelectionModel();this.view.store=this.view.getStore()}if(this.viewType=="grid"){this.view.sm.singleSelect=!this.multiSelect}else{this.view.singleSelect=!this.multiSelect;this.view.multiSelect=this.multiSelect}if(Ext.type(this.displayField)=="array"){this.displayField=this.displayField.join("")}if(/<tpl(.*)<\/tpl>/.test(this.displayField)&&!(this.displayFieldTpl instanceof Ext.XTemplate)){this.displayFieldTpl=new Ext.XTemplate(this.displayField).compile()}if(Ext.type(this.qtipTpl)=="array"){this.qtipTpl=this.qtipTpl.join("")}if(/<tpl(.*)<\/tpl>/.test(this.qtipTpl)&&!(this.qtipTpl instanceof Ext.XTemplate)){this.qtipTpl=new Ext.XTemplate(this.qtipTpl).compile()}if(this.view.store.autoLoad){this.isStoreLoaded=true}},validateValue:function(b){if(this.hiddenValue){return true}if(Ext.ux.form.LovField.superclass.validateValue.call(this,b)){if(this.selectedRecord&&this.selectedRecords.length<this.minItem){if(this.maxItem!=Number.MAX_VALUE){this.markInvalid(String.format(this.minItemText2,this.minItem,this.maxItem))}else{this.markInvalid(String.format(this.minItemText,this.minItem))}return false}if(this.selectedRecord&&this.selectedRecords.length>this.maxItem){this.markInvalid(String.format(this.maxItemText,this.maxItem));return false}}else{return false}return true},getSelectedRecords:function(){if(this.viewType=="grid"){this.selections=this.selectedRecords=this.view.sm.getSelections()}else{this.selections=this.view.getSelectedIndexes();this.selectedRecords=this.view.getSelectedRecords()}return this.selectedRecords},clearSelections:function(){return(this.viewType=="grid")?this.view.sm.clearSelections():this.view.clearSelections()},select:function(b){if(this.viewType=="grid"){if(b[0] instanceof Ext.data.Record){this.view.sm.selectRecords(b)}else{this.view.sm.selectRows(b)}}else{this.view.select(b)}},onSelect:function(){var f=this.prepareValue(this.getSelectedRecords());var e=f.hv?f.hv.join(this.valueSeparator):"";var b=f.dv?f.dv.join(this.displaySeparator):"";Ext.form.ComboBox.superclass.setValue.call(this,b);this.hiddenField.setAttribute("value",e);this.publish("ux.form.LovField.Select"+this.id,{sender:this.id,returnValue:e,displayValue:b,record:this.getSelectedRecords()[0].data});if(Ext.QuickTips){Ext.QuickTips.enable()}this.window.hide()},prepareValue:function(b){if(b.length>0){var e={hv:[],dv:[]};Ext.each(b,function(f){e.hv.push(f.get(this.valueField));if(this.displayFieldTpl){e.dv.push(this.displayFieldTpl.apply(f.data))}else{e.dv.push(f.get(this.displayField))}},this);return e}return false},getValue:function(){var b=this.hiddenField.value;if(b===this.emptyText||b===undefined){b=""}return b},onTriggerClick:function(b){if(this.isReadOnly||this.disabled){return}if(!this.isStoreLoaded){this.view.store.load();this.isStoreLoaded=true}else{if(this.alwaysLoadStore===true){this.view.store.reload()}}this.windowConfig=Ext.applyIf(this.windowConfig,{title:this.lovTitle,width:this.lovWidth,height:this.lovHeight,modal:true,autoScroll:true,layout:"fit",bbar:new Ext.Toolbar({cls:"go-paging-tb",items:[{text:'<img src="/media/images/divo/delete-red.gif"><span>取消</span>',tooltip:"关闭窗口不做任何选择",handler:function(){this.select(this.selections);this.window.hide()},scope:this},{text:'<img src="/media/images/divo/clear.gif"><span>清除</span>',tooltip:"清除当前所选行",handler:function(){this.clearSelections()},scope:this},"->",{text:'<img src="/media/images/divo/add2.gif"><span>选择</span>',tooltip:"关闭窗口并选择所选行",handler:this.onSelect,scope:this}]}),items:this.view},{shadow:false,frame:true});if(!this.window){this.window=new Ext.Window(this.windowConfig);if(b&&b.xy){this.window.setPagePosition(b.xy[0]+16,b.xy[1]+16)}this.window.on("beforeclose",function(){this.window.hide();return false},this);this.window.on("hide",this.validate,this);this.view.on("dblclick",this.onSelect,this);this.view.on("render",this.initSelect,this)}this.window.show();this.publish("ux.form.LovField.ShowWindow"+this.id,{sender:this.id,window:this.window,view:this.view})},initSelect:function(){if(!this.hiddenValue){return}rows=this.hiddenValue.split(""+this.valueSeparator);var b=new Array();for(i=0;i<rows.length;i++){record=this.view.getStore().getById(rows[i]);b.push(record)}this.view.sm.selectRecords(b,true)},setNameValue:function(b,e){this.setValue(b);this.hiddenField.setAttribute("value",e)}});Ext.reg("xlovfield",Ext.ux.form.LovField);Ext.namespace("Ext.ux");Ext.ux.DDView=function(e){if(!e.itemSelector){var b=e.tpl;if(this.classRe.test(b)){e.tpl=b.replace(this.classRe,"class=$1x-combo-list-item $2$1")}else{e.tpl=b.replace(this.tagRe,'$1 class="x-combo-list-item" $2')}e.itemSelector=".x-combo-list-item"}Ext.ux.DDView.superclass.constructor.call(this,Ext.apply(e,{border:false}))};Ext.extend(Ext.ux.DDView,Ext.DataView,{sortDir:"ASC",isFormField:true,classRe:/class=(['"])(.*)\1/,tagRe:/(<\w*)(.*?>)/,reset:Ext.emptyFn,clearInvalid:Ext.form.Field.prototype.clearInvalid,msgTarget:"qtip",afterRender:function(){Ext.ux.DDView.superclass.afterRender.call(this);if(this.dragGroup){this.setDraggable(this.dragGroup.split(","))}if(this.dropGroup){this.setDroppable(this.dropGroup.split(","))}if(this.deletable){this.setDeletable()}this.isDirtyFlag=false;this.addEvents("drop")},validate:function(){return true},destroy:function(){this.purgeListeners();this.getEl().removeAllListeners();this.getEl().remove();if(this.dragZone){if(this.dragZone.destroy){this.dragZone.destroy()}}if(this.dropZone){if(this.dropZone.destroy){this.dropZone.destroy()}}},getName:function(){return this.name},setValue:function(b){if(!this.store){throw"DDView.setValue(). DDView must be constructed with a valid Store"}var e={};e[this.store.reader.meta.root]=b?[].concat(b):[];this.store.proxy=new Ext.data.MemoryProxy(e);this.store.load()},getValue:function(){var b="(";this.store.each(function(e){b+=e.id+","});return b.substr(0,b.length-1)+")"},getIds:function(){var e=0,b=new Array(this.store.getCount());this.store.each(function(f){b[e++]=f.id});return b},isDirty:function(){return this.isDirtyFlag},getTargetFromEvent:function(f){var b=f.getTarget();while((b!==null)&&(b.parentNode!=this.el.dom)){b=b.parentNode}if(!b){b=this.el.dom.lastChild||this.el.dom}return b},getDragData:function(h){var g=this.findItemFromChild(h.getTarget());if(g){if(!this.isSelected(g)){delete this.ignoreNextClick;this.onItemClick(g,this.indexOf(g),h);this.ignoreNextClick=true}var f={sourceView:this,viewNodes:[],records:[],copy:this.copy||(this.allowCopy&&h.ctrlKey)};if(this.getSelectionCount()==1){var b=this.getSelectedIndexes()[0];var j=this.getNode(b);f.viewNodes.push(f.ddel=j);f.records.push(this.store.getAt(b));f.repairXY=Ext.fly(j).getXY()}else{f.ddel=document.createElement("div");f.ddel.className="multi-proxy";this.collectSelection(f)}return f}return false},getRepairXY:function(b){return this.dragData.repairXY},collectSelection:function(e){e.repairXY=Ext.fly(this.getSelectedNodes()[0]).getXY();if(this.preserveSelectionOrder===true){Ext.each(this.getSelectedIndexes(),function(f){var h=this.getNode(f);var g=h.cloneNode(true);g.id=Ext.id();e.ddel.appendChild(g);e.records.push(this.store.getAt(f));e.viewNodes.push(h)},this)}else{var b=0;this.store.each(function(g){if(this.isSelected(b)){var h=this.getNode(b);var f=h.cloneNode(true);f.id=Ext.id();e.ddel.appendChild(f);e.records.push(this.store.getAt(b));e.viewNodes.push(h)}b++},this)}},setDraggable:function(b){if(b instanceof Array){Ext.each(b,this.setDraggable,this);return}if(this.dragZone){this.dragZone.addToGroup(b)}else{this.dragZone=new Ext.dd.DragZone(this.getEl(),{containerScroll:true,ddGroup:b});if(!this.multiSelect){this.singleSelect=true}this.dragZone.getDragData=this.getDragData.createDelegate(this);this.dragZone.getRepairXY=this.getRepairXY;this.dragZone.onEndDrag=this.onEndDrag}},setDroppable:function(b){if(b instanceof Array){Ext.each(b,this.setDroppable,this);return}if(this.dropZone){this.dropZone.addToGroup(b)}else{this.dropZone=new Ext.dd.DropZone(this.getEl(),{owningView:this,containerScroll:true,ddGroup:b});this.dropZone.getTargetFromEvent=this.getTargetFromEvent.createDelegate(this);this.dropZone.onNodeEnter=this.onNodeEnter.createDelegate(this);this.dropZone.onNodeOver=this.onNodeOver.createDelegate(this);this.dropZone.onNodeOut=this.onNodeOut.createDelegate(this);this.dropZone.onNodeDrop=this.onNodeDrop.createDelegate(this)}},getDropPoint:function(j,o,g){if(o==this.el.dom){return"above"}var h=Ext.lib.Dom.getY(o),f=h+o.offsetHeight;var m=h+(f-h)/2;var k=Ext.lib.Event.getPageY(j);if(k<=m){return"above"}else{return"below"}},isValidDropPoint:function(e,g,b){if(!b.viewNodes||(b.viewNodes.length!=1)){return true}var f=b.viewNodes[0];if(f==g){return false}if((e=="below")&&(g.nextSibling==f)){return false}if((e=="above")&&(g.previousSibling==f)){return false}return true},onNodeEnter:function(h,b,g,f){if(this.highlightColor&&(f.sourceView!=this)){this.el.highlight(this.highlightColor)}return false},onNodeOver:function(m,b,k,h){var f=this.dropNotAllowed;var j=this.getDropPoint(k,m,b);if(this.isValidDropPoint(j,m,h)){if(this.appendOnly||this.sortField){return"x-tree-drop-ok-below"}if(j){var g;if(j=="above"){f=m.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";g="x-view-drag-insert-above"}else{f=m.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";g="x-view-drag-insert-below"}if(this.lastInsertClass!=g){Ext.fly(m).replaceClass(this.lastInsertClass,g);this.lastInsertClass=g}}}return f},onNodeOut:function(h,b,g,f){this.removeDropIndicators(h)},onNodeDrop:function(g,q,m,j){if(this.fireEvent("drop",this,g,q,m,j)===false){return false}var t=this.getDropPoint(m,g,q);var h=(this.appendOnly||(g==this.el.dom))?this.store.getCount():g.viewIndex;if(t=="below"){h++}if(j.sourceView==this){if(t=="below"){if(j.viewNodes[0]==g){j.viewNodes.shift()}}else{if(j.viewNodes[j.viewNodes.length-1]==g){j.viewNodes.pop()}}if(!j.viewNodes.length){return false}if(h>this.store.indexOf(j.records[0])){h--}}if(j.node instanceof Ext.tree.TreeNode){var b=j.node.getOwnerTree().recordFromNode(j.node);if(b){j.records=[b]}}if(!j.records){alert("Programming problem. Drag data contained no Records");return false}for(var k=0;k<j.records.length;k++){var b=j.records[k];var f=this.store.getById(b.id);if(f&&(q!=this.dragZone)){if(!this.allowDup&&!this.allowTrash){Ext.fly(this.getNode(this.store.indexOf(f))).frame("red",1);return true}var o=new Ext.data.Record();b.id=o.id;delete o}if(j.copy){this.store.insert(h++,b.copy())}else{if(j.sourceView){j.sourceView.isDirtyFlag=true;j.sourceView.store.remove(b)}if(!this.allowTrash){this.store.insert(h++,b)}}if(this.sortField){this.store.sort(this.sortField,this.sortDir)}this.isDirtyFlag=true}this.dragZone.cachedTarget=null;return true},onEndDrag:function(b,f){var g=Ext.get(this.dragData.ddel);if(g&&g.hasClass("multi-proxy")){g.remove()}},removeDropIndicators:function(b){if(b){Ext.fly(b).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);this.lastInsertClass="_noclass"}},setDeletable:function(b){if(!this.singleSelect&&!this.multiSelect){this.singleSelect=true}var e=this.getContextMenu();this.contextMenu.on("itemclick",function(f){switch(f.id){case"delete":this.remove(this.getSelectedIndexes());break}},this);this.contextMenu.add({icon:b||AU.resolveUrl("/images/delete.gif"),id:"delete",text:AU.getMessage("deleteItem")})},getContextMenu:function(){if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu({id:this.id+"-contextmenu"});this.el.on("contextmenu",this.showContextMenu,this)}return this.contextMenu},disableContextMenu:function(){if(this.contextMenu){this.el.un("contextmenu",this.showContextMenu,this)}},showContextMenu:function(f,b){b=this.findItemFromChild(f.getTarget());if(b){f.stopEvent();this.select(this.getNode(b),this.multiSelect&&f.ctrlKey,true);this.contextMenu.showAt(f.getXY())}},remove:function(e){e=[].concat(e);for(var b=0;b<e.length;b++){var f=this.store.getAt(e[b]);this.store.remove(f)}},onDblClick:function(j){var h=this.findItemFromChild(j.getTarget());if(h){if(this.fireEvent("dblclick",this,this.indexOf(h),h,j)===false){return false}if(this.dragGroup){var b=Ext.dd.DragDropMgr.getRelated(this.dragZone,true);while(b.contains(this.dropZone)){b.remove(this.dropZone)}if((b.length==1)&&(b[0].owningView)){this.dragZone.cachedTarget=null;var f=Ext.get(b[0].getEl());var g=f.getBox(true);b[0].onNodeDrop(f.dom,{target:f.dom,xy:[g.x,g.y+g.height-1]},null,this.getDragData(j))}}}},onItemClick:function(f,b,g){if(this.ignoreNextClick){delete this.ignoreNextClick;return}if(this.fireEvent("beforeclick",this,b,f,g)===false){return false}if(this.multiSelect||this.singleSelect){if(this.multiSelect&&g.shiftKey&&this.lastSelection){this.select(this.getNodes(this.indexOf(this.lastSelection),b),false)}else{if(this.isSelected(f)&&g.ctrlKey){this.deselect(f)}else{this.deselect(f);this.select(f,this.multiSelect&&g.ctrlKey);this.lastSelection=f}}g.preventDefault()}return true}});Ext.ux.Multiselect=Ext.extend(Ext.form.Field,{store:null,dataFields:[],data:[],width:100,height:100,displayField:0,valueField:1,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minLengthText:"Minimum {0} item(s) required",maxLengthText:"Maximum {0} item(s) allowed",copy:false,allowDup:false,allowTrash:false,legend:null,focusClass:undefined,delimiter:",",view:null,dragGroup:null,dropGroup:null,tbar:null,appendOnly:false,sortField:null,sortDir:"ASC",defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.Multiselect.superclass.initComponent.call(this);this.addEvents({dblclick:true,click:true,change:true,drop:true})},onRender:function(h,e){var b,f,g;Ext.ux.Multiselect.superclass.onRender.call(this,h,e);f="ux-mselect";b=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:1px;",tbar:this.tbar});b.body.addClass(f);g='<tpl for="."><div class="'+f+"-item";if(Ext.isIE||Ext.isIE7){g+='" unselectable=on'}else{g+=' x-unselectable"'}g+=">{"+this.displayField+"}</div></tpl>";if(!this.store){this.store=new Ext.data.SimpleStore({fields:this.dataFields,data:this.data})}this.view=new Ext.ux.DDView({multiSelect:true,store:this.store,selectedClass:f+"-selected",tpl:g,allowDup:this.allowDup,copy:this.copy,allowTrash:this.allowTrash,dragGroup:this.dragGroup,dropGroup:this.dropGroup,itemSelector:"."+f+"-item",isFormField:false,applyTo:b.body,appendOnly:this.appendOnly,sortField:this.sortField,sortDir:this.sortDir});b.add(this.view);this.view.on("click",this.onViewClick,this);this.view.on("beforeClick",this.onViewBeforeClick,this);this.view.on("dblclick",this.onViewDblClick,this);this.view.on("drop",function(m,t,k,q,o){return this.fireEvent("drop",m,t,k,q,o)},this);this.hiddenName=this.name;var j={tag:"input",type:"hidden",value:"",name:this.name};if(this.isFormField){this.hiddenField=this.el.createChild(j)}else{this.hiddenField=Ext.get(document.body).createChild(j)}b.doLayout()},initValue:Ext.emptyFn,onViewClick:function(h,f,g,j){var b=this.preClickSelections.indexOf(f);if(b!=-1){this.preClickSelections.splice(b,1);this.view.clearSelections(true);this.view.select(this.preClickSelections)}this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent("click",this,j);this.validate()},onViewBeforeClick:function(g,b,f,h){this.preClickSelections=this.view.getSelectedIndexes();if(this.disabled){return false}},onViewDblClick:function(g,b,f,h){return this.fireEvent("dblclick",g,b,f,h)},getValue:function(b){var g=[];var f=this.view.getSelectedIndexes();if(f.length==0){return""}for(var e=0;e<f.length;e++){g.push(this.store.getAt(f[e]).get(((b!=null)?b:this.valueField)))}return g.join(this.delimiter)},setValue:function(b){var e;var g=[];this.view.clearSelections();this.hiddenField.dom.value="";if(!b||(b=="")){return}if(!(b instanceof Array)){b=b.split(this.delimiter)}for(var f=0;f<b.length;f++){e=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+b[f]+"$","i")).itemAt(0));g.push(e)}this.view.select(g);this.hiddenField.dom.value=this.getValue();this.validate()},reset:function(){this.setValue("")},getRawValue:function(b){var e=this.getValue(b);if(e.length){e=e.split(this.delimiter)}else{e=[]}return e},setRawValue:function(b){setValue(b)},validateValue:function(b){if(b.length<1){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(b.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(b.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}return true}});Ext.reg("multiselect",Ext.ux.Multiselect);Ext.ux.ItemSelector=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"/media/images/divo/up2.gif",iconDown:"/media/images/divo/down2.gif",iconLeft:"/media/images/divo/left2.gif",iconRight:"/media/images/divo/right2.gif",iconTop:"/media/images/divo/top2.gif",iconBottom:"/media/images/divo/bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,allowDup:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.ItemSelector.superclass.initComponent.call(this);this.addEvents({rowdblclick:true,change:true})},onRender:function(g,b){Ext.ux.ItemSelector.superclass.onRender.call(this,g,b);this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.allowDup,copy:this.allowDup,allowTrash:this.allowDup,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir});this.fromMultiselect.on("dblclick",this.onRowDblClick,this);if(!this.sorterOnly){if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData})}this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.allowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.toSortField,sortDir:this.toSortDir});this.toMultiselect.on("dblclick",this.onRowDblClick,this)}var k=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});this.onRenderOther(k);k.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);var f=new Ext.Panel({header:false});k.add(f);if(!this.sorterOnly){k.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect)}k.render(this.el);f.el.down("."+f.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/"}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var j=f.getEl();if(!this.toSortField){this.toTopIcon=j.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});j.createChild({tag:"br"});this.upIcon=j.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});j.createChild({tag:"br"})}if(!this.sorterOnly){this.addIcon=j.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});j.createChild({tag:"br"});this.removeIcon=j.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});j.createChild({tag:"br"})}if(!this.toSortField){this.downIcon=j.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});j.createChild({tag:"br"});this.toBottomIcon=j.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}})}if(!this.readOnly){if(!this.toSortField){if(!this.sorterOnly){this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this)}else{this.toTopIcon.on("click",this.toTop2,this);this.upIcon.on("click",this.up2,this);this.downIcon.on("click",this.down2,this);this.toBottomIcon.on("click",this.toBottom2,this)}}if(!this.sorterOnly){this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this)}}if(!this.drawUpIcon||this.hideNavIcons){this.upIcon.dom.style.display="none"}if(!this.drawDownIcon||this.hideNavIcons){this.downIcon.dom.style.display="none"}if(!this.sorterOnly){if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none"}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none"}}if(!this.drawTopIcon||this.hideNavIcons){this.toTopIcon.dom.style.display="none"}if(!this.drawBotIcon||this.hideNavIcons){this.toBottomIcon.dom.style.display="none"}var e=k.body.first();this.el.setWidth(k.body.first().getWidth());k.body.removeClass();this.hiddenName=this.name;var h={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(h);if(!this.sorterOnly){this.valueChanged(this.toStore)}},initValue:Ext.emptyFn,toTop:function(){var f=this.toMultiselect.view.getSelectedIndexes();var b=[];if(f.length>0){f.sort();for(var e=0;e<f.length;e++){record=this.toMultiselect.view.store.getAt(f[e]);b.push(record)}f=[];for(var e=b.length-1;e>-1;e--){record=b[e];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);f.push(((b.length-1)-e))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(f)},toBottom:function(){var f=this.toMultiselect.view.getSelectedIndexes();var b=[];if(f.length>0){f.sort();for(var e=0;e<f.length;e++){record=this.toMultiselect.view.store.getAt(f[e]);b.push(record)}f=[];for(var e=0;e<b.length;e++){record=b[e];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);f.push((this.toMultiselect.view.store.getCount())-(b.length-e))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(f)},up:function(){var b=null;var f=this.toMultiselect.view.getSelectedIndexes();f.sort();var g=[];if(f.length>0){for(var e=0;e<f.length;e++){b=this.toMultiselect.view.store.getAt(f[e]);if((f[e]-1)>=0){this.toMultiselect.view.store.remove(b);this.toMultiselect.view.store.insert(f[e]-1,b);g.push(f[e]-1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(g)}},down:function(){var b=null;var f=this.toMultiselect.view.getSelectedIndexes();f.sort();f.reverse();var g=[];if(f.length>0){for(var e=0;e<f.length;e++){b=this.toMultiselect.view.store.getAt(f[e]);if((f[e]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(b);this.toMultiselect.view.store.insert(f[e]+1,b);g.push(f[e]+1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(g)}},fromTo:function(){var g=this.fromMultiselect.view.getSelectedIndexes();var e=[];if(g.length>0){for(var f=0;f<g.length;f++){record=this.fromMultiselect.view.store.getAt(g[f]);e.push(record)}if(!this.allowDup){g=[]}for(var f=0;f<e.length;f++){record=e[f];if(this.allowDup){var b=new Ext.data.Record();record.id=b.id;delete b;this.toMultiselect.view.store.add(record)}else{this.fromMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);g.push((this.toMultiselect.view.store.getCount()-1))}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir)}if(this.allowDup){this.fromMultiselect.view.select(g)}else{this.toMultiselect.view.select(g)}},toFrom:function(){var f=this.toMultiselect.view.getSelectedIndexes();var b=[];if(f.length>0){for(var e=0;e<f.length;e++){record=this.toMultiselect.view.store.getAt(f[e]);b.push(record)}f=[];for(var e=0;e<b.length;e++){record=b[e];this.toMultiselect.view.store.remove(record);if(!this.allowDup){this.fromMultiselect.view.store.add(record);f.push((this.fromMultiselect.view.store.getCount()-1))}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir)}this.fromMultiselect.view.select(f)},valueChanged:function(f){var b=null;var e=[];for(var g=0;g<f.getCount();g++){b=f.getAt(g);e.push(b.get(this.valueField))}this.hiddenField.dom.value=e.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value)},getValue:function(){if(!this.sorterOnly){return this.hiddenField.dom.value}var e=[];var b=this.fromMultiselect.view.store;for(var f=0;f<b.getCount();f++){record=b.getAt(f);e.push(record.get(this.valueField))}return e.join(this.delimiter)},onRowDblClick:function(g,b,f,h){return this.fireEvent("rowdblclick",g,b,f,h)},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();if(!this.allowDup){this.fromMultiselect.store.add(range);this.fromMultiselect.store.sort(this.displayField,"ASC")}this.valueChanged(this.toMultiselect.store)},toTop2:function(){var f=this.fromMultiselect.view.getSelectedIndexes();var b=[];if(f.length>0){f.sort();for(var e=0;e<f.length;e++){record=this.fromMultiselect.view.store.getAt(f[e]);b.push(record)}f=[];for(var e=b.length-1;e>-1;e--){record=b[e];this.fromMultiselect.view.store.remove(record);this.fromMultiselect.view.store.insert(0,record);f.push(((b.length-1)-e))}}this.fromMultiselect.view.refresh();this.fromMultiselect.view.select(f)},toBottom2:function(){var f=this.fromMultiselect.view.getSelectedIndexes();var b=[];if(f.length>0){f.sort();for(var e=0;e<f.length;e++){record=this.fromMultiselect.view.store.getAt(f[e]);b.push(record)}f=[];for(var e=0;e<b.length;e++){record=b[e];this.fromMultiselect.view.store.remove(record);this.fromMultiselect.view.store.add(record);f.push((this.fromMultiselect.view.store.getCount())-(b.length-e))}}this.fromMultiselect.view.refresh();this.fromMultiselect.view.select(f)},up2:function(){var b=null;var f=this.fromMultiselect.view.getSelectedIndexes();f.sort();var g=[];if(f.length>0){for(var e=0;e<f.length;e++){b=this.fromMultiselect.view.store.getAt(f[e]);if((f[e]-1)>=0){this.fromMultiselect.view.store.remove(b);this.fromMultiselect.view.store.insert(f[e]-1,b);g.push(f[e]-1)}}this.fromMultiselect.view.refresh();this.fromMultiselect.view.select(g)}},down2:function(){var b=null;var f=this.fromMultiselect.view.getSelectedIndexes();f.sort();f.reverse();var g=[];if(f.length>0){for(var e=0;e<f.length;e++){b=this.fromMultiselect.view.store.getAt(f[e]);if((f[e]+1)<this.fromMultiselect.view.store.getCount()){this.fromMultiselect.view.store.remove(b);this.fromMultiselect.view.store.insert(f[e]+1,b);g.push(f[e]+1)}}this.fromMultiselect.view.refresh();this.fromMultiselect.view.select(g)}},onRenderOther:Ext.emptyFn});Ext.reg("itemselector",Ext.ux.ItemSelector);Ext.ux.RadioGroup=Ext.extend(Ext.form.Field,{focusClass:undefined,fieldClass:"x-form-field",checked:false,defaultAutoCreate:{tag:"input",type:"radio",autocomplete:"off"},getId:function(){if(this.radios&&this.radios instanceof Array){if(this.radios.length){var b=this.radios[0];this.value=b.value;this.boxLabel=b.boxLabel;this.checked=b.checked||false;this.readOnly=b.readOnly||false;this.disabled=b.disabled||false;this.tabIndex=b.tabIndex;this.cls=b.cls;this.listeners=b.listeners;this.style=b.style;this.bodyStyle=b.bodyStyle;this.hideParent=b.hideParent;this.hidden=b.hidden}}Ext.ux.RadioGroup.superclass.getId.call(this)},initComponent:function(){Ext.ux.RadioGroup.superclass.initComponent.call(this);this.addEvents("check")},onResize:function(){Ext.ux.RadioGroup.superclass.onResize.apply(this,arguments);if(!this.boxLabel){this.el.alignTo(this.wrap,"c-c")}},initEvents:function(){Ext.ux.RadioGroup.superclass.initEvents.call(this);this.el.on("click",this.onClick,this);this.el.on("change",this.onClick,this)},getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},markInvalid:Ext.emptyFn,clearInvalid:Ext.emptyFn,onRender:function(f,b){Ext.ux.RadioGroup.superclass.onRender.call(this,f,b);this.wrap=this.el.wrap({cls:"x-form-check-wrap"});if(this.boxLabel){this.wrap.createChild({tag:"label",htmlFor:this.el.id,cls:"x-form-cb-label",html:this.boxLabel})}if(!this.isInGroup){this.wrap.applyStyles({"padding-top":"2px"})}if(this.checked){this.setChecked(true)}else{this.checked=this.el.dom.checked}if(this.radios&&this.radios instanceof Array){this.els=new Array();this.els[0]=this.el;for(var e=1;e<this.radios.length;e++){var g=this.radios[e];this.els[e]=new Ext.ux.RadioGroup({renderTo:this.wrap,hideLabel:true,boxLabel:g.boxLabel,checked:g.checked||false,value:g.value,name:this.name||this.id,readOnly:g.readOnly||false,disabled:g.disabled||false,tabIndex:g.tabIndex,cls:g.cls,listeners:g.listeners,style:g.style,bodyStyle:g.bodyStyle,hideParent:g.hideParent,hidden:g.hidden,isInGroup:true});if(this.horizontal){this.els[e].el.up("div.x-form-check-wrap").applyStyles({display:"inline","padding-left":"5px"})}}if(this.hidden){this.hide()}}},initValue:function(){if(this.value!==undefined){this.el.dom.value=this.value}else{if(this.el.dom.value.length>0){this.value=this.el.dom.value}}},onDestroy:function(){if(this.radios&&this.radios instanceof Array){var e=this.radios.length;for(var b=1;b<e;b++){this.els[b].destroy()}}if(this.wrap){this.wrap.remove()}Ext.ux.RadioGroup.superclass.onDestroy.call(this)},setChecked:function(b){if(this.el&&this.el.dom){var e=false;if(b!=this.checked){e=true}this.checked=b;this.el.dom.checked=this.checked;this.el.dom.defaultChecked=this.checked;if(e){this.fireEvent("check",this,this.checked)}}},getValue:function(){if(!this.rendered){return this.value}var b=this.el.up("form");if(!b){b=Ext.getBody()}var e=b.child("input[name="+escape(this.el.dom.name)+"]:checked",true);return(e)?e.value:this.value},onClick:function(){if(this.el.dom.checked!=this.checked){var e=this.el.up("form");if(!e){e=Ext.getBody()}var b=e.select("input[name="+escape(this.el.dom.name)+"]");b.each(function(f){if(f.dom.id==this.id){this.setChecked(true)}else{var g=Ext.getCmp(f.dom.id);g.setChecked.apply(g,[false])}},this)}},setValue:function(b){if(!this.rendered){this.value=b;return}var f=this.el.up("form");if(!f){f=Ext.getBody()}var e=f.child("input[name="+escape(this.el.dom.name)+"][value="+b+"]",true);if(e){e.checked=true}},clear:function(){if(!this.rendered){return}var b=this.el.up("form");if(!b){b=Ext.getBody()}var e=b.child("input[name="+escape(this.el.dom.name)+"]:checked",true);if(e){e.checked=false}},disable:function(){if(!this.rendered){return}var e=this.el.up("form");if(!e){e=Ext.getBody()}var b=e.select("input[name="+escape(this.el.dom.name)+"]");b.each(function(f){if(f.dom.id==this.id){Ext.ux.RadioGroup.superclass.disable.call(this)}else{var g=Ext.getCmp(f.dom.id);Ext.ux.RadioGroup.superclass.disable.call(g)}},this)},enable:function(){if(!this.rendered){return}var e=this.el.up("form");if(!e){e=Ext.getBody()}var b=e.select("input[name="+escape(this.el.dom.name)+"]");b.each(function(f){if(f.dom.id==this.id){Ext.ux.RadioGroup.superclass.enable.call(this)}else{var g=Ext.getCmp(f.dom.id);Ext.ux.RadioGroup.superclass.enable.call(g)}},this)},hide:function(){if(!this.rendered){return}this.wrap.hide();this.wrap.parent().parent().hide()},show:function(){if(!this.rendered){return}this.wrap.show();this.wrap.parent().parent().show()}});Ext.reg("ux-radiogroup",Ext.ux.RadioGroup);divo.form.EditAndSaveForm=Ext.extend(Ext.form.FormPanel,{initFocusFldName:null,url:null,saveRequestMethod:"PUT",initFormBySelf:true,sayAfterSaved:true,initComponent:function(){if(this.initFormBySelf){divo.waitFor(this.canInitForm,this.initForm,this)}this.on("beforedestroy",function(){if(Ext.MessageBox.isVisible()){Ext.MessageBox.hide()}},this);divo.form.EditAndSaveForm.superclass.initComponent.call(this)},canInitForm:function(){var e=this.getForm();if(e){var b=this.getForm().findField(this.initFocusFldName)}return b},initForm:function(){var b=this.getForm().findField(this.initFocusFldName);if(b){b.focus.defer(100,b)}if(!this.initFormBySelf){this.loadItem()}this.initFormAddon()},afterRender:function(){divo.form.EditAndSaveForm.superclass.afterRender.call(this);if(this.initFormBySelf){this.loadItem()}},initFormAddon:Ext.emptyFn,loadItem:function(){if(!this.url){return}Ext.MessageBox.wait("正在加载...","请稍候");var b=function(){Ext.Ajax.request({scope:this,url:this.url,method:"GET",success:function(e,f){var g=Ext.decode(e.responseText);if(g.success){this.getForm().setValues(g.data);this.afterLoadItem(g.data)}Ext.MessageBox.hide()},failure:function(e,f){Ext.MessageBox.hide();this.alert(e.responseText)}})};b.defer(100,this)},afterLoadItem:Ext.emptyFn,validateBeforeSave:function(b){return true},getSaveUrl:function(){return this.url},save:function(b){if(!this.url){return}var e=this.getForm().getObjectValues();if(!this.validateBeforeSave(e)){return}Ext.MessageBox.wait("正在保存...","请稍候");e=this.beforeSave(e);var g=function(f){Ext.Ajax.request({scope:this,url:this.getSaveUrl(),async:false,method:this.saveRequestMethod,jsonData:f,success:function(h,j){Ext.MessageBox.hide();if(this.sayAfterSaved){this.say("保存完毕")}if(b){b.call()}},failure:function(h,j){Ext.MessageBox.hide();this.alert(h.responseText)}})};g.defer(100,this,[e])},beforeSave:function(b){return b}});divo.form.AddOrEditForm=Ext.extend(Ext.form.FormPanel,{recordId:null,adding:false,initFocusFldName:null,labelWidth:100,defaultType:"textfield",labelAlign:"right",autoScroll:true,bodyStyle:"padding:10px",initFormBySelf:true,initComponent:function(){this.on("beforedestroy",function(){if(Ext.MessageBox.isVisible()){Ext.MessageBox.hide()}},this);divo.form.AddOrEditForm.superclass.initComponent.call(this)},initForm:function(b){if(!this.adding){this.loadItem()}if(this.initFocusFldName){var e=this.getForm().findField(this.initFocusFldName)}if(e){e.focus.defer(b?b:100,e)}},afterRender:function(){divo.form.AddOrEditForm.superclass.afterRender.call(this);if(this.initFormBySelf){this.initForm.defer(100,this)}},clearForm:function(){this.getForm().reset();this.initForm(1500)},getLoadItemUrl:function(b,e){if(b!=undefined){return b+"/"+e}else{if(!this.url||!this.recordId){return null}return this.url+"/"+this.recordId}},loadItem:function(b,e){var b=this.getLoadItemUrl(b,e);if(!b){return}Ext.MessageBox.wait("正在加载...","请稍候");var g=function(){Ext.Ajax.request({scope:this,url:b,method:"GET",success:function(f,h){var j=Ext.decode(f.responseText);this.getForm().setValues(j.data);this.afterLoadItem(j.data);this.oldData=j.data;Ext.MessageBox.hide()},failure:function(f,h){Ext.MessageBox.hide();this.alert(f.responseText)}})};g.defer(100,this)},afterLoadItem:Ext.emptyFn,getSaveUrl:function(){return this.url+(this.adding?"":"/"+this.recordId)},save:function(b){var e=this.getForm().getObjectValues();if(!this.validateBeforeSave(e)){return}Ext.MessageBox.wait("正在保存...","请稍候");e=this.beforeSave(e);var g=function(f){Ext.Ajax.request({scope:this,url:this.getSaveUrl(),method:(this.adding?"POST":"PUT"),async:true,jsonData:f,success:function(h,j){Ext.MessageBox.hide();var k=Ext.decode(h.responseText);if(!k.success){this.say("输入数据验证未通过，请检查。");this.getForm().markInvalid(k.errors);this.afterMarkInvalid()}else{this.afterSave(k.id,f);if(typeof b=="function"){b(k.id,f)}}},failure:function(h,j){Ext.MessageBox.hide();this.alert(h.responseText)}})};g.defer(100,this,[e])},validateBeforeSave:function(b){return true},beforeSave:function(b){return b},afterSave:Ext.emptyFn,afterMarkInvalid:Ext.emptyFn,refreshForm:function(b){this.recordId=b;this.initForm()}});Ext.ns("Ext.ux.form");Ext.ux.form.XCheckbox=Ext.extend(Ext.form.Checkbox,{submitOffValue:"false",submitOnValue:"true",onRender:function(){this.inputValue=this.submitOnValue;Ext.ux.form.XCheckbox.superclass.onRender.apply(this,arguments);this.hiddenField=this.wrap.insertFirst({tag:"input",type:"hidden"});if(this.tooltip){this.imageEl.set({qtip:this.tooltip})}this.updateHidden()},setValue:function(b){b=this.convertValue(b);this.updateHidden(b);Ext.ux.form.XCheckbox.superclass.setValue.apply(this,arguments)},updateHidden:function(b){b=undefined!==b?b:this.checked;b=this.convertValue(b);if(this.hiddenField){this.hiddenField.dom.value=b?this.submitOnValue:this.submitOffValue;this.hiddenField.dom.name=b?"":this.el.dom.name}},convertValue:function(b){return(b===true||b==="true"||b===this.submitOnValue||String(b).toLowerCase()==="on")}});Ext.reg("xcheckbox",Ext.ux.form.XCheckbox);Ext.apply(Ext.DataView.prototype,{deselect:function(e,b){if(this.isSelected(e)){var e=this.getNode(e);this.selected.removeElement(e);if(this.last==e.viewIndex){this.last=false}Ext.fly(e).removeClass(this.selectedClass);if(!b){this.fireEvent("selectionchange",this,this.selected.elements)}}}});Ext.namespace("Ext.ux.Andrie");Ext.ux.Andrie.Select=function(b){if(b.transform&&typeof b.multiSelect=="undefined"){var e=Ext.getDom(b.transform);b.multiSelect=(Ext.isIE?e.getAttributeNode("multiple").specified:e.hasAttribute("multiple"))}b.hideTrigger2=b.hideTrigger2||b.hideTrigger;Ext.ux.Andrie.Select.superclass.constructor.call(this,b)};Ext.extend(Ext.ux.Andrie.Select,Ext.form.ComboBox,{multiSelect:false,minLength:0,minLengthText:"Minimum {0} items required",maxLength:Number.MAX_VALUE,maxLengthText:"Maximum {0} items allowed",clearTrigger:true,history:false,historyMaxLength:0,separator:",",displaySeparator:",",valueArray:[],rawValueArray:[],initComponent:function(){this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger2Class}]};Ext.ux.Andrie.Select.superclass.initComponent.call(this);if(this.multiSelect){this.typeAhead=false;this.editable=false;this.triggerAction="all";this.selectOnFocus=false}if(this.history){this.forceSelection=false}if(this.value){this.setValue(this.value)}},hideTrigger1:true,getTrigger:Ext.form.TwinTriggerField.prototype.getTrigger,initTrigger:Ext.form.TwinTriggerField.prototype.initTrigger,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-arrow-trigger",onTrigger2Click:function(){this.onTriggerClick()},onTrigger1Click:function(){this.clearValue()},initList:function(){if(!this.list){var b="x-combo-list";this.list=new Ext.Layer({shadow:this.shadow,cls:[b,this.listClass].join(" "),constrain:false});var e=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.list.setWidth(e);this.list.swallowEvent("mousewheel");this.assetHeight=0;if(this.title){this.header=this.list.createChild({cls:b+"-hd",html:this.title});this.assetHeight+=this.header.getHeight()}this.innerList=this.list.createChild({cls:b+"-inner"});this.innerList.on("mouseover",this.onViewOver,this);this.innerList.on("mousemove",this.onViewMove,this);this.innerList.setWidth(e-this.list.getFrameWidth("lr"));if(this.pageSize){this.footer=this.list.createChild({cls:b+"-ft"});this.pageTb=new Ext.PagingToolbar({store:this.store,pageSize:this.pageSize,renderTo:this.footer});this.assetHeight+=this.footer.getHeight()}if(!this.tpl){this.tpl='<tpl for="."><div class="'+b+'-item">{'+this.displayField+"}</div></tpl>"}this.view=new Ext.DataView({applyTo:this.innerList,tpl:this.tpl,singleSelect:true,multiSelect:this.multiSelect,simpleSelect:true,overClass:b+"-cursor",selectedClass:this.selectedClass,itemSelector:this.itemSelector||"."+b+"-item"});this.view.on("click",this.onViewClick,this);this.view.on("beforeClick",this.onViewBeforeClick,this);this.bindStore(this.store,true);if(this.valueArray.length){this.selectByValue(this.valueArray)}if(this.resizable){this.resizer=new Ext.Resizable(this.list,{pinned:true,handles:"se"});this.resizer.on("resize",function(j,f,g){this.maxHeight=g-this.handleHeight-this.list.getFrameWidth("tb")-this.assetHeight;this.listWidth=f;this.innerList.setWidth(f-this.list.getFrameWidth("lr"));this.restrictHeight()},this);this[this.pageSize?"footer":"innerList"].setStyle("margin-bottom",this.handleHeight+"px")}}},initEvents:function(){Ext.form.ComboBox.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{up:function(b){this.inKeyMode=true;this.hoverPrev()},down:function(b){if(!this.isExpanded()){this.onTriggerClick()}else{this.inKeyMode=true;this.hoverNext()}},enter:function(f){if(this.isExpanded()){this.inKeyMode=true;var b=this.view.indexOf(this.view.lastItem);this.onViewBeforeClick(this.view,b,this.view.getNode(b),f);this.onViewClick(this.view,b,this.view.getNode(b),f)}else{this.onSingleBlur()}return true},esc:function(b){this.collapse()},tab:function(b){this.collapse();return true},home:function(b){this.hoverFirst();return false},end:function(b){this.hoverLast();return false},scope:this,doRelay:function(f,e,b){if(b=="down"||this.scope.isExpanded()){return Ext.KeyNav.prototype.doRelay.apply(this,arguments)}if(b=="enter"||this.scope.isExpanded()){return Ext.KeyNav.prototype.doRelay.apply(this,arguments)}return true},forceKeyDown:true});this.queryDelay=Math.max(this.queryDelay||10,this.mode=="local"?10:250);this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);if(this.typeAhead){this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this)}if(this.editable!==false){this.el.on("keyup",this.onKeyUp,this)}if(!this.multiSelect){if(this.forceSelection){this.on("blur",this.doForce,this)}this.on("focus",this.onSingleFocus,this);this.on("blur",this.onSingleBlur,this)}this.on("change",this.onChange,this)},doForce:function(){if(this.el.dom.value.length>0){if(this.el.dom.value==this.emptyText){this.clearValue()}else{if(!this.multiSelect){this.el.dom.value=this.lastSelectionText===undefined?"":this.lastSelectionText;this.applyEmptyText()}}}},onLoad:function(){if(!this.hasFocus){return}if(this.store.getCount()>0){this.expand();this.restrictHeight();if(this.lastQuery==this.allQuery){if(this.editable){this.el.dom.select()}this.selectByValue(this.value,true)}else{this.selectNext();if(this.typeAhead&&this.lastKey!=Ext.EventObject.BACKSPACE&&this.lastKey!=Ext.EventObject.DELETE){this.taTask.delay(this.typeAheadDelay)}}}else{this.onEmptyResults()}},onSelect:function(b,e){if(this.fireEvent("beforeselect",this,b,e)!==false){this.addValue(b.data[this.valueField||this.displayField]);this.fireEvent("select",this,b,e);if(!this.multiSelect){this.collapse()}}},onSingleFocus:function(){this.oldValue=this.getRawValue()},onSingleBlur:function(){var b=this.findRecord(this.displayField,this.getRawValue());if(b){this.select(this.store.indexOf(b));return}if(String(this.oldValue)!=String(this.getRawValue())){this.setValue(this.getRawValue());this.fireEvent("change",this,this.oldValue,this.getRawValue())}this.oldValue=String(this.getRawValue())},onChange:function(){if(!this.clearTrigger){return}if(this.getValue()!=""){this.triggers[0].show()}else{this.triggers[0].hide()}},collapse:function(){this.hoverOut();Ext.ux.Andrie.Select.superclass.collapse.call(this)},expand:function(){Ext.ux.Andrie.Select.superclass.expand.call(this);this.hoverFirst()},onViewOver:function(f,b){if(this.inKeyMode){return}},onViewBeforeClick:function(g,b,f,h){this.preClickSelections=this.view.getSelectedIndexes()},onViewClick:function(j,f,h,k){if(typeof f!="undefined"){var b=this.preClickSelections.indexOf(f);if(b!=-1&&this.multiSelect){this.removeValue(this.store.getAt(f).data[this.valueField||this.displayField]);if(this.inKeyMode){this.view.deselect(f,true)}this.hover(f,true)}else{var g=this.store.getAt(f);if(g){if(this.inKeyMode){this.view.select(f,true)}this.onSelect(g,f);this.hover(f,true)}}}if(j!==false){this.el.focus()}},addValue:function(e){if(!this.multiSelect){this.setValue(e);return}if(e instanceof Array){e=e[0]}e=String(e);if(this.valueArray.indexOf(e)==-1){var h=e;var f=this.findRecord(this.valueField||displayField,e);if(f){h=f.data[this.displayField];if(this.view){this.select(this.store.indexOf(f))}}else{if(this.forceSelection){return}}var b=Ext.apply([],this.valueArray);b.push(e);var g=Ext.apply([],this.rawValueArray);g.push(h);e=b.join(this.separator||",");h=g.join(this.displaySeparator||this.separator||",");this.commonChangeValue(e,h,b,g)}},removeValue:function(e){if(e instanceof Array){e=e[0]}e=String(e);if(this.valueArray.indexOf(e)!=-1){var h=e;var f=this.findRecord(this.valueField||displayField,e);if(f){h=f.data[this.displayField];if(this.view){this.deselect(this.store.indexOf(f))}}else{if(this.forceSelection){return}}var b=Ext.apply([],this.valueArray);b.remove(e);var g=Ext.apply([],this.rawValueArray);g.remove(h);e=b.join(this.separator||",");h=g.join(this.displaySeparator||this.separator||",");this.commonChangeValue(e,h,b,g)}},setValue:function(f){var e=[],m=[];if(!(f instanceof Array)){if(this.separator&&this.separator!==true){f=f.split(String(this.separator))}else{f=[f]}}else{if(!this.multiSelect){f=f.slice(0,1)}}for(var g=0,b=f.length;g<b;g++){var j=f[g];var k=j;if(this.valueField){var h=this.findRecord(this.valueField||this.displayField,j);if(h){k=h.data[this.displayField]}else{if(this.forceSelection){continue}}}e.push(j);m.push(k)}f=e.join(this.separator||",");k=m.join(this.displaySeparator||this.separator||",");this.commonChangeValue(f,k,e,m);if(this.history&&!this.multiSelect&&this.mode=="local"){this.addHistory(this.valueField?this.getValue():this.getRawValue())}if(this.view){this.view.clearSelections();this.selectByValue(this.valueArray)}},commonChangeValue:function(e,g,b,f){this.lastSelectionText=g;this.valueArray=b;this.rawValueArray=f;if(this.hiddenField){this.hiddenField.value=e}Ext.form.ComboBox.superclass.setValue.call(this,g);this.value=e;if(this.oldValueArray!=this.valueArray){this.fireEvent("change",this,this.oldValueArray,this.valueArray)}this.oldValueArray=Ext.apply([],this.valueArray)},validateValue:function(b){if(!Ext.ux.Andrie.Select.superclass.validateValue.call(this,b)){return false}if(this.valueArray.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(this.valueArray.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}return true},clearValue:function(){this.commonChangeValue("","",[],[]);if(this.view){this.view.clearSelections()}Ext.ux.Andrie.Select.superclass.clearValue.call(this)},reset:function(){if(this.view){this.view.clearSelections()}Ext.ux.Andrie.Select.superclass.reset.call(this)},getValue:function(b){if(b){return typeof this.valueArray!="undefined"?this.valueArray:[]}return Ext.ux.Andrie.Select.superclass.getValue.call(this)},getRawValue:function(b){if(b){return typeof this.rawValueArray!="undefined"?this.rawValueArray:[]}return Ext.ux.Andrie.Select.superclass.getRawValue.call(this)},beforeBlur:Ext.emptyFn,select:function(b,f){this.selectedIndex=b;if(!this.view){return}this.view.select(b,this.multiSelect);if(f!==false){var e=this.view.getNode(b);if(e){this.innerList.scrollChildIntoView(e,false)}}},deselect:function(b,f){this.selectedIndex=b;this.view.deselect(b,this.multiSelect);if(f!==false){var e=this.view.getNode(b);if(e){this.innerList.scrollChildIntoView(e,false)}}},selectByValue:function(f,k){this.hoverOut();if(f!==undefined&&f!==null){if(!(f instanceof Array)){f=[f]}var e=[];for(var g=0,b=f.length;g<b;g++){var j=f[g];var h=this.findRecord(this.valueField||this.displayField,j);if(h){this.select(this.store.indexOf(h),k);e.push(j)}}return e.join(",")}return false},selectFirst:function(){var b=this.store.getCount();if(b>0){this.select(0)}},selectLast:function(){var b=this.store.getCount();if(b>0){this.select(b)}},hover:function(b,g){if(!this.view){return}this.hoverOut();var f=this.view.getNode(b);this.view.lastItem=f;Ext.fly(f).addClass(this.view.overClass);if(g!==false){var e=this.view.getNode(b);if(e){this.innerList.scrollChildIntoView(e,false)}}},hoverOut:function(){if(!this.view){return}if(this.view.lastItem){Ext.fly(this.view.lastItem).removeClass(this.view.overClass);delete this.view.lastItem}},hoverNext:function(){if(!this.view){return}var e=this.store.getCount();if(e>0){if(!this.view.lastItem){this.hover(0)}else{var b=this.view.indexOf(this.view.lastItem);if(b<e-1){this.hover(b+1)}}}},hoverPrev:function(){if(!this.view){return}var e=this.store.getCount();if(e>0){if(!this.view.lastItem){this.hover(0)}else{var b=this.view.indexOf(this.view.lastItem);if(b!=0){this.hover(b-1)}}}},hoverFirst:function(){var b=this.store.getCount();if(b>0){this.hover(0)}},hoverLast:function(){var b=this.store.getCount();if(b>0){this.hover(b)}},addHistory:function(e){if(!e.length){return}var b=this.findRecord(this.valueField||this.displayField,e);if(b){this.store.remove(b)}else{var f={};if(this.valueField){f[this.valueField]=e}f[this.displayField]=e;b=new this.store.reader.recordType(f)}this.store.clearFilter();this.store.insert(0,b);this.pruneHistory()},pruneHistory:function(){if(this.historyMaxLength==0){return}if(this.store.getCount()>this.historyMaxLength){var f=this.store.getRange(this.historyMaxLength,this.store.getCount());for(var e=0,b=f.length;e<b;e++){this.store.remove(f[e])}}}});Ext.reg("select",Ext.ux.Andrie.Select);function TinyMCEFileBrowser(g,b,e,h){var f=new divo.window.ImageChooserWindow({width:815,height:500});f.showWindow(g,function(j,k){h.document.getElementById(j).value=k.url;h.document.getElementById("alt").value=k.title;if(h.ImageDialog.getImageData){h.ImageDialog.getImageData()}if(h.ImageDialog.showPreviewImage){h.ImageDialog.showPreviewImage(k.url)}});return false}Ext.namespace("Ext.ux.form");Ext.ux.form.ImageField=Ext.extend(Ext.BoxComponent,{inputType:"image",value:"",name:"",invalidClass:"x-form-imagefield-invalid",invalidText:"This field is required",validationEvent:"change",validationDelay:250,defaultAutoCreate:{tag:"div"},fieldClass:"x-form-imagefield",msgTarget:"qtip",msgFx:"normal",disabled:false,optional:false,hideTrigger:false,triggerClass:"",defaultImage:"/media/images/image-field-blank.gif",valueField:"url",isFormField:true,allowMaxWidth:null,allowMaxHeight:null,allowMaxFileSize:null,thumbWidth:0,thumbHeight:0,baseWidth:0,baseHeight:0,isFlash:false,initComponent:function(){Ext.ux.form.ImageField.superclass.initComponent.call(this);this.addEvents("change","invalid","valid");if(this.isFlash){this.defaultImage="/media/images/flashno.png"}},getName:function(){return this.rendered&&this.hiddenField.dom.name?this.hiddenField.dom.name:""},onRender:function(f,b){Ext.ux.form.ImageField.superclass.onRender.call(this,f,b);if(!this.el){var e=this.getAutoCreate();this.el=f.createChild(e,b)}this.imageEl=this.el.insertFirst({tag:"img",src:this.defaultImage});this.hiddenField=this.imageEl.insertSibling({tag:"input",type:"hidden",name:this.name,id:this.id+"-hidden"},"before");this.el.addClass([this.fieldClass,this.cls]);this.imageEl.addClass(this.fieldClass+"-image");this.initValue();this.wrap=this.imageEl.wrap({cls:"x-form-field-wrap"});this.trigger=this.wrap.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger"});if(this.hideTrigger){this.trigger.setDisplayed(false)}this.initTrigger()},initTrigger:function(){this.trigger.on("click",this.onTriggerClick,this,{preventDefault:true});this.trigger.addClassOnOver("x-form-trigger-over");this.trigger.addClassOnClick("x-form-trigger-click")},onDestroy:function(){if(this.trigger){this.trigger.removeAllListeners();this.trigger.remove()}this.wrap.remove();Ext.ux.form.ImageField.superclass.onDestroy.call(this)},onDisable:function(){this.wrap.addClass("x-item-disabled");this.hiddenField.dom.disabled=true},onEnable:function(){this.wrap.removeClass("x-item-disabled");this.hiddenField.dom.disabled=false},onShow:function(){this.wrap.dom.style.display="";this.wrap.dom.style.visibility="visible"},onHide:function(){this.wrap.dom.style.display="none"},onTriggerClick:function(f){if(this.disabled){return}var b=new divo.window.ImageChooserWindow({width:815,height:500,allowMaxWidth:this.allowMaxWidth,allowMaxHeight:this.allowMaxHeight,allowMaxFileSize:this.allowMaxFileSize,thumbWidth:this.thumbWidth,thumbHeight:this.thumbHeight,baseWidth:this.baseWidth,baseHeight:this.baseHeight,isFlash:this.isFlash});b.showWindow("",this.onSelect.createDelegate(this))},onSelect:function(b,e){this.setValue(e.url)},initValue:function(){if(this.value!==undefined){this.hiddenField.dom.value=(this.value===null||this.value===undefined?"":this.value)}else{this.hiddenField.dom.value=""}},isDirty:function(){if(this.disabled){return false}return String(this.getValue())!==String(this.originalValue)},afterRender:function(){Ext.ux.form.ImageField.superclass.afterRender.call(this);this.initEvents()},reset:function(){if(!this.originalValue){this.originalValue=this.defaultImage}this.setValue(this.originalValue);this.clearInvalid()},initEvents:function(){if(this.validationEvent!==false){this.el.on(this.validationEvent,this.validate,this,{buffer:this.validationDelay})}this.originalValue=this.getValue()},isValid:function(b){if(this.disabled){return true}var f=this.preventMark;this.preventMark=b===true;var e=this.validateValue(this.processValue(this.getRawValue()));this.preventMark=f;return e},validate:function(){if(this.disabled||this.validateValue(this.processValue(this.getRawValue()))){this.clearInvalid();return true}return false},processValue:function(b){return b},validateValue:function(b){if(this.hiddenField.dom.value===""){this.markInvalid();return false}else{return true}},markInvalid:function(f){if(!this.rendered||this.preventMark){return}this.el.addClass(this.invalidClass);f=f||this.invalidText;switch(this.msgTarget){case"qtip":this.el.dom.qtip=f;this.el.dom.qclass="x-form-invalid-tip";if(Ext.QuickTips){Ext.QuickTips.enable()}break;case"title":this.el.dom.title=f;break;case"under":if(!this.errorEl){var e=this.getErrorCt();this.errorEl=e.createChild({cls:"x-form-invalid-msg"});this.errorEl.setWidth(e.getWidth(true)-20)}this.errorEl.update(f);Ext.ux.form.ImageField.msgFx[this.msgFx].show(this.errorEl,this);break;case"side":if(!this.errorIcon){var e=this.getErrorCt();this.errorIcon=e.createChild({cls:"x-form-invalid-icon"})}this.alignErrorIcon();this.errorIcon.dom.qtip=f;this.errorIcon.dom.qclass="x-form-invalid-tip";this.errorIcon.show();this.on("resize",this.alignErrorIcon,this);break;default:var b=Ext.getDom(this.msgTarget);b.innerHTML=f;b.style.display=this.msgDisplay;break}this.fireEvent("invalid",this,f)},getErrorCt:function(){return this.el.findParent(".x-form-element",5,true)||this.el.findParent(".x-form-field-wrap",5,true)},alignErrorIcon:function(){this.errorIcon.alignTo(this.el,"tl-tr",[2,0])},clearInvalid:function(){if(!this.rendered||this.preventMark){return}this.el.removeClass(this.invalidClass);switch(this.msgTarget){case"qtip":this.el.dom.qtip="";break;case"title":this.el.dom.title="";break;case"under":if(this.errorEl){Ext.ux.form.ImageField.msgFx[this.msgFx].hide(this.errorEl,this)}break;case"side":if(this.errorIcon){this.errorIcon.dom.qtip="";this.errorIcon.hide();this.un("resize",this.alignErrorIcon,this)}break;default:var b=Ext.getDom(this.msgTarget);b.innerHTML="";b.style.display="none";break}this.fireEvent("valid",this)},getRawValue:function(){var b=this.rendered?this.hiddenField.getValue():Ext.value(this.value,"");return b},getValue:function(){if(!this.rendered){return this.value}var b=this.hiddenField.getValue();if(b===undefined){b=""}return b},setRawValue:function(b){return this.hiddenField.dom.value=(b===null||b===undefined?"":b)},setValue:function(b){if(!this.isFlash&&!b){b=this.defaultImage}var e=this.value;this.value=b;if(this.rendered){this.hiddenField.dom.value=(b===null||b===undefined?"":b);if(this.isFlash){this.imageEl.dom.src="/media/images/flash"+(b?"yes":"no")+".png"}else{this.imageEl.dom.src=(b===null||b===undefined?"":b)}this.fireEvent("change",this,e,b);this.validate()}}});Ext.ux.form.ImageField.msgFx={normal:{show:function(b,e){b.setDisplayed("block")},hide:function(b,e){b.setDisplayed(false).update("")}},slide:{show:function(b,e){b.slideIn("t",{stopFx:true})},hide:function(b,e){b.slideOut("t",{stopFx:true,useDisplay:true})}},slideRight:{show:function(b,e){b.fixDisplay();b.alignTo(e.el,"tl-tr");b.slideIn("l",{stopFx:true})},hide:function(b,e){b.slideOut("l",{stopFx:true,useDisplay:true})}}};Ext.reg("imagefield",Ext.ux.form.ImageField);divo.form.FormIntro=Ext.extend(Ext.BoxComponent,{_textEl:null,_labelEl:null,initComponent:function(){Ext.apply(this,{autoEl:{tag:"div",children:[{tag:"div",cls:"divo-formintro-container",children:[{tag:"div",cls:"divo-formintro-label",html:""},{tag:"div",cls:"divo-formintro-outersep",children:this.label?[{tag:"div",cls:"divo-formintro-sepx",html:"&nbsp;"}]:[]}]},{tag:"div",html:"",cls:"divo-formintro-description"}]}});divo.form.FormIntro.superclass.initComponent.call(this)},setLabel:function(b){this.label=b;if(this.renderedl){this._labelEl.update(b)}},setText:function(b){this.text=b;if(this.rendered){if(this.text!=undefined){this._textEl.update(this.text);this._textEl.setDisplayed(true)}else{this._textEl.setDisplayed(false)}}},onRender:function(e,b){divo.form.FormIntro.superclass.onRender.call(this,e,b);this._labelEl=new Ext.Element(this.el.dom.firstChild.firstChild);this._textEl=new Ext.Element(this.el.dom.lastChild);if(this.label){this._labelEl.update(this.label)}if(this.text!=undefined){this._textEl.update(this.text)}else{this._textEl.setDisplayed(false)}if(this.imageClass){this._textEl.addClass(this.imageClass)}}});divo.form.TreeSortForm=Ext.extend(Ext.form.FormPanel,{baseUrl:null,parentNode:null,initComponent:function(){Ext.apply(this,{baseCls:"x-plain",labelWidth:75,labelAlign:"right",autoScroll:true,bodyStyle:"padding:0",items:[{xtype:"itemselector",name:"tree-childs",hideLabel:true,sorterOnly:true,fromStore:this.getFromDataStore(),msWidth:500,msHeight:300,valueField:"id",displayField:"name"}]});divo.form.TreeSortForm.superclass.initComponent.call(this)},getFromDataStore:function(){return new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({method:"GET",url:this.baseUrl+"/children"}),reader:this.getReader(),baseParams:{node:this.parentNode.id,rootNeeded:1}})},getReader:function(){return new Ext.data.JsonReader({idProperty:"id",root:"rows",fields:[{name:"id",type:"int"},{name:"name",type:"string"}]})},save:function(f){var e=this.getForm().findField("tree-childs").getValue();var b=true;Ext.Ajax.request({scope:this,url:this.baseUrl+"/"+this.parentNode.id+"/order",async:false,method:"PUT",jsonData:{idList:e},success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){this.say("显示顺序修改成功")}},failure:function(g,h){this.alert(g.responseText);b=false}});if(b){f.call()}}});Ext.reg("divo.form.TreeSortForm",divo.form.TreeSortForm);divo.form.ClearableComboBox=Ext.extend(Ext.form.ComboBox,{initComponent:function(){divo.form.ClearableComboBox.superclass.initComponent.call(this);this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",style:"padding-right:2px",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger"},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-form-clear-trigger"}]}},getTrigger:function(b){return this.triggers[b]},initTrigger:function(){var b=this.trigger.select(".x-form-trigger",true);this.wrap.setStyle("overflow","hidden");var e=this;b.each(function(g,j,f){g.hide=function(){var k=e.wrap.getWidth();this.dom.style.display="none";e.el.setWidth(k-e.trigger.getWidth())};g.show=function(){var k=e.wrap.getWidth();this.dom.style.display="";e.el.setWidth(k-e.trigger.getWidth())};var h="Trigger"+(f+1);if(this["hide"+h]){g.dom.style.display="none"}g.on("click",this["on"+h+"Click"],this,{preventDefault:true});g.addClassOnOver("x-form-trigger-over");g.addClassOnClick("x-form-trigger-click")},this);this.triggers=b.elements},onTrigger1Click:function(){this.onTriggerClick()},onTrigger2Click:function(){this.reset();this.fireEvent("select",this,"")}});Ext.reg("clearablecombo",divo.form.ClearableComboBox);Ext.ns("Ext.ux.form");Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"input",type:"hidden"},timeWidth:100,dtSeparator:" ",hiddenFormat:"Y-m-d H:i:s",otherToNow:true,timePosition:"right",dateFormat:"m/d/y",timeFormat:"g:i A",initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);var e=Ext.apply({},{id:this.id+"-date",format:this.dateFormat||Ext.form.DateField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);this.df=new Ext.form.DateField(e);this.df.ownerCt=this;delete (this.dateFormat);var b=Ext.apply({},{id:this.id+"-time",format:this.timeFormat||Ext.form.TimeField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);this.tf=new Ext.form.TimeField(b);this.tf.ownerCt=this;delete (this.timeFormat);this.relayEvents(this.df,["focus","specialkey","invalid","valid"]);this.relayEvents(this.tf,["focus","specialkey","invalid","valid"])},onRender:function(f,b){if(this.isRendered){return}Ext.ux.form.DateTime.superclass.onRender.call(this,f,b);var e;if("below"===this.timePosition||"bellow"===this.timePosition){e=Ext.DomHelper.append(f,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-bottom:1px",cls:"ux-datetime-date"}]},{tag:"tr",children:[{tag:"td",cls:"ux-datetime-time"}]}]},true)}else{e=Ext.DomHelper.append(f,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-right:4px",cls:"ux-datetime-date"},{tag:"td",cls:"ux-datetime-time"}]}]},true)}this.tableEl=e;this.wrap=e.wrap({cls:"x-form-field-wrap"});this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(e.child("td.ux-datetime-date"));this.tf.render(e.child("td.ux-datetime-time"));if(Ext.isIE&&Ext.isStrict){e.select("input").applyStyles({top:0})}this.on("specialkey",this.onSpecialKey,this);this.df.el.swallowEvent(["keydown","keypress"]);this.tf.el.swallowEvent(["keydown","keypress"]);if("side"===this.msgTarget){var g=this.el.findParent(".x-form-element",10,true);this.errorIcon=g.createChild({cls:"x-form-invalid-icon"});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon}this.el.dom.name=this.hiddenName||this.name||this.id;this.df.el.dom.removeAttribute("name");this.tf.el.dom.removeAttribute("name");this.isRendered=true;this.updateHidden()},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,"tl-tr",[2,0])},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0)},clearInvalid:function(){this.df.clearInvalid();this.tf.clearInvalid()},markInvalid:function(b){this.df.markInvalid(b);this.tf.markInvalid(b)},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();this.wrap.remove();this.tableEl.remove();this.df.destroy();this.tf.destroy()}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable()}this.disabled=true;this.df.disabled=true;this.tf.disabled=true;this.fireEvent("disable",this);return this},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable()}this.disabled=false;this.df.disabled=false;this.tf.disabled=false;this.fireEvent("enable",this);return this},focus:function(){this.df.focus()},getPositionEl:function(){return this.wrap},getResizeEl:function(){return this.wrap},getValue:function(){return this.dateValue?new Date(this.dateValue):""},isValid:function(){return this.df.isValid()&&this.tf.isValid()},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible()},onBlur:function(b){if(this.wrapClick){b.focus();this.wrapClick=false}if(b===this.df){this.updateDate()}else{this.updateTime()}this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var e=this.getValue();if(String(e)!==String(this.startValue)){this.fireEvent("change",this,e,this.startValue)}this.hasFocus=false;this.fireEvent("blur",this)}}).defer(100,this)},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this)}},onMouseDown:function(b){if(!this.disabled){this.wrapClick="td"===b.target.nodeName.toLowerCase()}},onSpecialKey:function(f,g){var b=g.getKey();if(b===g.TAB){if(f===this.df&&!g.shiftKey){g.stopEvent();this.tf.focus()}if(f===this.tf&&g.shiftKey){g.stopEvent();this.df.focus()}}if(b===g.ENTER){this.updateValue()}},setDate:function(b){this.df.setValue(b)},setTime:function(b){this.tf.setValue(b)},setSize:function(b,e){if(!b){return}if("below"===this.timePosition){this.df.setSize(b,e);this.tf.setSize(b,e);if(Ext.isIE){this.df.el.up("td").setWidth(b);this.tf.el.up("td").setWidth(b)}}else{this.df.setSize(b-this.timeWidth-4,e);this.tf.setSize(this.timeWidth,e);if(Ext.isIE){this.df.el.up("td").setWidth(b-this.timeWidth-4);this.tf.el.up("td").setWidth(this.timeWidth)}}},setValue:function(f){if(!f&&true===this.emptyToNow){this.setValue(new Date());return}else{if(!f){this.setDate("");this.setTime("");this.updateValue();return}}if("number"===typeof f){f=new Date(f)}else{if("string"===typeof f&&this.hiddenFormat){f=Date.parseDate(f,this.hiddenFormat)}}f=f?f:new Date(1970,0,1,0,0,0);var b,e;if(f instanceof Date){this.setDate(f);this.setTime(f);this.dateValue=new Date(f)}else{b=f.split(this.dtSeparator);this.setDate(b[0]);if(b[1]){if(b[2]){b[1]+=b[2]}this.setTime(b[1])}}this.updateValue()},setVisible:function(b){if(b){this.df.show();this.tf.show()}else{this.df.hide();this.tf.hide()}return this},show:function(){return this.setVisible(true)},hide:function(){return this.setVisible(false)},updateDate:function(){var b=this.df.getValue();if(b){if(!(this.dateValue instanceof Date)){this.initDateValue();if(!this.tf.getValue()){this.setTime(this.dateValue)}}this.dateValue.setMonth(0);this.dateValue.setFullYear(b.getFullYear());this.dateValue.setMonth(b.getMonth(),b.getDate())}else{this.dateValue="";this.setTime("")}},updateTime:function(){var b=this.tf.getValue();if(b&&!(b instanceof Date)){b=Date.parseDate(b,this.tf.format)}if(b&&!this.df.getValue()){this.initDateValue();this.setDate(this.dateValue)}if(this.dateValue instanceof Date){if(b){this.dateValue.setHours(b.getHours());this.dateValue.setMinutes(b.getMinutes());this.dateValue.setSeconds(b.getSeconds())}else{this.dateValue.setHours(0);this.dateValue.setMinutes(0);this.dateValue.setSeconds(0)}}},updateHidden:function(){if(this.isRendered){var b=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):"";this.el.dom.value=b}},updateValue:function(){this.updateDate();this.updateTime();this.updateHidden();return},validate:function(){return this.df.validate()&&this.tf.validate()},renderer:function(f){var e=f.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;e+=" "+(f.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);var b=function(h){var g=Ext.util.Format.date(h,e);return g};return b}});Ext.reg("xdatetime",Ext.ux.form.DateTime);Ext.namespace("Ext.ux.form");Ext.ux.form.BrowseButton=Ext.extend(Ext.Button,{inputFileName:"file",debug:false,FLOAT_EL_WIDTH:60,FLOAT_EL_HEIGHT:18,buttonCt:null,clipEl:null,floatEl:null,inputFileEl:null,originalHandler:null,originalScope:null,initComponent:function(){Ext.ux.form.BrowseButton.superclass.initComponent.call(this);this.originalHandler=this.handler;this.originalScope=this.scope;this.handler=null;this.scope=null},onRender:function(g,e){Ext.ux.form.BrowseButton.superclass.onRender.call(this,g,e);this.buttonCt=this.el.child(".x-btn-center em");this.buttonCt.position("relative");var f={position:"absolute",overflow:"hidden",top:"0px",left:"0px"};if(Ext.isIE){Ext.apply(f,{left:"-3px",top:"-3px"})}else{if(Ext.isGecko){Ext.apply(f,{left:"-3px",top:"-3px"})}else{if(Ext.isSafari){Ext.apply(f,{left:"-4px",top:"-2px"})}}}this.clipEl=this.buttonCt.createChild({tag:"div",style:f});this.setClipSize();this.clipEl.on({mousemove:this.onButtonMouseMove,mouseover:this.onButtonMouseMove,scope:this});this.floatEl=this.clipEl.createChild({tag:"div",style:{position:"absolute",width:this.FLOAT_EL_WIDTH+"px",height:this.FLOAT_EL_HEIGHT+"px",overflow:"hidden"}});if(this.debug){this.clipEl.applyStyles({"background-color":"green"});this.floatEl.applyStyles({"background-color":"red"})}else{this.clipEl.setOpacity(0)}var b=this.el.child(this.buttonSelector);b.on("focus",this.onButtonFocus,this);if(Ext.isIE){this.el.on("keydown",this.onButtonKeyDown,this)}this.createInputFile()},setClipSize:function(){if(this.clipEl){var e=this.buttonCt.getWidth();var b=this.buttonCt.getHeight();if(Ext.isIE){e=e+5;b=b+5}else{if(Ext.isGecko){e=e+6;b=b+6}else{if(Ext.isSafari){e=e+6;b=b+6}}}this.clipEl.setSize(e,b)}},createInputFile:function(){this.inputFileEl=this.floatEl.createChild({tag:"input",type:"file",size:1,name:this.inputFileName||Ext.id(this.el),tabindex:this.tabIndex,style:{position:"absolute",cursor:"pointer",right:"0px",top:"0px"}});this.inputFileEl=this.inputFileEl.child("input")||this.inputFileEl;this.inputFileEl.on({click:this.onInputFileClick,change:this.onInputFileChange,focus:this.onInputFileFocus,select:this.onInputFileFocus,blur:this.onInputFileBlur,scope:this});if(this.tooltip){if(typeof this.tooltip=="object"){Ext.QuickTips.register(Ext.apply({target:this.inputFileEl},this.tooltip))}else{this.inputFileEl.dom[this.tooltipType]=this.tooltip}}},onButtonFocus:function(b){if(this.inputFileEl){this.inputFileEl.focus();b.stopEvent()}},onButtonKeyDown:function(b){if(this.inputFileEl&&b.getKey()==Ext.EventObject.SPACE){this.inputFileEl.dom.click();b.stopEvent()}},onButtonMouseMove:function(f){var b=f.getXY();b[0]-=this.FLOAT_EL_WIDTH/2;b[1]-=this.FLOAT_EL_HEIGHT/2;this.floatEl.setXY(b)},onInputFileFocus:function(b){if(!this.isDisabled){this.el.addClass("x-btn-over")}},onInputFileBlur:function(b){this.el.removeClass("x-btn-over")},onInputFileClick:function(b){b.stopPropagation()},onInputFileChange:function(){if(this.originalHandler){this.originalHandler.call(this.originalScope,this)}},detachInputFile:function(e){var b=this.inputFileEl;if(typeof this.tooltip=="object"){Ext.QuickTips.unregister(this.inputFileEl)}else{this.inputFileEl.dom[this.tooltipType]=null}this.inputFileEl.removeAllListeners();this.inputFileEl=null;if(!e){this.createInputFile()}return b},getInputFile:function(){return this.inputFileEl},disable:function(){Ext.ux.form.BrowseButton.superclass.disable.call(this);this.inputFileEl.dom.disabled=true},enable:function(){Ext.ux.form.BrowseButton.superclass.enable.call(this);this.inputFileEl.dom.disabled=false}});Ext.reg("browsebutton",Ext.ux.form.BrowseButton);Ext.namespace("Ext.ux");Ext.ux.BoxSelect=Ext.extend(Ext.form.ComboBox,{initComponent:function(){Ext.apply(this,{selectedValues:{},boxElements:{},current:false,options:{className:"bit",separator:","},hideTrigger:true,grow:false});Ext.ux.BoxSelect.superclass.initComponent.call(this)},onRender:function(e,b){Ext.ux.BoxSelect.superclass.onRender.call(this,e,b);this.el.removeClass("x-form-text");this.el.className="maininput";this.el.setWidth(20);this.holder=this.el.wrap({tag:"ul","class":"holder x-form-text"});this.holder.on("click",function(f){f.stopEvent();if(this.maininput!=this.current){this.focus(this.maininput)}},this);this.maininput=this.el.wrap({tag:"li","class":"bit-input"});Ext.apply(this.maininput,{focus:function(){this.focus()}.createDelegate(this)});this.store.on("datachanged",function(f){this.store.each(function(g){if(this.checkValue(g.data[this.valueField])){this.removedRecords[g.data[this.valueField]]=g;this.store.remove(g)}},this)},this);this.on("expand",function(f){this.store.each(function(g){if(this.checkValue(g.data[this.valueField])){this.removedRecords[g.data[this.valueField]]=g;this.store.remove(g)}},this)},this);this.removedRecords={}},onResize:function(b,f,g,e){this._width=b;this.holder.setWidth(b-4);Ext.ux.BoxSelect.superclass.onResize.call(this,b,f,g,e);this.autoSize()},onKeyUp:function(f){if(this.editable!==false&&!f.isSpecialKey()){if(f.getKey()==f.BACKSPACE&&this.lastValue.length==0){f.stopEvent();this.collapse();var b=this.maininput.prev();if(b){b.focus()}return}this.dqTask.delay(this.queryDelay)}this.autoSize();Ext.ux.BoxSelect.superclass.onKeyUp.call(this,f);this.lastValue=this.el.dom.value},onSelect:function(b,f){var g=b.data[this.valueField];this.selectedValues[g]=g;if(typeof this.displayFieldTpl==="string"){this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl)}if(!this.boxElements[g]){var e;if(this.displayFieldTpl){e=this.displayFieldTpl.apply(b.data)}else{if(this.displayField){e=b.data[this.displayField]}}this.addItem(b.data[this.valueField],e)}this.collapse();this.setRawValue("");this.lastSelectionText="";this.applyEmptyText();this.autoSize()},onEnable:function(){Ext.ux.BoxSelect.superclass.onEnable.apply(this,arguments);for(var b in this.boxElements){this.boxElements[b].enable()}},onDisable:function(){Ext.ux.BoxSelect.superclass.onDisable.apply(this,arguments);for(var b in this.boxElements){this.boxElements[b].disable()}},getValue:function(){var e=[];for(var b in this.selectedValues){if(this.selectedValues[b]){e.push(this.selectedValues[b])}}return e.join(this.options.separator)},setValue:function(e){this.removeAllItems();this.store.clearFilter();this.resetStore();if(Ext.isArray(this.value)&&typeof this.value[0]==="object"&&this.value[0].data){this.setValues(this.value)}else{if(e&&typeof e==="string"){e=e.split(",")}var b=[];if(this.mode=="local"){Ext.each(e,function(g){var f=this.store.find(this.valueField,g.trim());if(f>-1){b.push(this.store.getAt(f))}},this)}else{this.store.baseParams[this.queryParam]=e;this.store.load({params:this.getParams(e)})}this.setValues(b)}},setValues:function(b){if(b){Ext.each(b,function(e){this.onSelect(e)},this)}this.value=""},removeAllItems:function(){for(var b in this.boxElements){this.boxElements[b].dispose(true)}},resetStore:function(){for(var b in this.removedRecords){var e=this.removedRecords[b];this.store.add(e)}this.sortStore()},sortStore:function(){var b=this.store.getSortState();if(b&&b.field){this.store.sort(b.field,b.direction)}},addItem:function(f,b){var e=new Ext.ux.BoxSelect.Item({id:"Box_"+f,maininput:this.maininput,renderTo:this.holder,className:this.options.className,caption:b,disabled:this.disabled,value:f,listeners:{remove:function(g){delete this.selectedValues[g.value];var h=this.removedRecords[g.value];if(h){this.store.add(h);this.sortStore();this.view.render()}},scope:this}});e.render();e.hidden=this.el.insertSibling({tag:"input",type:"hidden",value:f,name:(this.hiddenName||this.name)},"before",true);this.boxElements["Box_"+f]=e},autoSize:function(){if(!this.rendered){return}if(!this.metrics){this.metrics=Ext.util.TextMetrics.createInstance(this.el)}var f=this.el;var e=f.dom.value;var g=document.createElement("div");g.appendChild(document.createTextNode(e));e=g.innerHTML;g=null;e+="&#160;";var b=Math.max(this.metrics.getWidth(e)+10,10);if(typeof this._width!="undefined"){b=Math.min(this._width,b)}this.el.setWidth(b);if(Ext.isIE){this.el.dom.style.top="0"}},onEnable:function(){Ext.ux.BoxSelect.superclass.onEnable.apply(this,arguments);for(var b in this.boxElements){this.boxElements[b].enable()}},onDisable:function(){Ext.ux.BoxSelect.superclass.onDisable.apply(this,arguments);for(var b in this.boxElements){this.boxElements[b].disable()}},checkValue:function(b){return(typeof this.selectedValues[b]!="undefined")}});Ext.reg("boxselect",Ext.ux.BoxSelect);Ext.ux.BoxSelect.Item=Ext.extend(Ext.Component,{initComponent:function(){Ext.ux.BoxSelect.Item.superclass.initComponent.call(this)},onElClick:function(b){this.focus()},onLnkClick:function(b){b.stopEvent();this.fireEvent("remove",this);this.dispose()},onLnkFocus:function(){this.el.addClass("bit-box-focus")},onLnkBlur:function(){this.el.removeClass("bit-box-focus")},enableElListeners:function(){this.el.on("click",this.onElClick,this,{stopEvent:true})},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,focus:this.onLnkFocus,blur:this.onLnkBlur,scope:this})},enableAllListeners:function(){this.enableElListeners();this.enableLnkListeners()},disableAllListeners:function(){this.el.un("click",this.onElClick,this);this.lnk.un("click",this.onLnkClick,this);this.lnk.un("focus",this.onLnkFocus,this);this.lnk.un("blur",this.onLnkBlur,this)},onRender:function(e,b){Ext.ux.BoxSelect.Item.superclass.onRender.call(this,e,this.maininput);this.addEvents("remove");this.addClass("bit-box");this.el=e.createChild({tag:"li"},this.maininput);this.el.addClassOnOver("bit-hover");Ext.apply(this.el,{focus:function(){this.down("a.closebutton").focus()},dispose:function(){this.dispose()}.createDelegate(this)});this.enableElListeners();this.el.update(this.caption);this.lnk=this.el.createChild({tag:"a","class":"closebutton",href:"#"});if(!this.disabled){this.enableLnkListeners()}else{this.disableAllListeners()}this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this});new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE],fn:function(){this.dispose()}.createDelegate(this)},{key:Ext.EventObject.RIGHT,fn:function(){this.move("right")}.createDelegate(this)},{key:Ext.EventObject.LEFT,fn:function(){this.move("left")}.createDelegate(this)},{key:Ext.EventObject.TAB,fn:function(){}.createDelegate(this)}]).stopEvent=true},move:function(b){if(b=="left"){el=this.el.prev()}else{el=this.el.next()}if(el){el.focus()}},dispose:function(b){this.fireEvent("remove",this);Ext.fly(this.hidden).remove();if(b){this.destroy()}else{this.el.hide({duration:0.5,callback:function(){this.move("right");this.destroy()}.createDelegate(this)})}return this}});Ext.namespace("Ext.ux.file");Ext.ux.file.BrowsePlugin=function(b){Ext.apply(this,b)};Ext.ux.file.BrowsePlugin.prototype={inputFileName:"file",debug:false,FLOAT_EL_WIDTH:60,FLOAT_EL_HEIGHT:18,buttonCt:null,clipEl:null,floatEl:null,inputFileEl:null,originalHandler:null,originalScope:null,init:function(b){this.originalHandler=b.handler||null;this.originalScope=b.scope||window;this.handler=null;this.scope=null;this.component=b;b.on("render",this.onRender,this);if(typeof b.setDisabled=="function"){b.setDisabled=b.setDisabled.createSequence(function(e){if(this.inputFileEl){this.inputFileEl.dom.disabled=e}},this)}if(typeof b.enable=="function"){b.enable=b.enable.createSequence(function(){if(this.inputFileEl){this.inputFileEl.dom.disabled=false}},this)}if(typeof b.disable=="function"){b.disable=b.disable.createSequence(function(){if(this.inputFileEl){this.inputFileEl.dom.disabled=true}},this)}},onRender:function(){this.buttonCt=this.buttonCt||this.component.el.child(".x-btn-center em")||this.component.el;this.buttonCt.position("relative");var b={position:"absolute",overflow:"hidden",top:"0px",left:"0px"};if(Ext.isIE){Ext.apply(b,{left:"-3px",top:"-3px"})}else{if(Ext.isGecko){Ext.apply(b,{left:"-3px",top:"-3px"})}else{if(Ext.isSafari){Ext.apply(b,{left:"-4px",top:"-2px"})}}}this.clipEl=this.buttonCt.createChild({tag:"div",style:b});this.setClipSize();this.clipEl.on({mousemove:this.onButtonMouseMove,mouseover:this.onButtonMouseMove,scope:this});this.floatEl=this.clipEl.createChild({tag:"div",style:{position:"absolute",width:this.FLOAT_EL_WIDTH+"px",height:this.FLOAT_EL_HEIGHT+"px",overflow:"hidden"}});this.clipEl.applyStyles({"background-color":"green"});this.floatEl.applyStyles({"background-color":"red"});if(!this.debug){this.clipEl.setOpacity(0)}this.createInputFile()},setClipSize:function(){if(this.clipEl){var e=this.buttonCt.getWidth();var b=this.buttonCt.getHeight();if(Ext.isIE){e=e+5;b=b+5}else{if(Ext.isGecko){e=e+6;b=b+6}else{if(Ext.isSafari){e=e+6;b=b+6}}}this.clipEl.setSize(e,b)}},createInputFile:function(){this.inputFileEl=this.floatEl.createChild({tag:"input",type:"file",size:1,name:this.inputFileName||Ext.id(this.el),style:{position:"absolute",cursor:"pointer",right:"0px",top:"0px"}});this.inputFileEl=this.inputFileEl.child("input")||this.inputFileEl;this.inputFileEl.on({click:this.onInputFileClick,change:this.onInputFileChange,scope:this});if(this.tooltip){if(typeof this.tooltip=="object"){Ext.QuickTips.register(Ext.apply({target:this.inputFileEl},this.tooltip))}else{this.inputFileEl.dom[this.tooltipType]=this.tooltip}}},onButtonMouseMove:function(f){var b=f.getXY();b[0]-=this.FLOAT_EL_WIDTH/2;b[1]-=this.FLOAT_EL_HEIGHT/2;this.floatEl.setXY(b)},onInputFileClick:function(b){b.stopPropagation()},onInputFileChange:function(){if(this.originalHandler){this.originalHandler.call(this.originalScope,this)}},detachInputFile:function(e){var b=this.inputFileEl;if(typeof this.tooltip=="object"){Ext.QuickTips.unregister(this.inputFileEl)}else{this.inputFileEl.dom[this.tooltipType]=null}this.inputFileEl.removeAllListeners();this.inputFileEl=null;if(!e){this.createInputFile()}return b},getInputFile:function(){return this.inputFileEl},disable:function(){Ext.ux.file.BrowseAction.superclass.disable.call(this);this.inputFileEl.dom.disabled=true},enable:function(){Ext.ux.file.BrowseAction.superclass.enable.call(this);this.inputFileEl.dom.disabled=false}};Ext.namespace("Ext.ux.file");Ext.ux.file.Uploader=function(b){Ext.apply(this,b);Ext.ux.file.Uploader.superclass.constructor.apply(this,arguments);this.addEvents("uploadcomplete","uploadfailure")};Ext.extend(Ext.ux.file.Uploader,Ext.util.Observable,{maxFileSize:2097152,url:"index.php",imageWidth:0,imageHeight:0,createForm:function(){var b=Ext.getBody().createChild({tag:"form",action:this.url,method:"post",cls:"x-hidden",id:Ext.id(),cn:[{tag:"input",type:"hidden",name:"MAX_FILE_SIZE",value:this.maxFileSize}]});return b},upload:function(){var e=this.createForm();e.appendChild(this.input);this.record=new Ext.ux.file.Uploader.file({input:this.input,form:e,status:"uploading"});var b=Ext.Ajax.request({isUpload:true,method:"post",form:e,scope:this,success:this.onUploadSuccess,failure:this.onUploadFail,params:{width:this.imageWidth,height:this.imageHeight}});this.record.set("request",b);return this},getRecord:function(){return this.record},onUploadSuccess:function(b,e){b=Ext.util.JSON.decode(b.responseText);if(b.status&&b.status!=="success"){this.onUploadFail()}else{this.record.set("status","complete");this.record.set("tempFile",b.tempFile);this.fireEvent("uploadcomplete",this,this.record)}},onUploadFail:function(b,e){this.record.set("status","failure");this.fireEvent("uploadfailure",this,this.record)},getFileName:function(){return this.input.getValue().split(/[\/\\]/).pop()},getFilePath:function(){return this.input.getValue().replace(/[^\/\\]+$/,"")},getFileCls:function(){var b=this.getFileName().split(".");if(b.length===1){return""}else{return b.pop().toLowerCase()}},isImage:function(){var b=this.getFileCls();return(b=="jpg"||b=="gif"||b=="png"||b=="jpeg")}});Ext.ux.file.Uploader.file=Ext.data.Record.create([{name:"id",type:"text",system:true},{name:"status",type:"text",system:true},{name:"tempFile",system:true},{name:"form",system:true},{name:"input",system:true},{name:"request",system:true}]);Ext.ux.form.ImageField2=Ext.extend(Ext.form.Field,{border:true,defaultImage:"/media/images/image-field-2-blank.gif",uploadUrl:"",defaultAutoCreate:{tag:"input",type:"hidden"},initComponent:function(){this.plugins=this.plugins||[];this.scope=this;this.handler=this.onFileSelect;this.browsePlugin=new Ext.ux.file.BrowsePlugin({});this.plugins.push(this.browsePlugin);Ext.ux.form.ImageField2.superclass.initComponent.call(this);this.imageSrc=this.defaultImage;if(this.border===true){this.width=this.width;this.height=this.height}},onRender:function(e,b){Ext.ux.form.ImageField2.superclass.onRender.call(this,e,b);this.buttonCt=Ext.DomHelper.insertFirst(e,"<div>&nbsp;</div>",true);this.buttonCt.applyStyles({border:this.border===true?"1px solid #B5B8C8":"0"});this.buttonCt.setSize(this.width,this.height);this.buttonCt.on("contextmenu",this.onContextMenu,this);this.imageCt=Ext.DomHelper.insertFirst(this.buttonCt,'<img src="'+this.imageSrc+'"/>',true);this.imageCt.setOpacity(0.2);this.imageCt.setStyle({position:"absolute",top:"18px"});Ext.apply(this.browsePlugin,{buttonCt:this.buttonCt,renderTo:this.buttonCt})},getValue:function(){var b=Ext.ux.form.ImageField2.superclass.getValue.call(this);return b},setValue:function(b){Ext.ux.form.ImageField2.superclass.setValue.call(this,b);if(!b||b==this.defaultImage){this.imageSrc=this.defaultImage}else{this.imageSrc=b;this.imageSrc.width=this.width;this.imageSrc.height=this.height;this.imageSrc.ratiomode=0}this.updateImage()},onFileSelect:function(f){var b=f.detachInputFile();var e=new Ext.ux.file.Uploader({input:b,url:this.uploadUrl,imageWidth:this.width,imageHeight:this.height});if(!e.isImage()){Ext.MessageBox.alert("提示","上传文件不是图片(gif/png/jpeg)").setIcon(Ext.MessageBox.ERROR);return}e.on("uploadcomplete",function(h,g){this.setValue(g.data.tempFile);this.updateImage()},this);e.on("uploadfailure",this.onUploadFail,this);this.buttonCt.mask("Loading","x-mask-loading");e.upload()},onUploadFail:function(){this.buttonCt.unmask();Ext.MessageBox.alert("提示","上传失败").setIcon(Ext.MessageBox.ERROR)},onContextMenu:function(g,b){g.preventDefault();var f=Ext.DomHelper.append(this.buttonCt,"<div>&nbsp;</div>",true);this.ctxMenu=new Ext.menu.Menu({items:[{text:"删除图片",iconCls:"action_delete",disabled:this.imageSrc==this.defaultImage,scope:this,handler:function(){this.setValue("")}}]});this.ctxMenu.showAt(g.getXY())},updateImage:function(){if(this.imageCt.dom.src.substr(-1*this.imageSrc.length)!=this.imageSrc){var e=this.imageCt.up("div");var b=Ext.DomHelper.insertAfter(this.imageCt,'<img src="'+this.imageSrc+'"/>',true);b.on("load",function(){this.imageCt.remove();this.imageCt=b;this.imageCt.setOpacity(this.imageSrc==this.defaultImage?0.2:1);this.buttonCt.unmask()},this);b.on("error",function(){Ext.MessageBox.alert("Image Failed","Could not load image. Please notify your Administrator").setIcon(Ext.MessageBox.ERROR);this.buttonCt.unmask()},this)}}});Ext.namespace("Ext.ux.form");Ext.ux.form.ButtonField=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"div"},value:"",onRender:function(f,b){if(!this.el){var e=this.getAutoCreate();if(!e.name){e.name=this.name||this.id}if(this.inputType){e.type=this.inputType}this.el=f.createChild(e,b)}this.button=new Ext.Button({renderTo:this.el,text:this.text,iconCls:this.iconCls||null,handler:this.handler||Ext.emptyFn,scope:this.scope||this})},getValue:function(){return this.button.text},setValue:function(b){this.button.text=b;this.value=b}});Ext.ComponentMgr.registerType("formBtn",Ext.ux.form.ButtonField);Ext.namespace("Ext.ux.form");Ext.ux.form.SimpleHtml=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"div"},value:"",onRender:function(f,b){if(!this.el){var e=this.getAutoCreate();if(!e.name){e.name=this.name||this.id}if(this.inputType){e.type=this.inputType}this.el=f.createChild(e,b)}this.component=new Ext.Component({renderTo:this.el,autoEl:{html:this.value},scope:this.scope||this,style:"padding-top:2px;"+(this.bodyStyle||"")});this.hiddenName=this.name},getValue:function(){return this.component.autoEl.html},setValue:function(b){this.component.getEl().dom.innerHTML=b;this.value=b}});Ext.ComponentMgr.registerType("formHtml",Ext.ux.form.SimpleHtml);Ext.namespace("Ext.ux","Ext.ux.form");Ext.ux.form.MagnifiedTextArea=Ext.extend(Ext.form.TextArea,{icon:"",msg:"",textHeight:400,title:"",tooltip:"放大输入框",onRender:function(e,b){Ext.ux.form.MagnifiedTextArea.superclass.onRender.call(this,e,b);if(!this.readOnly){this.img=Ext.DomHelper.insertAfter(this.el,{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-magnifiedTextArea"},true);this.img.on("click",this.showDialog,this);if(this.tooltip){Ext.QuickTips.init();if(typeof this.tooltip=="object"){this.tool=new Ext.ToolTip(Ext.apply(this.tooltip,{target:this.img.id}))}else{if(typeof this.tooltip=="string"){this.tool=new Ext.ToolTip({target:this.img.id,html:this.tooltip})}}}}},onDestroy:function(){this.img.removeAllListeners();Ext.removeNode(this.img);if(this.tool){this.tool.destroy()}Ext.ux.form.MagnifiedTextArea.superclass.onDestroy.call(this)},retrieveValue:function(b,e){if(b=="ok"){this.setValue(e)}},showDialog:function(){Ext.MessageBox.show({animEl:this.el,buttons:Ext.MessageBox.OKCANCEL,closable:true,fn:this.retrieveValue,icon:this.icon,modal:true,msg:this.msg,multiline:this.textHeight,scope:this,title:this.title?this.title:this.fieldLabel,value:this.getValue(),minWidth:this.width-10})}});Ext.reg("magnifiedTextArea",Ext.ux.form.MagnifiedTextArea);Ext.namespace("Ext.ux","Ext.ux.TDGi");Ext.ux.TDGi.BorderLayout=function(b){Ext.ux.TDGi.BorderLayout.superclass.constructor.call(this,b,this)};Ext.extend(Ext.ux.TDGi.BorderLayout,Ext.layout.BorderLayout,{northTitleAdded:false,southTitleAdded:false,eastTitleAdded:false,westTitleAdded:false,doCollapsedTitle:function(f){function g(k,j){if(k.region=="east"||k.region=="west"){if(Ext.isIE6||Ext.isIE7){if(k.region=="east"){Ext.get(k.collapsedEl.dom.firstChild).applyStyles({margin:"3px 3px 5px 3px"})}else{Ext.get(k.collapsedEl.dom.firstChild).applyStyles({margin:"3px auto 5px 3px"})}}return(Ext.DomHelper.append(k.collapsedEl,j))}else{return(Ext.DomHelper.insertFirst(k.collapsedEl,j))}}if(f.collapsedTitle){if(typeof f.collapsedTitle=="object"){if(typeof f.collapsedTitle.element=="object"){var e=f.collapsedTitle.element;if(e.style){e.style+="float: left;"}else{e.style="float: left;"}g(f,e);return(true)}}else{if(typeof f.collapsedTitle=="string"){var e=f.collapsedTitle;g(f,e);return(true)}else{if(typeof f.collapsedTitle=="boolean"&&f.collapsedTitle==true){if(f.region=="east"||f.region=="west"){if(Ext.isIE6||Ext.isIE7){var e={tag:"div",style:"writing-mode: tb-rl;FONT-FAMILY: 'Arial', 'Helvetica';FONT-SIZE: 13px; ",html:f.title}}else{var h=0,b="";for(i=0;h<f.title.length;i++){b+=f.title.substr(h,1)+"<br />";h++}var e={tag:"div",style:"text-align: center;",html:b}}}else{var e={tag:"div",html:f.title,style:"float: left;"}}g(f,e);return(true)}}}}},onLayout:function(g,M){var j;if(!this.rendered){M.position();M.addClass("x-border-layout-ct");var B=g.items.items;j=[];for(var F=0,G=B.length;F<G;F++){var J=B[F];var q=J.region;if(J.collapsed){j.push(J)}J.collapsed=false;if(!J.rendered){J.cls=J.cls?J.cls+" x-border-panel":"x-border-panel";J.render(M,F)}this[q]=q!="center"&&J.split?new Ext.layout.BorderLayout.SplitRegion(this,J.initialConfig,q):new Ext.layout.BorderLayout.Region(this,J.initialConfig,q);this[q].render(M,J)}this.rendered=true}var A=M.getViewSize();if(A.width<20||A.height<20){if(j){this.restoreCollapsed=j}return}else{if(this.restoreCollapsed){j=this.restoreCollapsed;delete this.restoreCollapsed}}var y=A.width,H=A.height;var x=y,E=H,t=0,u=0;var C=this.north,z=this.south,o=this.west,I=this.east,J=this.center;if(!J){throw"No center region defined in BorderLayout "+g.id}if(C&&C.isVisible()){var L=C.getSize();var D=C.getMargins();L.width=y-(D.left+D.right);L.x=D.left;L.y=D.top;t=L.height+L.y+D.bottom;E-=t;C.applyLayout(L);if(typeof C.collapsedEl!="undefined"&&C.collapsedTitle&&this.northTitleAdded==false){if(this.doCollapsedTitle(C)){this.northTitleAdded=true}}}if(z&&z.isVisible()){var L=z.getSize();var D=z.getMargins();L.width=y-(D.left+D.right);L.x=D.left;var K=(L.height+D.top+D.bottom);L.y=H-K+D.top;E-=K;z.applyLayout(L);if(typeof z.collapsedEl!="undefined"&&z.collapsedTitle&&this.southTitleAdded==false){if(this.doCollapsedTitle(z)){this.southTitleAdded=true}}}if(o&&o.isVisible()){var L=o.getSize();var D=o.getMargins();L.height=E-(D.top+D.bottom);L.x=D.left;L.y=t+D.top;var f=(L.width+D.left+D.right);u+=f;x-=f;o.applyLayout(L);if(typeof o.collapsedEl!="undefined"&&o.collapsedTitle&&this.westTitleAdded==false){if(this.doCollapsedTitle(o)){this.westTitleAdded=true}}}if(I&&I.isVisible()){var L=I.getSize();var D=I.getMargins();L.height=E-(D.top+D.bottom);var f=(L.width+D.left+D.right);L.x=y-f+D.left;L.y=t+D.top;x-=f;I.applyLayout(L);if(typeof I.collapsedEl!="undefined"&&I.collapsedTitle&&this.eastTitleAdded==false){if(this.doCollapsedTitle(I)){this.eastTitleAdded=true}}}var D=J.getMargins();var k={x:u+D.left,y:t+D.top,width:x-(D.left+D.right),height:E-(D.top+D.bottom)};J.applyLayout(k);if(j){for(var F=0,G=j.length;F<G;F++){j[F].collapse(false)}}if(Ext.isIE&&Ext.isStrict){M.repaint()}}});Ext.Container.LAYOUTS.tdgi_border=Ext.ux.TDGi.BorderLayout;Ext.namespace("Ext.ux.layout");Ext.override(Ext.layout.ContainerLayout,{fieldTpl:(function(){var b=new Ext.Template('<div class="x-form-item {5}" tabIndex="-1">','<label for="{0}" style="{2}" class="x-form-item-label">{1}{4}</label>','<div class="x-form-element" id="x-form-el-{0}" style="{3}">','</div><div class="{6}"></div>',"</div>");b.disableFormats=true;return b.compile()})()});Ext.ux.layout.AutoTableFormLayout=Ext.extend(Ext.layout.TableLayout,{labelSeparator:":",setContainer:function(h){this.columns=1;var m=new Array();for(var g=0,k=h.items.length;g<k;g++){var o=h.items.itemAt(g);if(o.fieldLabel==""){o.labelSeparator=""}o.labelWidth=o.labelWidth||h.labelWidth||100;o.colspan=o.colspan||1;var n=o.colspan;if(o.items!=undefined){for(var f=0,b=o.items.length;f<b;f++){var e=o.items[f];Ext.applyIf(e,h.defaults);e=Ext.ComponentMgr.create(e,e.xtype||h.defaultType||"textfield");if(e.fieldLabel==""){e.labelSeparator=""}e.labelWidth=e.labelWidth||h.subLabelWidth||0;o.items[f]=e;e.colspan=e.colspan||1;n+=e.colspan;h.getForm().add(e)}this.columns=Math.max(this.columns,n)}m[g]=n}for(var g=0,k=h.items.length;g<k;g++){var o=h.items.itemAt(g);o.colspan+=this.columns-m[g]}Ext.layout.FormLayout.prototype.setContainer.apply(this,arguments);this.currentRow=0;this.currentColumn=0;this.cells=[]},renderItem:function(h,b,f){if(h&&!h.rendered){this.doRender(h,0,Ext.get(this.getNextCell(h)),false);for(var e=0;e<this.columns-1;e++){if(h.items!=undefined&&e<h.items.length){var g=h.items[e];this.doRender(g,0,Ext.get(this.getNextCell(g)),true)}}if(h.hideRow){this.showRow(this.currentRow,false)}}},doRender:function(h,b,g,e){if(typeof h.labelWidth=="number"){var f=Ext.isIE?5:20;this.labelStyle="width:"+h.labelWidth+"px;";if(e){this.labelStyle+="width:"+(h.labelWidth-f)+"px; padding-left:"+f+"px;"}this.elementStyle="padding-left:"+(h.labelWidth+f)+"px;"}Ext.layout.FormLayout.prototype.renderItem.call(this,h,0,g)},showRow:function(e,b){var f=this.getRow(e);if(b){f.style.display=""}else{f.style.display="none"}}});Ext.Container.LAYOUTS.autotableform=Ext.ux.layout.AutoTableFormLayout;Ext.namespace("Ext.ux","Ext.ux.layout");Ext.ux.layout.HorizontalFitLayout=Ext.extend(Ext.layout.ContainerLayout,{containsScrollbar:false,monitorResize:true,onLayout:function(e,f){Ext.layout.FitLayout.superclass.onLayout.call(this,e,f);if(!this.container.collapsed){var b=f.getStyleSize();b.width=e.containsScrollbar?b.width-16:b.width;e.items.each(function(g){this.setItemSize(g,b)},this)}},setItemSize:function(e,b){if(e&&b.height>0){e.setWidth(b.width)}}});Ext.Container.LAYOUTS.hfit=Ext.ux.layout.HorizontalFitLayout;Ext.namespace("Ext.ux","Ext.ux.form");Ext.ux.form.ColumnFormPanel=Ext.extend(Ext.Panel,{formDefaults:{xtype:"textfield",anchor:"100%",labelSeparator:"",columnWidth:0.333},layout:"hfit",labelAlign:"top",initComponent:function(){var o=[];for(var k=0,h=this.items.length;k<h;k++){var t=this.items[k];var g={border:false,layout:"column",items:[]};for(var b=0,e=t.length;b<e;b++){var f=t[b];var q=g.items.push({columnWidth:f.columnWidth?f.columnWidth:this.formDefaults.columnWidth,layout:"form",labelAlign:this.labelAlign,defaults:this.formDefaults,bodyStyle:"padding-right: 5px;",border:false,items:f});if(f.width){g.items[q-1].width=f.width;delete g.items[q-1].columnWidth}}o.push(g)}this.items=o;Ext.ux.form.ColumnFormPanel.superclass.initComponent.call(this)}});Ext.reg("columnform",Ext.ux.form.ColumnFormPanel);divo.grid.SimpleGrid=Ext.extend(Ext.Panel,{item:null,displayEmptyText:null,editable:true,alternateRows:false,fields:[],rowAlternateClass:"alt",selectedClass:"selected",hoveredClass:"hovered",singleSelect:true,muliSelect:false,headerClass:"",headerUpClass:"selectedUp",headerDownClass:"selectedDown",tableClass:"j-grid-table",fieldDefinitions:null,getFieldFunc:null,setFieldFunc:null,selectRecord:null,sortable:true,sortInfo:{index:-1,direction:0},_meta:{field:null,format:null,filterer:null,sortable:true,sortType:"String",dataType:String,sortFunction:null,filterFunction:null,label:"",align:"left",valign:"top",getField:function(){return this.field||this.label},getType:function(){return this.dataType}},initComponent:function(){Ext.apply(this,{autoScroll:true,emptyText:this.displayEmptyText||"(无记录)",defaultDateFormat:this.getAppContext().getDayMonthYearFormat()});divo.grid.SimpleGrid.superclass.initComponent.call(this);if(this.fieldDefinitions){this.setFieldDefinitions(this.fieldDefinitions)}},afterRefresh:function(){var e=this.sortInfo;if(this.sortInfo&&this.sortInfo.index!=-1){var f=this.view.getEl().child("thead");if(f){var g=f.child("tr",true)}if(g&&e.index<g.cells.length){var b=g.cells[e.index];b.className=(e.direction==0)?this.headerDownClass:this.headerUpClass}}},setFieldDefinitions:function(f){this.sortInfo={index:-1,direction:0};this.fields=[];for(var e=0;e<f.length;e++){var b=Ext.applyIf(f[e],this._meta);this.fields.push(b)}this.createTemplate(this.fields)},createTemplate:function(g){var b='<table class="'+this.tableClass+'">';b+=this.createHeader();b+='<tbody><tpl for=".">';b+='<tr class="j-grid-row {alt}">';for(var f=0;f<g.length;f++){var e=g[f];b+='<td class="j-grid-col">{'+e.field+"}</td>"}b+="</tr>";b+="</tpl></tbody></table>";this.template=new Ext.XTemplate(b)},createHeader:function(){var b=new Ext.XTemplate('<thead><tr><tpl for=".">','<td width="{width}">{label}</td>',"</tpl></tr></thead>");return b.apply(this.fields)},prepareData:function(j,e,n){var h={};var f=this.fields;for(var k=0;k<f.length;k++){var g=f[k];var b=g.field;var m=j[b];h[b]=this.getFieldValue(g,m,n)}if(e%2==1){h.alt=(e%2==1)?"j-grid-row-alt":""}return h},getFieldValue:function(f,e,b){var g=e;if(f.renderer){g=f.renderer(e,null,b)}else{switch(f.dataType){case"lookup":if(!e){g=e}else{if(typeof(e)=="object"){g=e?e.name:""}else{if(f.options){var h=this.getLookup(f.options,e);g=h?h.name:""}}}break;case"date":g=e?e.format(f.format||this.defaultDateFormat):"";break;case"action":g=this.createActionHtml(f.actions);break;default:break}}return g},getLookup:function(e,h){var b=null;if(h){for(var f=0;f<e.length;f++){var g=e[f];if(g.id==h){b=g;break}}}return b},createActionHtml:function(h){var e="";if(this.editable){for(var b=0;b<h.length;b++){var g=h[b];if(g.hidden){continue}if(b>0){e+="&nbsp;|&nbsp;"}var f=String.format('<a href="javascript:void(0);" title="{2}" class="{0}">{1}</a>',"j-action-"+g.name,g.display,g.tooltip);e+=f}}return e},sortDataStore:function(){var b=this.sortInfo.index;if(b>=0){var e=this.fields[b];this.dataStore.sort(e.field,this.sortInfo.direction==0?"ASC":"DESC")}},onSelectRow:function(k,f,o,h){var q=this.body;var g=this.dataStore.getAt(f);var b=null;var t=h.getTarget("tr",q);var m=h.getTarget("td",q);var j=h.getTarget("a",q);if(j!=null){var n=j.className;if(n.indexOf("j-action-")!=-1){b=n.substr(9)}}this.onSelectItem(k,f,g,h,b,m.cellIndex)},onSort:function(j,g){var m;if(!this.sortable||!(m=g.getTarget("thead"))){return false}var n=g.getTarget("td",m);var h=n.cellIndex;var b=this.fields[h];if(!b.sortable){return false}var q=g.getTarget("tr",m);var k=q.getElementsByTagName("td");for(var f=0;f<k.length;f++){k[f].className=this.headerClass}var o=this.sortInfo;if(h==o.index){o.direction=(o.direction+1)%2}else{o={index:h,direction:0}}n.className=(o.direction==0)?this.headerDownClass:this.headerUpClass;this.sortInfo=o;this.sortDataStore();return true},onSelectItem:Ext.emptyFn,loadData:function(b){if(!this.dataStore.proxy&&!b){return}if(this.dataStore.proxy&&!this.dataStore.proxy.conn.url){return}this.mask();if(b){this.dataStore.loadData(b)}else{this.dataStore.load()}},mask:function(){this.el.mask("","x-mask-loading")},unmask:function(){this.el.unmask()},onRenderOther:Ext.emptyFn,onRender:function(b,e){divo.grid.SimpleGrid.superclass.onRender.call(this,b,e);if(this.fields){this.view=new Ext.DataView({emptyText:this.emptyText,tpl:this.template,store:this.dataStore,itemSelector:"tr.j-grid-row",selectedClass:this.selectedClass,prepareData:this.prepareData.createDelegate(this),listeners:{click:{fn:this.onSelectRow,scope:this},containerclick:{fn:this.onSort,scope:this},afterRefresh:{fn:this.afterRefresh,scope:this},loadexception:{fn:this.onLoadException,scope:this}}});this.add(this.view);this.doLayout();this.view.store.on("datachanged",this.unmask,this);this.onRenderOther()}},onLoadException:function(b,f,e){divo.showError(e.responseText)},setUrl:function(b){this.dataStore.proxy.conn.url=b},render:function(){divo.grid.SimpleGrid.superclass.render.apply(this,arguments);this.dataStore.on("load",this.onAfterLoad,this,true);this.showList()},onAfterLoad:Ext.emptyFn,showList:function(){this.loadData()}});divo.grid.SmartSimpleGrid=Ext.extend(Ext.grid.EditorGridPanel,{fieldDefinitions:null,isLookup:false,menuItemId:null,gridConfig:{},initComponent:function(){this.allRecordsVisible=false;this.meta=this.createGridMeta();if(this.gridConfig.autoSelectRow==undefined){this.autoSelectRow=true}else{this.autoSelectRow=this.gridConfig.autoSelectRow}if(this.gridConfig.showActiveBtn==undefined){this.showActiveBtn=false}else{this.showActiveBtn=this.gridConfig.showActiveBtn}if(this.gridConfig.simpleSearch==undefined){this.simpleSearch=false}else{this.simpleSearch=this.gridConfig.simpleSearch}if(this.gridConfig.clearSelection==undefined){this.clearSelection=true}else{this.clearSelection=this.gridConfig.clearSelection}if(this.gridConfig.viewForceFit==undefined){this.viewForceFit=false}else{this.viewForceFit=this.gridConfig.viewForceFit}if(this.gridConfig.viewEnableRowBody==undefined){this.viewEnableRowBody=false}else{this.viewEnableRowBody=this.gridConfig.viewEnableRowBody}this.lazyLoad=this.lazyLoad==undefined?false:this.lazyLoad;if(!this.url){this.lazyLoad=true}if(!this.gridConfig.groupField){this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({method:"GET",url:this.url}),reader:new Ext.data.JsonReader({root:"rows",totalProperty:"totalCount",id:"id"},this.meta.recordDef),remoteSort:true})}else{this.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({method:"GET",url:this.url}),reader:new Ext.data.JsonReader({root:"rows",totalProperty:"totalCount",id:"id"},this.meta.recordDef),remoteSort:true,groupField:this.gridConfig.groupField,remoteGroup:true})}this.tbarItems=[];if(this.gridConfig.toolbar){this.tbarItems=this.gridConfig.toolbar}else{if(!this.gridConfig.filter){this.tbarItems=[]}}this.pageSize=this.gridConfig.pageSize||20;if(this.gridConfig.footer==undefined||this.gridConfig.footer){this.createGridFooter()}else{this.pageSize=10000}if(this.gridConfig.filter){this.createGridFilter()}this.canMultiSelect=(this.gridConfig.singleSelect==false);if(this.canMultiSelect){this.selModel=new Ext.grid.CheckboxSelectionModel();var e=[this.selModel].concat(this.meta.cms);var b=new Ext.grid.ColumnModel(e)}else{var b=this.meta.columnModel;this.selModel=new Ext.grid.RowSelectionModel({singleSelect:true})}if(this.gridConfig.groupField){this.view=new Ext.grid.GroupingView({emptyText:this.gridConfig.emptyText||"没有找到记录",groupTextTpl:"{text}",showGroupName:false,enableNoGroups:false,enableGroupingMenu:false,hideGroupedColumn:true})}else{this.view=new Ext.grid.GridView({forceFit:this.viewForceFit,enableRowBody:this.viewEnableRowBody,getRowClass:this.gridConfig.getRowClass,emptyText:this.gridConfig.emptyText||"没有找到记录"})}var g=[];if(this.gridConfig.autoRefresher){g.push(new Ext.ux.grid.AutoRefresher({gridId:this.id}))}if(g.length==0){g=undefined}var f=[];if(this.gridConfig.plugins){f=this.gridConfig.plugins}Ext.apply(this,{region:this.region||"center",stripeRows:true,cm:b,hideHeaders:this.gridConfig.hideHeaders,loadMask:this.gridConfig.displayLoadMask==undefined||this.gridConfig.displayLoadMask?{msg:"",msgCls:"x-mask-loading"}:false,bbar:this.gridConfig.footer==undefined||this.gridConfig.footer?new Ext.PagingToolbar({cls:"go-paging-tb",plugins:g,pageSize:this.pageSize,store:this.store,displayInfo:true,items:this.bbarItems}):null,enableDragDrop:this.gridConfig.enableDragDrop==undefined?false:this.gridConfig.enableDragDrop,ddGroup:this.gridConfig.ddGroup||"gridDD",plugins:f,cls:this.gridConfig.cls,autoExpandColumn:this.gridConfig.autoExpandColumn});if(this.tbarItems.length>0){Ext.apply(this,{tbar:this.tbarItems})}divo.grid.SmartSimpleGrid.superclass.initComponent.call(this)},createGridMeta:function(){return divo.getGridMeta(this,this.fieldDefinitions)},smartLoad:function(){if(this.lazyLoad){return}this.loaded=true;this.store.load({params:{start:0,limit:this.pageSize}})},smartReload:function(){if(this.lazyLoad){return}if(!this.loaded){this.smartLoad()}else{this.store.reload()}},createGridFooter:function(){this.bbarItems=[];if(this.gridConfig.export2Excel){this.bbarItems.push("-");this.export2ExcelBtn=new Ext.Toolbar.Button({text:"<span>导出&nbsp;&nbsp;</span>",icon:divo.iconUrl+"excel.gif",cls:"x-btn-text-icon",tooltip:"导出网格内容到Excel",handler:this.onExport2Excel.createDelegate(this)});this.bbarItems.push(this.export2ExcelBtn)}this.createOtherFooterBtn()},createOtherFooterBtn:function(){if(this.gridConfig.showActiveBtn){this.createActiveFooterBtn()}},createActiveFooterBtn:function(){this.bbarItems.push("-");this.bbarItems.push({text:"<span>显示全部记录</span>",icon:divo.iconUrl+"pages.gif",cls:"x-btn-text-icon",tooltip:"隐藏非活动的记录或显示全部记录",enableToggle:true,toggleHandler:this.onShowAllRecords.createDelegate(this),pressed:false})},onShowAllRecords:function(b,e){this.allRecordsVisible=e;this.onRefreshList()},onExport2Excel:function(){if(!this.url){return}var k,j="",e="";var o=this.getColumnModel();var b=this.getStore();var q=b.getSortState();if(typeof(q)=="object"){if(("field" in q)&&("direction" in q)){j=q.field;e=q.direction}}var f=[],m=[];for(var h=0;h<o.config.length;h++){if(!o.config[h].hidden){f.push(o.config[h].dataIndex);m.push(o.config[h].header)}}document.GridExportForm.action=this.url+"/xls";document.GridExportForm.auth.value=Ext.Ajax.defaultHeaders.Authorization;document.GridExportForm.fieldHeaders.value=m.join("-");document.GridExportForm.fieldNames.value=f.join("-");document.GridExportForm.sort.value=j.length==0?"":j;document.GridExportForm.dir.value=e;if(this.gridConfig.filter){document.GridExportForm.filterValue.value=this.filterCombo?this.filterCombo.getValue():"";document.GridExportForm.filterField.value=this.getFilterField()}if(this.store.baseParams){var n=true;for(var g in this.store.baseParams){if("filterValue,filterField,dir,sort,fieldNames,fieldHeaders,auth,".indexOf(g)<0){v=this.store.baseParams[g];c=n?"?":"&";document.GridExportForm.action+=c+g+"="+v;n=false}}}document.GridExportForm.submit()},afterRender:function(){divo.grid.SmartSimpleGrid.superclass.afterRender.apply(this,arguments);this.store.on("beforeload",function(){if(this.gridConfig.filter){this.store.baseParams.filterValue=this.filterCombo?this.filterCombo.getValue():"";this.store.baseParams.filterField=this.getFilterField()}},this,true);this.store.on("loadexception",function(j,g,f,h){if(f.responseText){divo.showError(f.responseText,"数据加载失败")}},this,true);this.selModel.on("rowselect",this.onGridRowSelect,this);this.on("dblclick",this.onSelect,this);this.store.on("load",this.onGridLoad,this);this.store.on("beforeload",this.onBeforeLoad,this);var e=Ext.get("grid-export-form");if(!e){var b=['<div id="grid-export-form" class="x-hidden">','    <form method="POST" name="GridExportForm">','         <input type="hidden" name="auth"/>','         <input type="hidden" name="fieldNames"/>','         <input type="hidden" name="fieldHeaders"/>','         <input type="hidden" name="viewCode"/>','         <input type="hidden" name="sort"/>','         <input type="hidden" name="dir"/>','         <input type="hidden" name="filterValue"/>','         <input type="hidden" name="filterField"/>',"    </form>","</div>	"].join("");Ext.DomHelper.append(document.body,{html:b})}this.smartLoad()},createGridFilter:function(){this.createOtherBtn();if(!this.isLookup){this.tbarItems.push("->")}var e=this.meta.fs.length;if(!this.meta.fs||e==0){if(!this.simpleSearch){this.tbarItems.push({text:"搜索:&nbsp;&nbsp;"})}else{this.tbarItems.push({text:"输入搜索关键字然后按回车键:&nbsp;&nbsp;"})}}else{var g=[{text:"搜索:",handler:this.onFilterClick.createDelegate(this)}];for(var f=0;f<e;f++){g.push({text:this.meta.fs[f].text,handler:this.onFilterClick.createDelegate(this)})}this.filterBtn=new Ext.Toolbar.MenuButton({text:"搜索:",enableToggle:false,menu:{items:g}});this.tbarItems.push(this.filterBtn)}var b={selectOnFocus:true,emptyText:" ",resizable:true,hideClearButton:false,hideTrigger:false,typeAhead:true,width:150,triggerAction:"all"};if(this.simpleSearch){this.filterCombo=new Ext.form.ComboBox(b)}else{this.filterCombo=new Ext.ux.form.HistoryClearableComboBox(b)}this.tbarItems.push(this.filterCombo);this.filterCombo.on("specialkey",this.onSearchKeyPress.createDelegate(this));this.filterCombo.on("clearvalue",this.onSearch.createDelegate(this));this.filterCombo.on("select",this.onSearch.createDelegate(this));if(!this.simpleSearch){var h=this.gridConfig.filterTooltip?":"+this.gridConfig.filterTooltip:""}this.tbarItems.push({icon:divo.iconSearch,cls:"x-btn-icon",tooltip:"开始搜索(或按回车键)"+h,tooltipType:"title",handler:this.onSearch.createDelegate(this)})},createOtherBtn:Ext.emptyFn,getFilterField:function(){if(this.filterBtn){var f=this.filterBtn.getText();var b=this.meta.fs.length;for(var e=0;e<b;e++){if(f===this.meta.fs[e].text){return this.meta.fs[e].name}}}return""},onFilterClick:function(b){this.filterBtn.setText(b.text);if(this.filterCombo.getValue()){this.smartLoad()}},onSearchKeyPress:function(f,b){if(b.getKey()===b.ENTER){this.smartLoad()}},onSearch:function(){this.smartLoad()},onGridRowSelect:function(f,h,g){var b=this.selModel.getSelections()[0];this.cRowIndex=h;this.cRecordData=b.data;if(this.cIdFocus){this.cId=this.cIdFocus}else{this.cId=this.cRecordData.id}this.cIdFocus=null;this.cName=this.cRecordData.name;this.notifyRowChange(b)},notifyRowChange:function(b){this.publish("divo.rowSelect"+this.id,{sender:this.id,id:this.cId,name:this.cName,record:b?b.data:null})},onGridLoad:function(e,b,g){var h=function(){if(this.store.getTotalCount()==0){this.cId=null;this.cName=null;this.notifyRowChange()}else{if(this.cIdFocus){this.cId=this.cIdFocus}if(this.autoSelectRow){if(this.cId){var f=this.store.indexOfId(this.cId);if(f>=0){this.getView().focusRow(f);this.selModel.selectRow(f)}else{this.selModel.selectFirstRow()}}else{this.selModel.selectFirstRow()}}else{if(this.clearSelection){this.selModel.clearSelections();this.cId=null;this.cIdFocus=null;this.cName=null;this.notifyRowChange()}}}this.onAfterLoad(e,b,g)};if(!this.canMultiSelect){h.defer(1000,this)}},onAfterLoad:Ext.emptyFn,loadList:function(){this.smartReload()},setUrl:function(b){this.cId=null;this.cName=null;this.url=b;this.lazyLoad=false;this.store.proxy.conn.url=b},onSelect:function(b){this.onSmartDblClick()},onSmartDblClick:Ext.emptyFn,onBeforeLoad:function(b,e){if(this.showActiveBtn){b.baseParams.allRecordsVisible=this.allRecordsVisible?1:0}},checkSelection:function(b){if(!this.cId){this.say(b||"请先选择某条记录");return false}return true},deleteItem:function(){if(!this.cId){this.say("请先选择要删除的记录");return}if(!this.onBeforeDeleteItem()){return}Ext.MessageBox.confirm("确认","要删除吗?",this.deleteItemConfirm.createDelegate(this))},onBeforeDeleteItem:function(){return true},deleteItemConfirm:function(b){if(b=="yes"){this.onDeleteItem(this.cId)}},getDeleteUrl:function(b){return this.url+"/"+b},onDeleteItem:function(b){Ext.Ajax.request({scope:this,url:this.getDeleteUrl(b),method:"DELETE",success:function(e,f){var g=Ext.decode(e.responseText);if(g.success){this.deleteItemCallback();this.onAfterDeleteItem()}else{this.say(g.errors.reason)}},failure:function(e,f){this.alert(e.responseText)}})},onAfterDeleteItem:Ext.emptyFn,deleteItemCallback:function(){this.cId=null;this.cName=null;this.loadList()},rowNumberRender:function(g,h,b){var f=b.store;var e=f.lastOptions.params.start;if(isNaN(e)){e=0}return f.indexOf(b)+e+1},rowNumberDescRender:function(g,h,b){var f=b.store;var j=f.getTotalCount();var e=f.lastOptions.params.start;if(isNaN(e)){e=j}return j-f.indexOf(b)-e},addedOnRender:function(e,f,b){if(!e){return""}return e.substr(0,10)},lineBreakRender:function(e,f,b){return e.replace(/\n/g,"<br/>")},wordWrapRender:function(m,j,f,h,n){if(!this.getColumnModel().config[n].width){return m}if(!m){return""}v=m.replace(/\s*(.*?)\s*(\r\n)\s*/mg,"$1$2");var e=0;var g="";var k=v.getHzLength();var b=this.getColumnModel().getColumnWidth(n);b/=7.8;if(k>b){return v.brkLine(b).replace(/\n/g,"<br/>")}else{return v.replace(/\n/g,"<br/>")}},moneyRender:function(g,b,h,j,e,f){return divo.money(g)},amountRender:function(b){return divo.amount(b)},priceRender:function(b){return divo.amount(b)},booleanRender:function(g,b,h,j,e,f){return["<img ",'class="checkbox" ','src="/media/images/divo/',g?"checked2.gif":"unchecked2.gif",'"/>'].join("")},cellTooltipRender:function(e,b){b.attr=' ext:qtip="'+e+'"';return e},addedOnTextRender:function(e,f,b){return divo.getTimeText(e)},onRefreshList:function(){this.cIdFocus=this.cId;this.loadList()},onRefreshNextList:function(b,g,f){var e=this.store.indexOfId(this.cId);if(e<this.store.getCount()-1){this.cIdFocus=this.store.getAt(e+1).data.id;this.loadList()}},onChangeList:function(b,f,e){this.cIdFocus=f.id;this.loadList()},getTotalCount:function(){return this.store.getTotalCount()},totalSumRoundTo0Render:function(b,f,e){return Math.round(b)},totalSumRoundTo2Render:function(b,f,e){return Math.round(b*100)/100},totalSumRoundTo0MoneyRender:function(b,f,e){return divo.money(Math.round(b))},totalSumRoundTo2MoneyRender:function(b,f,e){return divo.money(Math.round(b*100)/100)},totalSumRoundToAmountRender:function(b,f,e){return divo.amount(b)},totalRender:function(b,f,e){return"合计："}});Ext.reg("divo.grid.SmartSimpleGrid",divo.grid.SmartSimpleGrid);Ext.ns("Ext.ux.grid");Ext.ux.grid.RowActions=function(b){Ext.apply(this,b);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.grid.RowActions.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.RowActions,Ext.util.Observable,{actionEvent:"click",autoWidth:true,header:"",menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions"><div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> {cls}" style="{style}" qtip="{qtip}">{text}</div></tpl>',tplRow:'<div class="ux-row-action"><tpl for="actions"><div class="ux-row-action-item {cls} <tpl if="text">ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}"><tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div></tpl></div>',widthIntercept:4,widthSlope:21,init:function(f){this.grid=f;if(!this.tpl){this.tpl=this.processActions(this.actions)}if(this.autoWidth){this.width=this.widthSlope*this.actions.length+this.widthIntercept;this.fixed=true}var e=f.getView();var b={scope:this};b[this.actionEvent]=this.onClick;f.on({render:{scope:this,fn:function(){e.mainBody.on(b)}}});if(!this.renderer){this.renderer=function(m,g,h,n,k,j){g.css+=(g.css?" ":"")+"ux-row-action-cell";return this.tpl.apply(this.getData(m,g,h,n,k,j))}.createDelegate(this)}if(e.groupTextTpl&&this.groupActions){e.interceptMouse=e.interceptMouse.createInterceptor(function(g){if(g.getTarget(".ux-grow-action-item")){return false}});e.groupTextTpl='<div class="ux-grow-action-text">'+e.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply()}},getData:function(h,b,e,j,g,f){return e.data||{}},processActions:function(g,f){var b=[];Ext.each(g,function(h,j){if(h.iconCls&&"function"===typeof(h.callback||h.cb)){this.callbacks=this.callbacks||{};this.callbacks[h.iconCls]=h.callback||h.cb}var k={cls:h.iconIndex?"{"+h.iconIndex+"}":(h.iconCls?h.iconCls:""),qtip:h.qtipIndex?"{"+h.qtipIndex+"}":(h.tooltip||h.qtip?h.tooltip||h.qtip:""),text:h.textIndex?"{"+h.textIndex+"}":(h.text?h.text:""),hide:h.hideIndex?'<tpl if="'+h.hideIndex+'">visibility:hidden;</tpl>':(h.hide?"visibility:hidden;":""),align:h.align||"right",style:h.style?h.style:""};b.push(k)},this);var e=new Ext.XTemplate(f||this.tplRow);return new Ext.XTemplate(e.apply({actions:b}))},onClick:function(k,m){var n=this.grid.getView();var g=false;var w=k.getTarget(".x-grid3-row");var b=n.findCellIndex(m.parentNode.parentNode);var u=k.getTarget(".ux-row-action-item");if(u){g=u.className.replace(/ux-row-action-item /,"");if(g){g=g.replace(/ ux-row-action-text/,"");g=g.trim()}}if(false!==w&&false!==b&&false!==g){var j=this.grid.store.getAt(w.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[g]){this.callbacks[g](this.grid,j,g,w.rowIndex,b)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,j,g,w.rowIndex,b)){return}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,j,g,w.rowIndex,b)}}}u=k.getTarget(".ux-grow-action-item");if(u){var o=n.findGroup(m);var h=o?o.id.replace(/ext-gen[0-9]+-gp-/,""):null;var f;if(h){var q=new RegExp(h);f=this.grid.store.queryBy(function(e){return e._groupId.match(q)});f=f?f.items:[]}g=u.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if("function"===typeof this.callbacks[g]){this.callbacks[g](this.grid,f,g,h)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,f,g,h)){return false}this.fireEvent("groupaction",this.grid,f,g,h)}}});Ext.reg("rowactions",Ext.ux.grid.RowActions);Ext.namespace("Ext.ux.grid");Ext.ux.grid.ProgressColumn=function(b){Ext.apply(this,b);this.renderer=this.renderer.createDelegate(this);this.addEvents("action");Ext.ux.grid.ProgressColumn.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.ProgressColumn,Ext.util.Observable,{textPst:"%",colored:false,actionEvent:"dblclick",init:function(e){this.grid=e;this.view=e.getView();if(this.editor&&e.isEditor){var b={scope:this};b[this.actionEvent]=this.onClick;e.afterRender=e.afterRender.createSequence(function(){this.view.mainBody.on(b)},this)}},onClick:function(h,g){var j=h.getTarget(".x-grid3-row").rowIndex;var b=this.view.findCellIndex(g.parentNode.parentNode);var f=h.getTarget(".x-progress-text");if(f){this.grid.startEditing(j,b)}},renderer:function(f,h,e){var g="";var b=(f<55)?"x-progress-text-back":"x-progress-text-front"+(Ext.isIE6?"-ie6":"");var j=String.format('</div><div class="x-progress-text {0}" style="width:100%;" id="{1}">{2}</div></div>',b,Ext.id(),f+this.textPst);j=(f<96)?j.substring(0,j.length-6):j.substr(6);if(this.colored==true){if(f<=100&&f>66){g="-green"}if(f<67&&f>33){g="-orange"}if(f<34){g="-red"}}h.css+=" x-grid3-progresscol";return String.format('<div class="x-progress-wrap"><div class="x-progress-inner"><div class="x-progress-bar{0}" style="width:{1}%;">{2}</div></div>',g,f,j)}});Ext.ns("Ext.ux.grid");Ext.ux.grid.RowPopup=function(b){Ext.apply(this,b);Ext.ux.grid.RowPopup.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.bodyContent={};this.actualRecord=0;this.enablePopup=true};Ext.extend(Ext.ux.grid.RowPopup,Ext.util.Observable,{mode:"locale",width:400,height:500,colId:false,timeOut:500,remoteUrl:false,enableCaching:true,enableButton:true,init:function(b){this.grid=b;if(this.mode=="locale"&&!this.tpl){return}if(this.mode=="remote"&&!this.remoteUrl){return}this.grid.onRender=b.onRender.createSequence(this.onRender,this);this.grid.on("mouseover",this.onMouseOver.createDelegate(this))},onRender:function(){this.win=new Ext.Window({layout:"fit",width:this.width,height:this.height,autoScroll:true,closeAction:"close",plain:false,closable:false,constrain:true});if(this.enableButton&&this.grid.getBottomToolbar()){var b=this.grid.getBottomToolbar();b.add("-");b.addButton({id:"diableRowPopup",text:this.i18n.rowPopupButtonText,tooltip:this.i18n.rowPopupButtonTooltipText,pressed:false,enableToggle:true,scope:this,iconCls:"diableRowPopup",toggleHandler:function(e,f){this.enablePopup=!f}})}this.grid.getEl().on("mousemove",this.onMouseMove.createDelegate(this))},getRecord:function(e){var b=this.grid.getView().findRowIndex(e);this.record=this.grid.store.getAt(b);return this.record},getBodyContent:function(b){if(!this.enableCaching){return this.tpl.apply(b.data)}var e=this.bodyContent[b.id];if(!e){e=this.tpl.apply(b.data);this.bodyContent[b.id]=e}return e},onMouseOver:function(e,t){if(!this.enablePopup){return}var row=e.getTarget(".x-grid3-row");if(this.colId){var Col=e.getTarget(".x-grid3-td-"+this.colId)}else{var Col=true}if(Col!=null&&row!=null){var rec=this.getRecord(t);if(this.actualRecord==rec.id){if(this.win.isVisible()){this.win.doLayout()}return}this.hideWin();this.actualRecord=rec.id;if(rec){var win=this.win;var self=this;var x=e.getXY()[0]+5;var y=e.getXY()[1];var clientH=Ext.lib.Dom.getViewHeight();var clientW=Ext.lib.Dom.getViewWidth();if(e.getXY()[0]+5+this.width>clientW){x=e.getXY()[0]-this.width-5}win.doLayout();if(this.mode=="locale"){if(!win.rendered){win.html=this.getBodyContent(rec)}else{win.body.update(this.getBodyContent(rec))}this.ctime=setTimeout(function(){self.showWin(x,y)},this.timeOut)}else{if(this.mode=="remote"){if(!win.rendered){win.show();win.hide()}if(this.enableCaching&&this.bodyContent[this.actualRecord]){win.body.update(this.bodyContent[this.actualRecord]);this.ctime=setTimeout(function(){self.showWin(x,y)},this.timeOut);return}this.updater=win.getUpdater();this.updater.showLoading();var data=rec.data;var urls=this.remoteUrl.split("{");var url_list=[];for(var i=0;i<urls.length;i++){var p=urls[i].indexOf("}");if(p<0){url_list.push('"'+urls[i]+'"+')}else{var fldName=urls[i].substring(0,p);var otherStr="";if(p<urls[i].length-1){otherStr='+"'+urls[i].substring(p+1,urls[i].length)+'"+'}url_list.push("data."+fldName+otherStr)}}var url=url_list.join("");url=url.substr(0,url.length-1);this.updater.update({url:eval(url),callback:function(e,s,r){if(this.enableCaching){this.bodyContent[this.actualRecord]=r.responseText}},scope:this});this.updater.on("update",function(){win.doLayout()});this.ctime=setTimeout(function(){self.showWin(x,y)},this.timeOut)}else{return}}}}},onMouseMove:function(f,b){if(!this.enablePopup){this.hideWin();return}if(this.colId){var h=f.getTarget(".x-grid3-td-"+this.colId)}else{var h=true}if(h){var g=this.getRecord(b);if(!g||this.actualRecord!=g.id){this.hideWin()}}else{this.hideWin()}},hideWin:function(){this.actualRecord=0;if(this.ctime){clearTimeout(this.ctime)}if(this.win&&this.win.isVisible()){this.win.hide()}if(this.updater&&this.updater.isUpdating()){this.updater.abort()}},showWin:function(b,e){this.win.setPosition(b,e);this.win.doLayout();this.win.show()}});Ext.ux.grid.RowPopup.prototype.i18n={rowPopupButtonText:"Hide popup",rowPopupButtonTooltipText:"Do not show the popup"};Ext.ux.grid.AutoRefresher=function(b){Ext.apply(this,b)};Ext.extend(Ext.ux.grid.AutoRefresher,Ext.util.Observable,{intervals:[[1],[5],[10],[15],[30],[60]],interval:1,beforeText:"刷新间隔",afterText:"分钟",addBefore:"-",addAfter:null,init:function(b){this.Toolbar=b;if(b.store){this.store=b.store}b.on("render",this.onRender,this);this.store.startAutoRefresh=function(e){if(this.autoRefreshProcId){clearInterval(this.autoRefreshProcId)}this.autoRefreshProcId=setInterval(this.reload.createDelegate(this,[{}]),e*1000)};this.store.stopAutoRefresh=function(){if(this.autoRefreshProcId){clearInterval(this.autoRefreshProcId)}}},update:function(e){var b=e.getValue();if(b>0){this.store.startAutoRefresh(b*60)}else{this.store.stopAutoRefresh()}},onRender:function(){var b={maskRe:/^d*$/,store:new Ext.data.SimpleStore({fields:["autoRefresh"],data:this.intervals}),displayField:"autoRefresh",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,width:50};Ext.apply(b,this.comboCfg);var e=new Ext.form.ComboBox(b);e.on("change",this.update,this);e.on("select",this.update,this);if(this.addBefore){this.Toolbar.add(this.addBefore)}this.Toolbar.add(this.beforeText,e,this.afterText);if(this.addAfter){this.Toolbar.add(this.addAfter)}e.getEl().on("keydown",function(g){var f=g.getKey();switch(f){case Ext.EventObject.ENTER:this.update(e)}},this);e.setValue(this.interval);if(this.interval>0){this.store.startAutoRefresh(this.interval*60)}else{this.store.stopAutoRefresh()}}});Ext.ns("Ext.ux.grid");Ext.ux.grid.GridSummary=function(b){Ext.apply(this,b)};Ext.extend(Ext.ux.grid.GridSummary,Ext.util.Observable,{init:function(e){this.grid=e;this.cm=e.getColumnModel();this.view=e.getView();var b=this.view;b.onLayout=this.onLayout;b.afterMethod("render",this.refreshSummary,this);b.afterMethod("refresh",this.refreshSummary,this);b.afterMethod("syncScroll",this.syncSummaryScroll,this);b.afterMethod("onColumnWidthUpdated",this.doWidth,this);b.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);b.afterMethod("onColumnHiddenUpdated",this.doHidden,this);e.store.on({add:this.refreshSummary,remove:this.refreshSummary,clear:this.refreshSummary,update:this.refreshSummary,scope:this});if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row x-grid3-gridsummary-row-offset">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table>","</div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},calculate:function(f,q){var h={},n=q.config;for(var k=0,o=n.length;k<o;k++){var e=n[k],m=e.dataIndex;h[m]=0;if(e.summaryType){for(var g=0,t=f.length;g<t;g++){var b=f[g];h[m]=Ext.ux.grid.GridSummary.Calculations[e.summaryType](b.get(m),b,m,h,g)}}}return h},onLayout:function(b,e){if(Ext.type(e)!="number"){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(e-this.summary.getHeight())}},syncSummaryScroll:function(){var b=this.view.scroller.dom;this.view.summaryWrap.dom.scrollLeft=b.scrollLeft;this.view.summaryWrap.dom.scrollLeft=b.scrollLeft},doWidth:function(f,b,e){var g=this.view.summary.dom;g.firstChild.style.width=e;g.firstChild.rows[0].childNodes[f].style.width=b},doAllWidths:function(b,e){var h=this.view.summary.dom,k=b.length;h.firstChild.style.width=e;var g=h.firstChild.rows[0].childNodes;for(var f=0;f<k;f++){g[f].style.width=b[f]}},doHidden:function(e,g,b){var f=this.view.summary.dom,h=g?"none":"";f.firstChild.style.width=b;f.firstChild.rows[0].childNodes[e].style.display=h},renderSummary:function(f,j,q){j=j||this.view.getColumnData();var k=q.config,g=[],t=j.length-1;for(var h=0,m=j.length;h<m;h++){var n=j[h],e=k[h],b={};b.id=n.id;b.style=n.style;b.css=h==0?"x-grid3-cell-first ":(h==t?"x-grid3-cell-last ":"");if(e.summaryType||e.summaryRenderer){b.value=(e.summaryRenderer||n.renderer)(f.data[n.name],b,f)}else{b.value=""}if(b.value==undefined||b.value===""){b.value="&#160;"}g[g.length]=this.cellTpl.apply(b)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:g.join("")})},refreshSummary:function(){var j=this.grid,m=j.store,h=this.view.getColumnData(),b=this.cm,e=m.getRange(),k=this.calculate(e,b),f=this.renderSummary({data:k},h,b);if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}this.view.summary=this.view.summaryWrap.update(f).first()},toggleSummary:function(e){var b=this.grid.getGridEl();if(b){if(e===undefined){e=b.hasClass("x-grid-hide-gridsummary")}b[e?"removeClass":"addClass"]("x-grid-hide-gridsummary");this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Ext.reg("gridsummary",Ext.ux.grid.GridSummary);Ext.ux.grid.GridSummary.Calculations={sum:function(e,b,f,h,g){return h[f]+Ext.num(e,0)},count:function(e,b,f,h,g){return g+1},max:function(e,b,f,h,g){return Math.max(Ext.num(e,0),h[f])},min:function(e,b,f,h,g){return Math.min(Ext.num(e,0),h[f])},average:function(e,b,g,k,j){var f=k[g]+Ext.num(e,0),h=b.store.getCount();return j==h-1?(f/h):f}};Ext.ns("Ext.ux.grid");Ext.ux.grid.CellActions=function(b){Ext.apply(this,b);this.addEvents("action","beforeaction");Ext.ux.grid.CellActions.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.CellActions,Ext.util.Observable,{actionEvent:"click",actionWidth:20,tpl:'<div class="ux-cell-value" style="padding-left:{padding}px"><tpl if="\'left\'!==align">{value}</tpl><div class="ux-cell-actions<tpl if="\'left\'===align"> ux-cell-actions-left</tpl>" style="width:{width}px"><tpl for="actions"><div class="ux-cell-action {cls}" qtip="{qtip}" style="{style}">&#160;</div></tpl></div><tpl if="\'left\'===align">{value}</tpl><div>',userProcessing:Ext.emptyFn,init:function(e){this.grid=e;e.afterRender=e.afterRender.createSequence(this.onRenderGrid,this);var b=this.grid.getColumnModel();Ext.each(b.config,function(g,f){if("object"===typeof g.cellActions){g.origRenderer=b.getRenderer(f);g.renderer=this.renderActions.createDelegate(this)}},this)},onRenderGrid:function(){this.view=this.grid.getView();var b={scope:this};b[this.actionEvent]=this.onClick;this.view.mainBody.on(b)},getData:function(h,b,e,j,g,f){return e.data||{}},renderActions:function(j,m,g,n,e,k){var h=this.grid.getColumnModel().config[e];var b=h.origRenderer(j,m,g,n,e,k);if(h.cellActions&&!h.actionsTpl){h.actionsTpl=this.processActions(h);h.actionsTpl.compile()}else{if(!h.cellActions){return b}}var f=this.getData.apply(this,arguments);f.value=b;return h.actionsTpl.apply(f)},processActions:function(f){this.callbacks=this.callbacks||{};var e={align:this.align||"right",width:this.actionWidth*f.cellActions.length,padding:"left"===this.align?this.actionWidth*f.cellActions.length:0,value:"{value}",actions:[]};Ext.each(f.cellActions,function(g,h){if(g.iconCls&&"function"===typeof(g.callback||g.cb)){this.callbacks[g.iconCls]=g.callback||g.cb}var j={cls:g.iconIndex?"{"+g.iconIndex+"}":(g.iconCls?g.iconCls:""),qtip:g.qtipIndex?"{"+g.qtipIndex+"}":(g.tooltip||g.qtip?g.tooltip||g.qtip:""),style:g.style?g.style:""};e.actions.push(j)},this);this.userProcessing(f,e);var b=new Ext.XTemplate(this.tpl);return new Ext.Template(b.apply(e))},onClick:function(h,j){var o=h.getTarget("div.ux-cell-action");var q=h.getTarget(".x-grid3-row");var b=this.view.findCellIndex(j.parentNode.parentNode);var k=this.grid.getColumnModel().config[b];var g,m,n,f;if(o){g=this.grid.store.getAt(q.rowIndex);m=k.dataIndex;n=g.get(m);f=o.className.replace(/ux-cell-action /,"")}if(false!==q&&false!==b&&g&&m&&f){if(this.callbacks&&"function"===typeof this.callbacks[f]){this.callbacks[f](this.grid,g,f,n,m,q.rowIndex,b)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,g,f,n,m,q.rowIndex,b)){return}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,g,f,n,m,q.rowIndex,b)}}}}});Ext.reg("cellactions",Ext.ux.grid.CellActions);divo.tree.SimpleTree=Ext.extend(Ext.tree.TreePanel,{url:null,nodeConfigFn:null,treeName:null,rootId:1,tbarVisible:true,allowMaint:true,initComponent:function(){Ext.apply(this,{animate:true,containerScroll:true,rootVisible:true,root:this.createRootNode(),tbar:this.tbarVisible?this.getTbar():undefined,autoScroll:true,loader:new Ext.tree.TreeLoader({requestMethod:"GET",dataUrl:this.url,nodeConfigFn:this.nodeConfigFn.createDelegate(this),listeners:{loadexception:{fn:this.onLoadException,scope:this}}})});divo.tree.SimpleTree.superclass.initComponent.call(this)},render:function(){divo.tree.SimpleTree.superclass.render.apply(this,arguments);this.getSelectionModel().on("selectionchange",this.onNodeSelected,this,true);this.loader.on("load",this.onLoad,this)},getTbar:function(){return new Ext.Toolbar({cls:"go-paging-tb",items:["->",{icon:divo.iconCollapseAll2,cls:"x-btn-icon",tooltip:"全部收缩",handler:this.onCollapseAll,scope:this}]})},onLoadException:function(b,f,e){divo.showError(e.responseText)},onCollapseAll:function(){this.root.collapse(true)},onNodeSelected:function(e,b){if(!b){return}this.currentNodeId=b.id;this.currentNode=b;this.publish("divo.nodeSelect"+this.id,{sender:this.id,node:b})},onLoad:function(g,f,b){if(this.currentNodeId){var e=f.findChild("id",this.currentNodeId);if(e){e.ensureVisible();e.expand();this.getSelectionModel().select(e)}}},createRootNode:function(){var b;Ext.Ajax.request({scope:this,url:this.rootUrl,async:false,method:"GET",success:function(f,g){var h=Ext.decode(f.responseText);if(!h.success){this.say(h.errors.reason);return}b=h.data},failure:function(f,g){this.alert(f.responseText)}});if(!b){return null}if(this.nodeConfigFn){var e=this.nodeConfigFn(b)}Ext.apply(e,{draggable:false,expanded:false});return new Ext.tree.AsyncTreeNode(e)}});divo.tree.DynamicTree=Ext.extend(divo.tree.SimpleTree,{readOnly:false,initComponent:function(){Ext.apply(this,{url:this.baseUrl+"/children",rootUrl:this.baseUrl+"/root",nodeConfigFn:this.createMyNode,autoScroll:true,enableDD:!this.readOnly||this.canUpdate()});this.subscribe("divo.window.TreeOrderChanged",this.onTreeOrderChanged,this);this.on("beforedestroy",function(){this.unsubscribe()},this);divo.tree.DynamicTree.superclass.initComponent.call(this)},onTreeOrderChanged:function(b,f,e){if(f.sender==this.treeSortWinId){if(f.node.reload){f.node.reload()}}},onRender:function(){divo.tree.DynamicTree.superclass.onRender.apply(this,arguments);if(this.readOnly||!this.canCreate()){return}this.on("contextmenu",this.onShowContext,this);this.on("beforemovenode",this.onMoveNode,this);this.createTreeEditor()},getTbar:function(){return new Ext.Toolbar({items:[{text:"新建",tooltip:"新建"+this.treeName,icon:divo.iconAdd,cls:"x-btn-text-icon",hidden:this.readOnly||!this.canCreate(),handler:function(){var b=this.getSelectNode();if(!b){return}this.onAdd(b)},scope:this},"->",{icon:divo.iconCollapseAll2,cls:"x-btn-icon",tooltip:"全部收缩",handler:this.onCollapseAll,scope:this}]})},onShowContext:function(b,f){if(this.readOnly){return}this.createContextMenu();if(this.ctxNode){this.ctxNode.ui.removeClass("x-node-ctx")}if(b){this.ctxNode=b;this.ctxNode.ui.addClass("x-node-ctx")}this.ctx.showAt(f.getXY())},createContextMenu:function(){if(this.ctx){return}this.ctx=new Ext.menu.Menu({items:[{text:"修改",icon:divo.iconEdit,scope:this,hidden:!this.canUpdate(),handler:function(){var b=this.getSelectNode();if(!b){return}this.onUpdate(b)}},{text:"删除",icon:divo.iconDelete,scope:this,hidden:!this.canDelete(),handler:function(){var b=this.getSelectNode();if(!b){return}this.onDelete(b)}},"-",{text:"调整显示顺序",icon:divo.iconUrl+"/component.gif",scope:this,hidden:!this.canUpdate(),handler:function(){var b=this.validateOnChangeDisplayOrder();if(b){this.onChangeDisplayOrder(b)}}}]});this.ctx.on("hide",this.onContextHide,this)},validateOnChangeDisplayOrder:function(){var b=this.getSelectNode();if(!b){return null}if(!b.firstChild){this.say("该节点无下级节点");return null}return b},hasSelection:function(){var b=this.getSelectionModel().getSelectedNode();if(!b){this.say("请先选择"+this.treeName+"。");return false}return true},getSelectNode:function(){var b;if(this.ctxNode){b=this.ctxNode;this.ctxNode.select()}else{if(!this.hasSelection()){return null}else{b=this.getSelectionModel().getSelectedNode()}}return b},onContextHide:function(){if(this.ctxNode){this.ctxNode.ui.removeClass("x-node-ctx");this.ctxNode=null}},onMoveNode:function(b,h,f,g,e){var j=true;Ext.util.Observable.capture(b,function(){return false});j=this.onChangeNodeParent(h,f,g);Ext.util.Observable.releaseCapture(b);return j},createTreeEditor:function(){this.treeEditor=new Ext.tree.TreeEditor(this,{allowBlank:false,blankText:"请输入"+this.treeName+"名称",selectOnFocus:true});this.un("beforeclick",this.treeEditor.beforeNodeClick,this.treeEditor);this.treeEditor.on("complete",this.onNodeEdited,this,true)},onNodeEdited:function(h,g,e){var f=h.editNode;var j=f.parentNode.attributes.id;if(this.adding){var b=this.save(null,g,j);if(b){f.id=b.id;f.attributes.id=b.id;f.attributes.code=b.code}}else{var b=this.save(f.attributes.id,g,j);if(!b){f.setText(e)}}this.editing=false;this.adding=false},save:function(g,e,h){this.getEl().mask("","x-mask-loading");var f={name:e,parent_id:h};var b=null;Ext.Ajax.request({scope:this,url:this.baseUrl+(g?"/"+g:""),method:!this.adding?"PUT":"POST",jsonData:f,async:false,success:function(j,k){this.getEl().unmask();var m=Ext.decode(j.responseText);b=m},failure:function(j,k){this.getEl().unmask();this.alert(j.responseText)}});if(!b){this.say("["+newText+"]保存失败")}else{if(!b.success){this.say(b.errors.name);b=null}}return b},clearSelectedNode:function(){this.getSelectionModel().clearSelections()},createMyNode:function(e){var b={leaf:e.is_leaf,id:e.id,text:e.name,codeLevel:e.code_level,code:e.tree_code,parentId:e.parent_id,draggable:e.parent_id>0};return this.createMyNodeAddon(b,e)},createMyNodeAddon:function(b,e){return b},onAdd:function(b){var e=new Ext.tree.TreeNode(this.createMyNode({is_leaf:true,id:"99999999",name:this.treeName,code_level:b.attributes.codeLevel+1,tree_code:"99999999",parent_id:b.attributes.id}));this.adding=true;b.appendChild(e);b.expand();e.select();b.lastChild.ensureVisible();this.treeEditor.triggerEdit(e)},onUpdate:function(b){if(b.isRoot){this.say("根节点不允许修改");return}this.treeEditor.triggerEdit(b)},onDelete:function(b){if(b.isRoot){this.say("根节点不允许删除。");return}if(b.firstChild){this.say("还有子节点，不允许删除。");return}if(!this.otherDeleteValidate(b)){return}this.currentNode=b;Ext.MessageBox.confirm("确认","要删除吗？",this.deleteConfirm.createDelegate(this))},deleteConfirm:function(e){if(e!=="yes"){return}var b=true;var f=this.currentNode;Ext.Ajax.request({scope:this,url:this.baseUrl+"/"+f.id,async:false,method:"DELETE",success:function(g,h){var j=Ext.decode(g.responseText);if(!j.success){b=false;this.say(j.errors.reason)}},failure:function(g,h){this.alert(g.responseText);b=false}});if(b){f.parentNode.removeChild(f)}},onChangeNodeParent:function(e,b,f){if(!this.otherDragValidate(e)){return false}if(b.id==f.id){this.say("此拖动操作无效");return false}Ext.Ajax.request({scope:this,url:this.baseUrl+"/"+e.id+"/parent",async:false,method:"PUT",jsonData:{newParentId:f.id},success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){this.say("拖动操作成功")}},failure:function(g,h){this.alert(g.responseText)}});return true},onChangeDisplayOrder:function(b){this.treeSortWinId=this.myId("sort-win");var e=new divo.window.TreeSortWindow({id:this.treeSortWinId,parentNode:b,baseUrl:this.baseUrl});e.show()},otherDeleteValidate:function(b){return true},otherDragValidate:function(b){return true}});divo.tree.ImageCatalogTree=Ext.extend(divo.tree.DynamicTree,{allowMaxWidth:null,allowMaxHeight:null,allowMaxFileSize:null,thumbWidth:0,thumbHeight:0,baseWidth:0,baseHeight:0,isFlash:false,initComponent:function(){Ext.apply(this,{baseUrl:"/imagecatalogs/"+this.getUserId(),treeName:"文件夹"});divo.tree.ImageCatalogTree.superclass.initComponent.call(this)},afterRender:function(){divo.tree.ImageCatalogTree.superclass.afterRender.apply(this,arguments);var b=function(){this.expandAll();this.root.select()};b.defer(100,this)},getTbar:function(){return[{text:"上传"+(this.isFlash?"Flash文件":"图片"),tooltip:"上传"+(this.isFlash?"Flash文件":"图片")+"到当前文件夹",icon:divo.iconUrl+"block-image.gif",cls:"x-btn-text-icon",handler:function(){var b=this.getSelectNode();if(!b){return}this.onUploadImage(b)},scope:this},{text:"批量上传",tooltip:"将多个"+(this.isFlash?"Flash文件":"图片")+"同时上传到当前文件夹",icon:divo.iconUrl+"arrow_up.png",cls:"x-btn-text-icon",handler:function(){var b=this.getSelectNode();if(!b){return}this.onUploadMultiImage(b)},scope:this},"->",{tooltip:"新建下级文件夹",icon:divo.iconAdd,cls:"x-btn-icon",handler:function(){var b=this.getSelectNode();if(!b){return}this.onAdd(b)},scope:this},{icon:divo.iconCollapseAll2,cls:"x-btn-icon",tooltip:"全部收缩",handler:this.onCollapseAll,scope:this}]},onUploadImage:function(b){var e=new Ext.ux.UploadDialog.Dialog({url:"/uploadedimages/"+this.getUserId()+"/"+b.attributes.code+"/"+this.getImageLimitStr(),upload_autostart:true,allow_close_on_upload:false,permitted_extensions:this.isFlash?["swf","SWF"]:["gif","jpg","png","GIF","JPG","PNG"],closeAction:"destroy"});e.on("uploadsuccess",this.onUploadSuccess,this);e.show()},onUploadSuccess:function(e,f,b){this.publish("divo.tree.ImageUploaded",{sender:this.id,fileId:b.fileId,catalogCode:b.catalogCode})},otherDeleteValidate:function(b){if(this.hasItems(b)){this.say("已经在此文件夹中保存了图片，不允许删除。");return false}return true},otherDragValidate:function(b){if(this.hasItems(b)){this.say("已经在此文件夹中保存了图片，不能再移动。");return false}return true},hasItems:function(f){var b=true;var e=0;Ext.Ajax.request({scope:this,url:"/uploadedimages/"+this.getUserId()+"/"+f.attributes.code,async:false,method:"GET",success:function(g,h){var j=Ext.decode(g.responseText);e=j.totalCount},failure:function(g,h){this.alert(g.responseText);b=false}});return b&&e>0},onUploadMultiImage:function(b){this.currentCatalogCode=b.attributes.code;var f=new Ext.ux.SwfUploadPanel({width:500,height:300,border:false,upload_url:"/uploadedimages/"+this.getUserId()+"/"+this.currentCatalogCode+"/multi/"+this.getImageLimitStr(),post_params:{id:123},file_types:this.isFlash?"*.swf":"*.jpg;*.jpeg;*.gif;*.png;",file_types_description:(this.isFlash?"Flash文件":"图片文件"),single_file_select:false,confirm_delete:false,remove_completed:true});f.on("fileUploadComplete",this.onUploadMultiSuccess,this);var e=new Ext.Window({title:"批量上传文件",width:514,modal:true,height:330,resizable:false,items:[f]});e.show()},onUploadMultiSuccess:function(b,f,e){this.publish("divo.tree.ImageUploaded",{sender:this.id,catalogCode:this.currentCatalogCode})},getImageLimitStr:function(){var e=this.allowMaxWidth||0;var j=this.allowMaxHeight||0;var k=this.allowMaxFileSize||300;var b=this.thumbWidth||0;var m=this.thumbHeight||0;var f=this.baseWidth||0;var h=this.baseHeight||0;var g=e+"/"+j+"/"+k+"/"+b+"/"+m+"/"+f+"/"+h;return g}});Ext.reg("divo.tree.ImageCatalogTree",divo.tree.ImageCatalogTree);Ext.ux.ToastWindowMgr={positions:[]};Ext.ux.ToastWindow=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,{iconCls:this.iconCls||"x-icon-information",width:300,autoHeight:true,plain:false,modal:false,bodyStyle:"text-align:center;padding:10px 1px 10px 1px;background-color:white;color:red;"});if(this.autoDestroy){this.task=new Ext.util.DelayedTask(this.hide,this)}Ext.ux.ToastWindow.superclass.initComponent.call(this)},setMessage:function(b){this.body.update(b)},setTitle:function(e,b){Ext.ux.ToastWindow.superclass.setTitle.call(this,e,b||this.iconCls)},onRender:function(e,b){Ext.ux.ToastWindow.superclass.onRender.call(this,e,b)},onDestroy:function(){Ext.ux.ToastWindowMgr.positions.remove(this.pos);Ext.ux.ToastWindow.superclass.onDestroy.call(this)},afterShow:function(){Ext.ux.ToastWindow.superclass.afterShow.call(this);this.on("move",function(){Ext.ux.ToastWindowMgr.positions.remove(this.pos);if(this.task){this.task.cancel()}},this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000)}},animShow:function(){this.pos=0;while(Ext.ux.ToastWindowMgr.positions.indexOf(this.pos)>-1){this.pos++}Ext.ux.ToastWindowMgr.positions.push(this.pos);this.setSize(300,100);this.el.alignTo(document,"br-br",[-20,-20-((this.getSize().height+10)*this.pos)]);this.el.slideIn("b",{duration:1,callback:this.afterShow,scope:this})},animHide:function(){Ext.ux.ToastWindowMgr.positions.remove(this.pos);this.el.ghost("b",{duration:1,remove:true})}});Ext.namespace("Ext.ux.Utils");Ext.ux.Utils.EventQueue=function(e,b){if(!e){throw"Handler is required."}this.handler=e;this.scope=b||window;this.queue=[];this.is_processing=false;this.postEvent=function(f,g){g=g||null;this.queue.push({event:f,data:g});if(!this.is_processing){this.process()}};this.flushEventQueue=function(){this.queue=[]},this.process=function(){while(this.queue.length>0){this.is_processing=true;var f=this.queue.shift();this.handler.call(this.scope,f.event,f.data)}this.is_processing=false}};Ext.ux.Utils.FSA=function(f,e,b){this.current_state=f;this.trans_table=e||{};this.trans_table_scope=b||window;Ext.ux.Utils.FSA.superclass.constructor.call(this,this.processEvent,this)};Ext.extend(Ext.ux.Utils.FSA,Ext.ux.Utils.EventQueue,{current_state:null,trans_table:null,trans_table_scope:null,state:function(){return this.current_state},processEvent:function(b,g){var m=this.currentStateEventTransitions(b);if(!m){throw"State '"+this.current_state+"' has no transition for event '"+b+"'."}for(var h=0,j=m.length;h<j;h++){var k=m[h];var n=k.predicate||k.p||true;var f=k.action||k.a||Ext.emptyFn;var e=k.state||k.s||this.current_state;var o=k.scope||this.trans_table_scope;if(this.computePredicate(n,o,g,b)){this.callAction(f,o,g,b);this.current_state=e;return}}throw"State '"+this.current_state+"' has no transition for event '"+b+"' in current context"},currentStateEventTransitions:function(b){return this.trans_table[this.current_state]?this.trans_table[this.current_state][b]||false:false},computePredicate:function(f,h,k,j){var e=false;switch(Ext.type(f)){case"function":e=f.call(h,k,j,this);break;case"array":e=true;for(var g=0,b=f.length;e&&(g<b);g++){if(Ext.type(f[g])=="function"){e=f[g].call(h,k,j,this)}else{throw ["Predicate: ",f[g],' is not callable in "',this.current_state,'" state for event "',j].join("")}}break;case"boolean":e=f;break;default:throw ["Predicate: ",f,' is not callable in "',this.current_state,'" state for event "',j].join("")}return e},callAction:function(j,f,h,g){switch(Ext.type(j)){case"array":for(var e=0,b=j.length;e<b;e++){if(Ext.type(j[e])=="function"){j[e].call(f,h,g,this)}else{throw ["Action: ",j[e],' is not callable in "',this.current_state,'" state for event "',g].join("")}}break;case"function":j.call(f,h,g,this);break;default:throw ["Action: ",j,' is not callable in "',this.current_state,'" state for event "',g].join("")}}});Ext.namespace("Ext.ux.UploadDialog");Ext.ux.UploadDialog.BrowseButton=Ext.extend(Ext.Button,{input_name:"file",input_file:null,original_handler:null,original_scope:null,initComponent:function(){Ext.ux.UploadDialog.BrowseButton.superclass.initComponent.call(this);this.original_handler=this.handler||null;this.original_scope=this.scope||window;this.handler=null;this.scope=null},onRender:function(e,b){Ext.ux.UploadDialog.BrowseButton.superclass.onRender.call(this,e,b);this.createInputFile()},createInputFile:function(){var f=this.el.child(".x-btn-center");f.position("relative");this.input_file=Ext.DomHelper.append(f,{tag:"input",type:"file",size:1,name:this.input_name||Ext.id(this.el),style:"position: absolute; display: block; border: none; cursor: pointer"},true);var e=f.getBox();this.input_file.setStyle("font-size",(e.width*0.5)+"px");var g=this.input_file.getBox();var b={x:3,y:3};if(Ext.isIE){b={x:0,y:3}}this.input_file.setLeft(e.width-g.width+b.x+"px");this.input_file.setTop(e.height-g.height+b.y+"px");this.input_file.setOpacity(0);if(this.handleMouseEvents){this.input_file.on("mouseover",this.onMouseOver,this);this.input_file.on("mousedown",this.onMouseDown,this)}if(this.tooltip){if(typeof this.tooltip=="object"){Ext.QuickTips.register(Ext.apply({target:this.input_file},this.tooltip))}else{this.input_file.dom[this.tooltipType]=this.tooltip}}this.input_file.on("change",this.onInputFileChange,this);this.input_file.on("click",function(h){h.stopPropagation()})},detachInputFile:function(e){var b=this.input_file;e=e||false;if(typeof this.tooltip=="object"){Ext.QuickTips.unregister(this.input_file)}else{this.input_file.dom[this.tooltipType]=null}this.input_file.removeAllListeners();this.input_file=null;if(!e){this.createInputFile()}return b},getInputFile:function(){return this.input_file},disable:function(){Ext.ux.UploadDialog.BrowseButton.superclass.disable.call(this);this.input_file.dom.disabled=true},enable:function(){Ext.ux.UploadDialog.BrowseButton.superclass.enable.call(this);this.input_file.dom.disabled=false},destroy:function(){var b=this.detachInputFile(true);b.remove();b=null;Ext.ux.UploadDialog.BrowseButton.superclass.destroy.call(this)},onInputFileChange:function(){if(this.original_handler){this.original_handler.call(this.original_scope,this)}}});Ext.ux.UploadDialog.TBBrowseButton=Ext.extend(Ext.ux.UploadDialog.BrowseButton,{hideParent:true,onDestroy:function(){Ext.ux.UploadDialog.TBBrowseButton.superclass.onDestroy.call(this);if(this.container){this.container.remove()}}});Ext.ux.UploadDialog.FileRecord=Ext.data.Record.create([{name:"filename"},{name:"state",type:"int"},{name:"note"},{name:"input_element"}]);Ext.ux.UploadDialog.FileRecord.STATE_QUEUE=0;Ext.ux.UploadDialog.FileRecord.STATE_FINISHED=1;Ext.ux.UploadDialog.FileRecord.STATE_FAILED=2;Ext.ux.UploadDialog.FileRecord.STATE_PROCESSING=3;Ext.ux.UploadDialog.Dialog=function(b){var e={border:false,width:450,height:300,minWidth:450,minHeight:300,modal:true,plain:true,constrainHeader:true,draggable:true,closable:true,maximizable:false,minimizable:false,resizable:true,autoDestroy:true,closeAction:"hide",title:this.i18n.title,cls:"ext-ux-uploaddialog-dialog",url:"",base_params:{},permitted_extensions:[],reset_on_hide:true,allow_close_on_upload:false,upload_autostart:false,post_var_name:"file"};b=Ext.applyIf(b||{},e);b.layout="absolute";Ext.ux.UploadDialog.Dialog.superclass.constructor.call(this,b)};Ext.extend(Ext.ux.UploadDialog.Dialog,Ext.Window,{fsa:null,state_tpl:null,form:null,grid_panel:null,progress_bar:null,is_uploading:false,initial_queued_count:0,upload_frame:null,initComponent:function(){Ext.ux.UploadDialog.Dialog.superclass.initComponent.call(this);var b={created:{"window-render":[{action:[this.createForm,this.createProgressBar,this.createGrid],state:"rendering"}],destroy:[{action:this.flushEventQueue,state:"destroyed"}]},rendering:{"grid-render":[{action:[this.fillToolbar,this.updateToolbar],state:"ready"}],destroy:[{action:this.flushEventQueue,state:"destroyed"}]},ready:{"file-selected":[{predicate:[this.fireFileTestEvent,this.isPermittedFile],action:this.addFileToUploadQueue,state:"adding-file"},{}],"grid-selection-change":[{action:this.updateToolbar}],"remove-files":[{action:[this.removeFiles,this.fireFileRemoveEvent]}],"reset-queue":[{action:[this.resetQueue,this.fireResetQueueEvent]}],"start-upload":[{predicate:this.hasUnuploadedFiles,action:[this.setUploadingFlag,this.saveInitialQueuedCount,this.updateToolbar,this.updateProgressBar,this.prepareNextUploadTask,this.fireUploadStartEvent],state:"uploading"},{}],"stop-upload":[{}],hide:[{predicate:[this.isNotEmptyQueue,this.getResetOnHide],action:[this.resetQueue,this.fireResetQueueEvent]},{}],destroy:[{action:this.flushEventQueue,state:"destroyed"}]},"adding-file":{"file-added":[{predicate:this.isUploading,action:[this.incInitialQueuedCount,this.updateProgressBar,this.fireFileAddEvent],state:"uploading"},{predicate:this.getUploadAutostart,action:[this.startUpload,this.fireFileAddEvent],state:"ready"},{action:[this.updateToolbar,this.fireFileAddEvent],state:"ready"}]},uploading:{"file-selected":[{predicate:[this.fireFileTestEvent,this.isPermittedFile],action:this.addFileToUploadQueue,state:"adding-file"},{}],"grid-selection-change":[{}],"start-upload":[{}],"stop-upload":[{predicate:this.hasUnuploadedFiles,action:[this.resetUploadingFlag,this.abortUpload,this.updateToolbar,this.updateProgressBar,this.fireUploadStopEvent],state:"ready"},{action:[this.resetUploadingFlag,this.abortUpload,this.updateToolbar,this.updateProgressBar,this.fireUploadStopEvent,this.fireUploadCompleteEvent],state:"ready"}],"file-upload-start":[{action:[this.uploadFile,this.findUploadFrame,this.fireFileUploadStartEvent]}],"file-upload-success":[{predicate:this.hasUnuploadedFiles,action:[this.resetUploadFrame,this.updateRecordState,this.updateProgressBar,this.prepareNextUploadTask,this.fireUploadSuccessEvent]},{action:[this.resetUploadFrame,this.resetUploadingFlag,this.updateRecordState,this.updateToolbar,this.updateProgressBar,this.fireUploadSuccessEvent,this.fireUploadCompleteEvent],state:"ready"}],"file-upload-error":[{predicate:this.hasUnuploadedFiles,action:[this.resetUploadFrame,this.updateRecordState,this.updateProgressBar,this.prepareNextUploadTask,this.fireUploadErrorEvent]},{action:[this.resetUploadFrame,this.resetUploadingFlag,this.updateRecordState,this.updateToolbar,this.updateProgressBar,this.fireUploadErrorEvent,this.fireUploadCompleteEvent],state:"ready"}],"file-upload-failed":[{predicate:this.hasUnuploadedFiles,action:[this.resetUploadFrame,this.updateRecordState,this.updateProgressBar,this.prepareNextUploadTask,this.fireUploadFailedEvent]},{action:[this.resetUploadFrame,this.resetUploadingFlag,this.updateRecordState,this.updateToolbar,this.updateProgressBar,this.fireUploadFailedEvent,this.fireUploadCompleteEvent],state:"ready"}],hide:[{predicate:this.getResetOnHide,action:[this.stopUpload,this.repostHide]},{}],destroy:[{predicate:this.hasUnuploadedFiles,action:[this.resetUploadingFlag,this.abortUpload,this.fireUploadStopEvent,this.flushEventQueue],state:"destroyed"},{action:[this.resetUploadingFlag,this.abortUpload,this.fireUploadStopEvent,this.fireUploadCompleteEvent,this.flushEventQueue],state:"destroyed"}]},destroyed:{}};this.fsa=new Ext.ux.Utils.FSA("created",b,this);this.addEvents({filetest:true,fileadd:true,fileremove:true,resetqueue:true,uploadsuccess:true,uploaderror:true,uploadfailed:true,uploadstart:true,uploadstop:true,uploadcomplete:true,fileuploadstart:true});this.on("render",this.onWindowRender,this);this.on("beforehide",this.onWindowBeforeHide,this);this.on("hide",this.onWindowHide,this);this.on("destroy",this.onWindowDestroy,this);this.state_tpl=new Ext.Template("<div class='ext-ux-uploaddialog-state ext-ux-uploaddialog-state-{state}'>&#160;</div>").compile()},createForm:function(){this.form=Ext.DomHelper.append(this.body,{tag:"form",method:"post",action:this.url,style:"position: absolute; left: -100px; top: -100px; width: 100px; height: 100px"})},createProgressBar:function(){this.progress_bar=this.add(new Ext.ProgressBar({x:0,y:0,anchor:"0",value:0,text:this.i18n.progress_waiting_text}))},createGrid:function(){var e=new Ext.data.Store({proxy:new Ext.data.MemoryProxy([]),reader:new Ext.data.JsonReader({},Ext.ux.UploadDialog.FileRecord),sortInfo:{field:"state",direction:"DESC"},pruneModifiedRecords:true});var b=new Ext.grid.ColumnModel([{header:this.i18n.state_col_title,width:this.i18n.state_col_width,resizable:false,dataIndex:"state",sortable:true,renderer:this.renderStateCell.createDelegate(this)},{header:this.i18n.filename_col_title,width:this.i18n.filename_col_width,dataIndex:"filename",sortable:true,renderer:this.renderFilenameCell.createDelegate(this)},{header:this.i18n.note_col_title,width:this.i18n.note_col_width,dataIndex:"note",sortable:true,renderer:this.renderNoteCell.createDelegate(this)}]);this.grid_panel=new Ext.grid.GridPanel({ds:e,cm:b,x:0,y:22,anchor:"0 -22",border:true,viewConfig:{autoFill:true,forceFit:true},bbar:new Ext.Toolbar()});this.grid_panel.on("render",this.onGridRender,this);this.add(this.grid_panel);this.grid_panel.getSelectionModel().on("selectionchange",this.onGridSelectionChange,this)},fillToolbar:function(){var b=this.grid_panel.getBottomToolbar();b.x_buttons={};b.x_buttons.add=b.addItem(new Ext.ux.UploadDialog.TBBrowseButton({input_name:this.post_var_name,text:this.i18n.add_btn_text,tooltip:this.i18n.add_btn_tip,iconCls:"ext-ux-uploaddialog-addbtn",handler:this.onAddButtonFileSelected,scope:this}));b.x_buttons.remove=b.addButton({text:this.i18n.remove_btn_text,tooltip:this.i18n.remove_btn_tip,iconCls:"ext-ux-uploaddialog-removebtn",handler:this.onRemoveButtonClick,scope:this});b.x_buttons.reset=b.addButton({text:this.i18n.reset_btn_text,tooltip:this.i18n.reset_btn_tip,iconCls:"ext-ux-uploaddialog-resetbtn",handler:this.onResetButtonClick,scope:this});b.add("-");b.x_buttons.upload=b.addButton({text:this.i18n.upload_btn_start_text,tooltip:this.i18n.upload_btn_start_tip,iconCls:"ext-ux-uploaddialog-uploadstartbtn",handler:this.onUploadButtonClick,scope:this});b.add("-");b.x_buttons.indicator=b.addItem(new Ext.Toolbar.Item(Ext.DomHelper.append(b.getEl(),{tag:"div",cls:"ext-ux-uploaddialog-indicator-stoped",html:"&#160"})));b.add("->");b.x_buttons.close=b.addButton({text:this.i18n.close_btn_text,tooltip:this.i18n.close_btn_tip,handler:this.onCloseButtonClick,scope:this})},renderStateCell:function(j,b,e,g,h,f){return this.state_tpl.apply({state:j})},renderFilenameCell:function(n,b,g,j,m,h){var e=this.grid_panel.getView();var k=function(){try{Ext.fly(e.getCell(j,m)).child(".x-grid3-cell-inner").dom.qtip=n}catch(f){}};k.defer(1000);return n},renderNoteCell:function(n,b,g,j,m,h){var e=this.grid_panel.getView();var k=function(){try{Ext.fly(e.getCell(j,m)).child(".x-grid3-cell-inner").dom.qtip=n}catch(f){}};k.defer(1000);return n},getFileExtension:function(e){var b=null;var f=e.split(".");if(f.length>1){b=f.pop()}return b},isPermittedFileType:function(e){var b=true;if(this.permitted_extensions.length>0){b=this.permitted_extensions.indexOf(this.getFileExtension(e))!=-1}return b},isPermittedFile:function(f){var b=false;var e=f.getInputFile().dom.value;if(this.isPermittedFileType(e)){b=true}else{Ext.Msg.alert(this.i18n.error_msgbox_title,String.format(this.i18n.err_file_type_not_permitted,e,this.permitted_extensions.join(this.i18n.permitted_extensions_join_str)));b=false}return b},fireFileTestEvent:function(b){return this.fireEvent("filetest",this,b.getInputFile().dom.value)!==false},addFileToUploadQueue:function(f){var b=f.detachInputFile();b.appendTo(this.form);b.setStyle("width","100px");b.dom.disabled=true;var e=this.grid_panel.getStore();e.add(new Ext.ux.UploadDialog.FileRecord({state:Ext.ux.UploadDialog.FileRecord.STATE_QUEUE,filename:b.dom.value,note:this.i18n.note_queued_to_upload,input_element:b}));this.fsa.postEvent("file-added",b.dom.value)},fireFileAddEvent:function(b){this.fireEvent("fileadd",this,b)},updateProgressBar:function(){if(this.is_uploading){var e=this.getQueuedCount(true);var b=1-e/this.initial_queued_count;this.progress_bar.updateProgress(b,String.format(this.i18n.progress_uploading_text,this.initial_queued_count-e,this.initial_queued_count))}else{this.progress_bar.updateProgress(0,this.i18n.progress_waiting_text)}},updateToolbar:function(){var b=this.grid_panel.getBottomToolbar();if(this.is_uploading){b.x_buttons.remove.disable();b.x_buttons.reset.disable();b.x_buttons.upload.enable();if(!this.getAllowCloseOnUpload()){b.x_buttons.close.disable()}Ext.fly(b.x_buttons.indicator.getEl()).replaceClass("ext-ux-uploaddialog-indicator-stoped","ext-ux-uploaddialog-indicator-processing");b.x_buttons.upload.setIconClass("ext-ux-uploaddialog-uploadstopbtn");b.x_buttons.upload.setText(this.i18n.upload_btn_stop_text);b.x_buttons.upload.getEl().child(b.x_buttons.upload.buttonSelector).dom[b.x_buttons.upload.tooltipType]=this.i18n.upload_btn_stop_tip}else{b.x_buttons.remove.enable();b.x_buttons.reset.enable();b.x_buttons.close.enable();Ext.fly(b.x_buttons.indicator.getEl()).replaceClass("ext-ux-uploaddialog-indicator-processing","ext-ux-uploaddialog-indicator-stoped");b.x_buttons.upload.setIconClass("ext-ux-uploaddialog-uploadstartbtn");b.x_buttons.upload.setText(this.i18n.upload_btn_start_text);b.x_buttons.upload.getEl().child(b.x_buttons.upload.buttonSelector).dom[b.x_buttons.upload.tooltipType]=this.i18n.upload_btn_start_tip;if(this.getQueuedCount()>0){b.x_buttons.upload.enable()}else{b.x_buttons.upload.disable()}if(this.grid_panel.getSelectionModel().hasSelection()){b.x_buttons.remove.enable()}else{b.x_buttons.remove.disable()}if(this.grid_panel.getStore().getCount()>0){b.x_buttons.reset.enable()}else{b.x_buttons.reset.disable()}}},saveInitialQueuedCount:function(){this.initial_queued_count=this.getQueuedCount()},incInitialQueuedCount:function(){this.initial_queued_count++},setUploadingFlag:function(){this.is_uploading=true},resetUploadingFlag:function(){this.is_uploading=false},prepareNextUploadTask:function(){var e=this.grid_panel.getStore();var b=null;e.each(function(f){if(!b&&f.get("state")==Ext.ux.UploadDialog.FileRecord.STATE_QUEUE){b=f}else{f.get("input_element").dom.disabled=true}});b.get("input_element").dom.disabled=false;b.set("state",Ext.ux.UploadDialog.FileRecord.STATE_PROCESSING);b.set("note",this.i18n.note_processing);b.commit();this.fsa.postEvent("file-upload-start",b)},fireUploadStartEvent:function(){this.fireEvent("uploadstart",this)},removeFiles:function(h){var e=this.grid_panel.getStore();for(var f=0,b=h.length;f<b;f++){var g=h[f];g.get("input_element").remove();e.remove(g)}},fireFileRemoveEvent:function(f){for(var e=0,b=f.length;e<b;e++){this.fireEvent("fileremove",this,f[e].get("filename"))}},resetQueue:function(){var b=this.grid_panel.getStore();b.each(function(e){e.get("input_element").remove()});b.removeAll()},fireResetQueueEvent:function(){this.fireEvent("resetqueue",this)},uploadFile:function(b){Ext.Ajax.request({url:this.url,params:this.base_params||this.baseParams||this.params,method:"POST",form:this.form,isUpload:true,success:this.onAjaxSuccess,failure:this.onAjaxFailure,scope:this,record:b})},fireFileUploadStartEvent:function(b){this.fireEvent("fileuploadstart",this,b.get("filename"))},updateRecordState:function(b){if("success" in b.response&&b.response.success){b.record.set("state",Ext.ux.UploadDialog.FileRecord.STATE_FINISHED);b.record.set("note",this.i18n.note_upload_success)}else{b.record.set("state",Ext.ux.UploadDialog.FileRecord.STATE_FAILED);b.record.set("note",b.response.message||b.response.error||this.i18n.note_upload_error)}b.record.commit()},fireUploadSuccessEvent:function(b){this.fireEvent("uploadsuccess",this,b.record.get("filename"),b.response)},fireUploadErrorEvent:function(b){this.fireEvent("uploaderror",this,b.record.get("filename"),b.response)},fireUploadFailedEvent:function(b){this.fireEvent("uploadfailed",this,b.record.get("filename"))},fireUploadCompleteEvent:function(){this.fireEvent("uploadcomplete",this)},findUploadFrame:function(){this.upload_frame=Ext.getBody().child("iframe.x-hidden:last")},resetUploadFrame:function(){this.upload_frame=null},removeUploadFrame:function(){if(this.upload_frame){this.upload_frame.removeAllListeners();this.upload_frame.dom.src="about:blank";this.upload_frame.remove()}this.upload_frame=null},abortUpload:function(){this.removeUploadFrame();var e=this.grid_panel.getStore();var b=null;e.each(function(f){if(f.get("state")==Ext.ux.UploadDialog.FileRecord.STATE_PROCESSING){b=f;return false}});b.set("state",Ext.ux.UploadDialog.FileRecord.STATE_FAILED);b.set("note",this.i18n.note_aborted);b.commit()},fireUploadStopEvent:function(){this.fireEvent("uploadstop",this)},repostHide:function(){this.fsa.postEvent("hide")},flushEventQueue:function(){this.fsa.flushEventQueue()},onWindowRender:function(){this.fsa.postEvent("window-render")},onWindowBeforeHide:function(){return this.isUploading()?this.getAllowCloseOnUpload():true},onWindowHide:function(){this.fsa.postEvent("hide")},onWindowDestroy:function(){this.fsa.postEvent("destroy")},onGridRender:function(){this.fsa.postEvent("grid-render")},onGridSelectionChange:function(){this.fsa.postEvent("grid-selection-change")},onAddButtonFileSelected:function(b){this.fsa.postEvent("file-selected",b)},onUploadButtonClick:function(){if(this.is_uploading){this.fsa.postEvent("stop-upload")}else{this.fsa.postEvent("start-upload")}},onRemoveButtonClick:function(){var b=this.grid_panel.getSelectionModel().getSelections();this.fsa.postEvent("remove-files",b)},onResetButtonClick:function(){this.fsa.postEvent("reset-queue")},onCloseButtonClick:function(){this[this.closeAction].call(this)},onAjaxSuccess:function(g,h){var b={success:false,error:this.i18n.note_upload_error};try{var f=g.responseText;var j=f.match(/^<[^>]+>((?:.|\n)*)<\/[^>]+>$/);if(j){f=j[1]}b=Ext.util.JSON.decode(f)}catch(m){}var k={record:h.record,response:b};if("success" in b){this.fsa.postEvent("file-upload-success",k)}else{this.fsa.postEvent("file-upload-error",k)}},onAjaxFailure:function(b,e){var f={record:e.record,response:{success:false,error:this.i18n.note_upload_failed}};this.fsa.postEvent("file-upload-failed",f)},startUpload:function(){this.fsa.postEvent("start-upload")},stopUpload:function(){this.fsa.postEvent("stop-upload")},getUrl:function(){return this.url},setUrl:function(b){this.url=b},getBaseParams:function(){return this.base_params},setBaseParams:function(b){this.base_params=b},getUploadAutostart:function(){return this.upload_autostart},setUploadAutostart:function(b){this.upload_autostart=b},getAllowCloseOnUpload:function(){return this.allow_close_on_upload},setAllowCloseOnUpload:function(b){this.allow_close_on_upload=b},getResetOnHide:function(){return this.reset_on_hide},setResetOnHide:function(b){this.reset_on_hide=b},getPermittedExtensions:function(){return this.permitted_extensions},setPermittedExtensions:function(b){this.permitted_extensions=b},isUploading:function(){return this.is_uploading},isNotEmptyQueue:function(){return this.grid_panel.getStore().getCount()>0},getQueuedCount:function(e){var f=0;var b=this.grid_panel.getStore();b.each(function(g){if(g.get("state")==Ext.ux.UploadDialog.FileRecord.STATE_QUEUE){f++}if(e&&g.get("state")==Ext.ux.UploadDialog.FileRecord.STATE_PROCESSING){f++}});return f},hasUnuploadedFiles:function(){return this.getQueuedCount()>0}});var p=Ext.ux.UploadDialog.Dialog.prototype;p.i18n={title:"文件上传",state_col_title:"状态",state_col_width:70,filename_col_title:"文件名",filename_col_width:230,note_col_title:"备注",note_col_width:150,add_btn_text:"添加",add_btn_tip:"添加文件到上传队列.",remove_btn_text:"删除",remove_btn_tip:"从上传队列中删除文件.",reset_btn_text:"重置",reset_btn_tip:"重置队列.",upload_btn_start_text:"上传",upload_btn_stop_text:"放弃",upload_btn_start_tip:"上传队列中的文件到服务器.",upload_btn_stop_tip:"停止上传.",close_btn_text:"关闭",close_btn_tip:"关闭此窗口.",progress_waiting_text:"(空闲)",progress_uploading_text:"正在上传: 已经完成 {0} / {1} .",error_msgbox_title:"错误",permitted_extensions_join_str:",",err_file_type_not_permitted:"所选文件的扩展名无效.<br/>请选择下列扩展名的文件: {1}",note_queued_to_upload:"上传排队中",note_processing:"正在上传...",note_upload_failed:"服务器故障.",note_upload_success:"上传成功.",note_upload_error:"上传失败.",note_aborted:"被用户放弃."};divo.window.ImageChooserWindow=Ext.extend(Ext.Window,{allowMaxWidth:null,allowMaxHeight:null,allowMaxFileSize:null,thumbWidth:null,thumbHeight:null,baseWidth:0,baseHeight:0,isFlash:false,initComponent:function(){this.imagePanelId="divo-uploaded-image-panel";Ext.apply(this,{title:"选择"+(this.isFlash?"Flash文件":"图片"),stateful:true,stateId:"divo-image-chooser-win",modal:true,closable:true,maximizable:false,minimizable:false,cancelAction:"destroy",closeAction:"destroy",buttons:[{text:"选择"+(this.isFlash?"Flash文件":"图片"),handler:this.onSave,scope:this},{text:"删除"+(this.isFlash?"Flash文件":"图片"),handler:this.onDelete,scope:this},{text:"关闭",handler:this.onCancel,scope:this}],layout:"tdgi_border",items:[{region:"west",title:"文件夹",stateful:true,stateId:this.myId("tree"),collapsible:true,width:250,collapsedTitle:true,split:true,layout:"fit",items:[{id:this.myId("tree"),xtype:"divo.tree.ImageCatalogTree",allowMaxWidth:this.allowMaxWidth,allowMaxHeight:this.allowMaxHeight,allowMaxFileSize:this.allowMaxFileSize,thumbWidth:this.thumbWidth,thumbHeight:this.thumbHeight,baseWidth:this.baseWidth,baseHeight:this.baseHeight,isFlash:this.isFlash}]},{region:"center",layout:"fit",autoScroll:true,items:[{id:this.imagePanelId,border:true,xtype:"divo.panel.UploadedImagePanel",allowMaxWidth:this.allowMaxWidth,allowMaxHeight:this.allowMaxHeight,isFlash:this.isFlash}]}]});this.subscribe("divo.panel.SelectImage",this.onSelectImage,this);this.subscribe("divo.nodeSelect"+this.myId("tree"),this.onImageCatalogSelected,this);this.subscribe("divo.tree.ImageUploaded",this.onImageUploaded,this);this.on("beforedestroy",function(){this.unsubscribe()},this);divo.window.ImageChooserWindow.superclass.initComponent.call(this)},onImageCatalogSelected:function(b,g,e){var f=Ext.getCmp(this.imagePanelId);f.showList(g.node.attributes.code)},onImageUploaded:function(b,g,e){if(g.sender==this.myId("tree")){var f=Ext.getCmp(this.imagePanelId);f.showList(g.catalogCode,g.fileId)}},onSelectImage:function(b,f,e){if(f.sender==this.imagePanelId){this.selectNode(f.node)}},onDelete:function(){var b=Ext.getCmp(this.imagePanelId);b.deleteImage()},onSave:function(){this.selectNode()},selectNode:function(e){var f=Ext.getCmp(this.imagePanelId);if(!e){var b=f.getCurrentNode()}else{var b=e}if(b){this.callback(this.imageSrcEl,b);this.close()}},showWindow:function(b,e){this.imageSrcEl=b;this.callback=e;this.show()}});divo.window.TreeSortWindow=Ext.extend(Ext.Window,{cancelAction:"destroy",closeAction:"destroy",parentNode:null,baseUrl:null,initComponent:function(){Ext.apply(this,{title:"排序",width:540,autoHeight:true,layout:"form",modal:true,closable:true,maximizable:false,minimizable:false,buttons:[{text:"确定",handler:this.onSave,scope:this},{text:"取消",handler:this.onCancel,scope:this}],items:this.getSortForm()});divo.window.TreeSortWindow.superclass.initComponent.call(this)},getSortForm:function(){return{xtype:"divo.form.TreeSortForm",parentNode:this.parentNode,baseUrl:this.baseUrl}},onSave:function(){this.items.itemAt(0).save(this.onSaveSucccess.createDelegate(this))},onSaveSucccess:function(){this.publish("divo.window.TreeOrderChanged",{sender:this.id,node:this.parentNode});this.close()}});divo.window.PdfShowWindow=Ext.extend(Ext.Window,{cancelAction:"destroy",closeAction:"destroy",url:null,title:null,initComponent:function(){Ext.apply(this,{stateful:true,stateId:"check-pdf-showWin",width:850,height:520,modal:true,closable:true,maximizable:true,minimizable:false,layout:"fit",items:{xtype:"mediapanel",mediaCfg:{mediaType:"PDFFRAME",url:this.url+"?auth="+Ext.Ajax.defaultHeaders.Authorization+"&_dc="+new Date().getTime(),controls:true,start:true}}});divo.window.PdfShowWindow.superclass.initComponent.call(this)}});Ext.override(Ext.Window.DD,{startDrag:function(){var b=this.win;b.fireEvent("ghost",[]);this.proxy=b.ghost();if(b.constrain!==false){var f=b.el.shadowOffset;this.constrainTo(b.container,{right:f,left:f,bottom:f})}else{if(b.constrainHeader!==false){var e=this.proxy.getSize();this.constrainTo(b.container,{right:-(e.width-this.headerOffsets[0]),bottom:-(e.height-this.headerOffsets[1])})}}}});Ext.override(Ext.Window,{setZIndex:function(e){var b=++e;if(this.modal){this.mask.setStyle("z-index",e)}this.el.setZIndex(b);e+=5;if(this.resizer){this.resizer.proxy.setStyle("z-index",++e)}if(b>this.lastZIndex){this.fireEvent("tofront",this)}else{this.fireEvent("toback",this)}this.lastZIndex=e}});var drawer=Ext.extend(Ext.Window,{resizable:false,closable:false,init:function(b){this.win=b;b.drawers=b.drawers||{};this.resizeHandles=this.side;b.drawers[this.side]=this;this.el.on("mousedown",this.win.toFront,this.win);this.win.on("tofront",this.onBeforeShow,this);this.win.on("toback",this.onBeforeShow,this);this.win.on("ghost",this.onBeforeResize,this);this.win.on("beforehide",function(){this.hide(true)},this);this.win.on("move",this.setAlignAndShow,this);var e=this.setAlignAndShow.createDelegate(this);(function(){if(this.win.resizer){this.win.resizer.on("resize",this.setAlignAndShow.createDelegate(this))}this.win.el.win=this.win;this.win.el.moveTo=this.win.el.moveTo.createSequence(function(){e()},this.win.el)}).defer(500,this);if(this.resizable){this.resizer=new Ext.Resizable(this.el,{minWidth:this.minWidth,minHeight:this.minHeight,handles:this.resizeHandles||null,pinned:true,resizeElement:this.resizerAction});this.resizer.window=this;this.resizer.on("beforeresize",this.beforeResize,this)}},initComponent:function(){Ext.apply(this,{renderTo:Ext.getBody(),frame:true,closeAction:"hide",draggable:false,alignToParams:{}});this.on("beforeshow",this.onBeforeShow,this);if(this.size){if(this.side=="e"||this.side=="w"){this.width=this.size}else{this.height=this.size}}drawer.superclass.initComponent.call(this,arguments)},setAlignAndShow:function(){this.setAlignments();if(!this.hidden){this.el.alignTo(this.win.el,this.alignToParams.alignTo,this.alignToParams.alignToXY);if(Ext.isIE){this.bwrap.hide();this.bwrap.show();Ext.log("here")}}else{this.el.alignTo(document.body,"tl",[-1,-1])}if(this.showAgain){this.show(true)}this.showAgain=false},onBeforeResize:function(){if(!this.hidden){this.showAgain=true}this.hide(true)},onBeforeShow:function(){this.setAlignments();this.setZIndexModified(this.win.el.getZIndex()-10)},show:function(b){if(!this.hidden){return}b=b||false;if(!this.rendered){this.render(Ext.getBody())}if(this.fireEvent("beforeshow",this)===false){return}this.hidden=false;this.beforeShow();this.afterShow(b)},afterShow:function(b){this.el.alignTo(this.win.el,this.alignToParams.alignTo,this.alignToParams.alignToXY);if(this.animate&&!b){this.el.slideIn(this.alignToParams.slideDirection,{duration:this.animDuration||0.25})}else{drawer.superclass.afterShow.call(this)}},setAlignments:function(){switch(this.side){case"n":this.setWidth(this.win.el.getWidth()-10);this.alignToParams=Ext.apply(this.alignToParams,{alignTo:"tl",alignToXY:[5,(this.el.getComputedHeight()*-1)+5],slideDirection:"b"});break;case"s":this.setWidth(this.win.el.getWidth()-10);this.alignToParams=Ext.apply(this.alignToParams,{alignTo:"bl",alignToXY:[5,(Ext.isIE6)?-2:-7],slideDirection:"t"});break;case"e":this.setHeight(this.win.el.getHeight()-10);this.alignToParams=Ext.apply(this.alignToParams,{alignTo:"tr",alignToXY:[-5,5],slideDirection:"l"});break;case"w":this.setHeight(this.win.el.getHeight()-10);this.alignToParams=Ext.apply(this.alignToParams,{alignTo:"tl",alignToXY:[(this.el.getComputedWidth()*-1)+5,5],slideDirection:"r"});break}},beforeHide:function(){},hide:function(b){b=b||false;if(this.hidden){return}if(this.animate===true&&b===false){this.el.disableShadow(true);this.el.slideOut(this.alignToParams.slideDirection,{duration:this.animDuration||0.25,callback:function(){drawer.superclass.hide.call(this)},scope:this})}else{drawer.superclass.hide.call(this)}},initEvents:function(){Ext.Window.superclass.initEvents.call(this);if(this.animateTarget){this.setAnimateTarget(this.animateTarget)}if(this.draggable){this.header.addClass("x-window-draggable")}this.initTools();this.el.on("mousedown",this.toFront,this);this.manager=this.manager||Ext.WindowMgr;this.manager.register(this);this.hidden=true;if(this.maximized){this.maximized=false;this.maximize()}if(this.closable){var b=this.getKeyMap();b.on(27,this.onEsc,this);b.disable()}},toFront:Ext.emptyFn,setZIndex:Ext.emptyFn,setZIndexModified:function(b){if(this.modal){this.mask.setStyle("z-index",b)}this.el.setZIndex(++b);b+=5;if(this.resizer){this.resizer.proxy.setStyle("z-index",++b)}this.lastZIndex=b}});divo.window.ExceptionDialog=Ext.extend(Ext.Window,{errorMsg:"",width:650,xtype:"panel",layout:"fit",plain:true,cancelAction:"destroy",closeAction:"destroy",autoScroll:true,modal:false,initComponent:function(){var b=this.getAppContext().isDebug;this.height=b?600:400;var e=b?400:200;this.title="非正常结束";this.items=new Ext.FormPanel({bodyStyle:"padding:5px;",buttonAlign:"right",labelAlign:"top",autoScroll:false,buttons:[{text:"发送报告",scope:this,handler:this.onSendReport},{text:"关闭",scope:this,handler:function(){this.close()}}],items:[{xtype:"panel",border:false,html:"<div><p>有错误发生，程序非正常终止。最后的动作可能没有正确执行。</p><p>请协助改进本软件，在下面填写关于在哪里有什么错误发生的简短描述。</p></div>"},{id:"divo-exceptiondialog-description",height:60,xtype:"textarea",hideLabel:true,name:"description",anchor:"95%"},{xtype:"iframepanel",collapsible:true,collapsed:!b,title:"显示细节",height:e,autoScroll:false,html:this.errorMsg}]});divo.window.ExceptionDialog.superclass.initComponent.call(this)},onSendReport:function(){var g=Ext.getCmp("divo-exceptiondialog-description").getValue();if(!g){this.say("请先输入有关异常的描述信息。");return}Ext.MessageBox.wait("正在发送...","请稍候");var b={userName:this.getAppContext().user.name,userFullName:this.getAppContext().user.fullName,descrip:g};var e=function(f){Ext.Ajax.request({scope:this,url:"/exception/report",async:true,method:"POST",jsonData:f,success:function(h,j){Ext.MessageBox.hide();this.say("报告发送完毕。")},failure:function(h,j){Ext.MessageBox.hide();this.say("报告发送失败。")}})};e.defer(100,this,[b])}});Ext.ux.MaximizeTool=function(){this.init=function(k){var g={id:"maximize",handler:e,scope:k,qtip:"最大化"};k.tools=k.tools||[];var m=k.tools.slice();k.tools=m;for(var j=0,f=k.tools.length;j<f;j++){if(k.tools[j].id=="maximize"){return}}var h=false;for(var j=0,f=k.tools.length;j<f;j++){if(k.tools[j].id=="close"){k.tools[k.tools.length]=k.tools[j];k.tools[j]=g;h=true;break}}if(!h){k.tools[k.tools.length]=g}};function e(j,h,g){g.originalOwnerCt=g.ownerCt;g.originalPosition=g.ownerCt.items.indexOf(g);g.originalSize=g.getSize();if(!h.window){var f={id:(g.getId()+"-MAX"),width:(Ext.getBody().getSize().width-100),height:(Ext.getBody().getSize().height-100),resizable:true,draggable:true,closable:true,closeAction:"hide",hideBorders:true,plain:true,layout:"fit",autoScroll:false,border:false,bodyBorder:false,frame:true,pinned:true,bodyStyle:"background-color: #ffffff;"};h.window=new Ext.Window(f);h.window.on("hide",b,g)}if(!g.dummyComponent){var k={title:g.title,width:g.getSize().width,height:g.getSize().height,html:"&nbsp;"};g.dummyComponent=new Ext.Panel(k)}h.window.add(g);if(g.tools.close){g.tools.close.setVisible(false)}g.tools.maximize.setVisible(false);g.originalOwnerCt.insert(g.originalPosition,g.dummyComponent);g.originalOwnerCt.doLayout();g.dummyComponent.setSize(g.originalSize);g.dummyComponent.setVisible(true);h.window.show(this)}function b(f){this.dummyComponent.setVisible(false);this.originalOwnerCt.insert(this.originalPosition,this);this.originalOwnerCt.doLayout();this.setSize(this.originalSize);this.tools.maximize.setVisible(true);if(this.tools.close){this.tools.close.setVisible(true)}}};Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",cls:"x-portal",defaultType:"portalcolumn",portlets:{},portalViewId:null,initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true,portletchanged:true})},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)},addPortlet:function(n,m,j,h){var g={autoCreate:true,tools:m,title:n.text,height:n.height,autoScroll:n.autoScroll};if(j.hbuttons){if(j.maximizable||j.maximizable==undefined){Ext.apply(g,{plugins:[new Ext.ux.MaximizeTool(),new Ext.ux.plugins.HeaderButtons()],hbuttons:j.hbuttons})}else{Ext.apply(g,{plugins:new Ext.ux.plugins.HeaderButtons(),hbuttons:j.hbuttons})}}else{if(j.maximizable||j.maximizable==undefined){Ext.apply(g,{plugins:new Ext.ux.MaximizeTool()})}}if(j.xtype){var k={id:j.id,xtype:j.xtype};if(j.config){Ext.apply(k,j.config)}Ext.apply(g,{layout:"fit",items:[k]})}else{var b=j.url;if(b.startsWith("/")){b=b+(b.indexOf("?")>0?"&":"?")+"auth="+Ext.Ajax.defaultHeaders.Authorization}var k={id:j.id,xtype:"iframepanel",defaultSrc:b};if(j.config){Ext.apply(k,j.config)}Ext.apply(g,{layout:"fit",items:[k]})}var e=new Ext.ux.Portlet(g);e.pInfo=n;this.portlets[n.id]=e;var f=this.items.itemAt(0);if(h!=undefined){f=this.items.itemAt(h);if(f.columnWidth==0.01){f=this.items.itemAt(0)}}f.insert(0,e);e.pClmn=f;return e},removePortlet:function(e){var b=this.portlets[e];if(b){b.pClmn.remove(b,true);delete this.portlets[e]}},removeAllPortlets:function(){for(var e=0;e<this.items.length;e++){var f=this.items.itemAt(e);if(f.items){for(var b=f.items.length-1;b>=0;b--){f.remove(f.items.itemAt(b),true)}}}this.portlets={}},getAllPortlets:function(){var f=[];for(var e=0;e<this.items.length;e++){var g=this.items.itemAt(e);if(g.items){for(var b=g.items.length-1;b>=0;b--){f.push(g.items.itemAt(b))}}}return f},getPortlet:function(b){return this.portlets[b]},setColNum:function(b){var g=this.items;var f=0.25;if(b==1){f=0.97}else{if(b==2){f=0.49}else{if(b==3){f=0.33}}}for(var e=0;e<b;e++){this.items.itemAt(e).columnWidth=f}for(var e=b;e<this.items.length;e++){this.items.itemAt(e).columnWidth=0.01}},restorePortlets:function(e){var b,m;if(e==undefined){divo.restoreProfile(function(n){b=n},divo.getUserId(),this.portalViewId+"-layout");if(b){var h=new Ext.state.Provider();m=h.decodeValue(b.msgValue)}}var f=this.portalState.getVisiblePortlets();if(!f){return}this.removeAllPortlets();this.setColNum(this.portalState.getColNum());var k=[];for(var g=0;g<f.length&&g<9;g++){var j=f[g];if(j&&j.id){k.push(j)}}k=this.showPortlets(k,m);this.doLayout()},showPortlets:function(f,m){var j=[];if(m){for(var k=0;k<this.columnCount;k++){for(var g=0;g<m[k].length;g++){var h=m[k][g];if(!h){continue}for(var e=0;e<f.length;e++){if(f[e].id==h.id){var b=this.items.itemAt(k);if(b.columnWidth==0.01){j.push(this.showPortlet(f[e],0))}else{j.push(this.showPortlet(f[e],k))}}}}}}else{for(var e=0;e<f.length;e++){j.push(this.showPortlet(f[e],0))}}return j},showPortlet:function(j,k){var b=this.getPortletDefinition(j.id);if(!b){return}var g=this;var e=[];if(b.closable!=false&&(b.closable==undefined||b.closable)){e=[{id:"close",handler:function(o,n,h){h.ownerCt.remove(h,true);g.fireEvent("portletchanged",h.pInfo.id,false);g.portalState.save()}}]}var f=this.portalState.getHeight(j.id);var m=this.addPortlet({id:j.id,text:j.text,autoScroll:b.autoScroll==true,height:f||200},e,b,k);this.fireEvent("portletchanged",j.id,true);m.on("resize",function(){this.portalState.save()},this);return m},getPortletDefinition:function(e){for(var b=0;b<this.portletDefinitions.length;b++){if(this.portletDefinitions[b].id==e){return this.portletDefinitions[b]}}},setPortletDefinition:function(b){this.portletDefinitions=b},setPortalState:function(b){this.portalState=b},setPortalViewId:function(b){this.portalViewId=b}});Ext.reg("portal",Ext.ux.Portal);Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",autoEl:"div",defaultType:"portlet",cls:"x-portal-column"});Ext.reg("portalcolumn",Ext.ux.PortalColumn);Ext.ux.Portal.DropZone=function(b,e){this.portal=b;Ext.dd.ScrollManager.register(b.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,b.bwrap.dom,e);b.body.ddScrollConfig=this.ddScrollConfig};Ext.extend(Ext.ux.Portal.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(b,h,g,f,k,j){return{portal:this.portal,panel:g.panel,columnIndex:f,column:k,position:j,data:g,source:b,rawEvent:h,status:this.dropAllowed}},notifyOver:function(B,z,C){var j=z.getXY(),b=this.portal,t=B.proxy;if(!this.grid){this.grid=this.getGrid()}var f=b.body.dom.clientWidth;if(!this.lastCW){this.lastCW=f}else{if(this.lastCW!=f){this.lastCW=f;b.doLayout();this.grid=this.getGrid()}}var g=0,o=this.grid.columnX,q=false;for(var x=o.length;g<x;g++){if(j[0]<(o[g].x+o[g].w)){q=true;break}}if(!q){g--}var w,n=false,m=0,A=b.items.itemAt(g),u=A.items.items;for(var x=u.length;m<x;m++){w=u[m];var y=w.el.getHeight();if(y!==0&&(w.el.getY()+(y/2))>j[1]){n=true;break}}var k=this.createEvent(B,z,C,g,A,n&&w?m:A.items.getCount());if(b.fireEvent("validatedrop",k)!==false&&b.fireEvent("beforedragover",k)!==false){t.getProxy().setWidth("auto");if(w){t.moveProxy(w.el.dom.parentNode,n?w.el.dom:null)}else{t.moveProxy(A.el.dom,null)}this.lastPos={c:A,col:g,p:n&&w?m:false};this.scrollPos=b.body.getScroll();b.fireEvent("dragover",k);return k.status}else{return k.status}},notifyOut:function(){delete this.grid},notifyDrop:function(n,h,g){delete this.grid;if(!this.lastPos){return}var k=this.lastPos.c,f=this.lastPos.col,m=this.lastPos.p;var b=this.createEvent(n,h,g,f,k,m!==false?m:k.items.getCount());if(this.portal.fireEvent("validatedrop",b)!==false&&this.portal.fireEvent("beforedrop",b)!==false){n.proxy.getProxy().remove();n.panel.el.dom.parentNode.removeChild(n.panel.el.dom);if(m!==false){k.insert(m,n.panel)}else{k.add(n.panel)}k.doLayout();this.portal.fireEvent("drop",b);var o=this.scrollPos.top;if(o){var j=this.portal.body.dom;setTimeout(function(){j.scrollTop=o},10)}}delete this.lastPos},getGrid:function(){var b=this.portal.bwrap.getBox();b.columnX=[];this.portal.items.each(function(e){b.columnX.push({x:e.el.getX(),w:e.el.getWidth()})});return b}});Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:true,hideMode:"visibility",collapsible:true,draggable:true,cls:"x-portlet",hideCollapseTool:false,onRender:function(e,b){Ext.ux.Portlet.superclass.onRender.call(this,e,b);this.resizer=new Ext.Resizable(this.el,{animate:true,duration:0.6,easing:"backIn",handles:"s",minHeight:this.minHeight||100,pinned:false});this.resizer.on("resize",this.onResizer,this)},onResizer:function(f,b,h,g){this.setHeight(h)},onCollapse:function(b,e){var f={userId:this.getUserId(),msgCode:this.pInfo.id+"-collapsed",msgValue:"Y"};divo.saveProfileAsync(f);this.el.setHeight("");Ext.ux.Portlet.superclass.onCollapse.call(this,b,e)},onExpand:function(b,e){var f={userId:this.getUserId(),msgCode:this.pInfo.id+"-collapsed",msgValue:"N"};divo.saveProfileAsync(f);Ext.ux.Portlet.superclass.onExpand.call(this,b,e)},getConfig:function(){return{id:this.pInfo.id}}});Ext.reg("portlet",Ext.ux.Portlet);Ext.ux.StatefulPortal=Ext.extend(Ext.ux.Portal,{autoScroll:false,columnCount:4,initComponent:function(){Ext.apply(this,{});Ext.ux.StatefulPortal.superclass.initComponent.apply(this,arguments)},getConfig:function(){var g=[[]];var b;for(var f=0;f<this.items.getCount();f++){b=this.items.get(f);g[f]=[];if(b.items){for(var e=b.items.getCount()-1;e>=0;e--){g[f].push(b.items.items[e].getConfig())}}}return g},afterRender:function(){Ext.ux.StatefulPortal.superclass.afterRender.apply(this,arguments);this.body.setStyle("overflow-y","scroll")}});Ext.reg("statefulportal",Ext.ux.StatefulPortal);Ext.ux.PortalState=function(){var o=new divo.StateProvider({stateOn:true});var e=o;var j,m,h,g;var n=true;function f(){if(!n){return}var w;try{w=m.getConfig()}catch(B){w=null}if(!w){return}divo.saveProfileAsync({userId:divo.getUserId(),msgCode:g+"-layout",msgValue:o.encodeValue(w)});var A=[];var z=[];var q=m.items.length;var C=0;while(true){var D=false;for(var x=0;x<q;x++){var u=m.items.itemAt(x).items.itemAt(C);if(u&&u.pInfo&&u.pInfo.id){A.push(u.pInfo);z.push(u);D=true}}if(!D){break}C++}if(A.length>0){e.set(j,A)}for(var x=0;x<z.length;x++){if(z[x].lastSize){var y=z[x].lastSize.height;var t=A[x].id+"-h";if(y){e.set(t,y)}}}}function k(){var q;divo.restoreProfile(function(t){q=t},divo.getUserId(),g+"-column-num");if(q&&q.msgValue){return parseInt(q.msgValue)}else{return 1}}function b(q){divo.saveProfileAsync({userId:divo.getUserId(),msgCode:g+"-column-num",msgValue:q})}return{init:function(t,q){h=t;j=q+"-state";g=q;m=Ext.getCmp(h)},save:function(){f()},getVisiblePortlets:function(){return e.get(j)},getHeight:function(q){return e.get(q+"-h")},getColNum:function(){return k()},saveColNum:function(q){b(q)},restoreCollapseState:function(u){var q;for(var t=0;t<u.length;t++){if(u[t]){divo.restoreProfile(function(w){q=w},divo.getUserId(),u[t].pInfo.id+"-collapsed");if(q&&q.msgValue=="Y"){u[t].collapse()}}}},setCanSave:function(q){n=q}}};Ext.ux.PortalManager=function(I){var H=false;var w=false;var m=I.portalViewId==undefined?I.portalId:I.portalViewId;var D=I.portalId;var y=I.portletDefinitions;var b=I.barContentMenuVisible==undefined?false:I.barContentMenuVisible;var t=I.showPromptWhenInit==undefined?true:I.showPromptWhenInit;var G,x;var h,g;var o;function A(){for(var L=0;L<y.length;L++){y[L].id=m+"-"+y[L].id;y[L].closable=H}}function e(){var L=[];if(!b){for(var M=0;M<y.length;M++){L.push({text:"<span>"+y[M].text+"</span>",icon:y[M].icon,cls:"x-btn-text-icon",handler:q})}}if(!I.barAlignLeft){L.push("->")}x=new Ext.ux.ColumnMenu({columnHeight:100,columnWidth:148,id:D+"menu",items:j()});L.push({text:"<span>内容选择...</span>",menu:x,hidden:!b});L.push({text:"<span>栏目数</span>"});G=new Ext.form.ComboBox({store:[[1,"1"],[2,"2"],[3,"3"],[4,"4"]],typeAhead:true,width:40,triggerAction:"all",editable:false,selectOnFocus:true});L.push(G);return L}function j(){var L=[];for(var M=0;M<y.length;M++){L.push({text:y[M].text,hideOnClick:false,checked:false,checkHandler:F})}return L}function F(N,M){var L=K(N.text);if(!M){g.removePortlet(L);g.doLayout()}else{var O=g.showPortlet({text:N.text,id:L,checked:true});g.doLayout()}h.save();B(o)}function q(L,M){u(L.text.replace("<span>","").replace("</span>",""));B(o)}function C(N,O,L){if(L==undefined){L=true}var M=f(N);if(M&&x&&x.items.itemAt(M)){x.items.itemAt(M).setChecked(O,L)}}function E(N){var L=N.getValue();if(L!=h.getColNum()){Ext.getBody().mask("","x-mask-loading");var M=function(){h.saveColNum(L);g.restorePortlets(true);Ext.getBody().unmask();B(o)};M.defer(100,this)}}function K(M){for(var L=0;L<y.length;L++){if(y[L].text==M){return y[L].id}}}function J(M){for(var L=0;L<y.length;L++){if(y[L].id==M){return y[L].text}}}function f(M){for(var L=0;L<y.length;L++){if(y[L].id==M){return[L]}}}function B(P){if(!g){return}if(!P){return}o=P;var L=g.getAllPortlets();for(var M=0;M<L.length;M++){var N=L[M];if(N.items){var O=N.items.items[0];if(O.showList){O.showList(o.id,o)}else{if(O.showContent){O.showContent(o.id,o)}}}}}function n(P){if(!P){return}o=P;var L=g.getAllPortlets();for(var M=0;M<L.length;M++){var N=L[M];if(N.items){var O=N.items.items[0];if(O.doCustomAction){O.doCustomAction(o)}}}}function z(){Ext.Ajax.request({scope:this,url:"/portalviews/"+m+"/"+divo.getUserId(),async:false,method:"PUT",jsonData:{aa:1}})}function k(N){Ext.getBody().mask("","x-mask-loading");var L=K(N);C(L,true,false);var M=function(){var R=Ext.getCmp(L);if(R){var O=R.ownerCt.tools.maximize;var Q=Ext.lib.Event.getListeners(O.dom);for(var P=0;P<Q.length;++P){if(Q[P].type=="click"){Q[P].fn(null,O.dom,R)}}}Ext.getBody().unmask()};M.defer(500,this)}function u(N){Ext.getBody().mask("","x-mask-loading");var L=K(N);var M=function(){var R=Ext.getCmp(L);if(R){var O=R.ownerCt.tools.close;if(O){var Q=Ext.lib.Event.getListeners(O.dom);for(var P=0;P<Q.length;++P){if(Q[P].type=="click"){Q[P].fn(null,O.dom,R)}}}}C(L,true,false);Ext.getBody().unmask()};M.defer(500,this)}return{init:function(){var L=H;if(t){divo.say("正在加载，请稍候...")}var M=function(){h=new Ext.ux.PortalState();h.init(D,m);var N=h.getColNum();if(G){G.on("select",E,this);G.setValue(N)}A();g=Ext.getCmp(D);g.setPortletDefinition(y);g.setPortalState(h);g.setPortalViewId(m);g.on("portletchanged",C,this);h.setCanSave(false);z();g.restorePortlets();h.setCanSave(L)};M.defer(t?1000:100,this)},getTbar:function(){H=true;return new Ext.Toolbar({cls:"go-paging-tb",items:e()})},onRefresh:function(L){B(L)},onCustomAction:function(L){n(L)},saveState:function(){h.save()},showPortlet:function(L){u(L)}}};divo.utils.JsLoader=function(){this.load=function(e,h){var g=document.getElementsByTagName("script");for(i=0;i<g.length;i++){if(g[i].src&&g[i].src.indexOf(e)!=-1){if(h){setTimeout(this.onSuccess,500)}return}}s=document.createElement("script");s.type="text/javascript";s.src=e;var f=document.getElementsByTagName("head")[0];f.appendChild(s);var b=this;s.onload=s.onreadystatechange=function(){if(this.readyState&&this.readyState=="loading"){return}if(h){setTimeout(b.onSuccess,500)}};s.onerror=function(){f.removeChild(s);b.onFailure(e)}};this.onSuccess=function(){};this.onFailure=function(b){alert(b+"载入失败！")}};divo.utils.base64=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var b=function(h){h=h.replace(/\r\n/g,"\n");var g="";for(var k=0;k<h.length;k++){var j=h.charCodeAt(k);if(j<128){g+=String.fromCharCode(j)}else{if((j>127)&&(j<2048)){g+=String.fromCharCode((j>>6)|192);g+=String.fromCharCode((j&63)|128)}else{g+=String.fromCharCode((j>>12)|224);g+=String.fromCharCode(((j>>6)&63)|128);g+=String.fromCharCode((j&63)|128)}}}return g};var f=function(g){var h="";var j=0;var k=c1=c2=0;while(j<g.length){k=g.charCodeAt(j);if(k<128){h+=String.fromCharCode(k);j++}else{if((k>191)&&(k<224)){c2=g.charCodeAt(j+1);h+=String.fromCharCode(((k&31)<<6)|(c2&63));j+=2}else{c2=g.charCodeAt(j+1);c3=g.charCodeAt(j+2);h+=String.fromCharCode(((k&15)<<12)|((c2&63)<<6)|(c3&63));j+=3}}}return h};return{encode:function(j){if(!j){j=""}var g="";var u,q,n,t,o,m,k;var h=0;j=b(j);while(h<j.length){u=j.charCodeAt(h++);q=j.charCodeAt(h++);n=j.charCodeAt(h++);t=u>>2;o=((u&3)<<4)|(q>>4);m=((q&15)<<2)|(n>>6);k=n&63;if(isNaN(q)){m=k=64}else{if(isNaN(n)){k=64}}g=g+e.charAt(t)+e.charAt(o)+e.charAt(m)+e.charAt(k)}return g},decode:function(j){if(!j){j=""}var g="";var u,q,n;var t,o,m,k;var h=0;j=j.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(h<j.length){t=e.indexOf(j.charAt(h++));o=e.indexOf(j.charAt(h++));m=e.indexOf(j.charAt(h++));k=e.indexOf(j.charAt(h++));u=(t<<2)|(o>>4);q=((o&15)<<4)|(m>>2);n=((m&3)<<6)|k;g=g+String.fromCharCode(u);if(m!=64){g=g+String.fromCharCode(q)}if(k!=64){g=g+String.fromCharCode(n)}}g=f(g);return g}}}();divo.utils.CapsLock=function(){return{init:function(){var f=Ext.id();this.alertBox=Ext.DomHelper.append(document.body,{tag:"div",style:"width:10em",children:[{tag:"div",style:"text-align: center; background-color: black;color: white;",html:"现在是字母大写状态",id:f}]},true);Ext.fly(f).boxWrap();this.alertBox.hide();var e=Ext.query("INPUT[type='password']");for(var b=0;b<e.length;b++){Ext.get(e[b].id).on("keypress",this.keypress.createDelegate(this,e[b],true),this)}},keypress:function(g,f){var b=g.getCharCode();if((g.shiftKey&&b>=97&&b<=122)||(!g.shiftKey&&b>=65&&b<=90)){this.showWarning(f)}else{this.hideWarning()}},showWarning:function(f){var b=Ext.fly(f).getX();var e=Ext.fly(f).getWidth();var g=Ext.fly(f).getY();this.alertBox.setXY([b+e+100,g]);this.alertBox.show()},hideWarning:function(){this.alertBox.hide()}}}();Ext.ns("Ext.ux.util");Ext.ux.util.MD5=function(u){var q=0;var m=8;function j(w,B){var A=(w&65535)+(B&65535);var z=(w>>16)+(B>>16)+(A>>16);return(z<<16)|(A&65535)}function o(w,x){return(w<<x)|(w>>>(32-x))}function e(C,z,y,w,B,A){return j(o(j(j(z,C),j(w,A)),B),y)}function k(z,y,D,C,w,B,A){return e((y&D)|((~y)&C),z,y,w,B,A)}function f(z,y,D,C,w,B,A){return e((y&C)|(D&(~C)),z,y,w,B,A)}function n(z,y,D,C,w,B,A){return e(y^D^C,z,y,w,B,A)}function h(z,y,D,C,w,B,A){return e(D^(y|(~C)),z,y,w,B,A)}function g(H,C){H[C>>5]|=128<<((C)%32);H[(((C+64)>>>9)<<4)+14]=C;var G=1732584193;var F=-271733879;var E=-1732584194;var D=271733878;for(var z=0;z<H.length;z+=16){var B=G;var A=F;var y=E;var w=D;G=k(G,F,E,D,H[z+0],7,-680876936);D=k(D,G,F,E,H[z+1],12,-389564586);E=k(E,D,G,F,H[z+2],17,606105819);F=k(F,E,D,G,H[z+3],22,-1044525330);G=k(G,F,E,D,H[z+4],7,-176418897);D=k(D,G,F,E,H[z+5],12,1200080426);E=k(E,D,G,F,H[z+6],17,-1473231341);F=k(F,E,D,G,H[z+7],22,-45705983);G=k(G,F,E,D,H[z+8],7,1770035416);D=k(D,G,F,E,H[z+9],12,-1958414417);E=k(E,D,G,F,H[z+10],17,-42063);F=k(F,E,D,G,H[z+11],22,-1990404162);G=k(G,F,E,D,H[z+12],7,1804603682);D=k(D,G,F,E,H[z+13],12,-40341101);E=k(E,D,G,F,H[z+14],17,-1502002290);F=k(F,E,D,G,H[z+15],22,1236535329);G=f(G,F,E,D,H[z+1],5,-165796510);D=f(D,G,F,E,H[z+6],9,-1069501632);E=f(E,D,G,F,H[z+11],14,643717713);F=f(F,E,D,G,H[z+0],20,-373897302);G=f(G,F,E,D,H[z+5],5,-701558691);D=f(D,G,F,E,H[z+10],9,38016083);E=f(E,D,G,F,H[z+15],14,-660478335);F=f(F,E,D,G,H[z+4],20,-405537848);G=f(G,F,E,D,H[z+9],5,568446438);D=f(D,G,F,E,H[z+14],9,-1019803690);E=f(E,D,G,F,H[z+3],14,-187363961);F=f(F,E,D,G,H[z+8],20,1163531501);G=f(G,F,E,D,H[z+13],5,-1444681467);D=f(D,G,F,E,H[z+2],9,-51403784);E=f(E,D,G,F,H[z+7],14,1735328473);F=f(F,E,D,G,H[z+12],20,-1926607734);G=n(G,F,E,D,H[z+5],4,-378558);D=n(D,G,F,E,H[z+8],11,-2022574463);E=n(E,D,G,F,H[z+11],16,1839030562);F=n(F,E,D,G,H[z+14],23,-35309556);G=n(G,F,E,D,H[z+1],4,-1530992060);D=n(D,G,F,E,H[z+4],11,1272893353);E=n(E,D,G,F,H[z+7],16,-155497632);F=n(F,E,D,G,H[z+10],23,-1094730640);G=n(G,F,E,D,H[z+13],4,681279174);D=n(D,G,F,E,H[z+0],11,-358537222);E=n(E,D,G,F,H[z+3],16,-722521979);F=n(F,E,D,G,H[z+6],23,76029189);G=n(G,F,E,D,H[z+9],4,-640364487);D=n(D,G,F,E,H[z+12],11,-421815835);E=n(E,D,G,F,H[z+15],16,530742520);F=n(F,E,D,G,H[z+2],23,-995338651);G=h(G,F,E,D,H[z+0],6,-198630844);D=h(D,G,F,E,H[z+7],10,1126891415);E=h(E,D,G,F,H[z+14],15,-1416354905);F=h(F,E,D,G,H[z+5],21,-57434055);G=h(G,F,E,D,H[z+12],6,1700485571);D=h(D,G,F,E,H[z+3],10,-1894986606);E=h(E,D,G,F,H[z+10],15,-1051523);F=h(F,E,D,G,H[z+1],21,-2054922799);G=h(G,F,E,D,H[z+8],6,1873313359);D=h(D,G,F,E,H[z+15],10,-30611744);E=h(E,D,G,F,H[z+6],15,-1560198380);F=h(F,E,D,G,H[z+13],21,1309151649);G=h(G,F,E,D,H[z+4],6,-145523070);D=h(D,G,F,E,H[z+11],10,-1120210379);E=h(E,D,G,F,H[z+2],15,718787259);F=h(F,E,D,G,H[z+9],21,-343485551);G=j(G,B);F=j(F,A);E=j(E,y);D=j(D,w)}return[G,F,E,D]}function b(z){var y=[];var w=(1<<m)-1;for(var x=0;x<z.length*m;x+=m){y[x>>5]|=(z.charCodeAt(x/m)&w)<<(x%32)}return y}function t(y){var x=q?"0123456789ABCDEF":"0123456789abcdef";var z="";for(var w=0;w<y.length*4;w++){z+=x.charAt((y[w>>2]>>((w%4)*8+4))&15)+x.charAt((y[w>>2]>>((w%4)*8))&15)}return z}return t(g(b(u),u.length*m))};Ext.ux.util.clone=function(f){if(!f||"object"!==typeof f){return f}if("function"===typeof f.clone){return f.clone()}var g="[object Array]"===Object.prototype.toString.call(f)?[]:{};var e,b;for(e in f){if(f.hasOwnProperty(e)){b=f[e];if(b&&"object"===typeof b){g[e]=Ext.ux.util.clone(b)}else{g[e]=b}}}return g};Ext.ux.util.applyMatching=function(b,e){var e=e||this;for(var f in b){if(b.hasOwnProperty(f)&&undefined!==e[f]){b[f]=e[f]}}return b};Ext.overrideIf="function"===typeof Ext.overrideIf?Ext.overrideIf:function(b,f){if(f){var e=b.prototype;for(var g in f){if(!e[g]){e[g]=f[g]}}}};if("function"!==typeof RegExp.escape){RegExp.escape=function(b){if("string"!==typeof b){return b}return b.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")}}Ext.overrideIf(RegExp,{clone:function(){return new RegExp(this)}});Ext.overrideIf(Array,{copy:function(){var e=[];for(var f=0,b=this.length;f<b;f++){e.push(this[f])}return e},indexOf:function(g,e){for(var h=+e||0,f=this.length;h<f;h++){if(this[h]===g){return h}}return -1},intersect:function(){if(!arguments.length){return[]}var g=this,b,f;for(var h=0,m=arguments.length;h<m;h++){f=[];b=arguments[h]||[];for(var j=0,e=g.length;j<e;j++){if(-1<b.indexOf(g[j])){f.push(g[j])}}g=f}return f.unique()},lastIndexOf:function(f,e){e=+e||0;var g=this.length;while(g-->e){if(this[g]===f){return g}}return -1},union:function(){var f=this.copy(),e;for(var g=0,j=arguments.length;g<j;g++){e=arguments[g]||[];for(var h=0,b=e.length;h<b;h++){f.push(e[h])}}return f.unique()},unique:function(){var e=[],f,b=this.length;for(f=0;f<b;f++){if(e.indexOf(this[f])<0){e.push(this[f])}}return e}});String.prototype.ltrim=function(){return this.replace(/(^\s*)/g,"")};String.prototype.rtrim=function(){return this.replace(/(\s*$)/g,"")};String.prototype.trim=function(){var b=/^\s+|\s+$/g;return function(){return this.replace(b,"")}}();String.prototype.ellipse=function(b){if(this.length>b){return this.substr(0,b-3)+"..."}return this};String.prototype.pad=function(b,f,e){return f||(f=" "),(b-=this.length)>0?(f=new Array(Math.ceil(b/f.length)+1).join(f)).substr(0,e=!e?b:e==1?0:Math.ceil(b/2))+this+f.substr(0,b-e):this};String.prototype.startsWith=function(b){return this.indexOf(b)==0};String.prototype.endsWith=function(b){return(this.match(b+"$")==b)};String.prototype.getHzLength=function(){var b=this.match(/[^\x00-\xff]/ig);return this.length+(b==null?0:b.length)};String.prototype.brkLine=function(b){s="";l=0;p=0;for(i=0;i<this.length;i++){a=this.charAt(i);s+=a;if(p!=0){if(a==">"){p=0}}else{if(a!="<"){if(!/^[\x00-\xff]/.test(a)){l++}l++;if(l>=b){s+="<br />";l=0}}else{if(this.substr(i,4).toLowerCase()=="<br />"){s+="br>";i+=4;l=0}else{p=1}}}}return s};String.prototype.ellipse=function(b,e){if(this.getHzLength()>b){var f=this.brkLine(b);return f.split("<br />")[0]+(e==undefined?"...":"")}return this};(function(){var b=Ext.lib.Ajax;b.Queue=function(f){f=f?(f.name?f:{name:f}):{};Ext.apply(this,f,{name:"q-default",priority:5,FIFO:true,callback:null,scope:null,suspended:false,progressive:false});this.requests=[];this.pending=false;this.priority=this.priority>9?9:(this.priority<0?0:this.priority)};Ext.extend(b.Queue,Object,{add:function(f){var g=b.events?b.fireEvent("beforequeue",this,f):true;if(g!==false){this.requests.push(f);this.pending=true;b.pendingRequests++;if(this.manager){this.manager.start()}}},suspended:false,activeRequest:null,next:function(){var f=this.requests[this.FIFO?"shift":"pop"]();this.pending=!!this.requests.length;return f},clear:function(){this.requests.length=0;this.pending=false;if(b.events){b.fireEvent("queueempty",this)}},suspend:function(){this.suspended=true},resume:function(){this.suspended=false},requestNext:function(){var f;this.activeRequest=null;if(!this.suspended&&(f=this.next())){b.pendingRequests--;this.activeRequest=f.active?b.request.apply(b,f):null;if(this.requests.length==0){if(this.callback){this.callback.call(this.scope||null,this)}this.clear()}}return this.activeRequest}});b.QueueManager=function(f){Ext.apply(this,f||{},{quantas:10,priorityQueues:[[],[],[],[],[],[],[],[],[],[]],queues:{}})};Ext.extend(b.QueueManager,Object,{getQueue:function(f){return this.queues[f]},createQueue:function(f){if(!f){return null}var g=new b.Queue(f);g.manager=this;this.queues[g.name]=g;var h=this.priorityQueues[g.priority];if(h&&h.indexOf(g.name)==-1){h.push(g.name)}return g},removeQueue:function(f){if(f&&(f=this.getQueue(f.name||f))){f.suspend();f.clear();this.priorityQueues[f.priority].remove(f);delete this.queues[f.name]}},start:function(){if(!this.started){this.started=true;this.dispatch()}},suspendAll:function(){forEach(this.queues,function(f){f.suspend()})},resumeAll:function(){forEach(this.queues,function(f){f.resume()});this.start()},progressive:false,stop:function(){this.started=false},dispatch:function(){var h=this,g=h.queues;var f=function(k){var j=g[k];if(j&&!j.suspended){while(j.pending&&!j.suspended&&b.pendingRequests&&b.activeRequests<b.maxConcurrentRequests){j.requestNext();if(j.progressive||h.progressive){break}}return !!b.pendingRequests?(b.activeRequests<b.maxConcurrentRequests):false}};Ext.each(this.priorityQueues,function(j){if(!b.pendingRequests){return false}return Ext.each(j||[],f,this)===undefined?true:false},this);!!b.pendingRequests?this.dispatch.defer(this.quantas,this):this.stop()}});Ext.apply(b,{queueManager:new b.QueueManager(),queueAll:false,activeRequests:0,pendingRequests:0,maxConcurrentRequests:10,forceActiveX:false,async:true,createXhrObject:function(m){var k={status:{isError:false},tId:m},g;try{if(Ext.isIE7&&!!this.forceActiveX){throw ("IE7forceActiveX")}k.conn=new XMLHttpRequest()}catch(f){for(var h=0;h<this.activeX.length;++h){try{k.conn=new ActiveXObject(this.activeX[h]);break}catch(j){}}}finally{k.status.isError=typeof(k.conn)=="undefined"}return k},encoder:encodeURIComponent,serializeForm:function(g){if(typeof g=="string"){g=(document.getElementById(g)||document.forms[g])}var h,f,k,n,o="",t=false;for(var q=0;q<g.elements.length;q++){h=g.elements[q];n=g.elements[q].disabled;f=g.elements[q].name;k=g.elements[q].value;if(!n&&f){switch(h.type){case"select-one":case"select-multiple":for(var m=0;m<h.options.length;m++){if(h.options[m].selected){if(Ext.isIE){o+=this.encoder(f)+"="+this.encoder(h.options[m].attributes.value.specified?h.options[m].value:h.options[m].text)+"&"}else{o+=this.encoder(f)+"="+this.encoder(h.options[m].hasAttribute("value")?h.options[m].value:h.options[m].text)+"&"}}}break;case"radio":case"checkbox":if(h.checked){o+=this.encoder(f)+"="+this.encoder(k)+"&"}break;case"file":case undefined:case"reset":case"button":break;case"submit":if(t===false){o+=this.encoder(f)+"="+this.encoder(k)+"&";t=true}break;default:o+=this.encoder(f)+"="+this.encoder(k)+"&";break}}}o=o.substr(0,o.length-1);return o},getHttpStatus:function(f){var h={status:0,statusText:"",isError:false,isLocal:false,isOK:false,error:null,isAbort:false,isTimeout:false};try{if(!f){throw ("noobj")}h.status=f.status;h.readyState=f.readyState;h.isLocal=(!f.status&&location.protocol=="file:")||(Ext.isSafari&&f.status===undefined);h.isOK=(h.isLocal||(h.status==304||h.status==1223||(h.status>199&&h.status<300)));h.statusText=f.statusText||""}catch(g){}return h},handleTransactionResponse:function(h,j,f){j=j||{};var g=null;this.activeRequests--;if(!h.status.isError){h.status=this.getHttpStatus(h.conn);g=this.createResponseObject(h,j.argument,f)}if(h.status.isError){g=Ext.apply({},g||{},this.createExceptionObject(h.tId,j.argument,(f?f:false)))}g.options=h.options;g.fullStatus=h.status;if(!this.events||this.fireEvent("status:"+h.status.status,h.status.status,h,g,j,f)!==false){if(h.status.isOK&&!h.status.isError){if(!this.events||this.fireEvent("response",h,g,j,f)!==false){if(j.success){j.success.call(j.scope||null,g)}}}else{if(!this.events||this.fireEvent("exception",h,g,j,f)!==false){if(j.failure){j.failure.call(j.scope||null,g)}}}}if(h.options.async){this.releaseObject(h);g=null}else{this.releaseObject(h);return g}},createResponseObject:function(g,w,k){var q={responseXML:null,responseText:"",responseStream:null,getResponseHeader:{},getAllResponseHeaders:""};var C={},j="";if(k!==true){try{q.responseText=g.conn.responseText;q.responseStream=g.conn.responseStream||null}catch(x){g.status.isError=true;g.status.error=x}try{q.responseXML=g.conn.responseXML||null}catch(y){}try{j=g.conn.getAllResponseHeaders()||""}catch(f){}if((g.status.isLocal||g.proxied)&&typeof q.responseText=="string"){g.status.isOK=!g.status.isError&&((g.status.status=(!!q.responseText.length)?200:404)==200);if(g.status.isOK&&(!q.responseXML||(q.responseXML&&q.responseXML.childNodes.length===0))){var u=null;try{if(window.ActiveXObject){u=new ActiveXObject("MSXML2.DOMDocument.3.0");u.async=false;u.loadXML(q.responseText)}else{var A=null;try{A=new DOMParser();u=A.parseFromString(q.responseText,"application/xml")}catch(z){}finally{A=null}}}catch(B){g.status.isError=true;g.status.error=B}q.responseXML=u}if(q.responseXML){var m=(q.responseXML.documentElement&&q.responseXML.documentElement.nodeName=="parsererror")||(q.responseXML.parseError||0)!==0||q.responseXML.childNodes.length===0;if(!m){j="Content-Type: "+(q.responseXML.contentType||"text/xml")+"\n"+j}}}}var t=j.split("\n");for(var n=0;n<t.length;n++){var h=t[n].indexOf(":");if(h!=-1){C[t[n].substring(0,h)]=t[n].substring(h+2)}}g.status.proxied=!!g.proxied;Ext.apply(q,{tId:g.tId,status:g.status.status,statusText:g.status.statusText,getResponseHeader:C,getAllResponseHeaders:j,fullStatus:g.status});if(typeof w!="undefined"){q.argument=w}return q},setDefaultPostHeader:function(f){this.defaultPostHeader=f},setDefaultXhrHeader:function(f){this.useDefaultXhrHeader=f||false},request:function(f,j,m,o,y){y=Ext.apply({async:this.async||false,headers:false,userId:null,password:null,xmlData:null,jsonData:null,queue:null,proxied:false},y||{});if(!this.events||this.fireEvent("request",f,j,m,o,y)!==false){if((y.queue||(y.queue=this.queueAll||null))&&!y.queued){var g=y.queue,k=g.name||"default",x=this.queueManager;g=x.getQueue(k)||x.createQueue(g);y.queue=g;y.queued=true;var u=[f,j,m,o,y];u.active=true;g.add(u);return{tId:this.transactionId++,queued:true,request:u,options:y}}var w=y.headers;if(w){for(var t in w){if(w.hasOwnProperty(t)){this.initHeader(t,w[t],false)}}}var n=this.headers["Content-Type"]||null;delete this.headers["Content-Type"];if(y.xmlData){n||(n="text/xml");f="POST";o=y.xmlData}else{if(y.jsonData){n||(n="application/json");f="POST";o=typeof y.jsonData=="object"?Ext.encode(y.jsonData):y.jsonData}}if(o){n||(n=this.useDefaultHeader?this.defaultPostHeader:null);if(n){this.initHeader("Content-Type",n,false)}}return this.makeRequest(y.method||f,j,m,o,y)}return null},getConnectionObject:function(j,g){var n,k,m=Ext.emptyFn;var q=this.transactionId;try{if(k=g.proxied){n={tId:q,status:{},proxied:true,conn:{el:null,send:function(){var o=(k.target||window).document,f=o.getElementsByTagName("head")[0];if(f&&this.el){f.appendChild(this.el)}},abort:function(){this.readyState=0},setRequestHeader:m,getAllResponseHeaders:m,onreadystatechange:null,readyState:0,status:0,responseText:null,responseXML:null},debug:k.debug,cbName:k.callbackName||"basexCallback"+q,cbParam:k.callbackParam||null};window[n.cbName]=n.cb=function(t,o){this.responseText=!!t?t:null;this.readyState=4;this.status=!!t?200:404;if(typeof this.onreadystatechange=="function"){this.onreadystatechange()}if(!o.debug){Ext.removeNode(this.el);this.el=null}window[o.cbName]=undefined;try{delete window[o.cbName]}catch(f){}}.createDelegate(n.conn,[n],true);n.conn.open=function(){this.el=e(k.tag||"script",{type:"text/javascript",src:n.cbParam?j+(j.indexOf("?")!=-1?"&":"?")+String.format("{0}={1}",n.cbParam,n.cbName):j},null,k.target,true)};n.conn.readyState=1;if(typeof n.conn.onreadystatechange=="function"){n.conn.onreadystatechange()}g.async=true}else{n=this.createXhrObject(q)}if(n){this.transactionId++}}catch(h){}finally{return n}},makeRequest:function(q,j,n,f,g){var m=this.getConnectionObject(j,g);if(!m||m.status.isError){return Ext.apply(m,this.handleTransactionResponse(m,n))}else{m.options=g;try{m.conn.open(q.toUpperCase(),j,g.async,g.userId,g.password);m.conn.onreadystatechange=this.onReadyState?this.onReadyState.createDelegate(this,[m],0):Ext.emptyFn}catch(h){m.status.isError=true;m.status.error=h;return Ext.apply(m,this.handleTransactionResponse(m,n))}this.activeRequests++;if(this.useDefaultXhrHeader){if(!this.defaultHeaders["X-Requested-With"]){this.initHeader("X-Requested-With",this.defaultXhrHeader,true)}}if(this.hasDefaultHeaders||this.hasHeaders){this.setHeader(m)}if(m.options.async){this.handleReadyState(m,n)}try{if(!this.events||this.fireEvent("beforesend",m,q,j,n,f,g)!==false){m.conn.send(f||null)}}catch(k){m.status.isError=true;m.status.error=k;return Ext.apply(m,this.handleTransactionResponse(m,n))}return g.async?m:Ext.apply(m,this.handleTransactionResponse(m,n))}},abort:function(g,h,f){if(g&&g.queued&&g.request){g.request.active=g.queued=false;if(this.events){this.fireEvent("abort",g,h)}}else{if(g&&this.isCallInProgress(g)){g.conn.abort();window.clearInterval(this.poll[g.tId]);delete this.poll[g.tId];if(f){delete this.timeout[g.tId]}g.status.isAbort=!(g.status.isTimeout=f||false);if(this.events){this.fireEvent(f?"timeout":"abort",g,h)}this.handleTransactionResponse(g,h,true);return true}else{return false}}},clearAuthenticationCache:function(f){try{if(Ext.isIE){document.execCommand("ClearAuthenticationCache")}else{var g;if(g=new XMLHttpRequest()){g.open("GET",f||"/@@",true,"logout","logout");g.send("");g.abort.defer(100,g)}}}catch(h){}}});var e=function(t,j,o,f,q){j=Ext.apply({},j||{});f||(f=window);var g=null,n=f.document,m=n.getElementsByTagName("head")[0];if(n&&m&&(g=n.createElement(t))){for(var k in j){if(j.hasOwnProperty(k)&&k in g){g.setAttribute(k,j[k])}}if(o){var h=(o.success||o).createDelegate(o.scope||null,[o],0);if(Ext.isIE){g.onreadystatechange=function(){if(/loaded|complete|4/i.test(String(this.readyState))){h()}}.createDelegate(g)}else{if(Ext.isSafari3&&t=="script"){g.addEventListener("load",h)}else{if(Ext.isSafari){h.defer(50)}else{t!=="link"||Ext.isOpera?Ext.get(g).on("load",h):h.defer(50)}}}}if(!q){m.appendChild(g)}}return g};if(Ext.util.Observable){Ext.apply(b,{events:{request:true,beforesend:true,response:true,exception:true,abort:true,timeout:true,readystatechange:true,beforequeue:true,queue:true,queueempty:true},onStatus:function(f,k,j,h){var g=Array.prototype.slice.call(arguments,1);f=[].concat(f||[]);Ext.each(f,function(m){m=parseInt(m,10);if(!isNaN(m)){var n="status:"+m;this.events[n]||(this.events[n]=true);this.on.apply(this,[n].concat(g))}},this)},unStatus:function(f,k,j,h){var g=Array.prototype.slice.call(arguments,1);f=[].concat(f||[]);Ext.each(f,function(m){m=parseInt(m,10);if(!isNaN(m)){var n="status:"+m;this.un.apply(this,[n].concat(g))}},this)},onReadyState:function(){this.fireEvent.apply(this,["readystatechange"].concat(Array.prototype.slice.call(arguments,0)))}},new Ext.util.Observable());Ext.hasBasex=true}})();(function(){Ext.stopIteration={stopIter:true};Ext.applyIf(Array.prototype,{map:function(e,h){var b=this.length;if(typeof e!="function"){throw new TypeError()}var g=new Array(b);for(var f=0;f<b;f++){if(f in this){g[f]=e.call(h||this,this[f],f,this)}}return g},forEach:function(g,e){if(typeof g!="function"){throw new TypeError()}var b=0,f=this.length;while(b<f){g.call(e||null,this[b],b++,this)}},include:function(f){if(typeof this.indexOf=="function"){return this.indexOf(f)!=-1}var e=false;try{this.forEach(function(h,g){if(e=(h==f)){throw Ext.stopIteration}})}catch(b){if(b!=Ext.stopIteration){throw b}}return e},filter:function(f,e){var b=[];this.forEach(function(h,g){if(f.call(e,h,g)){b.push(h)}});return b},compact:function(e){var b=[];this.forEach(function(f){(f===null||f===undefined)||b.push(e&&Ext.isArray(f)?f.compact():f)},this);return b},flatten:function(){var b=[];this.forEach(function(e){Ext.isArray(e)?(b=b.concat(e)):b.push(e)},this);return b},unique:function(e){var b=[];this.forEach(function(g,f){if(0==f||(e?b.last()!=g:!b.include(g))){b.push(g)}},this);return b},grep:function(h,g,f){var b=[];g||(g=function(j){return j});var e=f?g.createDelegate(f):g;if(typeof h=="string"){h=new RegExp(h)}this.forEach(function(k,j){if(h.test(k)){b.push(e(k,j))}});return b},first:function(){return this[0]},last:function(){return this[this.length-1]},clone:function(){return[].concat(this)},clear:function(){this.length=0}});Ext.applyIf(Function.prototype,{forEach:function(b,j,g){if(typeof j!="function"){throw new TypeError()}for(var f in b){if(typeof this.prototype[f]=="undefined"){try{j.call(g||null,b[f],f,b)}catch(h){}}}}});Ext.applyIf(String.prototype,{forEach:function(g,e){if(typeof g!="function"){throw new TypeError()}var f=this.toString();e=e||this;var b=f.split("")||[];b.forEach(function(j,h){try{g.apply(e,[j,h,f])}catch(k){}},b)},trim:function(){var b=/^\s+|\s+$/g;return function(){return this.replace(b,"")}}()});window.forEach=function(b,g,e){e=e||b;if(b){if(typeof g!="function"){throw new TypeError()}var f=Object;if(b instanceof Function){f=Function}else{if(b.forEach instanceof Function){b.forEach(g,e);return}}return f.forEach(b,g,e)}}})();Ext.namespace("Ext.ux");Ext.ux.Sortable=function(e){var b=Ext.applyIf(e,{container:document.body,className:null,tagName:"li",handles:false,contextMenu:Ext.emptyFn,DDGroupName:"draggable",autoEnable:true});Ext.applyIf(this,b);this._buildQueryString();this.addEvents("serialise","enable","disable","enableElement","disableElement");this._createDragDrop();if(this.autoEnable){this.enable()}this.dropTarget==Ext.get(this.container)};Ext.extend(Ext.ux.Sortable,Ext.util.Observable,{_buildQueryString:function(){this.queryString="";if(this.tagName){this.queryString+=this.tagName.toLowerCase()}if(this.className){this.queryString+="."+this.className}},_createDragDrop:function(){this.dragZone=new Ext.dd.SortableDragZone(this.container,{ddGroup:this.DDGroupName,scroll:false,containerScroll:true,queryString:this.queryString});this.dropTarget=new Ext.dd.SortableDropZone(this.container,{ddGroup:this.DDGroupName,queryString:this.queryString,handles:this.handles})},serialise:function(b){if(b||b=="undefined"){this.fireEvent("serialise",this)}return Ext.query(this.queryString,this.container)},enable:function(){this.drags=this.serialise(false);if(this.handles&&this.contextMenu){for(var e=0,b=this.drags.length;e<b;e++){Ext.dd.Registry.register(this.drags[e],{isHandle:false,handles:["handle_"+this.drags[e].id],ddGroup:this.DDGroupName});Ext.fly("handle_"+this.drags[e].id).on("contextmenu",this.contextMenu,this,{preventDefault:true})}}else{if(this.handles){for(var e=0,b=this.drags.length;e<b;e++){Ext.dd.Registry.register(drags[e],{isHandle:false,handles:["handle_"+this.drags[e].id],ddGroup:this.DDGroupName})}}else{if(this.contextMenu){for(var e=0,b=this.drags.length;e<b;e++){Ext.dd.Registry.register(this.drags[e],{ddGroup:this.DDGroupName});Ext.fly(this.drags[e].id).on("contextmenu",this.contextMenu,this,{preventDefault:true})}}else{for(var e=0,b=this.drags.length;e<b;e++){Ext.dd.Registry.register(this.drags[e],{ddGroup:this.DDGroupName})}}}}this.dropTarget.unlock();this.dragZone.unlock();this.fireEvent("enable",this)},disable:function(){this.drags=this.serialise(false);if(!this.contextMenu){for(var e=0,b=this.drags.length;e<b;e++){Ext.dd.Registry.unregister(this.drags[e]);Ext.fly("handle_"+this.drags[e].id).un("contextmenu",this.contextMenu)}}if(this.contextMenu){for(var e=0,b=this.drags.length;e<b;e++){Ext.dd.Registry.unregister(this.drags[e]);Ext.fly(this.drags[e].id).un("contextmenu",this.contextMenu)}}this.dropTarget.lock();this.dragZone.lock();this.fireEvent("disable",this)},enableElement:function(b){if(this.handles&&this.contextMenu){Ext.dd.Registry.register(b,{isHandle:false,handles:["handle_"+b],ddGroup:this.DDGroupName});Ext.fly("handle_"+b).on("contextmenu",this.contextMenu,this,{preventDefault:true})}else{if(this.handles){Ext.dd.Registry.register(b,{isHandle:false,handles:["handle_"+b],ddGroup:this.DDGroupName})}else{if(this.contextMenu){Ext.dd.Registry.register(b,{ddGroup:this.DDGroupName});Ext.fly("handle_"+b).un("contextmenu",this.contextMenu)}else{Ext.dd.Registry.register(b,{ddGroup:this.DDGroupName})}}}this.fireEvent("enableElement",this)},disableElement:function(b){Ext.dd.Registry.unregister(b);if(this.contextMenu){Ext.fly("handle_"+b).un("contextmenu",this.contextMenu)}this.fireEvent("disableElement",this)},swapDDGroup:function(b){this.dragZone.removeFromGroup(this.DDGroupName);this.dropTarget.removeFromGroup(this.DDGroupName);this.DDGroupName=b;this.dragZone.addToGroup(this.DDGroupName);this.dropTarget.addToGroup(this.DDGroupName);this.enable()}});Ext.dd.SortableDragZone=function(e,b){Ext.dd.DragZone.superclass.constructor.call(this,e,b)};Ext.extend(Ext.dd.SortableDragZone,Ext.dd.DragZone,{onInitDrag:function(e,f){var b=this.dragData.ddel.cloneNode(true);b.id="";this.proxy.update(b);this.onStartDrag(e,f);this.dragData.ddel.style.visibility="hidden";return true},afterRepair:function(){this.dragData.ddel.style.visibility="";this.dragging=false},getRepairXY:function(b){return Ext.Element.fly(this.dragData.ddel).getXY()},getNodeData:function(f){f=Ext.EventObject.setEvent(f);var b=f.getTarget(this.queryString);if(b){this.dragData.ddel=b.parentNode;this.dragData.single=true;return this.dragData}return false},onEndDrag:function(h,j){var f=h.handles[0].split("-");var g=f[f.length-1];if(h.ddel.nextSibling&&h.ddel.nextSibling.id){f=h.ddel.nextSibling.id.split("-");var b=f[f.length-1]}else{var b=0}divo.publish("ux.sortable.DragEnded",{sender:this.id,dragedId:g,nextId:b})}});Ext.dd.SortableDropZone=function(e,b){Ext.dd.DropZone.superclass.constructor.call(this,e,b)};Ext.extend(Ext.dd.SortableDropZone,Ext.dd.DropZone,{notifyEnter:function(f,g,b){this.srcEl=Ext.get(b.ddel);if(this.groups[Ext.dd.Registry.getTarget(this.srcEl.id).ddGroup]){if(this.srcEl!==null){if(this.srcEl.dom.parentNode!==this.el.dom){if(!Ext.query(this.queryString,this.el).length>0&&this.srcEl.is(this.queryString)){this.srcEl.appendTo(this.el)}}if(this.overClass){this.el.addClass(this.overClass)}return this.dropAllowed}}},onContainerOver:function(b,g,f){if(this.groups[Ext.dd.Registry.getTarget(this.srcEl.id).ddGroup]){return this.dropAllowed}},notifyOver:function(f,h,g){if(this.groups[Ext.dd.Registry.getTarget(this.srcEl.id).ddGroup]){var b;var j=this.getTargetFromEvent(h);if(!j){b=Ext.get(h.target.parentNode);if(this.handles){if(b.is(this.queryString)){j=Ext.dd.Registry.getHandle("handle_"+b.id)}}}if(!j){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,f,h,g);this.lastOverNode=null}return this.onContainerOver(f,h,g)}if(this.lastOverNode!=j){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,f,h,g)}this.onNodeEnter(j,f,h,g);this.lastOverNode=j}return this.onNodeOver(j,f,h,g)}},onNodeOver:function(k,b,h,g){if(this.groups[Ext.dd.Registry.getTarget(this.srcEl.id).ddGroup]){var j=h.getPageY();if(j<this.lastY){this.goingUp=true}else{if(j>this.lastY){this.goingUp=false}}this.lastY=j;var f=Ext.get(k.ddel);if(this.srcEl!==null){if(f.is(this.queryString)){if(this.goingUp){this.srcEl.insertBefore(f)}else{this.srcEl.insertAfter(f)}}}return this.dropAllowed}else{return this.dropNotAllowed}},notifyDrop:function(b,g,f){if(this.groups[Ext.dd.Registry.getTarget(this.srcEl.id).ddGroup]){if(this.srcEl!==null){this.srcEl.setStyle("visibility","");Ext.dd.DragDropMgr.refreshCache(this.groupName);return true}}}});Ext.ns("divo.home");divo.home=function(){return{clearRememberUserInfo:function(){var f=divo.utils.base64.encode("user_remember");var e=divo.utils.base64.encode("user_loginName");var b=divo.utils.base64.encode("user_password");divo.remove(f);divo.remove(e);divo.remove(b)},clearAuthInfo:function(){divo.remove(divo.TOKEN_KEY);divo.remove(divo.AUTH_KEY)}}}();Ext.override(Ext.Component,{menuItemId:null,canCreate:function(){if(this.menuItemId){return divo.canCreate(this.menuItemId)}else{return true}},canUpdate:function(){if(this.menuItemId){return divo.canUpdate(this.menuItemId)}else{return true}},canDelete:function(){if(this.menuItemId){return divo.canDelete(this.menuItemId)}else{return true}}});divo.home.Login=function(){var h=divo.utils.base64.encode("user_remember");var e=divo.utils.base64.encode("user_loginName");var b=divo.utils.base64.encode("user_password");var g=divo.utils.base64.encode("token");var f=divo.AUTH_KEY;return{loginUrl:"/login",gup:function(k){k=k.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var j="[\\?&]"+k+"=([^&#]*)";var n=new RegExp(j);var m=n.exec(window.location.href);if(m==null){return""}else{return divo.utils.base64.decode(m[1])}},loginFormConfig:{labelAlign:"right",labelWidth:75,frame:false,defaultType:"textfield",items:[new divo.form.FormIntro({style:"margin:10px 15px 0 10px;",label:"登录",text:"请输入您的用户名和密码，然后直接回车，或点击登录按钮。"}),{xtype:"spacer",height:12},{fieldLabel:"用户名",name:"username",tabIndex:1,width:180},{fieldLabel:"密码",name:"password",tabIndex:2,inputType:"password",width:180},{xtype:"checkbox",name:"isPersistent",boxLabel:"下次自动登录",labelSeparator:"",listener:{check:this.onRememberCheck,scope:this}},{xtype:"spacer",height:12}]},init:function(){var m=location.href.split("/");var j=m[m.length-1];if(j.indexOf("username")>0){this.autoLogin(this.gup("username"),this.gup("password"));return}var k=divo.find(h);if(k&&k=="1"){this.autoLogin();return}this.removeLoading();this.loginForm=new Ext.form.FormPanel(this.loginFormConfig);this.loginWindow=new Ext.Window({cls:"login-window",closable:false,closeAction:"hide",autoWidth:false,width:490,height:250,modal:false,constrain:true,resizable:false,draggable:false,items:[{xtype:"box",cls:"login-window-softwareLabel",autoEl:{tag:"div",html:divo.appContext.productName}},this.loginForm],buttons:[{text:"登录",scope:this,handler:this.loginHandler}],keys:{key:Ext.EventObject.ENTER,fn:this.loginHandler,scope:this}});this.loginWindow.on("show",function(){this.loginForm.find("name","username")[0].focus(true,100)},this);this.loginWindow.on("close",function(){this.loginForm.getForm().reset()},this);this.loginForm.getForm().clearInvalid();this.loginWindow.show();this.loginForm.find("name","isPersistent")[0].setValue(false);divo.utils.CapsLock.init()},onRememberCheck:function(k,j){j||divo.home.clearRememberUserInfo()},loginHandler:function(){this.addMask();var n=this.loginForm.find("name","username")[0].getValue().trim();var k=this.loginForm.find("name","password")[0].getValue();var m=this.loginForm.find("name","isPersistent")[0].getValue();var j=divo.utils.base64.encode(n+":"+k);Ext.Ajax.request({scope:this,url:this.loginUrl,method:"GET",headers:{Authorization:j},success:function(o,q){var u=Ext.decode(o.responseText);if(!u.success){this.unmask();alert(u.errors.reason);return}Ext.Ajax.defaultHeaders.Authorization=j;this.loginWindow.hide();this.loginForm.getForm().reset();divo.save(h,m?"1":"0");if(m){divo.save(e,divo.utils.base64.encode(n));divo.save(b,divo.utils.base64.encode(k))}else{divo.home.clearRememberUserInfo()}divo.save(g,u.authToken);divo.save(f,j);if(!u.passwordChanged){this.unmask();var t=new divo.home.ChangePasswordWindow({userId:u.id,userName:u.name,userFullName:u.fullName,passwordTimeout:u.passwordTimeout,firstChangePassword:true});t.show();return}divo.publish("j.showHomepage",{userId:u.id,userName:u.name})},failure:function(o,q){this.unmask();divo.showError(o.responseText);this.loginForm.find("name","password")[0].focus(true)}})},autoLogin:function(m,n){if(!m){var o=divo.utils.base64.decode(divo.find(e));var k=divo.utils.base64.decode(divo.find(b));var j=divo.utils.base64.encode(o+":"+k)}else{var j=divo.utils.base64.encode(m+":"+n)}Ext.Ajax.request({scope:this,url:this.loginUrl,method:"GET",headers:{Authorization:j},success:function(q,t){var u=Ext.decode(q.responseText);if(!u.success||!u.passwordChanged){divo.home.clearRememberUserInfo();location.reload(false);return}divo.save(g,u.authToken);divo.save(f,j);this.addMask();divo.publish("j.showHomepage",{userId:u.id,userName:u.name})},failure:function(q,t){this.unmask();divo.showError(q.responseText);divo.home.clearRememberUserInfo();location.reload(false)}})},removeLoading:function(){Ext.get("loading").setStyle("display","none")},addMask:function(){Ext.get("loading-info").update("“上海市消防中队战备执勤信息管理系统”正在登录...");Ext.get("loading").setStyle("display","block")},unmask:function(){this.removeLoading()}}}();var loginApp=function(){return{init:function(){divo.home.clearAuthInfo();divo.appContext.loadAppContext();if(Ext.isIE){Ext.util.CSS.swapStyleSheet("css-patch","/media/css/ie-patch.css?v="+divo.appContext.version)}if(Ext.isChrome){Ext.util.CSS.swapStyleSheet("css-patch","/media/css/chrome-patch.css?v="+divo.appContext.version)}divo.home.Login.init();divo.subscribe("j.showHomepage",this.onShowHomePage,this)},onShowHomePage:function(b,f,e){top.window.location.href="/index.html?_dc="+new Date().getTime()}}}();var homeApp=function(){var f=new divo.utils.JsLoader();function e(){Ext.get("loading").setStyle("display","none")}function b(){Ext.getBody().unmask()}function g(){var h=true;Ext.Ajax.request({scope:this,url:"/users/"+divo.getUserId()+"/jsmodules",async:false,method:"GET",success:function(k,m){var t=Ext.decode(k.responseText);if(t.modules.length>0){var o=t.modules.split(",");for(var n=0;n<o.length;n++){var j=(n==o.length-1);f.load("/media/js/divo-"+o[n],j);if(j){var q=function(){e()};q.defer(3000,this)}}}else{e()}}})}return{init:function(){Ext.get("loading-info").update("“上海市消防中队战备执勤信息管理系统”正在加载...");divo.appContext.loadAppContext();if(!divo.appContext.user.id){top.window.location.href="/";return}Ext.Ajax.defaultHeaders.Authorization=divo.find(divo.AUTH_KEY);if(Ext.isIE){Ext.util.CSS.swapStyleSheet("css-patch","/media/css/ie-patch.css?v="+divo.appContext.version)}if(Ext.isChrome){Ext.util.CSS.swapStyleSheet("css-patch","/media/css/chrome-patch.css?v="+divo.appContext.version)}if(Ext.isGecko){Ext.util.CSS.swapStyleSheet("css-patch","/media/css/firefox-patch.css?v="+divo.appContext.version)}new divo.home.Main({id:"home-app"});if(divo.appContext.version.endsWith("-dev")){e()}else{g()}}}}();divo.home.CenterTabbedPanel=Ext.extend(divo.panel.TabbedPanel,{onTabChanged:function(e,b){this.publish("divo.home.TabChanged",{sender:this.id,tabId:b.id})}});divo.home.Main=Ext.extend(Ext.Viewport,{initComponent:function(){this.user=this.getAppContext().user;var b=[new divo.home.DashWorkspacePanel({title:"首页",iconCls:"icon-menu-overview",id:"home-page"})];Ext.get("loading").setStyle("display","none");Ext.get("header").removeClass("x-hidden");Ext.get("footer").removeClass("x-hidden");new Ext.Viewport({layout:"tdgi_border",defaults:{border:true},items:[new Ext.BoxComponent({region:"north",el:"header"}),new Ext.BoxComponent({region:"south",el:"footer"}),{region:"west",id:"menu-panel",title:'<img src="/media/images/silk/application_double.png" />&nbsp;菜单导航',collapsedTitle:"菜单导航",split:true,stateful:true,stateId:this.myId("west"),width:150,bodyBorder:false,minSize:100,maxSize:300,collapsible:true,collapsed:false,margins:"0 0 0 0",layout:"fit",items:[{xtype:"divo.tree.MenuTree"}]},new divo.home.CenterTabbedPanel({defaults:{border:true},id:"tabs-panel",region:"center",activeTab:0,enableTabScroll:true,items:b})]});this.subscribe("divo.tree.MenuItemSelect",this.onMenuSelected,this);this.on("beforedestroy",function(){this.unsubscribe()},this);divo.home.Main.superclass.initComponent.call(this)},afterRender:function(){divo.home.Main.superclass.afterRender.call(this);var h=function(){if(this.getUserId()==1){Ext.get("logout").on("click",function(j,f){divo.home.clearRememberUserInfo();divo.home.clearAuthInfo();top.window.location.href="/"},this)}else{Ext.get("logout").update("")}Ext.get("user").update(this.getUserFullName());this.setupAction();Ext.get("todoPrompt").on("click",function(j,f){Ext.getCmp("tabs-panel").setActiveTab(0)},this)};h.defer(1000,this);var e=60*1;var g=0;var b={run:function(){g++;if(g%e==0){g=0;Ext.getCmp("home-page").showContent()}},scope:this,interval:1000};Ext.TaskMgr.start(b)},onMenuSelected:function(e,h,g){var b=Ext.getCmp("tabs-panel");var f={id:h.menuItemId,url:h.menuItemUrl,text:h.menuItemName,icon:h.menuItemIcon,autoActivated:h.autoActivated};divo.home.Loader.selectMenu(b,f)},setupAction:function(){Ext.get("setup").on("click",function(h,g){var f=[{text:"清除记忆信息",icon:divo.iconUrl+"delete.png",cls:"x-btn-text-icon",handler:this.deleteMyProfile.createDelegate(this)}];if(this.getUserId()==1){f.push("-");f.push({text:"加载数据",icon:divo.iconUrl+"add_file.gif",cls:"x-btn-text-icon",handler:this.importData.createDelegate(this)})}var j=new Ext.menu.Menu({items:f});var b=Ext.get("setup").getXY();b[1]=b[1]+22;j.showAt(b)},this)},changePassword:function(){var b=new divo.home.ChangePasswordWindow({userId:this.user.id,userName:this.user.name,userFullName:this.user.fullName,firstChangePassword:false});b.show()},importData:function(){var b={title:"加载数据",width:500,height:300};var e=new divo.home.LoadDataForm();divo.showPopupWindow(b,e)},deleteMyProfile:function(){Ext.MessageBox.confirm("确认","清除记忆信息后，如窗口位置和大小、页面布局等会恢复到默认状态，要继续吗？",this.onDeleteMyProfile.createDelegate(this))},onDeleteMyProfile:function(e){if(e!=="yes"){return}var b=true;Ext.Ajax.request({scope:this,url:"/myprofile/"+this.getUserId(),async:false,method:"DELETE",failure:function(f,g){this.alert(f.responseText);b=false}});if(b){this.say("操作成功，重新登录后生效")}}});var siteApp=function(){var jsLoader=new divo.utils.JsLoader();function loadApp(pageName){var ok=true;var jsFileName;Ext.Ajax.request({scope:this,url:"/pages/"+pageName+"/js",async:false,method:"GET",success:function(response,options){var resp=Ext.decode(response.responseText);if(!resp.success){alert("加载["+pageName+"]时出错（请查看log.txt，获得详细错误信息）");return}jsFileName=resp.jsFileName},failure:function(response,options){divo.showError(response.responseText);ok=false}});if(!ok){return}var callback=function(){var objName="divo."+pageName+".Main";var oMain;eval("oMain = "+objName);var n=0;while(!oMain&&n<2){alert("点击[确定]后继续");eval("oMain = "+objName);n++}oMain.init()};jsLoader.onSuccess=callback;jsLoader.load("/media/js/pages/"+jsFileName,true)}return{init:function(){divo.appContext.loadAppContext();if(Ext.isIE){Ext.util.CSS.swapStyleSheet("css-patch","/media/css/ie-patch.css?v="+divo.appContext.version)}if(Ext.isChrome){Ext.util.CSS.swapStyleSheet("css-patch","/media/css/chrome-site-patch.css?v="+divo.appContext.version)}if(Ext.isGecko){Ext.util.CSS.swapStyleSheet("css-patch","/media/css/firefox-site-patch.css?v="+divo.appContext.version)}if(divo.includePages){for(var i=0;i<divo.includePages.length;i++){loadApp(divo.includePages[i])}}if(divo.pageName){loadApp(divo.pageName)}}}}();divo.home.ChangePasswordForm=Ext.extend(Ext.form.FormPanel,{userId:null,userName:null,firstChangePassword:null,passwordTimeout:null,bySite:null,initComponent:function(){this.user=this.getAppContext().user;var b="修改登录密码";if(this.firstChangePassword){if(this.passwordTimeout){b="现密码已经过期，请设置新登录密码"}else{b="设置新登录密码"}}Ext.apply(this,{labelWidth:150,defaultType:"textfield",labelAlign:"right",autoScroll:true,bodyStyle:"padding:10px",items:[new divo.form.FormIntro({style:"margin:0px 0 10px 0;",label:b,text:"密码长度必须大于6位，可以由英文字母、阿拉伯数字等组成，区分大小写。"}),{fieldLabel:"现密码",name:"password",inputType:"password",width:150},{fieldLabel:"新密码",name:"new_password",inputType:"password",width:150},{fieldLabel:"再次输入新密码",inputType:"password",name:"new_password2",width:150}]});divo.home.ChangePasswordForm.superclass.initComponent.call(this)},afterRender:function(){divo.home.ChangePasswordForm.superclass.afterRender.call(this);var b=function(){divo.utils.CapsLock.init();this.initFocus()};b.defer(100,this)},initFocus:function(){var b=this.getForm().findField("password");b.focus.defer(100,b)},save:function(e){var g=this.getForm().getObjectValues();this.getEl().mask("","x-mask-loading");var b="/users/"+this.userId+"/password";var h=function(){Ext.Ajax.request({scope:this,url:b,method:"PUT",jsonData:g,success:function(j,k){var n=Ext.decode(j.responseText);this.getEl().unmask();if(!n.success){this.say(n.errors.reason)}else{var f=divo.utils.base64.encode(this.userName+":"+k.jsonData.new_password);Ext.Ajax.defaultHeaders.Authorization=f;var m=divo.AUTH_KEY;divo.save(m,f);this.say("新密码已经保存");divo.home.clearRememberUserInfo(this.bySite);e.call()}},failure:function(f,j){this.getEl().unmask();this.alert(f.responseText)}})};h.defer(100,this,[g])}});Ext.reg("divo.home.ChangePasswordForm",divo.home.ChangePasswordForm);divo.home.ChangePasswordWindow=Ext.extend(Ext.Window,{userId:null,userName:null,userFullName:null,firstChangePassword:true,passwordTimeout:false,cancelAction:"destroy",closeAction:"destroy",bySite:false,initComponent:function(){var b=[{text:"确定",handler:this.onSave,scope:this}];if(!this.firstChangePassword){b=b.concat([{text:"取消",handler:this.onCancel,scope:this}])}Ext.apply(this,{width:400,height:300,modal:false,closable:!this.firstChangePassword,maximizable:false,minimizable:false,layout:"fit",buttons:b,items:{xtype:"divo.home.ChangePasswordForm",userId:this.userId,userName:this.userName,bySite:this.bySite,firstChangePassword:this.firstChangePassword,passwordTimeout:this.passwordTimeout},keys:{key:Ext.EventObject.ENTER,fn:this.onSave,scope:this}});divo.home.ChangePasswordWindow.superclass.initComponent.call(this)},onSave:function(){this.items.itemAt(0).save(this.onSaveSucccess.createDelegate(this))},onSaveSucccess:function(){this.close();if(this.firstChangePassword){if(this.bySite){divo.home.gotoNewPageAfterLogin()}else{divo.publish("j.showHomepage")}}}});divo.tree.MenuTree=Ext.extend(Ext.tree.TreePanel,{initComponent:function(){Ext.apply(this,{animate:false,autoScroll:true,enableDD:false,containerScroll:true,lines:true,tbar:this.createTopBar(),rootVisible:false,root:new Ext.tree.TreeNode({text:"全部",leaf:false,expanded:true})});divo.tree.MenuTree.superclass.initComponent.call(this)},afterRender:function(){divo.tree.MenuTree.superclass.afterRender.call(this);this.on("click",this.onNodeClicked,this);this.setupMenu()},createTopBar:function(){return new Ext.Toolbar({items:["->",{icon:divo.iconCollapseAll2,cls:"x-btn-icon",tooltip:"全部折叠",handler:this.onCollapseAll,scope:this}]})},onCollapseAll:function(){this.root.collapse(true)},onNodeClicked:function(g,h,f){if(!g.attributes.leaf){return}var b=(f==undefined?true:false);this.publish("divo.tree.MenuItemSelect",{sender:this.id,menuItemId:g.attributes.code,menuItemName:g.attributes.text,menuItemIcon:g.attributes.icon,menuItemUrl:g.attributes.url,autoActivated:b})},setupMenu:function(){var f=[];var b=[];var e;Ext.Ajax.request({scope:this,url:"/users/"+this.getUserId()+"/modules/default/menus",async:true,method:"GET",success:function(g,h){var m=Ext.decode(g.responseText);if(m.totalCount==0){return}e=m.rows;var k="";for(var j=0;j<e.length;j++){if(j==e.length-1){k+=e[j].id}else{k+=e[j].id+"_"}}b=e;Ext.Ajax.request({scope:this,url:"/users/"+this.getUserId()+"/menus/"+k+"/items",async:true,method:"GET",success:function(n,q){var x=Ext.decode(n.responseText);for(var t=0;t<b.length;t++){var w={title:b[t].name,items:[]};for(var o=0;o<x.rows.length;o++){var u=x.rows[o];if(u.menu_id+""==b[t].id+""){w.items.push({text:u.name,id:u.id,url:u.url,icon:u.small_image})}}f.push(w)}this.initMenu(f)},failure:function(n,o){this.alert(n.responseText)}})},failure:function(g,h){this.alert(g.responseText)}})},initMenu:function(k){for(var f=0;f<k.length;f++){var h=k[f];var b=new Ext.tree.TreeNode({text:h.title,leaf:false});this.root.appendChild(b);for(var e=0;e<h.items.length;e++){var g=h.items[e];b.appendChild(new Ext.tree.TreeNode({text:g.text,code:g.id,url:g.url,icon:"/media/images/menus/"+g.icon,leaf:true}))}}this.root.expand(true)}});Ext.reg("divo.tree.MenuTree",divo.tree.MenuTree);divo.home.DashWorkspaceBasePanel=Ext.extend(Ext.Panel,{getPortletHtml:function(g,f,e,b){return['		<div class="'+f+'">','			<table width="100%" cellspacing="0" cellpadding="0">',"				<tr>",'					<td colspan="2" rowspan="2" class="dashHeader">','						<table id="'+g+'-header" style="width:100%;'+(b?"cursor: pointer":"")+'">',"							<tr>","								<td>",'									<div id="'+g+'-title" class="dashTitle">'+e+"</div>","								</td>",'								<td align="right" style="width:30px">','									<div id="'+g+'-header-state" class="'+(b?"dash-expander ico-dash-collapsed":"")+'"></div>',"								</td>","							</tr>","						</table>","					</td>",'					<td class="coViewTopRight">&nbsp;&nbsp;</td>',"				</tr>",'				<tr><td class="coViewRight" rowspan="2"></td></tr>',"				<tr>",'					<td class="coViewBody" colspan="2" style="padding:0px">','						<div id="'+g+'-body" style="display: block;">',"						</div>","					</td>","				</tr>","				<tr>",'					<td class="coViewBottomLeft"></td>','					<td class="coViewBottom">&nbsp;</td>','					<td class="coViewBottomRight"></td>',"				</tr>","			</table>","		</div>"].join("")},renderPortlet:function(b){Ext.fly(b+"-header").on("click",function(g,f){this.togglePortletState(b)},this);this.restorePortletVisibility(b)},showDashItemList:function(k,h,b,g){if(h.length==0){Ext.get(k+"-body").update("");return}var f=['<div style="">','	<table style="width:100%">'];for(var e=0;e<h.length;e++){if(g&&g(h[e])){continue}var j=(e%2==0)?"":"dashAltRow";f.push(['		<tr class="'+j+'" style="">','			<td style="padding-left: 5px;">',b(h[e]),"			</td>","		</tr>"].join(""))}f.push(["	</table>","</div>"].join(""));Ext.get(k+"-body").update(f.join(""))}});divo.home.DashWorkspacePanel=Ext.extend(divo.home.DashWorkspaceBasePanel,{initComponent:function(){var b=this.getDeptName()?this.getDeptName():this.getUserFullName();var e=['<div class="dashWorkspace">','	<span class="name">'+b+"</span>","</div>",'<div class="dashActions">','	<a class="internalLink" href="#">','		<div id="dash-refresh" class="viewRefresh"><img src="/media/images/divo/refresh.gif"/>&nbsp;刷新</div>',"	</a>","</div>","",'<table style="width:100%;" cellspacing="0" cellpadding="0">',"	<tr>","		<!-- 左边栏 -->",'		<td valign="top">',this.getPortletHtml("activity","dashActivity","最近的操作一览",false),"		</td>","	    <!-- 右边栏 -->",'<td valign="top" style="width:50%">',this.getPortletHtml("todo","dashTodo","提醒事项(0)",false),"		</td>","	</tr>","</table>"].join("");Ext.apply(this,{layout:"fit",items:[{autoScroll:true,bodyStyle:"padding: 10px 10px 10px 10px",html:e}]});this.subscribe("divo.home.TabChanged",this.onTabChanged,this);this.on("beforedestroy",function(){this.unsubscribe()},this);divo.waitFor(this.canRenderOther,this.renderOther,this);divo.home.DashWorkspacePanel.superclass.initComponent.apply(this,arguments)},onTabChanged:function(b,f,e){if(f.tabId=="home-page"){this.showContent()}},canRenderOther:function(){return Ext.get("dash-refresh")},renderOther:function(){Ext.fly("dash-refresh").on("click",function(f,b){this.showContent()},this)},showContent:function(){Ext.Ajax.request({scope:this,url:"/zd/activitys/latest/limit/20",method:"GET",async:true,success:function(b,e){var f=Ext.decode(b.responseText);this.showDashItemList("activity",f.rows,function(g){return"["+divo.getTimeText(g.added_on)+"]:&nbsp;"+g.descrip});this.queryTodo()}})},queryTodo:function(){Ext.Ajax.request({scope:this,url:"/zd/todo",method:"POST",async:true,success:function(b,e){var f=Ext.decode(b.responseText);if(f.success){this.showTodoInfo()}}})},showTodoInfo:function(){Ext.Ajax.request({scope:this,url:"/zd/todo/results/info",method:"GET",async:true,success:function(b,e){var h=Ext.decode(b.responseText);var f=h.count;var g="提醒事项("+f+")";Ext.get("todo-title").update(g);if(f>0){Ext.get("todoPrompt").update("<b>"+g+"</b>")}else{Ext.get("todoPrompt").update(g)}this.showTodoList()}})},showTodoList:function(){Ext.Ajax.request({scope:this,url:"/zd/todo/results",method:"GET",async:true,success:function(b,e){var f=Ext.decode(b.responseText);this.showDashItemList("todo",f.rows,function(g){return g.descrip+"("+g.todo_count+")"})}})}});Ext.reg("divo.home.DashWorkspacePanel",divo.home.DashWorkspacePanel);divo.home.Loader=function(){var maxPanelNum=10;var jsLoader=new divo.utils.JsLoader();function selectMenu(mainTabPanel,menuItemNode){loadApp(mainTabPanel,menuItemNode)}function getMenuItemInfo(menuId){var ok=true;var objName,loadOnDemand,imageUrl;Ext.Ajax.request({scope:this,url:"/menus/items/"+menuId+"/main",async:false,method:"GET",success:function(response,options){Ext.getBody().unmask();var resp=Ext.decode(response.responseText);if(!resp.success){alert("加载菜单项时出错（请查看log.txt，获得详细错误信息）");return}objName=resp.objName;loadOnDemand=resp.loadOnDemand;imageUrl=resp.imageUrl},failure:function(response,options){Ext.getBody().unmask();divo.showError(response.responseText);ok=false}});return{ok:ok,objName:objName,loadOnDemand:loadOnDemand,imageUrl:imageUrl}}function loadApp(mainTabPanel,menuItemNode){var menuItemId=menuItemNode.id;var menuItem=getMenuItemInfo(menuItemId);if(!menuItem.ok){return}var objName=menuItem.objName;var loadOnDemand=menuItem.loadOnDemand;var callback=function(){var oMain;eval("oMain = "+objName);var n=0;while(!oMain&&n<2){alert("点击[确定]后继续");eval("oMain = "+objName);n++}var p=oMain.init(menuItemId);var canClose=(oMain.closable==undefined||oMain.closable==true);showMainPage(p,mainTabPanel,menuItemNode.id,menuItemNode.text,objName,menuItemNode.autoActivated,canClose)};if(loadOnDemand){jsLoader.onSuccess=callback;jsLoader.load("/media/debug/"+objName+".js?dev=yes",true)}else{callback()}}function showMainPage(p,mainTabPanel,menuItemId,menuItemText,objName,autoActivated,canClose){var tabId="mp-"+menuItemId;var oldTabPanel=mainTabPanel.getItem(tabId);if(!oldTabPanel){mainTabPanel.openNormalTab(tabId,menuItemText,p,autoActivated,canClose,"icon-"+objName.replace(/\./g,"-"),"og-content-panel")}else{mainTabPanel.openDynamicTab(tabId,menuItemText)}}return{selectMenu:function(mainTabPanel,menuItemNode){Ext.getBody().mask("","x-mask-loading");selectMenu.defer(100,this,[mainTabPanel,menuItemNode])}}}();divo.home.LoadDataForm=Ext.extend(Ext.form.FormPanel,{initComponent:function(){this.isDebug=this.getAppContext().isDebug;var e=[{items:[this.btnMenuItem=new Ext.Button({handler:this.onLoadMenuItems,text:"加载“菜单项”",scope:this})]},{html:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"},{html:'<div id="data-load-menu-item"></div><span class="common-text" id="data-load-menu-item-text"></span><br /><br />'},{items:[this.btnPortalView=new Ext.Button({handler:this.onLoadPortalViews,text:"加载“门户状态”",scope:this})]},{html:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"},{html:'<div id="data-load-portalviews"></div><span class="common-text" id="data-load-portalviews-text"></span><br /><br />'},{items:[this.btnGlobal=new Ext.Button({handler:this.onLoadGlobalPermissions,text:"加载“全局权限”",scope:this})]},{html:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"},{html:'<div id="data-load-globals"></div><span class="common-text" id="data-load-globals-text"></span><br /><br />'}];var b=[{items:[this.btnOther=new Ext.Button({handler:this.onLoadOthers,text:"加载“其他数据”",scope:this})]},{html:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"},{html:'<div id="data-load-others"></div><span class="common-text" id="data-load-others-text"></span><br /><br />'}];Ext.apply(this,{autoScroll:true,bodyStyle:"padding:20px",items:[{layout:"table",border:false,layoutConfig:{columns:3},items:e.concat(b)}]});divo.home.LoadDataForm.superclass.initComponent.apply(this,arguments)},onLoadMenuItems:function(){this.loadAndshowProgess("data-load-menu-item","/data/menuitems",this.btnMenuItem)},onLoadGridViews:function(){this.loadAndshowProgess("data-load-grid-view","/data/gridviews",this.btnGridView)},onLoadGlobalPermissions:function(){this.loadAndshowProgess("data-load-globals","/data/globals",this.btnGlobal)},onLoadPortalViews:function(){this.loadAndshowProgess("data-load-portalviews","/data/portalviews",this.btnPortalView)},onLoadOthers:function(){this.loadAndshowProgess("data-load-others","/data/others",this.btnOther)},loadAndshowProgess:function(g,b,e){e.disable();var f=new Ext.ProgressBar({width:300,renderTo:g});f.on("update",function(h){Ext.fly(g+"-text").dom.innerHTML+="."});Ext.fly(g+"-text").update("加载中...");f.wait();Ext.Ajax.request({scope:this,url:b,async:true,method:"PUT",success:function(h,j){var k=Ext.decode(h.responseText);if(k.success){f.destroy();e.enable();Ext.fly(g+"-text").update("完成")}},failure:function(h,j){this.alert(h.responseText);f.destroy();e.enable();Ext.fly(g+"-text").update("失败")}})}});Ext.reg("divo.home.LoadDataForm",divo.home.LoadDataForm);