Ext.ns("utils");utils.zd=function(){return{INDEX_ALLOW_ROLL:"index.allow.roll",CHART_ALLOW_ROLL:"chart.allow.roll",DATA_ALLOW_ROLL:"data.allow.roll",HONOR_ALLOW_ROLL:"honor.allow.roll",INDEX_ROLL_TIME:"index.roll.time",CHART_ROLL_TIME:"chart.roll.time",DATA_ROLL_TIME:"data.roll.time",HONOR_ROLL_TIME:"honor.roll.time",RECIPE_ALLOW_JUMP:"recipe.allow.jump",RECIPE_JUMP_START_TIME:"recipe.jump.start.time",RECIPE_JUMP_END_TIME:"recipe.jump.end.time",recipeJumpSetup:null,stayInterval:60,getRecipeJumpSetup:function(){var b=this.getSetupValue(this.RECIPE_JUMP_START_TIME);if(!b){b="11:00"}var a=this.getSetupValue(this.RECIPE_JUMP_END_TIME);if(!a){a="11:30"}return{allowJump:this.getSetupValue(this.RECIPE_ALLOW_JUMP),startTime:b,endTime:a}},getRollSetup:function(){var e=this.getSetupValue(this.INDEX_ALLOW_ROLL);if(typeof(e)=="string"&&e.length==0){e=true}var b=this.getSetupValue(this.INDEX_ROLL_TIME);if(!b){b=10}var h=this.getSetupValue(this.CHART_ALLOW_ROLL);if(typeof(h)=="string"&&h.length==0){h=false}var c=this.getSetupValue(this.CHART_ROLL_TIME);if(!c){c=15}var g=this.getSetupValue(this.DATA_ALLOW_ROLL);if(typeof(g)=="string"&&g.length==0){g=false}var f=this.getSetupValue(this.DATA_ROLL_TIME);if(!f){f=10}var d=this.getSetupValue(this.HONOR_ALLOW_ROLL);if(typeof(d)=="string"&&d.length==0){d=false}var a=this.getSetupValue(this.HONOR_ROLL_TIME);if(!a){a=10}return{indexAllowRoll:e,indexRollTime:b,chartAllowRoll:h,chartRollTime:c,dataAllowRoll:g,dataRollTime:f,honorAllowRoll:d,honorRollTime:a}},numberPad:function(b,a){var c=""+b;while(c.length<a){c="0"+c}return c},recipeJump:function(a){if(!this.recipeJumpSetup){this.recipeJumpSetup=this.getRecipeJumpSetup()}if(!this.recipeJumpSetup.allowJump){return}var f=new Date();var c=this.numberPad(f.getHours(),2);var e=this.numberPad(f.getMinutes(),2);var b=this.numberPad(f.getSeconds(),2);var g=c+":"+e;if(g==this.recipeJumpSetup.startTime&&a!="recipe"){window.location.href="/zd/recipe.html";return true}if(g==this.recipeJumpSetup.endTime&&a!="index"){window.location.href="/zd/index.html";return true}return false},remainInRecipe:function(){if(!this.recipeJumpSetup){this.recipeJumpSetup=this.getRecipeJumpSetup()}if(!this.recipeJumpSetup.allowJump){return}var e=new Date();var b=this.numberPad(e.getHours(),2);var c=this.numberPad(e.getMinutes(),2);var a=this.numberPad(e.getSeconds(),2);var f=b+":"+c+a;return(f>=this.recipeJumpSetup.startTime+"00"&&f<=this.recipeJumpSetup.endTime+"00")},getSetupValue:function(a){var b="";Ext.Ajax.request({scope:this,url:"/zd/setups/"+a,method:"GET",async:false,success:function(c,d){var e=Ext.decode(c.responseText);b=e.value},failure:function(c,d){alert(c.responseText)}});if(b&&b=="1"){return true}if(b&&b=="0"){return false}return b},saveSetupValue:function(b,c){var a=c+"";if(c==true){a="1"}if(c==false){a="0"}Ext.Ajax.request({scope:this,url:"/zd/setups",async:false,method:"POST",jsonData:{code:b,value:a},failure:function(d,e){alert(d.responseText)}})},getCarTotalCount:function(){var a=0;Ext.Ajax.request({scope:this,url:"/zd/vehicles/count",method:"GET",async:false,success:function(b,c){var d=Ext.decode(b.responseText);a=d.count},failure:function(b,c){alert(b.responseText)}});return a},getEquipmentTotalCount:function(){var a=0;Ext.Ajax.request({scope:this,url:"/zd/equipments/count",method:"GET",async:false,success:function(b,c){var d=Ext.decode(b.responseText);a=d.count},failure:function(b,c){alert(b.responseText)}});return a},queryVehicleOutStatus:function(){Ext.Ajax.request({scope:this,url:"/zd/vehicle/statuschanges/lastest?outOnly=1",method:"GET",async:false,success:function(b,c){var e=Ext.decode(b.responseText);if(e.length==0){return}divo.publish("divo.header.stopRollAll");utils.zd.openLayer("tipsDiv");var d=60;var a={run:function(){if(d==0){window.location.reload();return}Ext.get("tipsContent").update(d);d-=1},scope:this,interval:1000};Ext.TaskMgr.start(a)}})},openLayer:function(g){var b=function(){var h;if(self.pageYOffset){h=self.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){h=document.documentElement.scrollTop}else{if(document.body){h=document.body.scrollTop}}}c=new Array("",h);return c};var f=function(){var l,h;if(window.innerHeight&&window.scrollMaxY){l=document.body.scrollWidth;h=window.innerHeight+window.scrollMaxY}else{if(document.body.scrollHeight>document.body.offsetHeight){sScroll=document.body.scrollWidth;h=document.body.scrollHeight}else{l=document.body.offsetWidth;h=document.body.offsetHeight}}var j,m;if(self.innerHeight){j=self.innerWidth;m=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){j=document.documentElement.clientWidth;m=document.documentElement.clientHeight}else{if(document.body){j=document.body.clientWidth;m=document.body.clientHeight}}}var i,k;if(h<m){k=m}else{k=h}if(l<j){i=j}else{i=l}d=new Array(i,k,j,m);return d};var d=f();var c=b();var e=document.getElementById(g);if(!document.getElementById("bodybg")){var a=document.createElement("div");document.body.appendChild(a);a.setAttribute("id","bodybg");a.style.position="absolute";a.style.width=(d[0]+0+"px");a.style.height=(d[1]+35+"px");a.style.zIndex=2999;a.style.top=0;a.style.left=0;a.style.filter="alpha(opacity=50)";a.style.opacity=0.5;a.style.background="#000"}document.getElementById("bodybg").style.display="";e.style.display="";e.style.top=c[1]+(d[3]-e.offsetHeight)/2+"px";e.style.left=(d[0]-e.offsetWidth)/2+"px";e.style.zIndex=3000},closeLayer:function(a){document.getElementById(a).style.display="none";document.getElementById("bodybg").style.display="none";return false}}}();Ext.ns("divo.panel");Ext.ns("form.admin");Ext.ns("window.admin");Ext.ns("tree.admin");Ext.ns("grid.admin");Ext.ns("panel.zd");Ext.ns("form.zd");Ext.ns("window.zd");Ext.ns("grid.zd");Ext.ns("tree.zd");Ext.ns("window.board");Ext.ns("divo.header");divo.header.Main=function(){var b,d,c,a;function e(){divo.publish("divo.header.stopRollAll");var f=new Ext.WindowGroup();f.zseed=1000;var g=new window.zd.DisplayAdminWindow({manager:f,closeAction:"destroy",cancelAction:"destroy"});g.show()}return{init:function(){var f=utils.zd.getRollSetup();b=f.indexAllowRoll;d=f.chartAllowRoll;c=f.dataAllowRoll;a=f.honorAllowRoll;divo.subscribe("divo.index.rollOver",this.onIndexRollOver,this);divo.subscribe("divo.honor.rollOver",this.onHonorRollOver,this);divo.subscribe("divo.chart.rollOver",this.onChartRollOver,this);divo.subscribe("divo.data.rollOver",this.onDataRollOver,this);divo.subscribe("divo.recipe.rollOver",this.onRecipeRollOver,this);Ext.fly("setup").on("click",function(h,g){e()},this)},onIndexRollOver:function(f,h,g){if(d){window.location.href="/zd/chart.html";return}if(c){window.location.href="/zd/data.html";return}if(a){window.location.href="/zd/honor.html";return}window.location.href="/zd/index.html"},onHonorRollOver:function(f,h,g){if(d){window.location.href="/zd/chart.html";return}if(c){window.location.href="/zd/data.html";return}if(b){window.location.href="/zd/index.html";return}window.location.href="/zd/honor.html"},onChartRollOver:function(f,h,g){if(c){window.location.href="/zd/data.html";return}if(b){window.location.href="/zd/index.html";return}if(a){window.location.href="/zd/honor.html";return}window.location.href="/zd/chart.html"},onDataRollOver:function(f,h,g){if(b){window.location.href="/zd/index.html";return}if(a){window.location.href="/zd/honor.html";return}if(d){window.location.href="/zd/chart.html";return}window.location.href="/zd/data.html"},onRecipeRollOver:function(){if(b){window.location.href="/zd/index.html";return}if(d){window.location.href="/zd/hart.html";return}if(c){window.location.href="/zd/data.html";return}if(a){window.location.href="/zd/honor.html";return}}}}();window.zd.DisplayAdminWindow=Ext.extend(Ext.Window,{initComponent:function(){this.contentId=this.myId("content");Ext.apply(this,{title:"系统管理",width:550,height:380,modal:false,stateful:true,stateId:"window-zd-Upload",maximizable:false,minimizable:false,closable:true,layout:"fit",items:[{xtype:"tabpanel",activeTab:0,items:[{title:"滚动设置",xtype:"form.zd.RollSetupForm"}]}]});this.on("beforedestroy",function(){location.reload(false)},this);window.zd.DisplayAdminWindow.superclass.initComponent.call(this)}});form.zd.RollSetupForm=Ext.extend(Ext.form.FormPanel,{initComponent:function(){Ext.apply(this,{labelWidth:10,defaultType:"textfield",labelAlign:"right",autoScroll:true,bodyStyle:"padding:10px",layout:"autotableform",items:[{xtype:"formHtml",hideLabel:true,value:"循环滚动 _________________________________________________________________"},{xtype:"checkbox",boxLabel:"全部滚动",labelSeparator:"",name:"rollAll",listeners:{check:this.onRollAll,scope:this}},{xtype:"checkbox",boxLabel:"执勤动态",labelSeparator:"",name:"rollIndex",listeners:{check:this.onRollIndex,scope:this},items:[{xtype:"numberfield",labelWidth:200,fieldLabel:"每个显示单元停留(秒)",name:"rollTimeIndex",width:50,decimalPrecision:0,minValue:5,allowNegative:false,enableKeyEvents:true,listeners:{keyup:this.onRollTimeIndex,scope:this}}]},{xtype:"checkbox",boxLabel:"中队历史",labelSeparator:"",name:"rollHonor",listeners:{check:this.onRollHonor,scope:this},items:[{xtype:"numberfield",labelWidth:200,fieldLabel:"每个显示单元停留(秒)",name:"rollTimeHonor",width:50,decimalPrecision:0,minValue:5,allowNegative:false,enableKeyEvents:true,listeners:{keyup:this.onRollTimeHonor,scope:this}}]},{xtype:"checkbox",boxLabel:"辖区图示",labelSeparator:"",name:"rollChart",listeners:{check:this.onRollChart,scope:this},items:[{xtype:"numberfield",labelWidth:200,fieldLabel:"每个显示单元停留(秒)",name:"rollTimeChart",width:50,decimalPrecision:0,minValue:5,allowNegative:false,enableKeyEvents:true,listeners:{keyup:this.onRollTimeChart,scope:this}}]},{xtype:"checkbox",boxLabel:"战备数据",labelSeparator:"",name:"rollData",listeners:{check:this.onRollData,scope:this},items:[{xtype:"numberfield",labelWidth:200,fieldLabel:"每个显示单元停留(秒)",name:"rollTimeData",width:50,decimalPrecision:0,minValue:5,allowNegative:false,enableKeyEvents:true,listeners:{keyup:this.onRollTimeData,scope:this}}]},{xtype:"spacer",height:30},{xtype:"formHtml",hideLabel:true,value:"定时显示菜谱 _____________________________________________________________"},{xtype:"checkbox",boxLabel:"要定时显示菜谱",labelSeparator:"",name:"allowJump",listeners:{check:this.onAllowJump,scope:this}},{labelWidth:130,xtype:"timefield",name:"startTime",editable:false,fieldLabel:"开始显示时间",format:"H:i",width:80,listeners:{change:this.onRecipeStartTime,scope:this},items:[{labelWidth:150,xtype:"timefield",name:"endTime",fieldLabel:"结束显示时间",format:"H:i",editable:false,width:80,listeners:{change:this.onRecipeEndTime,scope:this}}]}]});form.zd.RollSetupForm.superclass.initComponent.call(this)},afterRender:function(){form.zd.RollSetupForm.superclass.afterRender.call(this);Ext.MessageBox.wait("正在加载...","请稍候");var a=function(){var d=utils.zd.getRollSetup();var c=this.getForm();c.findField("rollIndex").setValue(d.indexAllowRoll);c.findField("rollTimeIndex").setValue(d.indexRollTime);c.findField("rollChart").setValue(d.chartAllowRoll);c.findField("rollTimeChart").setValue(d.chartRollTime);c.findField("rollData").setValue(d.dataAllowRoll);c.findField("rollTimeData").setValue(d.dataRollTime);c.findField("rollHonor").setValue(d.honorAllowRoll);c.findField("rollTimeHonor").setValue(d.honorRollTime);if(d.indexAllowRoll&&d.chartAllowRoll&&d.dataAllowRoll&&d.honorAllowRoll){c.findField("rollAll").setValue(true)}var b=utils.zd.getRecipeJumpSetup();c.findField("allowJump").setValue(b.allowJump);c.findField("startTime").setValue(b.startTime);c.findField("endTime").setValue(b.endTime);Ext.MessageBox.hide()};a.defer(100,this)},onRollAll:function(c,b){var a=this.getForm();a.findField("rollIndex").setValue(b);utils.zd.saveSetupValue(utils.zd.INDEX_ALLOW_ROLL,b);a.findField("rollChart").setValue(b);utils.zd.saveSetupValue(utils.zd.CHART_ALLOW_ROLL,b);a.findField("rollData").setValue(b);utils.zd.saveSetupValue(utils.zd.DATA_ALLOW_ROLL,b);a.findField("rollHonor").setValue(b);utils.zd.saveSetupValue(utils.zd.HONOR_ALLOW_ROLL,b)},onRollIndex:function(b,a){utils.zd.saveSetupValue(utils.zd.INDEX_ALLOW_ROLL,a)},onRollTimeIndex:function(b,a){utils.zd.saveSetupValue(utils.zd.INDEX_ROLL_TIME,b.getValue())},onRollChart:function(b,a){utils.zd.saveSetupValue(utils.zd.CHART_ALLOW_ROLL,a)},onRollTimeChart:function(b,a){utils.zd.saveSetupValue(utils.zd.CHART_ROLL_TIME,b.getValue())},onRollData:function(b,a){utils.zd.saveSetupValue(utils.zd.DATA_ALLOW_ROLL,a)},onRollTimeData:function(b,a){utils.zd.saveSetupValue(utils.zd.DATA_ROLL_TIME,b.getValue())},onRollHonor:function(b,a){utils.zd.saveSetupValue(utils.zd.HONOR_ALLOW_ROLL,a)},onRollTimeHonor:function(b,a){utils.zd.saveSetupValue(utils.zd.HONOR_ROLL_TIME,b.getValue())},onAllowJump:function(b,a){utils.zd.saveSetupValue(utils.zd.RECIPE_ALLOW_JUMP,a)},onRecipeStartTime:function(c,b,a){utils.zd.saveSetupValue(utils.zd.RECIPE_JUMP_START_TIME,b)},onRecipeEndTime:function(c,b,a){utils.zd.saveSetupValue(utils.zd.RECIPE_JUMP_END_TIME,b)}});Ext.reg("form.zd.RollSetupForm",form.zd.RollSetupForm);